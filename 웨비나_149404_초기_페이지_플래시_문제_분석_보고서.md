# 웨비나 149404 초기 페이지 플래시 문제 분석 보고서

## 📋 문제 개요

**문제**: `/webinar/149404` 페이지 접속 시 파란색 그라데이션 배경이 있는 초기 페이지가 잠깐 나타났다가 사라지고, 그 후 흰색 배경의 WERT 스타일 페이지가 나타남

**목표**: 초기 페이지 플래시를 제거하고, 처음부터 흰색 배경의 WERT 스타일 페이지가 즉시 표시되도록 함

**영향 페이지**: `http://localhost:3000/webinar/149404`

---

## 🔍 문제 원인 분석

### 1. 스타일 적용 순서 문제

#### 1.1 `globals.css`의 전역 스타일
```css
/* app/globals.css:21-29 */
body {
  color: rgb(var(--foreground-rgb));
  background: linear-gradient(
      to bottom,
      transparent,
      rgb(var(--background-end-rgb))
    )
    rgb(var(--background-start-rgb));
}
```
- **문제**: `body` 태그에 그라데이션 배경이 전역적으로 적용됨
- **영향**: 모든 페이지의 초기 렌더링 시 이 배경이 먼저 표시됨

#### 1.2 Next.js 렌더링 타이밍
- **서버 사이드 렌더링 (SSR)**: HTML이 서버에서 생성될 때 `globals.css`가 먼저 적용됨
- **클라이언트 사이드 하이드레이션**: React가 클라이언트에서 마운트되면서 `styled-jsx` 스타일이 적용됨
- **타이밍 갭**: 이 사이의 짧은 시간 동안 `globals.css`의 그라데이션 배경이 보임

### 2. 조건부 스타일 적용의 한계

#### 2.1 `shouldShowWertStyle` 계산 시점
```typescript
// app/(webinar)/webinar/[id]/components/WebinarEntry.tsx:869-872
const pathname = typeof window !== 'undefined' ? window.location.pathname : ''
const isPath149404 = pathname.includes('/149404')
const shouldShowWertStyle = isPath149404 || String(webinar.slug) === '149404' || ...
```
- **문제**: `window.location.pathname`은 클라이언트 사이드에서만 사용 가능
- **서버 사이드**: `pathname`이 빈 문자열이므로 초기 렌더링 시 조건이 false일 수 있음
- **클라이언트 사이드**: 하이드레이션 후에야 `pathname`이 설정되어 조건이 true가 됨

#### 2.2 `styled-jsx`의 적용 시점
- `styled-jsx`는 컴포넌트가 마운트된 후에 스타일을 주입함
- 초기 HTML에는 `globals.css`의 스타일만 포함되어 있음

### 3. 레이아웃 구조의 영향

#### 3.1 `app/layout.tsx`
```tsx
<body className={`${inter.className} flex flex-col min-h-screen`}>
  <Header />
  <LayoutWrapper>
    <div className="flex-1">
      {children}
    </div>
  </LayoutWrapper>
  <ConditionalFooter />
</body>
```
- `body` 태그에 직접 클래스가 적용되어 있음
- `globals.css`의 `body` 스타일이 우선 적용됨

#### 3.2 `LayoutWrapper.tsx`
```tsx
// 공개 웨비나 페이지는 사이드바 없이 렌더링
if (isPublicPage || isPublicWebinarPage || ...) {
  return <>{children}</>
}
```
- 공개 웨비나 페이지는 사이드바 없이 렌더링되지만, `body`의 배경 스타일은 여전히 적용됨

---

## 🛠️ 시도한 해결 방법

### 방법 1: `shouldShowWertStyle` 조건 강화
**시도 내용**:
- URL 경로에서도 slug 확인 (`isPath149404`)
- 여러 조건을 OR로 연결하여 강화

**결과**: ❌ 실패
- 서버 사이드 렌더링 시 `window` 객체가 없어 `pathname`이 빈 문자열
- 초기 렌더링 시점에 조건이 false로 평가될 수 있음

### 방법 2: 초기 렌더링 시 흰색 배경 강제 적용
**시도 내용**:
```tsx
<style jsx global>{`
  html, body, #__next {
    background-color: #fff !important;
  }
  ${wertStyles}
`}</style>
```

**결과**: ❌ 부분 실패
- `background-color`만으로는 `globals.css`의 `background` 속성을 완전히 덮어쓰지 못함

### 방법 3: `background` 속성도 명시적으로 설정
**시도 내용**:
```tsx
<style jsx global>{`
  html, body, #__next {
    background-color: #fff !important;
    background: #fff !important;
  }
  ${wertStyles}
`}</style>
```

**결과**: ❌ 여전히 실패
- `styled-jsx`가 적용되기 전에 이미 `globals.css`의 스타일이 렌더링됨

### 방법 4: `@import`를 `<link>` 태그로 분리
**시도 내용**:
- `@import`를 별도의 `<link>` 태그로 분리하여 중첩 오류 해결

**결과**: ✅ 빌드 오류 해결, 하지만 플래시 문제는 지속

---

## 💡 근본 원인

1. **CSS 적용 순서**: `globals.css` → 서버 HTML 생성 → 클라이언트 하이드레이션 → `styled-jsx` 적용
2. **타이밍 갭**: 서버에서 생성된 HTML이 브라우저에 전달되고, React가 하이드레이션되기 전까지의 시간 동안 `globals.css`의 스타일이 표시됨
3. **조건부 렌더링의 한계**: 클라이언트 사이드에서만 확인 가능한 값(`window.location.pathname`)에 의존하여 서버 사이드 렌더링 시점에 올바른 스타일을 적용할 수 없음

---

## 🎯 권장 해결 방안

### 방안 1: 서버 사이드에서 스타일 미리 적용 (권장)

#### 1.1 `app/(webinar)/webinar/[id]/page.tsx`에서 조건 확인
```typescript
// 서버 사이드에서 slug 확인
const isWertPage = id === '149404' || webinar?.slug === '149404'

// 조건에 따라 다른 레이아웃 또는 스타일 적용
```

#### 1.2 `app/(webinar)/webinar/[id]/layout.tsx` 생성
```tsx
export default function WebinarLayout({
  children,
  params,
}: {
  children: React.ReactNode
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  
  // 서버 사이드에서 slug 확인
  const isWertPage = id === '149404'
  
  return (
    <>
      {isWertPage && (
        <style dangerouslySetInnerHTML={{
          __html: `
            html, body, #__next {
              background-color: #fff !important;
              background: #fff !important;
            }
          `
        }} />
      )}
      {children}
    </>
  )
}
```

**장점**:
- 서버 사이드에서 스타일이 HTML에 포함되어 전달됨
- 초기 렌더링 시점부터 올바른 스타일이 적용됨
- 플래시 현상 완전 제거

### 방안 2: `globals.css`에서 조건부 스타일 제거

#### 2.1 `globals.css` 수정
```css
/* 웨비나 페이지에서는 그라데이션 배경 제거 */
body:not([data-webinar-page]) {
  background: linear-gradient(...);
}

/* 또는 */
body {
  background: linear-gradient(...);
}

/* 웨비나 페이지용 오버라이드 */
[data-webinar-page="149404"] {
  background: #fff !important;
}
```

#### 2.2 `WebinarEntry` 컴포넌트에서 `data` 속성 추가
```tsx
useEffect(() => {
  if (shouldShowWertStyle) {
    document.body.setAttribute('data-webinar-page', '149404')
  }
}, [shouldShowWertStyle])
```

**장점**:
- 전역 스타일을 조건부로 적용 가능
- 다른 페이지에 영향 없음

**단점**:
- 클라이언트 사이드에서만 적용되므로 여전히 플래시 가능성 있음

### 방안 3: CSS-in-JS 라이브러리 사용

#### 3.1 `styled-components` 또는 `emotion` 도입
- 서버 사이드 렌더링 시 스타일을 HTML에 포함시킬 수 있음
- 초기 렌더링부터 올바른 스타일 적용 가능

**단점**:
- 추가 라이브러리 의존성
- 기존 `styled-jsx`와의 충돌 가능성

### 방안 4: 인라인 스타일로 즉시 적용

#### 4.1 `app/(webinar)/webinar/[id]/page.tsx` 수정
```tsx
export default async function WebinarPage({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params
  const isWertPage = id === '149404'
  
  return (
    <div style={isWertPage ? { backgroundColor: '#fff', background: '#fff' } : {}}>
      <WebinarEntry webinar={webinarData} />
    </div>
  )
}
```

**장점**:
- 간단하고 즉시 적용 가능
- 서버 사이드에서도 작동

**단점**:
- 인라인 스타일은 우선순위가 높지만, `body` 태그에는 직접 적용 불가

---

## 📊 우선순위별 권장 사항

### 즉시 적용 가능 (Quick Win)
1. **방안 4**: 인라인 스타일로 최상위 div에 배경색 적용
2. **방안 2**: `data-webinar-page` 속성 사용

### 근본적 해결 (Long-term)
1. **방안 1**: 서버 사이드 레이아웃에서 스타일 미리 적용 (가장 권장)
2. **방안 3**: CSS-in-JS 라이브러리 도입 (프로젝트 전체 개선 시)

---

## 🔬 추가 디버깅 필요 사항

1. **서버 사이드 렌더링 로그 확인**
   - `webinar.slug` 값이 서버에서 올바르게 전달되는지 확인
   - `shouldShowWertStyle` 계산 로직에 로그 추가

2. **브라우저 개발자 도구 확인**
   - Network 탭에서 초기 HTML 확인
   - Elements 탭에서 스타일 적용 순서 확인
   - Performance 탭에서 렌더링 타이밍 확인

3. **하이드레이션 불일치 확인**
   - React DevTools에서 하이드레이션 경고 확인
   - 서버와 클라이언트의 렌더링 결과 비교

---

## 📝 결론

현재 문제는 **Next.js의 서버 사이드 렌더링과 클라이언트 사이드 하이드레이션 사이의 타이밍 갭**에서 발생합니다. `globals.css`의 전역 스타일이 먼저 적용되고, 이후에 `styled-jsx`로 오버라이드되는 과정에서 플래시가 발생합니다.

**가장 효과적인 해결책**은 서버 사이드에서 조건을 확인하고, HTML 생성 시점에 올바른 스타일을 포함시키는 것입니다. 이를 위해 `layout.tsx`를 활용하거나, 서버 컴포넌트에서 스타일을 직접 주입하는 방법을 권장합니다.

---

**작성일**: 2026-01-25  
**작성자**: AI Assistant  
**관련 파일**:
- `app/(webinar)/webinar/[id]/components/WebinarEntry.tsx`
- `app/(webinar)/webinar/[id]/page.tsx`
- `app/globals.css`
- `app/layout.tsx`
- `components/layout/LayoutWrapper.tsx`
