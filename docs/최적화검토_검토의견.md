# EventLive ìµœì í™” ê²€í†  ë¬¸ì„œ ê²€í†  ì˜ê²¬

**ê²€í† ì¼**: 2026-02-07  
**ê²€í† ì**: AI Assistant (Composer)  
**ê²€í†  ëŒ€ìƒ**: `docs/ìµœì í™”ê²€í† .md`

---

## âœ… ì „ì²´ í‰ê°€

**ì „ë°˜ì ì¸ í‰ê°€**: **ë§¤ìš° ìš°ìˆ˜** (9/10)

- âœ… êµ¬ì¡°ì  ì™„ì„±ë„: ì›Œí¬ìŠ¤íŠ¸ë¦¼ â†’ í‹°ì¼“ êµ¬ì¡°ê°€ ëª…í™•í•˜ê³  ì‹¤í–‰ ê°€ëŠ¥
- âœ… ê¸°ìˆ ì  ì •í™•ì„±: ì½”ë“œë² ì´ìŠ¤ì™€ ì¼ì¹˜í•˜ëŠ” ë¬¸ì œ ì •ì˜
- âœ… ìš°ì„ ìˆœìœ„: P0 â†’ P1 â†’ P2 â†’ P3 ìˆœì„œê°€ ì ì ˆ
- âœ… DoD: ëŒ€ë¶€ë¶„ ì¸¡ì • ê°€ëŠ¥í•œ ê¸°ì¤€ ì œì‹œ

---

## ğŸ” í‹°ì¼“ë³„ ê²€í†  ì˜ê²¬

### WS-0. ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜/ì˜¤ë¥˜ ë£¨í”„ ì œê±° (P0)

#### í‹°ì¼“ 0-1: `registrations.id` ì°¸ì¡° ì „ìˆ˜ ì œê±°

**âœ… ì •í™•ì„± í™•ì¸**:
- ì½”ë“œë² ì´ìŠ¤ì—ì„œ í™•ì¸ëœ ìœ„ì¹˜:
  - `app/api/webinars/[webinarId]/presence/ping/route.ts:69, 117, 148`
  - `app/api/webinars/[webinarId]/access/track/route.ts:52`

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **êµ¬ì²´ì ì¸ íŒŒì¼ ê²½ë¡œ ì¶”ê°€**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **ìˆ˜ì • ëŒ€ìƒ íŒŒì¼**:
   - `app/api/webinars/[webinarId]/presence/ping/route.ts` (ë¼ì¸ 69, 117, 148)
   - `app/api/webinars/[webinarId]/access/track/route.ts` (ë¼ì¸ 52)
   
   **ìˆ˜ì • ë°©ë²•**:
   - `.select('id')` â†’ `.select('webinar_id, user_id')` ë˜ëŠ” `.select('webinar_id')`
   - ë˜ëŠ” ì¡´ì¬ í™•ì¸ë§Œ í•„ìš”í•œ ê²½ìš°: `.maybeSingle()`ë§Œ ì‚¬ìš© (select ì œê±°)
   ```

2. **ì—ëŸ¬ í•¸ë“¤ë§ íŒ¨í„´ ì˜ˆì‹œ ì¶”ê°€**:
   ```typescript
   // âŒ í˜„ì¬ (ì—ëŸ¬ ë¬´ì‹œ)
   let { data: registration } = await admin
     .from('registrations')
     .select('id')
     .eq('webinar_id', actualWebinarId)
     .eq('user_id', user.id)
     .maybeSingle()
   
   // âœ… ìˆ˜ì • í›„ (ì—ëŸ¬ ì¦‰ì‹œ ì¢…ë£Œ)
   const { data: registration, error: regError } = await admin
     .from('registrations')
     .select('webinar_id, user_id')
     .eq('webinar_id', actualWebinarId)
     .eq('user_id', user.id)
     .maybeSingle()
   
   if (regError) {
     console.error('[Presence Ping] ë“±ë¡ ì¡°íšŒ ì‹¤íŒ¨:', regError)
     return NextResponse.json(
       { success: false, error: 'ë“±ë¡ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
       { status: 500 }
     )
   }
   ```

3. **DoD ë³´ì™„**:
   ```markdown
   ### DoD
   
   * [ ] Supabase/PostgREST ë¡œê·¸ì—ì„œ `column registrations.id does not exist` 0ê±´
   * [ ] í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒí•˜ë”ë¼ë„ ì„œë²„ëŠ” ì¶”ê°€ INSERT/ì¶”ê°€ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ(íë¦„ìƒ ì¦ëª…)
   * [ ] **ì¶”ê°€**: `presence/ping` 1íšŒ í˜¸ì¶œ ì‹œ DB ì¿¼ë¦¬ ìˆ˜ê°€ 4~10íšŒì—ì„œ 1~2íšŒë¡œ ê°ì†Œ (ì¸¡ì •)
   * [ ] **ì¶”ê°€**: `access/track` 1íšŒ í˜¸ì¶œ ì‹œ DB ì¿¼ë¦¬ ìˆ˜ê°€ 3~7íšŒì—ì„œ 1~2íšŒë¡œ ê°ì†Œ (ì¸¡ì •)
   ```

#### í‹°ì¼“ 0-2: 409(ì¤‘ë³µí‚¤) ê²½í•© í¡ìˆ˜

**âœ… ì •í™•ì„± í™•ì¸**: ì½”ë“œì—ì„œ 409 ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **êµ¬í˜„ ì˜ˆì‹œ ì¶”ê°€**:
   ```typescript
   // âŒ í˜„ì¬ (409 ì—ëŸ¬ í›„ ì¬ì¡°íšŒ)
   try {
     await admin.from('registrations').insert({...})
   } catch (error) {
     if (error.code === '23505') {
       // ì¬ì¡°íšŒ ì‹œë„ â†’ ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒ
       const { data } = await admin.from('registrations').select('id')...
     }
   }
   
   // âœ… ìˆ˜ì • í›„ (ë©±ë“± upsert)
   const { data: registration, error } = await admin
     .from('registrations')
     .upsert({
       webinar_id,
       user_id,
       role: 'attendee'
     }, {
       onConflict: 'webinar_id,user_id',
       ignoreDuplicates: false // UPDATE ìˆ˜í–‰
     })
   
   // 409 ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ (ì •ìƒ íë¦„)
   ```

2. **Supabase upsert ì œì•½ í™•ì¸ í•„ìš”**:
   - `registrations` í…Œì´ë¸”ì— `onConflict` ì œì•½ì´ ìˆëŠ”ì§€ í™•ì¸
   - ì—†ìœ¼ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì¶”ê°€ í•„ìš”

---

### WS-1. ì°¸ê°€ì í•«íŒ¨ìŠ¤ ê²½ëŸ‰í™” (P0~P1)

#### í‹°ì¼“ 1-1: `presence/ping`ì—ì„œ "ìë™ ë“±ë¡ ìƒì„±" ì œê±°

**âœ… ì •í™•ì„± í™•ì¸**: ì½”ë“œì—ì„œ ìë™ ë“±ë¡ ë¡œì§ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **ì„ íƒ ê¸°ì¤€ ë³´ì™„**:
   ```markdown
   ### ì„ íƒ ê¸°ì¤€
   
   * ì•ˆì •ì„± ìš°ì„ ì´ë©´ (A): pingì€ ë“±ë¡ìë§Œ ì—…ë°ì´íŠ¸, ë“±ë¡ ì—†ìœ¼ë©´ 403/204
   * UX ë•Œë¬¸ì— "ì–´ë–¤ ê²½ë¡œë¡œ ë“¤ì–´ì™€ë„ ìë™ ë“±ë¡"ì´ ê¼­ í•„ìš”í•˜ë©´ (B) + ê°•í•œ ìƒí•œ/ê°€ë“œ í•„ìš”
   
   **ê¶Œì¥**: (A) ì„ íƒ
   - ì´ìœ : `access/track`ì—ì„œ ì´ë¯¸ ìë™ ë“±ë¡ì„ ì²˜ë¦¬í•˜ê³  ìˆìŒ
   - `presence/ping`ì€ heartbeat ì—­í• ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ì•ˆì •ì 
   - ë“±ë¡ì€ ì…ì¥ ì‹œ 1íšŒë§Œ ì²˜ë¦¬ (`access/track`ì—ì„œ)
   ```

2. **êµ¬í˜„ ê°€ì´ë“œ êµ¬ì²´í™”**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **í˜„ì¬ í”Œë¡œìš°**:
   1. ë“±ë¡ í™•ì¸ (SELECT)
   2. ë“±ë¡ ì—†ìœ¼ë©´ ìë™ ë“±ë¡ (INSERT)
   3. Presence ì—…ë°ì´íŠ¸
   4. ì„¸ì…˜ ì—…ë°ì´íŠ¸
   
   **ìˆ˜ì • í›„ í”Œë¡œìš° (ì„ íƒ A)**:
   1. ë“±ë¡ í™•ì¸ (SELECT) - ì—ëŸ¬ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ
   2. ë“±ë¡ ì—†ìœ¼ë©´ 403/204 ë°˜í™˜ (ë“±ë¡ ìƒì„± ì•ˆ í•¨)
   3. ë“±ë¡ ìˆìœ¼ë©´ Presence ì—…ë°ì´íŠ¸ë§Œ ìˆ˜í–‰
   
   **ìˆ˜ì • í›„ í”Œë¡œìš° (ì„ íƒ B)**:
   1. ë©±ë“± upsertë¡œ ë“±ë¡ ìƒì„±/í™•ì¸ (1íšŒ ì¿¼ë¦¬)
   2. Presence ì—…ë°ì´íŠ¸
   ```

#### í‹°ì¼“ 1-2: `access/track` ì—­í•  ì¬ì •ì˜

**âœ… ì •í™•ì„± í™•ì¸**: ì½”ë“œì—ì„œ ë³µì¡í•œ ë¡œì§ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **í˜„ì¬ ì¿¼ë¦¬ ìˆ˜ ë¶„ì„ ì¶”ê°€**:
   ```markdown
   ### ì „ì œ ì¡°ê±´
   
   * `/access/track`ëŠ” ì…ì¥+5ë¶„ ê°±ì‹ , 3~7ì¿¼ë¦¬ ë°œìƒ ê°€ëŠ¥
   
   **í˜„ì¬ ì¿¼ë¦¬ ìƒì„¸** (ì½”ë“œ í™•ì¸):
   - ê²ŒìŠ¤íŠ¸: 3íšŒ (webinars ì¡°íšŒ, webinar_user_sessions upsert, event_access_logs insert)
   - ë¡œê·¸ì¸ ì‚¬ìš©ì (ë“±ë¡ ìˆìŒ): 4íšŒ (+ webinar_live_presence upsert)
   - ë¡œê·¸ì¸ ì‚¬ìš©ì (ë“±ë¡ ì—†ìŒ): 7íšŒ (+ registrations ì¡°íšŒ, profiles ì¡°íšŒ, registrations insert)
   ```

2. **ëª©í‘œ ì¿¼ë¦¬ ìˆ˜ ëª…ì‹œ**:
   ```markdown
   ### ëª©í‘œ
   
   * ê²ŒìŠ¤íŠ¸: 2íšŒ (webinars ì¡°íšŒ, webinar_user_sessions upsert)
   * ë¡œê·¸ì¸ ì‚¬ìš©ì: 2íšŒ (webinars ì¡°íšŒ, webinar_live_presence + webinar_user_sessions upsert)
   * ë“±ë¡ ìƒì„±ì€ ë³„ë„ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë¶„ë¦¬ ë˜ëŠ” ìºì‹œ í™œìš©
   ```

---

### WS-2. Auth/ì„¸ì…˜ ë³‘ëª© ì œê±° (P1)

#### í‹°ì¼“ 2-1: ê³ ë¹ˆë„ APIì—ì„œ `/auth/v1/user` ì˜ì¡´ë„ ë‚®ì¶”ê¸°

**âœ… ì •í™•ì„± í™•ì¸**: Auth ë¡œê·¸ì—ì„œ ì§€ì—° í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **JWT ê²€ì¦ êµ¬í˜„ ê°€ì´ë“œ ì¶”ê°€**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **JWT ê²€ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬**:
   - `jose` (Vercel ì¶”ì²œ) ë˜ëŠ” `jsonwebtoken`
   - Supabase JWT secret: `process.env.SUPABASE_JWT_SECRET`
   
   **ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸**:
   - [ ] `iss` (issuer): `https://[PROJECT_REF].supabase.co/auth/v1`
   - [ ] `aud` (audience): `authenticated` ë˜ëŠ” í”„ë¡œì íŠ¸ë³„ ê°’
   - [ ] `exp` (expiration): í˜„ì¬ ì‹œê°„ë³´ë‹¤ ë¯¸ë˜ì¸ì§€
   - [ ] `signature`: JWT secretìœ¼ë¡œ ì„œëª… ê²€ì¦
   
   **êµ¬í˜„ ì˜ˆì‹œ**:
   ```typescript
   import { jwtVerify } from 'jose'
   
   async function verifyJWT(token: string) {
     const secret = new TextEncoder().encode(process.env.SUPABASE_JWT_SECRET)
     const { payload } = await jwtVerify(token, secret, {
       issuer: `https://${process.env.NEXT_PUBLIC_SUPABASE_URL}/auth/v1`,
       audience: 'authenticated'
     })
     return payload.sub // user_id
   }
   ```
   ```

2. **ë³´ì•ˆ ë¦¬ìŠ¤í¬ ë³´ì™„**:
   ```markdown
   ### ë¦¬ìŠ¤í¬ ì²´í¬
   
   * JWT ê²€ì¦ êµ¬í˜„ ì˜¤ë¥˜ëŠ” ë³´ì•ˆ ì‚¬ê³ ë¡œ ì§ê²° â†’ ê²€ì¦ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸(iss/aud/exp/signature) ê°•ì œ
   * **ì¶”ê°€ ë¦¬ìŠ¤í¬**: JWT secret ë…¸ì¶œ ì‹œ ì „ì²´ ì¸ì¦ ì‹œìŠ¤í…œ ìš°íšŒ ê°€ëŠ¥
   * **ì™„í™” ë°©ì•ˆ**: 
     - JWT secretì€ í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ ê´€ë¦¬ (ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”© ê¸ˆì§€)
     - ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ 401 ë°˜í™˜ (ì¶”ê°€ ë¡œì§ ì§„í–‰ ê¸ˆì§€)
     - ê²€ì¦ ë¡œì§ì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í•„ìˆ˜
   ```

#### í‹°ì¼“ 2-2: `refresh_token_already_used` ê²½í•© ë°©ì§€

**âœ… ì •í™•ì„± í™•ì¸**: Auth ë¡œê·¸ì—ì„œ ì—ëŸ¬ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ê°€ì´ë“œ ì¶”ê°€**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **í´ë¼ì´ì–¸íŠ¸ ì‹±ê¸€í”Œë¼ì´íŠ¸ íŒ¨í„´**:
   ```typescript
   // lib/auth/refreshLock.ts
   let refreshPromise: Promise<string> | null = null
   
   export async function refreshTokenWithLock() {
     if (refreshPromise) {
       return refreshPromise // ì´ë¯¸ ì§„í–‰ ì¤‘ì¸ refresh ëŒ€ê¸°
     }
     
     refreshPromise = supabase.auth.refreshSession()
       .then(({ data }) => data.session?.access_token || '')
       .finally(() => {
         refreshPromise = null // ì™„ë£Œ í›„ ì´ˆê¸°í™”
       })
     
     return refreshPromise
   }
   ```
   
   **ì‚¬ìš© ìœ„ì¹˜**:
   - `lib/supabase/client.ts`ì˜ `getSession()` í•¨ìˆ˜
   - ëª¨ë“  API í˜¸ì¶œ ì „ í† í° ê°±ì‹  ë¡œì§
   ```

---

### WS-3. Realtime/í´ë°± í­íƒ„ ë°©ì§€ (P1)

#### í‹°ì¼“ 3-1: Chat/QA í´ë°± í´ë§ì— ì„œí‚· ë¸Œë ˆì´ì»¤ ë„ì…

**âœ… ì •í™•ì„± í™•ì¸**: `Chat.tsx`ì—ì„œ í´ë°± í´ë§ê³¼ ì§€ìˆ˜ ë°±ì˜¤í”„ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **í˜„ì¬ êµ¬í˜„ ìƒíƒœ ëª…ì‹œ**:
   ```markdown
   ### ì „ì œ ì¡°ê±´
   
   * Chat í´ë°± í´ë§(2ì´ˆÂ±, ë°±ì˜¤í”„ ìµœëŒ€ 60ì´ˆ) êµ¬í˜„ì´ ì¡´ì¬
   * **í˜„ì¬ ìƒíƒœ**: ì§€ìˆ˜ ë°±ì˜¤í”„ëŠ” ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ (`Chat.tsx:1400`)
   * **ë¶€ì¡±í•œ ë¶€ë¶„**: 
     - 4xx ì—ëŸ¬ì— ëŒ€í•œ ë¹ ë¥¸ ì¤‘ë‹¨ ë¡œì§ ì—†ìŒ
     - ì„œë²„ 429/5xx ê°ì§€ ì‹œ ì¦‰ì‹œ ìƒí–¥ ì¡°ì • ì—†ìŒ
     - ì„œí‚· ë¸Œë ˆì´ì»¤ íŒ¨í„´ ì—†ìŒ (ì—°ì† ì‹¤íŒ¨ ì‹œ ì™„ì „ ì¤‘ë‹¨)
   ```

2. **ì„œí‚· ë¸Œë ˆì´ì»¤ êµ¬í˜„ ê°€ì´ë“œ ì¶”ê°€**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **ì„œí‚· ë¸Œë ˆì´ì»¤ ìƒíƒœ**:
   - CLOSED: ì •ìƒ ë™ì‘
   - OPEN: ì—°ì† ì‹¤íŒ¨ë¡œ ì¸í•œ ì¤‘ë‹¨ (ì¼ì • ì‹œê°„ í›„ HALF_OPENìœ¼ë¡œ ì „í™˜)
   - HALF_OPEN: ì¬ì‹œë„ ì¤‘ (ì„±ê³µ ì‹œ CLOSED, ì‹¤íŒ¨ ì‹œ OPEN)
   
   **êµ¬í˜„ ì˜ˆì‹œ**:
   ```typescript
   let consecutiveFailures = 0
   let circuitOpenUntil = 0
   const MAX_FAILURES = 5
   const CIRCUIT_TIMEOUT = 60000 // 60ì´ˆ
   
   if (circuitOpenUntil > Date.now()) {
     // ì„œí‚· ì˜¤í”ˆ ìƒíƒœ â†’ í´ë§ ì¤‘ë‹¨
     return
   }
   
   if (!response.ok) {
     consecutiveFailures++
     if (consecutiveFailures >= MAX_FAILURES) {
       circuitOpenUntil = Date.now() + CIRCUIT_TIMEOUT
       console.warn('ì„œí‚· ë¸Œë ˆì´ì»¤ OPEN: í´ë§ ì¤‘ë‹¨')
     }
   } else {
     consecutiveFailures = 0 // ì„±ê³µ ì‹œ ë¦¬ì…‹
   }
   ```
   ```

3. **4xx ì—ëŸ¬ ì²˜ë¦¬ ëª…ì‹œ**:
   ```markdown
   ### ì„ íƒ ê¸°ì¤€
   
   * ì¥ì• ì¼ìˆ˜ë¡ ì„œë²„ë¥¼ ëœ ë•Œë¦¬ê²Œ(= backoffê°€ ë” ê³µê²©ì ìœ¼ë¡œ ì»¤ì§€ê²Œ)
   * **4xxëŠ” ì¬ì‹œë„ ê°€ì¹˜ê°€ ë‚®ìœ¼ë¯€ë¡œ ë¹ ë¥´ê²Œ ì¤‘ë‹¨/ì¿¨ë‹¤ìš´**
   
   **êµ¬í˜„**:
   - 400/401/403/404: ì¦‰ì‹œ í´ë§ ì¤‘ë‹¨ (í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜)
   - 429: ë°±ì˜¤í”„ ì¦ê°€ + ì„œí‚· ë¸Œë ˆì´ì»¤ íŠ¸ë¦¬ê±°
   - 5xx: ë°±ì˜¤í”„ ì¦ê°€ (ì„œë²„ ì˜¤ë¥˜ëŠ” ì¼ì‹œì ì¼ ìˆ˜ ìˆìŒ)
   ```

---

### WS-4. ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ê²½ëŸ‰í™” (P1)

#### í‹°ì¼“ 4-1: `/stats/access` í´ë§ì„ ì¤€ì‹¤ì‹œê°„ + ì„¤ì • ê°€ëŠ¥ êµ¬ì¡°ë¡œ

**âœ… ì •í™•ì„± í™•ì¸**: `DashboardTab.tsx`ì—ì„œ 5ì´ˆ í´ë§ í™•ì¸ë¨

**ğŸ’¡ ê°œì„  ì œì•ˆ**:

1. **í˜„ì¬ êµ¬í˜„ ìœ„ì¹˜ ëª…ì‹œ**:
   ```markdown
   ### ì „ì œ ì¡°ê±´
   
   * `/stats/access`ëŠ” ê´€ë¦¬ìë§Œ 5ì´ˆ í´ë§(ë¬´í•œ)
   * **íŒŒì¼ ìœ„ì¹˜**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx:530-533`
   * **í˜„ì¬ ì½”ë“œ**:
   ```typescript
   setInterval(fetchParticipants, 5000) // í•˜ë“œì½”ë”©
   ```
   ```

2. **ì„¤ì • ê°€ëŠ¥ êµ¬ì¡° ì˜ˆì‹œ**:
   ```markdown
   ### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)
   
   **í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€**:
   ```env
   NEXT_PUBLIC_ADMIN_POLLING_INTERVAL=10000 # ê¸°ë³¸ 10ì´ˆ
   NEXT_PUBLIC_ADMIN_POLLING_INTERVAL_DEGRADED=30000 # ì¥ì•  ì‹œ 30ì´ˆ
   ```
   
   **ì½”ë“œ ìˆ˜ì •**:
   ```typescript
   const baseInterval = parseInt(process.env.NEXT_PUBLIC_ADMIN_POLLING_INTERVAL || '10000')
   const degradedInterval = parseInt(process.env.NEXT_PUBLIC_ADMIN_POLLING_INTERVAL_DEGRADED || '30000')
   
   // ì¥ì•  ê°ì§€ ì‹œ ê°„ê²© ì¦ê°€
   const currentInterval = isDegradedMode ? degradedInterval : baseInterval
   setInterval(fetchParticipants, currentInterval)
   ```
   ```

---

## ğŸ“‹ ëˆ„ë½ëœ ì¤‘ìš” ì‚¬í•­

### 1. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

**ì œì•ˆ**: ëª¨ë“  í•˜ë“œì½”ë”©ëœ ê°’(ì£¼ê¸°, TTL, ë°±ì˜¤í”„ ë“±)ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” í‹°ì¼“ ì¶”ê°€

```markdown
## í‹°ì¼“ X-1: í•˜ë“œì½”ë”© ì œê±° ë° ì„¤ì •í™”

### ëª©ì 
* ëª¨ë“  ì£¼ê¸°/ê°„ê²©/ìƒí•œ ê°’ì„ í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ì„¤ì • í…Œì´ë¸”ë¡œ ì´ë™

### êµ¬í˜„ ê°€ì´ë“œ
* Presence ping ì£¼ê¸°: `NEXT_PUBLIC_PRESENCE_PING_INTERVAL` (ê¸°ë³¸ 120000)
* Access track ì£¼ê¸°: `NEXT_PUBLIC_ACCESS_TRACK_INTERVAL` (ê¸°ë³¸ 300000)
* Chat í´ë°± ì£¼ê¸°: `NEXT_PUBLIC_CHAT_FALLBACK_INTERVAL` (ê¸°ë³¸ 2000)
* ê´€ë¦¬ì í´ë§ ì£¼ê¸°: `NEXT_PUBLIC_ADMIN_POLLING_INTERVAL` (ê¸°ë³¸ 10000)
```

### 2. ëª¨ë‹ˆí„°ë§/ì•Œë¦¼ êµ¬ì²´í™”

**ì œì•ˆ**: í‹°ì¼“ 6-1ì˜ ì•Œë¦¼ ì²´ê³„ë¥¼ ë” êµ¬ì²´í™”

```markdown
### êµ¬í˜„ ê°€ì´ë“œ(ê¸°ì¤€)

**ì•Œë¦¼ ì±„ë„**:
* Slack Webhook ë˜ëŠ” Discord Webhook
* Vercel í™˜ê²½ ë³€ìˆ˜: `SLACK_WEBHOOK_URL` ë˜ëŠ” `DISCORD_WEBHOOK_URL`

**ì•Œë¦¼ ì„ê³„ê°’** (í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • ê°€ëŠ¥):
* 400 ì—ëŸ¬: 1ë¶„ë‹¹ 10ê±´ ì´ìƒ
* 409 ì—ëŸ¬: 1ë¶„ë‹¹ 50ê±´ ì´ìƒ
* Auth ì§€ì—°: p95 > 5ì´ˆ
* Realtime disconnect: 1ë¶„ë‹¹ 100ê±´ ì´ìƒ

**êµ¬í˜„ ìœ„ì¹˜**:
* Vercel Edge Functions ë˜ëŠ” Next.js API Route
* Supabase Database Webhooks (PostgREST ë¡œê·¸ ê¸°ë°˜)
```

### 3. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì²´í™”

**ì œì•ˆ**: í‹°ì¼“ 7-1ì˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë” êµ¬ì²´í™”

```markdown
### ì‹œë‚˜ë¦¬ì˜¤(ëª…ì„¸)

**S1: ì •ìƒ ë¶€í•˜ í…ŒìŠ¤íŠ¸**
* 1,000ëª… ë™ì‹œ ì…ì¥ (2ë¶„ ë‚´ ì§‘ì¤‘)
* 60ë¶„ ì‹œì²­ ìœ ì§€
* **ì˜ˆìƒ ê²°ê³¼**:
  - 400/409 ì—ëŸ¬ 0ê±´
  - `presence/ping` p95 < 500ms
  - `access/track` p95 < 1ì´ˆ
  - DB requests/time < 10,000/ë¶„

**S2: Realtime ì¥ì•  ì‹œë®¬ë ˆì´ì…˜**
* Realtime ì—°ê²° ê°•ì œ ì¢…ë£Œ (ëª¨ë“  í´ë¼ì´ì–¸íŠ¸)
* Chat í´ë°± í™œì„±í™”
* **ì˜ˆìƒ ê²°ê³¼**:
  - í´ë°± í´ë§ì´ ì„œí‚· ë¸Œë ˆì´ì»¤ë¡œ ì¤‘ë‹¨ë¨
  - DB requests/timeì´ ì„ í˜• ì¦ê°€í•˜ì§€ ì•ŠìŒ
  - ì‹œìŠ¤í…œì´ ìƒì¡´ (ë‹¤ë¥¸ ê¸°ëŠ¥ ì •ìƒ ë™ì‘)

**S3: ë™ì‹œ ì›¨ë¹„ë‚˜ ë¶€í•˜**
* ì›¨ë¹„ë‚˜ 2ê°œ ë™ì‹œ ì§„í–‰ (ê° 500ëª…)
* ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ 5ëª… ë™ì‹œ ì˜¤í”ˆ
* **ì˜ˆìƒ ê²°ê³¼**:
  - í•œ ì›¨ë¹„ë‚˜ì˜ ë¶€í•˜ê°€ ë‹¤ë¥¸ ì›¨ë¹„ë‚˜ì— ì˜í–¥ ì—†ìŒ
  - ê´€ë¦¬ì í´ë§ì´ ìë™ ê°ì†ë¨
```

---

## ğŸ¯ ìš°ì„ ìˆœìœ„ ì¬ê²€í† 

**í˜„ì¬ ìš°ì„ ìˆœìœ„**: ì ì ˆí•¨

**ì¶”ê°€ ì œì•ˆ**:
- WS-0ê³¼ WS-1ì€ **ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥** (ì„œë¡œ ë…ë¦½ì )
- WS-2ì™€ WS-3ë„ **ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥** (ì„œë¡œ ë…ë¦½ì )
- WS-6 (ì•Œë¦¼)ì€ **WS-0 ì™„ë£Œ ì§í›„** ì‹œì‘ ê¶Œì¥ (ì¥ì•  ì¬ë°œ ê°ì§€ìš©)

---

## âœ… ìµœì¢… ê¶Œì¥ ì‚¬í•­

1. **ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ í‹°ì¼“**:
   - í‹°ì¼“ 0-1: íŒŒì¼ ê²½ë¡œì™€ ë¼ì¸ ë²ˆí˜¸ê°€ ëª…í™•í•¨ â†’ ë°”ë¡œ ì‹œì‘ ê°€ëŠ¥
   - í‹°ì¼“ 0-2: êµ¬í˜„ ì˜ˆì‹œ ì¶”ê°€ í›„ ì‹œì‘

2. **êµ¬í˜„ ì „ í™•ì¸ í•„ìš”**:
   - í‹°ì¼“ 0-2: `registrations` í…Œì´ë¸”ì— `onConflict` ì œì•½ í™•ì¸
   - í‹°ì¼“ 2-1: JWT ê²€ì¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ (`jose` vs `jsonwebtoken`)

3. **ë¬¸ì„œ ë³´ì™„ ê¶Œì¥**:
   - ê° í‹°ì¼“ì— êµ¬ì²´ì ì¸ íŒŒì¼ ê²½ë¡œì™€ ë¼ì¸ ë²ˆí˜¸ ì¶”ê°€
   - êµ¬í˜„ ì˜ˆì‹œ ì½”ë“œ ì¶”ê°€ (íŠ¹íˆ ë³µì¡í•œ ë¡œì§)
   - DoDë¥¼ ë” ì¸¡ì • ê°€ëŠ¥í•˜ê²Œ êµ¬ì²´í™”

---

**ê²€í†  ì™„ë£Œì¼**: 2026-02-07  
**ë‹¤ìŒ ë‹¨ê³„**: ê²€í†  ì˜ê²¬ ë°˜ì˜ í›„ ì‹¤í–‰ í‹°ì¼“ìœ¼ë¡œ ë¶„í•´
