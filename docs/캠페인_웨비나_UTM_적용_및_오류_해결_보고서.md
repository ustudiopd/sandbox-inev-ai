# ê´‘ê³ /ìº í˜ì¸ ë§í¬ ë° ì „í™˜ ì¶”ì  ì‹œìŠ¤í…œ êµ¬í˜„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2026-01-28  
**ë²„ì „**: 2.0 (ê²€í†  ë³´ì™„ë³¸)  
**ì‘ì„±ì**: AI Assistant

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ë¬¸ì œ ìƒí™©](#ë¬¸ì œ-ìƒí™©)
3. [êµ¬í˜„ ë‚´ìš©](#êµ¬í˜„-ë‚´ìš©)
4. [ë°œê²¬ëœ ì´ìŠˆ ë° í•´ê²°](#ë°œê²¬ëœ-ì´ìŠˆ-ë°-í•´ê²°)
5. [ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°](#ë°ì´í„°ë² ì´ìŠ¤-êµ¬ì¡°)
6. [API ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ì‚¬í•­](#api-ì—”ë“œí¬ì¸íŠ¸-ë³€ê²½ì‚¬í•­)
7. [í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­](#í”„ë¡ íŠ¸ì—”ë“œ-ë³€ê²½ì‚¬í•­)
8. [ì „í™˜ ì¶”ì  ì‹œìŠ¤í…œ](#ì „í™˜-ì¶”ì -ì‹œìŠ¤í…œ)
9. [êµ¬ì¡°ì  ë¦¬ìŠ¤í¬ ë° ê°œì„  ê¶Œì¥ì‚¬í•­](#êµ¬ì¡°ì -ë¦¬ìŠ¤í¬-ë°-ê°œì„ -ê¶Œì¥ì‚¬í•­)
10. [í–¥í›„ ê°œì„  ì‚¬í•­](#í–¥í›„-ê°œì„ -ì‚¬í•­)
11. [ì²´í¬ë¦¬ìŠ¤íŠ¸](#ì²´í¬ë¦¬ìŠ¤íŠ¸)

---

## 1. ê°œìš”

### 1.1 ëª©ì 
ê´‘ê³  ìº í˜ì¸ ë§í¬ ìƒì„± ì‹œìŠ¤í…œì— ì›¨ë¹„ë‚˜ ì§€ì›ì„ ì¶”ê°€í•˜ê³ , ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ êµ¬ë¶„í•˜ì—¬ UTM íŒŒë¼ë¯¸í„° ì¶”ì  ë° ì „í™˜ ì¶”ì ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ë„ë¡ ê°œì„ 

### 1.2 ë²”ìœ„
- ìº í˜ì¸ ë§í¬ ìƒì„± UI ê°œì„ 
- ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ì§€ì› ì¶”ê°€
- ì „í™˜ ì¶”ì  ì‹œìŠ¤í…œ í™•ì¥
- URL ìƒì„± ë¡œì§ ê°œì„ 
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

---

## 2. ë¬¸ì œ ìƒí™©

### 2.1 ì´ˆê¸° ë¬¸ì œì 

1. **ì›¨ë¹„ë‚˜ê°€ ìº í˜ì¸ ì„ íƒ ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŒ**
   - ìº í˜ì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ì›¨ë¹„ë‚˜ê°€ í¬í•¨ë˜ì§€ ì•Šì•„ ì›¨ë¹„ë‚˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ë§í¬ ìƒì„± ë¶ˆê°€

2. **ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ ì „í™˜ ì¶”ì  ë¶ˆê°€**
   - ì›¨ë¹„ë‚˜ ë“±ë¡ì€ `registrations` í…Œì´ë¸”ì—ë§Œ ì €ì¥
   - `event_survey_entries` í…Œì´ë¸” ê¸°ë°˜ ì „í™˜ ì§‘ê³„ì— í¬í•¨ë˜ì§€ ì•ŠìŒ
   - `marketing_campaign_link_id` í•„ë“œê°€ `registrations` í…Œì´ë¸”ì— ì—†ìŒ

3. **ëœë”© ìœ„ì¹˜ ì˜µì…˜ ë¶ˆì¼ì¹˜**
   - ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œì—ë„ ìº í˜ì¸ìš© ëœë”© ìœ„ì¹˜ ì˜µì…˜(ì„¤ë¬¸ í˜ì´ì§€ ë“±)ì´ í‘œì‹œë¨
   - ì›¨ë¹„ë‚˜ëŠ” ì„¤ë¬¸ í˜ì´ì§€ê°€ ì—†ëŠ”ë° ì˜µì…˜ì— í¬í•¨ë¨

4. **URL ìƒì„± ì˜¤ë¥˜**
   - ì›¨ë¹„ë‚˜ URLì— `/event` ì ‘ë‘ì‚¬ê°€ ì˜ëª» ì¶”ê°€ë¨
   - ì›¨ë¹„ë‚˜ slug ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±

5. **500 ì—ëŸ¬ ë°œìƒ**
   - ë§í¬ ìƒì„± ì‹œ 500 Internal Server Error ë°œìƒ
   - ì—ëŸ¬ ë¡œê¹… ë¶€ì¡±ìœ¼ë¡œ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€

---

## 3. êµ¬í˜„ ë‚´ìš©

### 3.1 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ í™•ì¥

#### 3.1.1 `campaign_link_meta` í…Œì´ë¸” í™•ì¥
**ë§ˆì´ê·¸ë ˆì´ì…˜**: `072_add_webinar_support_to_campaign_link_meta.sql`

```sql
-- target_type í•„ë“œ ì¶”ê°€
ALTER TABLE public.campaign_link_meta
  ADD COLUMN IF NOT EXISTS target_type TEXT DEFAULT 'campaign';

-- target_campaign_idë¥¼ nullableë¡œ ë³€ê²½
ALTER TABLE public.campaign_link_meta
  ALTER COLUMN target_campaign_id DROP NOT NULL;

-- target_webinar_id í•„ë“œ ì¶”ê°€
ALTER TABLE public.campaign_link_meta
  ADD COLUMN IF NOT EXISTS target_webinar_id UUID REFERENCES public.webinars(id) ON DELETE CASCADE;

-- ì œì•½ ì¡°ê±´ ì¶”ê°€
ALTER TABLE public.campaign_link_meta
  ADD CONSTRAINT check_target_type_campaign 
    CHECK (
      (target_type = 'campaign' AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL) OR
      (target_type = 'webinar' AND target_webinar_id IS NOT NULL AND target_campaign_id IS NULL) OR
      (target_type IS NULL AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL)
    );
```

**âš ï¸ ì œì•½ ì¡°ê±´ ê°œì„  ê¶Œì¥ì‚¬í•­** (9.1.1 ì°¸ì¡°):
- í˜„ì¬ êµ¬ì¡°ëŠ” legacy í˜¸í™˜ì„ ìœ„í•´ `target_type IS NULL` ì¼€ì´ìŠ¤ë¥¼ í—ˆìš©í•˜ì§€ë§Œ, ìš´ì˜ ì‹œ í˜¼ë€ì„ ì¤„ ìˆ˜ ìˆìŒ
- ê¶Œì¥: `target_type`ì„ NOT NULLë¡œ ê°•ì œí•˜ê³ , enum ìˆ˜ì¤€ìœ¼ë¡œ ëª…í™•íˆ ì •ì˜

#### 3.1.2 `registrations` í…Œì´ë¸” í™•ì¥
**ë§ˆì´ê·¸ë ˆì´ì…˜**: `077_add_marketing_campaign_link_id_to_registrations.sql`

```sql
-- marketing_campaign_link_id í•„ë“œ ì¶”ê°€
ALTER TABLE public.registrations
  ADD COLUMN IF NOT EXISTS marketing_campaign_link_id UUID 
    REFERENCES public.campaign_link_meta(id) ON DELETE SET NULL;

-- ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_registrations_marketing_campaign_link_id 
  ON public.registrations(marketing_campaign_link_id)
  WHERE marketing_campaign_link_id IS NOT NULL;
```

### 3.2 API ë³€ê²½ì‚¬í•­

#### 3.2.1 ìº í˜ì¸ ëª©ë¡ API (`/api/event-survey/campaigns/list`)
**ë³€ê²½ ë‚´ìš©**:
- ì›¨ë¹„ë‚˜ ëª©ë¡ë„ í•¨ê»˜ ì¡°íšŒí•˜ì—¬ ë°˜í™˜
- ì›¨ë¹„ë‚˜ë¥¼ ìº í˜ì¸ í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ í†µí•© ëª©ë¡ ì œê³µ

```typescript
// ì›¨ë¹„ë‚˜ ëª©ë¡ ì¡°íšŒ
const { data: webinars } = await admin
  .from('webinars')
  .select('id, title, slug, created_at')
  .eq('client_id', clientId)
  .order('created_at', { ascending: false })

// ì›¨ë¹„ë‚˜ë¥¼ ìº í˜ì¸ í˜•íƒœë¡œ ë³€í™˜
const webinarsAsCampaigns = (webinars || []).map(webinar => ({
  id: webinar.id,
  title: webinar.title || `ì›¨ë¹„ë‚˜ ${webinar.slug || webinar.id.slice(0, 8)}`,
  type: 'webinar' as const,
  slug: webinar.slug,
  created_at: webinar.created_at,
  public_path: webinar.slug ? `/${webinar.slug}` : null,
  stats: {
    total_completed: 0,
    total_verified: 0,
    total_prize_recorded: 0,
  }
}))

// ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ í•©ì³ì„œ ë°˜í™˜
const allItems = [...campaignsWithStats, ...webinarsAsCampaigns]
```

#### 3.2.2 ë§í¬ ìƒì„± API (`/api/clients/[clientId]/campaigns/links`)
**ë³€ê²½ ë‚´ìš©**:
- ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ì§€ì› ì¶”ê°€
- íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¥¸ URL ìƒì„± ë¡œì§ ë¶„ê¸°
- ì›¨ë¹„ë‚˜ ì „í™˜ ì¶”ì  ì§€ì›

**ì£¼ìš” ë¡œì§**:
```typescript
// íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ID ì„¤ì •
if (target_type === 'campaign') {
  insertData.target_campaign_id = target_campaign_id && target_campaign_id.trim() ? target_campaign_id : null
  insertData.target_webinar_id = null
} else if (target_type === 'webinar') {
  insertData.target_webinar_id = target_webinar_id && target_webinar_id.trim() ? target_webinar_id : null
  insertData.target_campaign_id = null
}

// URL ìƒì„± ì‹œ íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ë¶„ê¸°
if (target_type === 'webinar' && target_webinar_id) {
  // ì›¨ë¹„ë‚˜ URL: /webinar/{slug} ë˜ëŠ” /webinar/{slug}/register
  const webinarPath = webinar?.slug ? `/webinar/${webinar.slug}` : `/webinar/${target_webinar_id}`
  landingPath = landing_variant === 'register' 
    ? `${webinarPath}/register` 
    : webinarPath
} else {
  // ìº í˜ì¸ URL: /event/{public_path} ë˜ëŠ” /event/{public_path}/register
  landingPath = landing_variant === 'welcome' 
    ? targetCampaign.public_path
    : landing_variant === 'survey'
    ? `${targetCampaign.public_path}/survey`
    : `${targetCampaign.public_path}/register`
}

// ì›¨ë¹„ë‚˜ëŠ” /event ì ‘ë‘ì‚¬ ì—†ì´, ìº í˜ì¸ì€ /event ì ‘ë‘ì‚¬ ì‚¬ìš©
const shareUrl = target_type === 'webinar' 
  ? `${baseUrl}${landingPath}?${shareParams.toString()}`
  : `${baseUrl}/event${landingPath}?${shareParams.toString()}`
```

#### 3.2.3 ë§í¬ ëª©ë¡ API (`GET /api/clients/[clientId]/campaigns/links`)
**ë³€ê²½ ë‚´ìš©**:
- ì›¨ë¹„ë‚˜ íƒ€ê²Ÿì˜ ì „í™˜ ìˆ˜ë¥¼ `registrations` í…Œì´ë¸”ì—ì„œ ì§‘ê³„
- ìº í˜ì¸ íƒ€ê²Ÿì˜ ì „í™˜ ìˆ˜ë¥¼ `event_survey_entries` í…Œì´ë¸”ì—ì„œ ì§‘ê³„

```typescript
// íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ì „í™˜ ìˆ˜ ì§‘ê³„
if (link.target_type === 'webinar') {
  const { count: webinarCount } = await admin
    .from('registrations')
    .select('*', { count: 'exact', head: true })
    .eq('marketing_campaign_link_id', link.id)
  count = webinarCount || 0
} else {
  const { count: campaignCount } = await admin
    .from('event_survey_entries')
    .select('*', { count: 'exact', head: true })
    .eq('marketing_campaign_link_id', link.id)
  count = campaignCount || 0
}
```

**âš ï¸ ì„±ëŠ¥ ê°œì„  ê¶Œì¥ì‚¬í•­** (9.1.5 ì°¸ì¡°):
- í˜„ì¬ êµ¬ì¡°ëŠ” N+1 ì¿¼ë¦¬ íŒ¨í„´ìœ¼ë¡œ, ë§í¬ê°€ ë§ì•„ì§€ë©´ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥
- ê¶Œì¥: Phase 4 ë˜ëŠ” íŠ¸ë˜í”½ ì¦ê°€ ì‹œ link_id ê¸°ì¤€ group-by ì§‘ê³„ RPCë¡œ í†µí•© ì˜ˆì •

#### 3.2.4 ë“±ë¡ API (`/api/public/event-survey/[campaignId]/register`)
**ë³€ê²½ ë‚´ìš©**:
- ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ `marketing_campaign_link_id` ì €ì¥

```typescript
// registrations í…Œì´ë¸”ì— ë“±ë¡
const { error: regError } = await admin
  .from('registrations')
  .insert({
    webinar_id: webinar.id,
    user_id: profile.id,
    role: 'attendee',
    nickname: name ? name.trim() || null : null,
    registered_via: 'manual',
    registration_data: cleanedRegistrationData,
    // ë§ˆì¼€íŒ… ìº í˜ì¸ ë§í¬ ì¶”ì  (ì „í™˜ ì¶”ì ìš©)
    marketing_campaign_link_id: resolvedMarketingCampaignLinkId || null,
  })
```

### 3.3 í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­

#### 3.3.1 ìº í˜ì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ê°œì„ 
**íŒŒì¼**: `app/(client)/client/[clientId]/campaigns/components/CampaignLinksTab.tsx`

**ë³€ê²½ ë‚´ìš©**:
- ìº í˜ì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ì›¨ë¹„ë‚˜ë„ í•¨ê»˜ í‘œì‹œ
- ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ íƒ€ê²Ÿ íƒ€ì… ë³€ê²½
- ì›¨ë¹„ë‚˜ëŠ” `[ì›¨ë¹„ë‚˜]` ì ‘ë‘ì‚¬ë¡œ êµ¬ë¶„ í‘œì‹œ

```typescript
// ìº í˜ì¸ ì„ íƒ í•¸ë“¤ëŸ¬ (ì›¨ë¹„ë‚˜ë„ í¬í•¨)
const handleCampaignChange = (selectedId: string) => {
  const isWebinar = webinars.some(w => w.id === selectedId)
  
  if (isWebinar) {
    setTargetType('webinar')
    setFormData(prev => ({ 
      ...prev, 
      target_webinar_id: selectedId, 
      target_campaign_id: '',
      landing_variant: prev.landing_variant === 'survey' ? 'welcome' : prev.landing_variant
    }))
  } else {
    setTargetType('campaign')
    setFormData(prev => ({ ...prev, target_campaign_id: selectedId, target_webinar_id: '' }))
  }
}

// ë“œë¡­ë‹¤ìš´ ë Œë”ë§
<select>
  <option value="">ìº í˜ì¸ ì„ íƒ</option>
  {/* ìº í˜ì¸ í‘œì‹œ */}
  {campaigns.map(campaign => (
    <option key={campaign.id} value={campaign.id}>
      {campaign.title}
    </option>
  ))}
  {/* ì›¨ë¹„ë‚˜ë„ í•¨ê»˜ í‘œì‹œ */}
  {webinars.map(webinar => (
    <option key={webinar.id} value={webinar.id}>
      [ì›¨ë¹„ë‚˜] {webinar.title}
    </option>
  ))}
</select>
```

#### 3.3.2 ëœë”© ìœ„ì¹˜ ì˜µì…˜ ê°œì„ 
**ë³€ê²½ ë‚´ìš©**:
- ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œ: "ì›¨ë¹„ë‚˜ ì…ì¥ í˜ì´ì§€", "ë“±ë¡ í˜ì´ì§€"ë§Œ í‘œì‹œ
- ìº í˜ì¸ ì„ íƒ ì‹œ: "Welcome í˜ì´ì§€", "ë“±ë¡ í˜ì´ì§€", "ì„¤ë¬¸ í˜ì´ì§€" í‘œì‹œ

```typescript
<select value={formData.landing_variant}>
  {targetType === 'webinar' ? (
    <>
      <option value="welcome">ì›¨ë¹„ë‚˜ ì…ì¥ í˜ì´ì§€</option>
      <option value="register">ë“±ë¡ í˜ì´ì§€</option>
    </>
  ) : (
    <>
      <option value="welcome">Welcome í˜ì´ì§€</option>
      <option value="register">ë“±ë¡ í˜ì´ì§€</option>
      <option value="survey">ì„¤ë¬¸ í˜ì´ì§€</option>
    </>
  )}
</select>
```

#### 3.3.3 ë§í¬ ìƒì„± ë¡œì§ ê°œì„ 
**ë³€ê²½ ë‚´ìš©**:
- ì„ íƒëœ IDê°€ ì›¨ë¹„ë‚˜ì¸ì§€ ìë™ ê°ì§€
- íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ì˜¬ë°”ë¥¸ í•„ë“œ ì „ì†¡
- ê´‘ê³  ì‹œì‘ì¼ ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •

```typescript
const handleCreateLink = async (e: React.FormEvent) => {
  // ì„ íƒëœ IDê°€ ì›¨ë¹„ë‚˜ì¸ì§€ í™•ì¸í•˜ì—¬ íƒ€ê²Ÿ íƒ€ì… ê²°ì •
  const selectedId = formData.target_campaign_id || formData.target_webinar_id
  const isWebinar = webinars.some(w => w.id === selectedId)
  const finalTargetType = isWebinar ? 'webinar' : 'campaign'
  
  const requestBody = {
    ...formData,
    target_type: finalTargetType,
    target_campaign_id: finalTargetType === 'campaign' ? selectedId : null,
    target_webinar_id: finalTargetType === 'webinar' ? selectedId : null,
  }
}
```

---

## 4. ë°œê²¬ëœ ì´ìŠˆ ë° í•´ê²°

### 4.1 ì´ìŠˆ 1: ì›¨ë¹„ë‚˜ê°€ ìº í˜ì¸ ëª©ë¡ì— í‘œì‹œë˜ì§€ ì•ŠìŒ

**ë¬¸ì œ**:
- ìº í˜ì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ì›¨ë¹„ë‚˜ê°€ í¬í•¨ë˜ì§€ ì•ŠìŒ
- ì›¨ë¹„ë‚˜ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ í•˜ëŠ” ë§í¬ ìƒì„± ë¶ˆê°€

**í•´ê²°**:
- ìº í˜ì¸ ëª©ë¡ APIì— ì›¨ë¹„ë‚˜ë„ í¬í•¨í•˜ì—¬ ë°˜í™˜
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ í•¨ê»˜ í‘œì‹œ
- ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ íƒ€ê²Ÿ íƒ€ì… ë³€ê²½

**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

### 4.2 ì´ìŠˆ 2: ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ ì „í™˜ ì¶”ì  ë¶ˆê°€

**ë¬¸ì œ**:
- ì›¨ë¹„ë‚˜ ë“±ë¡ì€ `registrations` í…Œì´ë¸”ì—ë§Œ ì €ì¥
- `marketing_campaign_link_id` í•„ë“œê°€ ì—†ì–´ ì „í™˜ ì¶”ì  ë¶ˆê°€
- ë§í¬ ëª©ë¡ì—ì„œ ì „í™˜ ìˆ˜ê°€ 0ìœ¼ë¡œ í‘œì‹œë¨

**í•´ê²°**:
- `registrations` í…Œì´ë¸”ì— `marketing_campaign_link_id` í•„ë“œ ì¶”ê°€ (ë§ˆì´ê·¸ë ˆì´ì…˜ 077)
- ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ `marketing_campaign_link_id` ì €ì¥
- ë§í¬ ëª©ë¡ APIì—ì„œ ì›¨ë¹„ë‚˜ íƒ€ê²Ÿì€ `registrations` í…Œì´ë¸”ì—ì„œ ì§‘ê³„

**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

**âš ï¸ êµ¬ì¡°ì  ë¦¬ìŠ¤í¬**: í˜„ì¬ êµ¬ì¡°ëŠ” ê¸°ìˆ ì ìœ¼ë¡œ ë™ì‘í•˜ì§€ë§Œ, ê´‘ê³  ì„±ê³¼ ë¶„ì„ ê´€ì ì—ì„œ ë¦¬ìŠ¤í¬ê°€ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [9.1.1 ì „í™˜ ê·€ì† ê¸°ì¤€ í†µí•©](#91-êµ¬ì¡°ì -ë¦¬ìŠ¤í¬-ë°-ê°œì„ -ê¶Œì¥ì‚¬í•­) ì°¸ì¡°.

### 4.3 ì´ìŠˆ 3: ëœë”© ìœ„ì¹˜ ì˜µì…˜ ë¶ˆì¼ì¹˜

**ë¬¸ì œ**:
- ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œì—ë„ "ì„¤ë¬¸ í˜ì´ì§€" ì˜µì…˜ì´ í‘œì‹œë¨
- ì›¨ë¹„ë‚˜ëŠ” ì„¤ë¬¸ í˜ì´ì§€ê°€ ì—†ëŠ”ë° ì˜µì…˜ì— í¬í•¨ë¨

**í•´ê²°**:
- íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ëœë”© ìœ„ì¹˜ ì˜µì…˜ ë™ì  ë³€ê²½
- ì›¨ë¹„ë‚˜: "ì›¨ë¹„ë‚˜ ì…ì¥ í˜ì´ì§€", "ë“±ë¡ í˜ì´ì§€"
- ìº í˜ì¸: "Welcome í˜ì´ì§€", "ë“±ë¡ í˜ì´ì§€", "ì„¤ë¬¸ í˜ì´ì§€"

**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

### 4.4 ì´ìŠˆ 4: URL ìƒì„± ì˜¤ë¥˜

**ë¬¸ì œ**:
- ì›¨ë¹„ë‚˜ URLì— `/event` ì ‘ë‘ì‚¬ê°€ ì˜ëª» ì¶”ê°€ë¨
- ì›¨ë¹„ë‚˜ slug ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±
- `.single()` ì‚¬ìš©ìœ¼ë¡œ ë°ì´í„° ì—†ì„ ë•Œ ì—ëŸ¬ ë°œìƒ

**í•´ê²°**:
- ì›¨ë¹„ë‚˜ URL: `/webinar/{slug}` ë˜ëŠ” `/webinar/{slug}/register` (ì ‘ë‘ì‚¬ ì—†ìŒ)
- ìº í˜ì¸ URL: `/event/{public_path}` ë˜ëŠ” `/event/{public_path}/register` (ì ‘ë‘ì‚¬ ìˆìŒ)
- `.single()` â†’ `.maybeSingle()`ë¡œ ë³€ê²½í•˜ì—¬ ì—ëŸ¬ ë°©ì§€
- ì›¨ë¹„ë‚˜/ìº í˜ì¸ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜

**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

### 4.5 ì´ìŠˆ 5: 500 ì—ëŸ¬ ë°œìƒ

**ë¬¸ì œ**:
- ë§í¬ ìƒì„± ì‹œ 500 Internal Server Error ë°œìƒ
- ì—ëŸ¬ ë¡œê¹… ë¶€ì¡±ìœ¼ë¡œ ì›ì¸ íŒŒì•… ì–´ë ¤ì›€
- ë¹ˆ ë¬¸ìì—´ì´ nullë¡œ ë³€í™˜ë˜ì§€ ì•Šì•„ ì œì•½ ì¡°ê±´ ìœ„ë°˜ ê°€ëŠ¥

**í•´ê²°**:
- ë¹ˆ ë¬¸ìì—´ì„ nullë¡œ ë³€í™˜í•˜ëŠ” ë¡œì§ ì¶”ê°€
- ì—ëŸ¬ ë¡œê¹… ê°•í™” (ì½”ë“œ, ë©”ì‹œì§€, ìƒì„¸ ì •ë³´)
- ì œì•½ ì¡°ê±´ ìœ„ë°˜ ì˜¤ë¥˜ ì²˜ë¦¬ ì¶”ê°€
- URL ìƒì„± ë¶€ë¶„ì— try-catch ì¶”ê°€
- ì¤‘ë³µëœ return ë¬¸ ì œê±°

**ìƒíƒœ**: âœ… í•´ê²° ì™„ë£Œ

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### 5.1 `campaign_link_meta` í…Œì´ë¸”

```sql
CREATE TABLE public.campaign_link_meta (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  agency_id UUID,
  client_id UUID NOT NULL,
  name TEXT NOT NULL,
  target_type TEXT DEFAULT 'campaign', -- 'campaign' ë˜ëŠ” 'webinar'
  target_campaign_id UUID REFERENCES public.event_survey_campaigns(id) ON DELETE CASCADE, -- nullable
  target_webinar_id UUID REFERENCES public.webinars(id) ON DELETE CASCADE, -- nullable
  landing_variant TEXT, -- 'welcome', 'register', 'survey'
  cid TEXT NOT NULL, -- ì™¸ë¶€ ê³µìœ ìš© ìº í˜ì¸ ë§í¬ ì‹ë³„ì (short_link_idì™€ 1:1 ë§¤í•‘)
  utm_source TEXT,
  utm_medium TEXT,
  utm_campaign TEXT,
  utm_term TEXT,
  utm_content TEXT,
  start_date TIMESTAMPTZ,
  status TEXT DEFAULT 'active', -- 'active', 'paused', 'archived'
  created_by UUID REFERENCES public.profiles(id),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  
  -- ì œì•½ ì¡°ê±´
  CONSTRAINT check_target_type_campaign CHECK (
    (target_type = 'campaign' AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL) OR
    (target_type = 'webinar' AND target_webinar_id IS NOT NULL AND target_campaign_id IS NULL) OR
    (target_type IS NULL AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL)
  ),
  CONSTRAINT uniq_campaign_link_meta_name_client UNIQUE (client_id, name),
  CONSTRAINT uniq_campaign_link_meta_cid_client UNIQUE (client_id, cid)
);
```

**ì£¼ìš” í•„ë“œ ì„¤ëª…**:
- **`cid`**: ì™¸ë¶€ ê³µìœ ìš© ìº í˜ì¸ ë§í¬ ì‹ë³„ì. URL querystring ë° ì „í™˜ ì¶”ì ì˜ ê¸°ì¤€ í‚¤ë¡œ ì‚¬ìš©ë¨. 
  - **ìš´ì˜ ê·œì¹™**: cidëŠ” ì™¸ë¶€ ê³µìœ ìš© ì‹ë³„ìì´ë©°, ìƒˆ ë§í¬ëŠ” ë°˜ë“œì‹œ cidë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¶”ì í•©ë‹ˆë‹¤.
  - short_link_idê°€ ë”°ë¡œ ìˆë”ë¼ë„ "ë§ˆì¼€íŒ… ì¶”ì ì˜ ê¸°ì¤€ í‚¤ëŠ” cid"ë¡œ ê³ ì •ë©ë‹ˆë‹¤.
  - ì½”ë“œì—ì„œëŠ” normalizeCID()ë¥¼ ëª¨ë“  ì§„ì…ì ì—ì„œ ë™ì¼í•˜ê²Œ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- **`target_type`**: íƒ€ê²Ÿ íƒ€ì… ('campaign' ë˜ëŠ” 'webinar'). í˜„ì¬ëŠ” nullableì´ì§€ë§Œ, ìš´ì˜ ì‹œ NOT NULLë¡œ ê°•ì œ ê¶Œì¥.

### 5.2 `registrations` í…Œì´ë¸” í™•ì¥

```sql
ALTER TABLE public.registrations
  ADD COLUMN marketing_campaign_link_id UUID 
    REFERENCES public.campaign_link_meta(id) ON DELETE SET NULL;

CREATE INDEX idx_registrations_marketing_campaign_link_id 
  ON public.registrations(marketing_campaign_link_id)
  WHERE marketing_campaign_link_id IS NOT NULL;
```

### 5.3 ë°ì´í„° íë¦„

```
ì‚¬ìš©ì í´ë¦­
  â†“
ë§í¬ ì ‘ê·¼ (cid + UTM í¬í•¨)
  â†“
ëœë”© í˜ì´ì§€ (ìº í˜ì¸ ë˜ëŠ” ì›¨ë¹„ë‚˜)
  â†“
ë“±ë¡ ì™„ë£Œ
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ìº í˜ì¸ íƒ€ê²Ÿ    â”‚   ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ event_survey_   â”‚ registrations   â”‚
â”‚ entries ì €ì¥    â”‚ í…Œì´ë¸” ì €ì¥      â”‚
â”‚                 â”‚                 â”‚
â”‚ marketing_      â”‚ marketing_      â”‚
â”‚ campaign_link_  â”‚ campaign_link_  â”‚
â”‚ id ì €ì¥         â”‚ id ì €ì¥         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
ì „í™˜ ì§‘ê³„ (íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ë¶„ê¸°)
  â†“
ë§í¬ë³„ ì „í™˜ ìˆ˜ í‘œì‹œ
```

**âš ï¸ í˜„ì¬ êµ¬ì¡°ì˜ í•œê³„**:
- ì „í™˜ ì§‘ê³„ê°€ íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ë‘ í…Œì´ë¸”ë¡œ ë¶„ê¸°ë¨
- ê´‘ê³  ì„±ê³¼ ë¶„ì„ ì‹œ ë³µì¡ë„ ì¦ê°€
- ê¶Œì¥ ê°œì„  ë°©ì•ˆì€ [9.1.1 ì „í™˜ ê·€ì† ê¸°ì¤€ í†µí•©](#91-êµ¬ì¡°ì -ë¦¬ìŠ¤í¬-ë°-ê°œì„ -ê¶Œì¥ì‚¬í•­) ì°¸ì¡°

---

## 6. API ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ì‚¬í•­

### 6.1 GET `/api/event-survey/campaigns/list`

**ë³€ê²½ ì „**:
- ìº í˜ì¸ë§Œ ë°˜í™˜

**ë³€ê²½ í›„**:
- ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ í†µí•©í•˜ì—¬ ë°˜í™˜
- ê° í•­ëª©ì— `type: 'campaign' | 'webinar'` í•„ë“œ ì¶”ê°€

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "success": true,
  "campaigns": [
    {
      "id": "campaign-uuid",
      "title": "ìº í˜ì¸ ì œëª©",
      "type": "campaign",
      "public_path": "/campaign-path",
      "stats": { ... }
    },
    {
      "id": "webinar-uuid",
      "title": "ì›¨ë¹„ë‚˜ ì œëª©",
      "type": "webinar",
      "slug": "426307",
      "stats": { ... }
    }
  ],
  "webinars": [ ... ] // ê¸°ì¡´ í˜¸í™˜ì„± ìœ ì§€
}
```

### 6.2 POST `/api/clients/[clientId]/campaigns/links`

**ë³€ê²½ ì‚¬í•­**:
- `target_type` í•„ë“œ ì§€ì› ('campaign' ë˜ëŠ” 'webinar')
- `target_webinar_id` í•„ë“œ ì§€ì›
- ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ì‹œ URL ìƒì„± ë¡œì§ ë¶„ê¸°
- ì›¨ë¹„ë‚˜ slug ì¡°íšŒ ë° ì—ëŸ¬ ì²˜ë¦¬
- **íƒ€ê²Ÿ ì†Œì† ê²€ì¦ ê°•ì œ**: `target_webinar_id`ì™€ `target_campaign_id`ê°€ í•´ë‹¹ `client_id`ì— ì†í•˜ëŠ”ì§€ ê²€ì¦ (ë³´ì•ˆ/ë°ì´í„° ì˜¤ì—¼ ë°©ì§€)

**ìš”ì²­ ì˜ˆì‹œ**:
```json
{
  "name": "ì›¨ë¹„ë‚˜ ë“±ë¡ ë§í¬",
  "target_type": "webinar",
  "target_webinar_id": "webinar-uuid",
  "target_campaign_id": null,
  "landing_variant": "register",
  "utm_source": "facebook",
  "utm_medium": "social",
  "utm_campaign": "webinar-registration",
  "start_date": "2026-01-28"
}
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "id": "link-uuid",
  "name": "ì›¨ë¹„ë‚˜ ë“±ë¡ ë§í¬",
  "target_type": "webinar",
  "target_webinar_id": "webinar-uuid",
  "cid": "ABC123",
  "url": "https://eventflow.kr/webinar/426307/register?cid=ABC123&utm_source=facebook&utm_medium=social&utm_campaign=webinar-registration",
  "share_url": "https://eventflow.kr/webinar/426307/register?cid=ABC123",
  "campaign_url": "https://eventflow.kr/webinar/426307/register?cid=ABC123&utm_source=facebook&utm_medium=social&utm_campaign=webinar-registration"
}
```

### 6.3 GET `/api/clients/[clientId]/campaigns/links`

**ë³€ê²½ ì‚¬í•­**:
- ì›¨ë¹„ë‚˜ íƒ€ê²Ÿì˜ ì „í™˜ ìˆ˜ë¥¼ `registrations` í…Œì´ë¸”ì—ì„œ ì§‘ê³„
- ìº í˜ì¸ íƒ€ê²Ÿì˜ ì „í™˜ ìˆ˜ë¥¼ `event_survey_entries` í…Œì´ë¸”ì—ì„œ ì§‘ê³„
- ì›¨ë¹„ë‚˜ URL ìƒì„± ì‹œ `/event` ì ‘ë‘ì‚¬ ì œê±°
- **í˜ì´ì§• ì§€ì›**: ê¸°ë³¸ limit 50, ìµœëŒ€ 100, offset íŒŒë¼ë¯¸í„° ì§€ì›
- **ìƒíƒœ í•„í„°**: `?status=active` íŒŒë¼ë¯¸í„°ë¡œ í™œì„± ë§í¬ë§Œ ì¡°íšŒ ê°€ëŠ¥
- **ì‘ë‹µì— pagination ì •ë³´ í¬í•¨**: `{ links: [], pagination: { total, limit, offset, hasMore } }`

### 6.4 POST `/api/public/event-survey/[campaignId]/register`

**ë³€ê²½ ì‚¬í•­**:
- ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ `marketing_campaign_link_id` ì €ì¥
- `cid` íŒŒë¼ë¯¸í„°ë¡œ ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ë§í¬ ì¡°íšŒ ì§€ì›

---

## 7. í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­

### 7.1 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
CampaignLinksTab
â”œâ”€â”€ ìº í˜ì¸/ì›¨ë¹„ë‚˜ ì„ íƒ ë“œë¡­ë‹¤ìš´ (í†µí•©)
â”œâ”€â”€ ëœë”© ìœ„ì¹˜ ì„ íƒ (íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ë™ì  ë³€ê²½)
â”œâ”€â”€ UTM íŒŒë¼ë¯¸í„° ì…ë ¥
â””â”€â”€ ë§í¬ ìƒì„±/ìˆ˜ì • í¼
```

### 7.2 ìƒíƒœ ê´€ë¦¬

```typescript
// íƒ€ê²Ÿ íƒ€ì… ìƒíƒœ
const [targetType, setTargetType] = useState<'campaign' | 'webinar'>('campaign')

// í¼ ë°ì´í„° ìƒíƒœ
const [formData, setFormData] = useState({
  name: '',
  target_campaign_id: '',
  target_webinar_id: '',
  landing_variant: 'register',
  start_date: new Date().toISOString().split('T')[0], // ì˜¤ëŠ˜ ë‚ ì§œ
  // ... UTM íŒŒë¼ë¯¸í„°
})

// ìº í˜ì¸/ì›¨ë¹„ë‚˜ ëª©ë¡ ìƒíƒœ
const [campaigns, setCampaigns] = useState<Campaign[]>([])
const [webinars, setWebinars] = useState<Webinar[]>([])
```

### 7.3 ì£¼ìš” ë¡œì§

#### 7.3.1 ë°ì´í„° ë¡œë“œ
```typescript
const loadData = async () => {
  // ìº í˜ì¸ ëª©ë¡ ì¡°íšŒ (ì›¨ë¹„ë‚˜ í¬í•¨)
  const campaignsResponse = await fetch(`/api/event-survey/campaigns/list?clientId=${clientId}`)
  const campaignsResult = await campaignsResponse.json()
  
  if (campaignsResponse.ok && campaignsResult.campaigns) {
    // ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì €ì¥
    const campaignItems = campaignsResult.campaigns
      .filter((c: any) => c.type === 'campaign')
      .map((c: any) => ({ ...c, type: 'campaign' as const }))
    
    const webinarItems = campaignsResult.campaigns
      .filter((c: any) => c.type === 'webinar')
      .map((c: any) => ({ ...c, type: 'webinar' as const }))
    
    setCampaigns(campaignItems)
    setWebinars(webinarItems)
  }
}
```

#### 7.3.2 ë§í¬ ìƒì„±
```typescript
const handleCreateLink = async (e: React.FormEvent) => {
  const selectedId = formData.target_campaign_id || formData.target_webinar_id
  const isWebinar = webinars.some(w => w.id === selectedId)
  const finalTargetType = isWebinar ? 'webinar' : 'campaign'
  
  const requestBody = {
    ...formData,
    target_type: finalTargetType,
    target_campaign_id: finalTargetType === 'campaign' ? selectedId : null,
    target_webinar_id: finalTargetType === 'webinar' ? selectedId : null,
  }
  
  // API í˜¸ì¶œ
}
```

---

## 8. ì „í™˜ ì¶”ì  ì‹œìŠ¤í…œ

### 8.1 ì „í™˜ ì¶”ì  íë¦„

```
1. ì‚¬ìš©ìê°€ ë§í¬ í´ë¦­
   â†“
2. URLì— cid + UTM íŒŒë¼ë¯¸í„° í¬í•¨
   ì˜ˆ: /webinar/426307/register?cid=ABC123&utm_source=facebook&utm_medium=social
   â†“
3. ë“±ë¡ í˜ì´ì§€ì—ì„œ cid íŒŒë¼ë¯¸í„° ì½ê¸°
   â†“
4. campaign_link_meta í…Œì´ë¸”ì—ì„œ ë§í¬ ì¡°íšŒ
   - client_id + cidë¡œ ì¡°íšŒ
   - target_typeê³¼ target_idë¡œ ê²€ì¦
   â†“
5. ë“±ë¡ ì™„ë£Œ ì‹œ marketing_campaign_link_id ì €ì¥
   - ìº í˜ì¸: event_survey_entries í…Œì´ë¸”
   - ì›¨ë¹„ë‚˜: registrations í…Œì´ë¸”
   â†“
6. ë§í¬ ëª©ë¡ì—ì„œ ì „í™˜ ìˆ˜ ì§‘ê³„
   - ìº í˜ì¸: event_survey_entriesì—ì„œ ì§‘ê³„
   - ì›¨ë¹„ë‚˜: registrationsì—ì„œ ì§‘ê³„
```

### 8.2 Visit ì¶”ì  ë° Dedup ì •ì±…

**Visit ì •ì˜ (ì •í™•íˆ í•œ ë¬¸ì¥ìœ¼ë¡œ ê³ ì •)**:
- **Visits = session_id ê¸°ì¤€, íƒ€ê²Ÿë‹¹ 1íšŒ ì§‘ê³„**
- í•˜ë‚˜ì˜ `session_id`ëŠ” í•˜ë‚˜ì˜ ìº í˜ì¸ì— ëŒ€í•´ ìµœëŒ€ 1íšŒ Visitìœ¼ë¡œ ì§‘ê³„ë©ë‹ˆë‹¤.
- API ë ˆë²¨ì˜ ì¤‘ë³µ ë°©ì§€ ë¡œì§ì€ DB write í­ì£¼ ë°©ì§€ìš©ì´ë©°, ì§‘ê³„ ê¸°ì¤€ì€ `session_id` ê¸°ì¤€ì…ë‹ˆë‹¤.

**êµ¬í˜„**:
- Visit API (`/api/public/campaigns/[campaignId]/visit`)ì—ì„œ `session_id` ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
- `event_access_logs` í…Œì´ë¸”ì— Visit ê¸°ë¡ ì €ì¥
- ì „í™˜ ë°œìƒ ì‹œ `converted_at`ê³¼ `entry_id` ì—…ë°ì´íŠ¸

**âš ï¸ ìš´ì˜ ê·œì¹™**:
- API ë ˆë²¨ì˜ 5ë¶„ ìŠ¤í‚µì€ "ì“°ê¸° í­ì£¼ ë°©ì§€ìš©"ì…ë‹ˆë‹¤.
- RPC ì§‘ê³„ëŠ” "ì„¸ì…˜ë³„ 1íšŒ" ê¸°ì¤€ì…ë‹ˆë‹¤.
- ì´ëŠ” ì˜ë„ëœ ì„¤ê³„ì´ë©°, API ë ˆë²¨ì˜ dedupì€ ì„±ëŠ¥ ìµœì í™”ìš©ì…ë‹ˆë‹¤.
- KPI ì˜ì—­ì— "Visits = session_id ê¸°ì¤€, íƒ€ê²Ÿë‹¹ 1íšŒ ì§‘ê³„"ë¥¼ ì‘ê²Œ í‘œì‹œ ê¶Œì¥

### 8.3 ì „í™˜ ì¶”ì  ì½”ë“œ

#### 8.3.1 ë“±ë¡ APIì—ì„œ ë§í¬ ì¡°íšŒ
```typescript
// cidë¡œ ë§í¬ lookup
let resolvedMarketingCampaignLinkId: string | null = marketing_campaign_link_id || null
if (cid && !resolvedMarketingCampaignLinkId) {
  const normalizedCid = normalizeCID(cid)
  if (normalizedCid) {
    let linkQuery = admin
      .from('campaign_link_meta')
      .select('id, target_type, target_campaign_id, target_webinar_id')
      .eq('client_id', campaign.client_id)
      .eq('cid', normalizedCid)
      .eq('status', 'active')
    
    // ì›¨ë¹„ë‚˜ IDì¸ ê²½ìš°
    if (isWebinarId) {
      linkQuery = linkQuery
        .eq('target_type', 'webinar')
        .eq('target_webinar_id', campaignId)
    } else {
      // ìº í˜ì¸ IDì¸ ê²½ìš°
      linkQuery = linkQuery
        .or(`target_type.is.null,target_type.eq.campaign`)
        .eq('target_campaign_id', campaignId)
    }
    
    const { data: link } = await linkQuery.maybeSingle()
    if (link) {
      resolvedMarketingCampaignLinkId = link.id
    }
  }
}
```

#### 8.3.2 ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ ë§í¬ ID ì €ì¥
```typescript
// registrations í…Œì´ë¸”ì— ë“±ë¡
const { error: regError } = await admin
  .from('registrations')
  .insert({
    webinar_id: webinar.id,
    user_id: profile.id,
    role: 'attendee',
    registered_via: 'manual',
    registration_data: cleanedRegistrationData,
    marketing_campaign_link_id: resolvedMarketingCampaignLinkId || null, // ì „í™˜ ì¶”ì 
  })
```

#### 8.3.3 ì „í™˜ ìˆ˜ ì§‘ê³„
```typescript
// ë§í¬ ëª©ë¡ ì¡°íšŒ ì‹œ ì „í™˜ ìˆ˜ ì§‘ê³„
const linksWithStats = await Promise.all(
  (links || []).map(async (link) => {
    let count = 0
    
    if (link.target_type === 'webinar') {
      // ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ: registrations í…Œì´ë¸”ì—ì„œ ì§‘ê³„
      const { count: webinarCount } = await admin
        .from('registrations')
        .select('*', { count: 'exact', head: true })
        .eq('marketing_campaign_link_id', link.id)
      count = webinarCount || 0
    } else {
      // ìº í˜ì¸ íƒ€ê²Ÿ: event_survey_entries í…Œì´ë¸”ì—ì„œ ì§‘ê³„
      const { count: campaignCount } = await admin
        .from('event_survey_entries')
        .select('*', { count: 'exact', head: true })
        .eq('marketing_campaign_link_id', link.id)
      count = campaignCount || 0
    }
    
    return {
      ...link,
      conversion_count: count,
      // ... URL ì •ë³´
    }
  })
)
```

---

## 9. êµ¬ì¡°ì  ë¦¬ìŠ¤í¬ ë° ê°œì„  ê¶Œì¥ì‚¬í•­

### 9.1 êµ¬ì¡°ì  ë¦¬ìŠ¤í¬ ë° ê°œì„  ê¶Œì¥ì‚¬í•­

#### 9.1.1 âš ï¸ ì „í™˜ ê·€ì† ê¸°ì¤€ í†µí•© (í–¥í›„ í†µí•© ì„¤ê³„)

**í˜„ì¬ ìš´ì˜ ë²„ì „ (v2.0)ì˜ ê²½ê³„**:
- **í˜„ì¬ v2.0ì€ ìº í˜ì¸/ì›¨ë¹„ë‚˜ ì „í™˜ì„ ì„œë¡œ ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì§‘ê³„í•©ë‹ˆë‹¤.**
  - ìº í˜ì¸ íƒ€ê²Ÿ â†’ `event_survey_entries` í…Œì´ë¸”ì— ì €ì¥
  - ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ â†’ `registrations` í…Œì´ë¸”ì— ì €ì¥
  - ë§í¬ ëª©ë¡ APIì—ì„œ íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¼ ì§‘ê³„ í…Œì´ë¸”ì„ ë¶„ê¸°
- **ëŒ€ì‹œë³´ë“œì—ì„œ í•©ì‚° ì§€í‘œ í•´ì„ ì‹œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.**
  - UIì—ì„œ "ìº í˜ì¸ ì „í™˜(ë“±ë¡/ì„¤ë¬¸ ì œì¶œ)" vs "ì›¨ë¹„ë‚˜ ì „í™˜(ì›¨ë¹„ë‚˜ ë“±ë¡)"ìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„ í‘œì‹œ
  - í•©ì‚° KPIê°€ ìˆë‹¤ë©´ "ì´ ì „í™˜(ì •ì˜ ìƒì´)" ê²½ê³  ë¬¸êµ¬ í‘œì‹œ

**í˜„ì¬ êµ¬ì¡°ì˜ í•œê³„**:
ê´‘ê³ /ìº í˜ì¸ í˜ì´ì§€ì—ì„œ ë³´ê³  ì‹¶ì€ ì§ˆë¬¸ì€ í•­ìƒ ì´ê²ƒì…ë‹ˆë‹¤:

> "ì´ ê´‘ê³  ë§í¬ë¡œ **ëª‡ ëª…ì´ ì „í™˜ëë‚˜?**"

ì—¬ê¸°ì„œ ì „í™˜ì´ ì–´ë–¤ ê²½ìš°ì—” `event_survey_entries`, ì–´ë–¤ ê²½ìš°ì—” `registrations`ë¡œ ê°ˆë¼ì§€ë©´:
- CVR ê³„ì‚°ì´ ë³µì¡í•´ì§
- Source/Medium/Campaign ì§‘ê³„ê°€ ë³µì¡í•´ì§
- ë‚ ì§œ í•„í„°ê°€ ë³µì¡í•´ì§
- Rollup/RPC í™•ì¥ì´ ë³µì¡í•´ì§
- ëª¨ë“  ë¡œì§ì´ ë‘ ê°ˆë˜ë¡œ ë¶„ê¸°ë¨

**í–¥í›„ í†µí•© ì„¤ê³„ (ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥í•œ ì‹œì ì— ì ìš©)**:

**ê´‘ê³  ì „í™˜ì˜ ê¸°ì¤€ í…Œì´ë¸”ì€ `event_survey_entries` í•˜ë‚˜ë¡œ í†µí•©**

ì›¨ë¹„ë‚˜ ë§í¬ë¼ë„:
- "ì›¨ë¹„ë‚˜ ë“±ë¡ ë°œìƒ ì‹œ"
- **`event_survey_entries`ì— ëŒ€ì‘ë˜ëŠ” ì „í™˜ ë ˆì½”ë“œë¥¼ ìƒì„±**
- `registrations`ëŠ” "ì°¸ì—¬/ìš´ì˜ìš©"ìœ¼ë¡œë§Œ ì‚¬ìš©

**êµ¬í˜„ ë°©ë²•**:
1. ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ `webinar.registration_campaign_id`ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìº í˜ì¸ì˜ `event_survey_entries`ì— ë ˆì½”ë“œ ìƒì„±
2. `registration_campaign_id`ê°€ ì—†ìœ¼ë©´ ì›¨ë¹„ë‚˜ ì „ìš© ìº í˜ì¸ì„ ìë™ ìƒì„±í•˜ê±°ë‚˜, ê¸°ì¡´ ìº í˜ì¸ê³¼ ì—°ê²°
3. ì „í™˜ ì§‘ê³„ëŠ” í•­ìƒ `event_survey_entries`ì—ì„œ ìˆ˜í–‰
4. `registrations`ëŠ” ì›¨ë¹„ë‚˜ ì°¸ì—¬/ìš´ì˜ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©

**ì¥ì **:
- ê´‘ê³  ì„±ê³¼ ì§‘ê³„ëŠ” í•­ìƒ `event_survey_entries` í•˜ë‚˜
- ì›¨ë¹„ë‚˜/ìº í˜ì¸ ë¶„ê¸° ë¡œì§ ì œê±°
- RPC/ëŒ€ì‹œë³´ë“œê°€ ë‹¨ìˆœí•´ì§
- í™•ì¥ì„± í–¥ìƒ

**ì£¼ì˜ì‚¬í•­**:
- ì´ê±´ "ë‚˜ì¤‘ì— ê³ ì¹˜ê¸° ì–´ë ¤ìš´ êµ¬ì¡°"ë¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥í•œ ì‹œì ì— ì ìš© ê¶Œì¥
- ê¸°ì¡´ ì›¨ë¹„ë‚˜ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”

#### 9.1.2 âš ï¸ Visit Dedup ì •ì±… ëª…í™•í™”

**í˜„ì¬ ìƒíƒœ**:
- API ë ˆë²¨: `session_id` ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
- ì§‘ê³„ ë ˆë²¨: ì„¸ì…˜ë³„ ì²« ë°©ë¬¸ë§Œ ì§‘ê³„

**ë¬¸ì œì **:
- ë‘ ë¬¸ì¥ì´ ì‚´ì§ ì¶©ëŒí•  ìˆ˜ ìˆìŒ
- íŠ¹ì • ì¼€ì´ìŠ¤ì—ì„œ APIì—ëŠ” ì—¬ëŸ¬ ë¡œê·¸ê°€ ìˆê³ , ì§‘ê³„ëŠ” 1íšŒë§Œ ì¡íˆëŠ” êµ¬ì¡°ê°€ ë  ìˆ˜ ìˆìŒ

**ê¶Œì¥ ë³´ì™„**:
ë¬¸ì„œì— ì•„ë˜ë¥¼ **ëª…ì‹œì ìœ¼ë¡œ ê³ ì •**:

```text
Visit ì •ì˜:
- í•˜ë‚˜ì˜ session_idëŠ” í•˜ë‚˜ì˜ ìº í˜ì¸ì— ëŒ€í•´ ìµœëŒ€ 1íšŒ Visitìœ¼ë¡œ ì§‘ê³„ëœë‹¤.
- API ë ˆë²¨ì˜ ì¤‘ë³µ ë°©ì§€ ë¡œì§ì€ DB write í­ì£¼ ë°©ì§€ìš©ì´ë©°,
  ì§‘ê³„ ê¸°ì¤€ì€ session_id ê¸°ì¤€ì´ë‹¤.
```

ì´ë ‡ê²Œ ì ì–´ë‘ë©´ **ì˜ë„ëœ ë¶ˆì¼ì¹˜ê°€ ì•„ë‹ˆë¼ ì„¤ê³„ëœ ë¶ˆì¼ì¹˜**ê°€ ë©ë‹ˆë‹¤.

#### 9.1.3 âš ï¸ `campaign_link_meta` ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™”

**í˜„ì¬ ì œì•½ ì¡°ê±´**:
```sql
CONSTRAINT check_target_type_campaign CHECK (
  (target_type = 'campaign' AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL) OR
  (target_type = 'webinar' AND target_webinar_id IS NOT NULL AND target_campaign_id IS NULL) OR
  (target_type IS NULL AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL)
)
```

**ë¬¸ì œì **:
- `target_type IS NULL` ì¼€ì´ìŠ¤ëŠ” legacy í˜¸í™˜ìš©ìœ¼ë¡œ ë³´ì´ì§€ë§Œ, ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” í˜¼ë€ë§Œ ì¤Œ

**ê¶Œì¥ ìˆ˜ì •**:
- `target_type`ëŠ” **NOT NULL**ë¡œ ê°•ì œ
- enum ìˆ˜ì¤€ìœ¼ë¡œ ëª…í™•íˆ: `target_type = 'campaign' | 'webinar'`
- ì²´í¬ ì œì•½ì€ **ë”± ë‘ ì¼€ì´ìŠ¤ë§Œ í—ˆìš©**:
  - `campaign` â†’ `target_campaign_id NOT NULL`
  - `webinar` â†’ `target_webinar_id NOT NULL`

**ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆì‹œ**:
```sql
-- ê¸°ì¡´ ë°ì´í„° ì •ë¦¬
UPDATE campaign_link_meta 
SET target_type = 'campaign' 
WHERE target_type IS NULL;

-- NOT NULL ì œì•½ ì¶”ê°€
ALTER TABLE campaign_link_meta 
  ALTER COLUMN target_type SET NOT NULL;

-- ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™”
ALTER TABLE campaign_link_meta 
  DROP CONSTRAINT check_target_type_campaign;

ALTER TABLE campaign_link_meta 
  ADD CONSTRAINT check_target_type_campaign CHECK (
    (target_type = 'campaign' AND target_campaign_id IS NOT NULL AND target_webinar_id IS NULL) OR
    (target_type = 'webinar' AND target_webinar_id IS NOT NULL AND target_campaign_id IS NULL)
  );
```

#### 9.1.4 âš ï¸ `cid`ì˜ ì—­í•  ëª…í™•í™”

**í˜„ì¬ ë¬¸ì„œì˜ ìƒíƒœ**:
- `cid` = ë§í¬ ì‹ë³„ì
- `short_link_id`ì™€ëŠ” ë³„ë„ ê°œë…ì²˜ëŸ¼ ë³´ì„

**ì‹¤ì œ ì½”ë“œ íë¦„**:
- `cid`ê°€ ì‚¬ì‹¤ìƒ **public short identifier** ì—­í• 

**ê¶Œì¥ ë³´ì™„**:
ë¬¸ì„œì— ëª…í™•íˆ ì ì–´ë‘ì„¸ìš”:

```text
cidëŠ” ì™¸ë¶€ ê³µìœ ìš© ìº í˜ì¸ ë§í¬ ì‹ë³„ìì´ë©°,
short_link_idì™€ 1:1 ë§¤í•‘ëœë‹¤.
cidëŠ” URL querystring ë° ì „í™˜ ì¶”ì ì˜ ê¸°ì¤€ í‚¤ë¡œ ì‚¬ìš©ëœë‹¤.
```

ì•ˆ ì ì–´ë‘ë©´ ë‚˜ì¤‘ì—:
- "ì™œ short_linksì—ë„ codeê°€ ìˆê³  cidë„ ìˆì§€?" ë¼ëŠ” ì§ˆë¬¸ì´ ë‚˜ì˜µë‹ˆë‹¤.

#### 9.1.5 âš ï¸ ëŒ€ì‹œë³´ë“œ ì§‘ê³„ APIì˜ N+1 ìœ„í—˜

**í˜„ì¬ êµ¬ì¡°**:
```typescript
Promise.all(
  links.map(async (link) => {
    registrations.count(...)
  })
)
```

**ë¬¸ì œì **:
- ë§í¬ê°€ ë§ì•„ì§€ë©´ **N+1 ì¿¼ë¦¬ í­íƒ„** ë©ë‹ˆë‹¤.

**ì¦‰ì‹œ ë³´ì™„ (ë§ˆì´ê·¸ë ˆì´ì…˜ ì—†ì´ ê°€ëŠ¥)**:
- ë§í¬ ëª©ë¡ APIì— ê¸°ë³¸ limit (ì˜ˆ: 50, ìµœëŒ€ 100) ì ìš© âœ…
- ë‚ ì§œ í•„í„°/ìƒíƒœ í•„í„°(í™œì„±ë§Œ) ì§€ì› âœ…
- UIì—ì„œ "ìµœê·¼ ìƒì„± ìˆœ" ê¸°ë³¸ ì •ë ¬ âœ…
- í˜ì´ì§€ë„¤ì´ì…˜(ìµœì†Œ next) ë˜ëŠ” "ë” ë³´ê¸°" ì§€ì› ê¶Œì¥

**í–¥í›„ ê°œì„  (Phase 4 ë˜ëŠ” íŠ¸ë˜í”½ ì¦ê°€ ì‹œ)**:
- **link_id ê¸°ì¤€ group-by ì§‘ê³„ RPCë¡œ í†µí•© ì˜ˆì •**
- í˜„ì¬ ë°©ì‹ì€ ì´ˆê¸° ìš´ì˜ìš©ì´ë©°, ìƒí•œì„ /í˜ì´ì§•ìœ¼ë¡œ í­ë°œ ë°©ì§€

**ê°œì„  ë°©ì•ˆ**:
```sql
-- RPC í•¨ìˆ˜ ì˜ˆì‹œ
CREATE OR REPLACE FUNCTION get_link_conversion_stats(client_id_param UUID)
RETURNS TABLE (
  link_id UUID,
  conversion_count BIGINT
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    marketing_campaign_link_id as link_id,
    COUNT(*) as conversion_count
  FROM event_survey_entries
  WHERE marketing_campaign_link_id IN (
    SELECT id FROM campaign_link_meta WHERE client_id = client_id_param
  )
  GROUP BY marketing_campaign_link_id
  
  UNION ALL
  
  SELECT 
    marketing_campaign_link_id as link_id,
    COUNT(*) as conversion_count
  FROM registrations
  WHERE marketing_campaign_link_id IN (
    SELECT id FROM campaign_link_meta WHERE client_id = client_id_param
  )
  GROUP BY marketing_campaign_link_id;
END;
$$ LANGUAGE plpgsql;
```

---

## 10. í–¥í›„ ê°œì„  ì‚¬í•­

### 10.1 ë‹¨ê¸° ê°œì„  (ìš°ì„ ìˆœìœ„ ë†’ìŒ)

1. **ì „í™˜ ì§‘ê³„ ê¸°ì¤€ í…Œì´ë¸” í†µí•©** (ê°€ì¥ ì¤‘ìš”)
   - ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ `event_survey_entries`ì—ë„ ë ˆì½”ë“œ ìƒì„±
   - ì „í™˜ ì§‘ê³„ëŠ” í•­ìƒ `event_survey_entries`ì—ì„œ ìˆ˜í–‰
   - ìì„¸í•œ ë‚´ìš©ì€ [9.1.1 ì „í™˜ ê·€ì† ê¸°ì¤€ í†µí•©](#91-êµ¬ì¡°ì -ë¦¬ìŠ¤í¬-ë°-ê°œì„ -ê¶Œì¥ì‚¬í•­) ì°¸ì¡°

2. **ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™”**
   - `target_type`ì„ NOT NULLë¡œ ê°•ì œ
   - legacy í˜¸í™˜ ì¼€ì´ìŠ¤ ì œê±°
   - ìì„¸í•œ ë‚´ìš©ì€ [9.1.3 ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™”](#913-campaign_link_meta-ì œì•½-ì¡°ê±´-ë‹¨ìˆœí™”) ì°¸ì¡°

3. **ì—ëŸ¬ ë©”ì‹œì§€ ê°œì„ **
   - ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
   - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì—ëŸ¬ ìƒì„¸ ì •ë³´ í‘œì‹œ

4. **ê²€ì¦ ê°•í™”**
   - ì›¨ë¹„ë‚˜ slug ì¡´ì¬ ì—¬ë¶€ ì‚¬ì „ ê²€ì¦
   - ìº í˜ì¸ public_path ì¡´ì¬ ì—¬ë¶€ ì‚¬ì „ ê²€ì¦

5. **ë¡œê¹… ê°œì„ **
   - êµ¬ì¡°í™”ëœ ë¡œê¹… ì‹œìŠ¤í…œ ë„ì…
   - ì—ëŸ¬ ì¶”ì ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸ ì €ì¥

### 10.2 ì¤‘ê¸° ê°œì„  (ìš°ì„ ìˆœìœ„ ì¤‘ê°„)

1. **ëŒ€ì‹œë³´ë“œ ê°œì„ **
   - ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ë§í¬ì˜ ì „í™˜ìœ¨ í‘œì‹œ
   - ìº í˜ì¸/ì›¨ë¹„ë‚˜ êµ¬ë¶„í•˜ì—¬ í†µê³„ í‘œì‹œ

2. **ì„±ëŠ¥ ìµœì í™”**
   - ì „í™˜ ìˆ˜ ì§‘ê³„ ì¿¼ë¦¬ ìµœì í™” (N+1 ë¬¸ì œ í•´ê²°)
   - link_id ê¸°ì¤€ group-by ì§‘ê³„ RPCë¡œ í†µí•©
   - ì¸ë±ìŠ¤ ì¶”ê°€ ê²€í† 

3. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**
   - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì¶”ê°€
   - í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€

### 10.3 ì¥ê¸° ê°œì„  (ìš°ì„ ìˆœìœ„ ë‚®ìŒ)

1. **ì‹¤ì‹œê°„ í†µê³„**
   - WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ì „í™˜ ìˆ˜ ì—…ë°ì´íŠ¸

2. **A/B í…ŒìŠ¤íŠ¸ ì§€ì›**
   - ë™ì¼ íƒ€ê²Ÿì— ëŒ€í•œ ì—¬ëŸ¬ ë§í¬ ë¹„êµ ê¸°ëŠ¥

3. **ê³ ê¸‰ ë¶„ì„**
   - ì‹œê°„ëŒ€ë³„ ì „í™˜ ì¶”ì´ ë¶„ì„
   - ì±„ë„ë³„ ì„±ê³¼ ë¶„ì„

---

## 11. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 11.1 ë°ì´í„°ë² ì´ìŠ¤

- [x] `campaign_link_meta` í…Œì´ë¸”ì— `target_type` í•„ë“œ ì¶”ê°€
- [x] `campaign_link_meta` í…Œì´ë¸”ì— `target_webinar_id` í•„ë“œ ì¶”ê°€
- [x] `target_campaign_id`ë¥¼ nullableë¡œ ë³€ê²½
- [x] ì œì•½ ì¡°ê±´ ì¶”ê°€ (`check_target_type_campaign`)
- [x] `registrations` í…Œì´ë¸”ì— `marketing_campaign_link_id` í•„ë“œ ì¶”ê°€
- [x] ì¸ë±ìŠ¤ ì¶”ê°€
- [ ] `target_type`ì„ NOT NULLë¡œ ê°•ì œ (ê¶Œì¥)
- [ ] ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™” (legacy ì¼€ì´ìŠ¤ ì œê±°) (ê¶Œì¥)

### 11.2 API

- [x] ìº í˜ì¸ ëª©ë¡ APIì— ì›¨ë¹„ë‚˜ í¬í•¨
- [x] ë§í¬ ìƒì„± APIì— ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ì§€ì›
- [x] ë§í¬ ëª©ë¡ APIì—ì„œ ì›¨ë¹„ë‚˜ ì „í™˜ ìˆ˜ ì§‘ê³„
- [x] ì›¨ë¹„ë‚˜ ë“±ë¡ APIì— ë§í¬ ID ì €ì¥
- [x] URL ìƒì„± ë¡œì§ ê°œì„  (ì›¨ë¹„ë‚˜/ìº í˜ì¸ ë¶„ê¸°)
- [x] ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
- [ ] ì „í™˜ ì§‘ê³„ ê¸°ì¤€ í…Œì´ë¸” í†µí•© (ê¶Œì¥)
- [ ] N+1 ì¿¼ë¦¬ ìµœì í™” (RPC í•¨ìˆ˜ ë„ì…) (ê¶Œì¥)

### 11.3 í”„ë¡ íŠ¸ì—”ë“œ

- [x] ìº í˜ì¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ì›¨ë¹„ë‚˜ í‘œì‹œ
- [x] ì›¨ë¹„ë‚˜ ì„ íƒ ì‹œ íƒ€ê²Ÿ íƒ€ì… ìë™ ë³€ê²½
- [x] ëœë”© ìœ„ì¹˜ ì˜µì…˜ ë™ì  ë³€ê²½
- [x] ë§í¬ ìƒì„± ì‹œ íƒ€ê²Ÿ íƒ€ì… ìë™ ê°ì§€
- [x] ê´‘ê³  ì‹œì‘ì¼ ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ë³€ê²½
- [x] ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ê°œì„ 

### 11.4 í…ŒìŠ¤íŠ¸

- [ ] ì›¨ë¹„ë‚˜ ë§í¬ ìƒì„± í…ŒìŠ¤íŠ¸
- [ ] ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ ì „í™˜ ì¶”ì  í…ŒìŠ¤íŠ¸
- [ ] ìº í˜ì¸ ë§í¬ ìƒì„± í…ŒìŠ¤íŠ¸ (ê¸°ì¡´ ê¸°ëŠ¥)
- [ ] URL ìƒì„± ì •í™•ì„± í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸

---

## 12. ì°¸ê³  ìë£Œ

### 12.1 ê´€ë ¨ ë¬¸ì„œ
- `docs/ê´‘ê³ ìº í˜ì¸_UTM.md` - UTM ì¶”ì  ì‹œìŠ¤í…œ ëª…ì„¸ì„œ
- `docs/ê´‘ê³ ìº í˜ì¸_ëª¨ë“ˆ_ëª…ì„¸ì„œ_ê²€í† ë³´ê³ ì„œ.md` - ëª¨ë“ˆ ê²€í†  ë³´ê³ ì„œ
- `supabase/migrations/072_add_webinar_support_to_campaign_link_meta.sql` - ì›¨ë¹„ë‚˜ ì§€ì› ë§ˆì´ê·¸ë ˆì´ì…˜
- `supabase/migrations/077_add_marketing_campaign_link_id_to_registrations.sql` - ì „í™˜ ì¶”ì  ë§ˆì´ê·¸ë ˆì´ì…˜

### 12.2 ê´€ë ¨ íŒŒì¼
- `app/api/clients/[clientId]/campaigns/links/route.ts` - ë§í¬ ìƒì„±/ì¡°íšŒ API
- `app/api/event-survey/campaigns/list/route.ts` - ìº í˜ì¸ ëª©ë¡ API
- `app/api/public/event-survey/[campaignId]/register/route.ts` - ë“±ë¡ API
- `app/(client)/client/[clientId]/campaigns/components/CampaignLinksTab.tsx` - ë§í¬ ê´€ë¦¬ UI

---

## 13. ê²°ë¡ 

ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ë¥¼ êµ¬ë¶„í•˜ì—¬ UTM ì¶”ì  ë° ì „í™˜ ì¶”ì  ì‹œìŠ¤í…œì„ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì£¼ìš” ì„±ê³¼:

1. âœ… ì›¨ë¹„ë‚˜ íƒ€ê²Ÿ ë§í¬ ìƒì„± ì§€ì›
2. âœ… ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œ ì „í™˜ ì¶”ì  ê°€ëŠ¥
3. âœ… íƒ€ê²Ÿ íƒ€ì…ì— ë”°ë¥¸ ì˜¬ë°”ë¥¸ URL ìƒì„±
4. âœ… ì‚¬ìš©ì ì¹œí™”ì ì¸ UI ê°œì„ 
5. âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… ê°•í™”

**ë•œì§ˆìš© ì¦‰ì‹œ ë³´ì™„ ì™„ë£Œ (v2.0)**:
1. âœ… **UI ë¼ë²¨ ë¶„ë¦¬**: "ìº í˜ì¸ ì „í™˜(ë“±ë¡/ì„¤ë¬¸ ì œì¶œ)" vs "ì›¨ë¹„ë‚˜ ì „í™˜(ì›¨ë¹„ë‚˜ ë“±ë¡)" ëª…í™•íˆ êµ¬ë¶„
2. âœ… **Visit dedup ê·œì¹™ ëª…í™•í™”**: "Visits = session_id ê¸°ì¤€, íƒ€ê²Ÿë‹¹ 1íšŒ ì§‘ê³„" ì •í™•íˆ í•œ ë¬¸ì¥ìœ¼ë¡œ ê³ ì •
3. âœ… **íƒ€ê²Ÿ ì†Œì† ê²€ì¦ ê°•ì œ**: ë§í¬ ìƒì„± ì‹œ `client_id` ì¼ì¹˜ ê²€ì¦ (ë³´ì•ˆ/ë°ì´í„° ì˜¤ì—¼ ë°©ì§€)
4. âœ… **cid/short link ê´€ê³„ ìš´ì˜ ê·œì¹™ ê³ ì •**: "ë§ˆì¼€íŒ… ì¶”ì ì˜ ê¸°ì¤€ í‚¤ëŠ” cid" ëª…ì‹œ
5. âœ… **N+1 ë°©ì§€ ì•ˆì „ì¥ì¹˜**: ë§í¬ ëª©ë¡ APIì— limit(ê¸°ë³¸ 50, ìµœëŒ€ 100) ë° í˜ì´ì§• ì¶”ê°€

**í˜„ì¬ ìš´ì˜ ë²„ì „ (v2.0)ì˜ ê²½ê³„**:
- **í˜„ì¬ v2.0ì€ ìº í˜ì¸/ì›¨ë¹„ë‚˜ ì „í™˜ì„ ì„œë¡œ ë‹¤ë¥¸ í…Œì´ë¸”ì—ì„œ ì§‘ê³„í•©ë‹ˆë‹¤.**
- ëŒ€ì‹œë³´ë“œì—ì„œ í•©ì‚° ì§€í‘œ í•´ì„ ì‹œ ì£¼ì˜ê°€ í•„ìš”í•˜ë©°, UIì—ì„œ ëª…í™•íˆ êµ¬ë¶„ í‘œì‹œí•©ë‹ˆë‹¤.
- ì´ëŠ” "ë•œì§ˆ êµ¬ì¡°"ì´ì§€ë§Œ, ìœ„ 5ê°€ì§€ ë³´ì™„ì‚¬í•­ìœ¼ë¡œ ìš´ì˜ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”í–ˆìŠµë‹ˆë‹¤.

**í–¥í›„ ê°œì„  ì‚¬í•­ (ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”)**:
- **ì „í™˜ ì§‘ê³„ ê¸°ì¤€ í…Œì´ë¸” í†µí•©** (í–¥í›„ í†µí•© ì„¤ê³„): ì›¨ë¹„ë‚˜ ë“±ë¡ ì‹œì—ë„ `event_survey_entries`ì— ë ˆì½”ë“œ ìƒì„±í•˜ì—¬ ê´‘ê³  ì„±ê³¼ ë¶„ì„ ë‹¨ìˆœí™”
- **ì œì•½ ì¡°ê±´ ë‹¨ìˆœí™”**: `target_type`ì„ NOT NULLë¡œ ê°•ì œí•˜ê³  legacy ì¼€ì´ìŠ¤ ì œê±°
- **ì„±ëŠ¥ ìµœì í™”**: N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ RPC í•¨ìˆ˜ ë„ì…

ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì ìš©ë˜ì—ˆê³ , ì½”ë“œ ë³€ê²½ì‚¬í•­ë„ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œì€ ì´ì œ ìº í˜ì¸ê³¼ ì›¨ë¹„ë‚˜ ëª¨ë‘ë¥¼ ì§€ì›í•˜ë©°, ê°ê°ì˜ íŠ¹ì„±ì— ë§ê²Œ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•©ë‹ˆë‹¤.

**ìµœì¢… ì²´í¬: ì§€ê¸ˆ ìƒíƒœë¡œ ë‹¹ì¥ ìš´ì˜ ê°€ëŠ¥í•œê°€?**
âœ… **ê°€ëŠ¥í•©ë‹ˆë‹¤.**
ë‹¤ë§Œ ìœ„ 5ê°€ì§€ ë•œì§ˆìš© ë³´ì™„ì‚¬í•­(íŠ¹íˆ 1~3)ì€ ì˜¤ëŠ˜ ë°”ë¡œ ë°˜ì˜ë˜ì—ˆìœ¼ë©°, ë§ˆì´ê·¸ë ˆì´ì…˜ ì—†ì´ë„ ê°€ëŠ¥í•œ "ê°€ë“œ/ë¼ë²¨/ìƒí•œ"ì´ë¼ ë¦¬ìŠ¤í¬ ëŒ€ë¹„ íš¨ìœ¨ì´ ìµœê³ ì…ë‹ˆë‹¤.

---

**ë¬¸ì„œ ë²„ì „**: 2.0 (ê²€í†  ë³´ì™„ë³¸)  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026-01-28
