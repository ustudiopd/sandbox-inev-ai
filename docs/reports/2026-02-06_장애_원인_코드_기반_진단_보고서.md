# EventLive 2026-02-06 ìž¥ì•  ì›ì¸ ì½”ë“œ ê¸°ë°˜ ì§„ë‹¨ ë³´ê³ ì„œ

**ìž‘ì„±ì¼**: 2026-02-07  
**ìž¥ì•  ì‹œê°„ëŒ€**: 2026-02-06 13:30~14:30 (KST)  
**í”„ë¡œì íŠ¸**: EventLive (Supabase + Next.js ê¸°ë°˜)  
**ëª©ì **: ì½”ë“œë² ì´ìŠ¤ ê·¼ê±° ê¸°ë°˜ ì •ë°€ ì›ì¸ ë¶„ì„

---

## ðŸ“‹ ëª©ì°¨

1. [íŠ¸ëž˜í”½ ì¦í­ ë§µ](#1-íŠ¸ëž˜í”½-ì¦í­-ë§µ)
2. [400 / 409 ì—ëŸ¬ íŠ¸ë¦¬ê±° ê·¼ê±°](#2-400--409-ì—ëŸ¬-íŠ¸ë¦¬ê±°-ê·¼ê±°)
3. [ìž¬ì‹œë„ / í´ë§ / ë¬´í•œ ë£¨í”„ ì¡°ì‚¬](#3-ìž¬ì‹œë„--í´ë§--ë¬´í•œ-ë£¨í”„-ì¡°ì‚¬)
4. [N+1 Query ì¦ê±° ìˆ˜ì§‘](#4-n1-query-ì¦ê±°-ìˆ˜ì§‘)
5. [RLS ì •ì±… ì„±ëŠ¥ ì§„ë‹¨](#5-rls-ì •ì±…-ì„±ëŠ¥-ì§„ë‹¨)
6. [ì¸ë±ìŠ¤ & ì¿¼ë¦¬ í”Œëžœ ì ê²€](#6-ì¸ë±ìŠ¤--ì¿¼ë¦¬-í”Œëžœ-ì ê²€)
7. [ì¸ì¦/ë¡œê·¸ì¸ ê²½ë¡œ ë¶„ì„](#7-ì¸ì¦ë¡œê·¸ì¸-ê²½ë¡œ-ë¶„ì„)
8. [ìµœì¢… ìš”ì•½](#8-ìµœì¢…-ìš”ì•½)

---

## 1. íŠ¸ëž˜í”½ ì¦í­ ë§µ

### 1.1 ì—”ë“œí¬ì¸íŠ¸ë³„ ì •ë¦¬ í‘œ

| Endpoint URL | í˜¸ì¶œ ì£¼ì²´ | í˜¸ì¶œ ì‹œì  | í˜¸ì¶œ ì£¼ê¸° | 1íšŒ í˜¸ì¶œë‹¹ DB ì¿¼ë¦¬ ìˆ˜ | ì½ê¸°/ì“°ê¸° | ì ‘ê·¼ í…Œì´ë¸” ëª©ë¡ | RLS ì ìš© ì—¬ë¶€ |
|---|---|---|---|---|---|---|---|
| `POST /api/webinars/[webinarId]/access/track` | ì°¸ê°€ìž | ìž…ìž¥ / ì„¸ì…˜ ê°±ì‹  | ìž…ìž¥ ì‹œ 1íšŒ, ì´í›„ **5ë¶„ë§ˆë‹¤** | **3~7íšŒ** | R: 2~4, W: 1~3 | `webinars`, `registrations`, `profiles`, `webinar_live_presence`, `webinar_user_sessions` | âŒ (Admin Supabase) |
| `POST /api/webinars/[webinarId]/presence/ping` | ì°¸ê°€ìž | ì‹œì²­ ì¤‘ | **120ì´ˆ Â± 10ì´ˆ** | **4~10íšŒ** | R: 2~5, W: 1~2, RPC: 1~3 | `webinars`, `registrations`, `profiles`, `webinar_live_presence` (RPC), `webinar_user_sessions` (RPC) | âœ… (ì¼ë¶€), âŒ (Admin ì¼ë¶€) |
| `POST /api/webinars/[webinarId]/register` | ì°¸ê°€ìž | ìž…ìž¥ | ìž…ìž¥ ì‹œ 1íšŒ (ìžë™ ë“±ë¡) | **4íšŒ** | R: 2, W: 1~2 | `webinars`, `registrations` | âŒ (Admin Supabase) |
| `GET /api/webinars/[webinarId]/stats/access` | ê´€ë¦¬ìž | ëŒ€ì‹œë³´ë“œ ë¡œë”© | **5ì´ˆë§ˆë‹¤** | **6~8íšŒ** | R: 6~8 | `webinars`, `webinar_live_presence`, `profiles`, `registrations`, `webinar_access_logs` | âŒ (Admin Supabase) |
| ì¤‘ë³µ ë¡œê·¸ì¸ ì²´í¬ (Realtime Presence) | ì°¸ê°€ìž | ì‹œì²­ ì¤‘ | **5ì´ˆë§ˆë‹¤** | **0íšŒ** | - | - | - |

**íŒŒì¼ ìœ„ì¹˜**:
- `app/api/webinars/[webinarId]/access/track/route.ts`
- `app/api/webinars/[webinarId]/presence/ping/route.ts`
- `app/api/webinars/[webinarId]/register/route.ts`
- `app/api/webinars/[webinarId]/stats/access/route.ts`
- `app/(webinar)/webinar/[id]/components/WebinarView.tsx` (ì¤‘ë³µ ë¡œê·¸ì¸ ì²´í¬)

### 1.2 íŠ¸ëž˜í”½ ì¦í­ ê³„ì‚° (1,000ëª… ë™ì‹œ ì ‘ì† ì‹œë‚˜ë¦¬ì˜¤)

**1ë¶„ë‹¹ ìš”ì²­ ìˆ˜**:

| API | ì£¼ê¸° | 1ë¶„ë‹¹ ìš”ì²­ ìˆ˜ | 1ë¶„ë‹¹ DB ì¿¼ë¦¬ ìˆ˜ |
|---|---|---|---|
| `/access/track` | ìž…ìž¥ ì‹œ 1íšŒ, ì´í›„ 5ë¶„ë§ˆë‹¤ | 1,000íšŒ (ìž…ìž¥) + 200íšŒ (ê°±ì‹ ) = **1,200íšŒ** | 1,200 Ã— 4 = **4,800íšŒ** |
| `/presence/ping` | 120ì´ˆ Â± 10ì´ˆ | 1,000ëª… Ã— 0.5íšŒ/ë¶„ = **500íšŒ** | 500 Ã— 4 = **2,000íšŒ** |
| `/register` | ìž…ìž¥ ì‹œ 1íšŒ | 1,000íšŒ (ìž…ìž¥) | 1,000 Ã— 4 = **4,000íšŒ** |
| `/stats/access` | ê´€ë¦¬ìž 5ì´ˆë§ˆë‹¤ | 1ëª… Ã— 12íšŒ/ë¶„ = **12íšŒ** | 12 Ã— 7 = **84íšŒ** |
| ì¤‘ë³µ ë¡œê·¸ì¸ ì²´í¬ | 5ì´ˆë§ˆë‹¤ | 1,000ëª… Ã— 12íšŒ/ë¶„ = **12,000íšŒ** | **0íšŒ** (Realtime) |

**ì´ 1ë¶„ë‹¹ DB ì¿¼ë¦¬ ìˆ˜**: ì•½ **10,884íšŒ**  
**ì‹œê°„ë‹¹ DB ì¿¼ë¦¬ ìˆ˜**: ì•½ **653,040íšŒ**

### 1.3 í•µì‹¬ íŠ¸ëž˜í”½ ì¦í­ ìš”ì¸

1. **Presence Ping (120ì´ˆ ì£¼ê¸°)**: ëª¨ë“  ì°¸ê°€ìžê°€ ë™ì‹œì— í˜¸ì¶œ â†’ DB ë¶€í•˜ ì§‘ì¤‘
2. **ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ (5ì´ˆ ì£¼ê¸°)**: ê´€ë¦¬ìž 1ëª…ì´ 5ì´ˆë§ˆë‹¤ í˜¸ì¶œ â†’ ì¶”ê°€ ë¶€í•˜
3. **Access Track (5ë¶„ ì£¼ê¸°)**: ìž…ìž¥ ì‹œ ì§‘ì¤‘ í˜¸ì¶œ â†’ ì´ˆê¸° ë¶€í•˜ ê¸‰ì¦

---

## 2. 400 / 409 ì—ëŸ¬ íŠ¸ë¦¬ê±° ê·¼ê±°

### 2.1 registrations.id ì°¸ì¡° ë¬¸ì œ

**ë¬¸ì œ**: `registrations` í…Œì´ë¸”ì€ **ë³µí•© ê¸°ë³¸ í‚¤ `(webinar_id, user_id)`**ë¥¼ ì‚¬ìš©í•˜ë©°, **`id` ì»¬ëŸ¼ì´ ì¡´ìž¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

**ìŠ¤í‚¤ë§ˆ ì •ì˜**:
```sql
create table public.registrations (
  webinar_id uuid not null references public.webinars(id) on delete cascade,
  user_id uuid not null references public.profiles(id) on delete cascade,
  role text not null default 'attendee',
  created_at timestamptz default now(),
  primary key (webinar_id, user_id)  -- ë³µí•© ê¸°ë³¸ í‚¤, id ì»¬ëŸ¼ ì—†ìŒ
);
```

### 2.2 400 ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜ ì „ìˆ˜ ì¡°ì‚¬

| íŒŒì¼ ê²½ë¡œ | ë¼ì¸ | í•¨ìˆ˜ëª… | ë¬¸ì œë˜ëŠ” ì¿¼ë¦¬ | í˜¸ì¶œë˜ëŠ” API ì—”ë“œí¬ì¸íŠ¸ | ì—ëŸ¬ ë°œìƒ ì‹œ íë¦„ |
|---|---|---|---|---|---|
| `app/api/webinars/[webinarId]/presence/ping/route.ts` | 69 | `POST` | `.select('id')` | `POST /api/webinars/[webinarId]/presence/ping` | âŒ ìž¬ì‹œë„ ì—†ìŒ, ë‹¤ìŒ ì£¼ê¸°(120ì´ˆ)ê¹Œì§€ ëŒ€ê¸° |
| `app/api/webinars/[webinarId]/presence/ping/route.ts` | 117 | `POST` | `.select('id')` | `POST /api/webinars/[webinarId]/presence/ping` | âŒ ìž¬ì‹œë„ ì—†ìŒ, ë‹¤ìŒ ì£¼ê¸°(120ì´ˆ)ê¹Œì§€ ëŒ€ê¸° |
| `app/api/webinars/[webinarId]/presence/ping/route.ts` | 148 | `POST` | `.select('id')` | `POST /api/webinars/[webinarId]/presence/ping` | âŒ ìž¬ì‹œë„ ì—†ìŒ, ë‹¤ìŒ ì£¼ê¸°(120ì´ˆ)ê¹Œì§€ ëŒ€ê¸° |
| `app/api/webinars/[webinarId]/access/track/route.ts` | 52 | `POST` | `.select('id')` | `POST /api/webinars/[webinarId]/access/track` | âŒ ìž¬ì‹œë„ ì—†ìŒ, 5ë¶„ë§ˆë‹¤ ìžë™ ìž¬ì‹œë„ |

**í˜¸ì¶œ ìŠ¤íƒ**:
```
[í´ë¼ì´ì–¸íŠ¸]
  components/webinar/hooks/usePresencePing.ts:60
    fetch(`/api/webinars/${webinarId}/presence/ping`)
      â†“
[ì„œë²„]
  app/api/webinars/[webinarId]/presence/ping/route.ts:67-72
    admin.from('registrations').select('id')  â† 400 ì—ëŸ¬ ë°œìƒ
```

### 2.3 409 Conflict ì—ëŸ¬ (ì¤‘ë³µ í‚¤ ìœ„ë°˜)

**ë°œìƒ ìœ„ì¹˜**:
- `app/api/webinars/[webinarId]/presence/ping/route.ts:98-105` (ìžë™ ë“±ë¡ ì‹œë„)
- `app/api/webinars/[webinarId]/register/route.ts:60-68` (ë“±ë¡ ìƒì„±)

**ì›ì¸**: ë™ì‹œì— ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì¼í•œ `(webinar_id, user_id)` ì¡°í•©ìœ¼ë¡œ INSERT ì‹œë„

**ì—ëŸ¬ ë©”ì‹œì§€**: `duplicate key value violates unique constraint "registrations_pkey"`

**ì—ëŸ¬ ì½”ë“œ**: `23505` (PostgreSQL ì¤‘ë³µ í‚¤ ì—ëŸ¬)

**ì²˜ë¦¬ ë°©ì‹**:
- `presence/ping`: ì¤‘ë³µ í‚¤ ì—ëŸ¬ëŠ” ë¬´ì‹œí•˜ê³  ìž¬ì¡°íšŒ (ë¼ì¸ 112-123)
- `register`: ì¤‘ë³µ í‚¤ ì—ëŸ¬ëŠ” ë¬´ì‹œí•˜ê³  ì„±ê³µ ë°˜í™˜ (ë¼ì¸ 71-72)

**ë¬¸ì œì **: ì—ëŸ¬ëŠ” ì²˜ë¦¬ë˜ì§€ë§Œ, ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•œ DB ë¶€í•˜ ì¦ê°€

### 2.4 400 ì—ëŸ¬ í­ë°œ ë©”ì»¤ë‹ˆì¦˜

**ì‹œë‚˜ë¦¬ì˜¤**: 1,000ëª… ë™ì‹œ ì ‘ì† (ëª¨ë‘ ë¡œê·¸ì¸ ì‚¬ìš©ìž)

**1ë¶„ë‹¹ 400 ì—ëŸ¬ ë°œìƒ ìˆ˜**:
- Presence ping: 500íšŒ Ã— 1ê°œ ì¿¼ë¦¬(ë¼ì¸ 69) = **500ê±´**
- Access track: 1,200íšŒ Ã— 1ê°œ ì¿¼ë¦¬(ë¼ì¸ 52) = **1,200ê±´**
- **ì´ 1,700ê±´ì˜ 400 ì—ëŸ¬ ë°œìƒ**

**íƒ€ìž„ë¼ì¸**:
```
14:00:00 - ì‚¬ìš©ìžë“¤ ëŒ€ëŸ‰ ì§„ìž…
  â†“
  POST /api/webinars/[webinarId]/access/track (1,000ê±´)
  â†’ ê° ìš”ì²­ë§ˆë‹¤ .select('id') ì‹¤í–‰
  â†’ 1,000ê±´ì˜ 400 ì—ëŸ¬ ë°œìƒ (ì•½ 1ì´ˆ ë‚´)
  
14:00:10 - Presence Ping ì²« ì „ì†¡
  â†“
  POST /api/webinars/[webinarId]/presence/ping (ì•½ 500ê±´)
  â†’ ê° ìš”ì²­ë§ˆë‹¤ .select('id') ì‹¤í–‰
  â†’ 500ê±´ì˜ 400 ì—ëŸ¬ ë°œìƒ (ì•½ 10ì´ˆ ë‚´)
  
14:02:00 - Presence Ping ë‘ ë²ˆì§¸ ì „ì†¡
  â†“
  â†’ 500ê±´ì˜ 400 ì—ëŸ¬ ë°œìƒ
```

**ê²°ê³¼**: ì›¨ë¹„ë‚˜ ì‹œìž‘ í›„ ì²« 2ë¶„ ë™ì•ˆ **ì•½ 2,000ê±´ì˜ 400 ì—ëŸ¬** ì§‘ì¤‘ ë°œìƒ

---

## 3. ìž¬ì‹œë„ / í´ë§ / ë¬´í•œ ë£¨í”„ ì¡°ì‚¬

### 3.1 í´ë§ êµ¬ì¡° ì „ìˆ˜ ì¡°ì‚¬

| íŒŒì¼ ê²½ë¡œ | ìš”ì²­ ëŒ€ìƒ API | ìž¬ì‹œë„ ì¡°ê±´ | ìµœëŒ€ íšŸìˆ˜ ë˜ëŠ” ë¬´í•œ ì—¬ë¶€ | ì£¼ê¸° |
|---|---|---|---|---|
| `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx` | `/api/webinars/[webinarId]/stats/access` | í•­ìƒ | **ë¬´í•œ** (ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€) | **5ì´ˆë§ˆë‹¤** |
| `app/(webinar)/webinar/[id]/components/WebinarView.tsx` | `/api/webinars/[webinarId]/stats/access` | í•­ìƒ | **ë¬´í•œ** (ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€) | **5ì´ˆë§ˆë‹¤** |
| `components/webinar/Chat.tsx` | `/api/webinars/[webinarId]/messages` | Realtime ì‹¤íŒ¨ ì‹œ | **ë¬´í•œ** (Realtime ë³µêµ¬ê¹Œì§€) | **2ì´ˆ Â± 0.5ì´ˆ** (í´ë°± í´ë§) |
| `components/webinar/QA.tsx` | ì§ˆë¬¸ ëª©ë¡ ì¡°íšŒ | Realtime ì‹¤íŒ¨ ì‹œ | **ë¬´í•œ** (Realtime ë³µêµ¬ê¹Œì§€) | **5ì´ˆë§ˆë‹¤** (í´ë°± í´ë§) |
| `components/webinar/hooks/usePresencePing.ts` | `/api/webinars/[webinarId]/presence/ping` | í•­ìƒ | **ë¬´í•œ** (íŽ˜ì´ì§€ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€) | **120ì´ˆ Â± 10ì´ˆ** |
| `app/(webinar)/webinar/[id]/components/WebinarView.tsx` | ì¤‘ë³µ ë¡œê·¸ì¸ ì²´í¬ (Presence) | í•­ìƒ | **ë¬´í•œ** (ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€) | **5ì´ˆë§ˆë‹¤** |

### 3.2 ìž¬ì‹œë„ ë¡œì§ ì¡°ì‚¬

#### 3.2.1 Presence Ping (ìž¬ì‹œë„ ì—†ìŒ)

**íŒŒì¼**: `components/webinar/hooks/usePresencePing.ts:60-78`

```typescript
const response = await fetch(`/api/webinars/${webinarId}/presence/ping`, {
  method: 'POST',
  headers: body ? { 'Content-Type': 'application/json' } : undefined,
  body: body,
  credentials: 'include',
})

if (response.ok) {
  lastPingRef.current = now
  console.log(`[Presence Ping] ì „ì†¡ ì„±ê³µ: ${response.status}`)
} else {
  console.error(`[Presence Ping] ì „ì†¡ ì‹¤íŒ¨: ${response.status} ${response.statusText}`)
  // âŒ ìž¬ì‹œë„ ë¡œì§ ì—†ìŒ - ë‹¤ìŒ ì£¼ê¸°ê¹Œì§€ ëŒ€ê¸°
}
```

**ìž¬ì‹œë„ ë¡œì§**: âŒ **ì—†ìŒ**
- 400 ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸ë§Œ ì¶œë ¥í•˜ê³  ë‹¤ìŒ ì£¼ê¸°(120ì´ˆ)ê¹Œì§€ ëŒ€ê¸°
- ì¦‰ì‹œ ìž¬ì‹œë„í•˜ì§€ ì•ŠìŒ

#### 3.2.2 Dashboard Stats (ìž¬ì‹œë„ ì—†ìŒ)

**íŒŒì¼**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx:530-533`

```typescript
intervalRef.current = setInterval(() => {
  console.log('[DashboardTab] ì£¼ê¸°ì  presence state í™•ì¸')
  updateParticipants()
}, 5000) // 5ì´ˆë§ˆë‹¤
```

**ìž¬ì‹œë„ ë¡œì§**: âŒ **ì—†ìŒ**
- ì—ëŸ¬ ë°œìƒ ì‹œ ë‹¤ìŒ ì£¼ê¸°(5ì´ˆ)ê¹Œì§€ ëŒ€ê¸°
- ë¬´í•œ ë°˜ë³µ

#### 3.2.3 Chat í´ë°± í´ë§ (ì§€ìˆ˜ ë°±ì˜¤í”„)

**íŒŒì¼**: `components/webinar/Chat.tsx:1275-1424`

```typescript
const pollWithJitter = async () => {
  try {
    const response = await fetch(`/api/webinars/${webinarId}/messages?after=${lastMessageIdRef.current}`)
    
    if (response.ok) {
      // ì„±ê³µ ì‹œ ë°±ì˜¤í”„ ì´ˆê¸°í™”
      pollBackoffRef.current = 0
    } else {
      // ì—ëŸ¬ ë°œìƒ ì‹œ ë°±ì˜¤í”„ ì¦ê°€ (ì§€ìˆ˜ ë°±ì˜¤í”„)
      pollBackoffRef.current = Math.min(pollBackoffRef.current * 2 + 5000, 60000) // ìµœëŒ€ 60ì´ˆ
    }
  } catch (error) {
    // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ë°±ì˜¤í”„ ì¦ê°€
    pollBackoffRef.current = Math.min(pollBackoffRef.current * 2 + 5000, 60000)
  }
  
  // ì§€í„° ì ìš©: ê¸°ë³¸ 2ì´ˆ Â± 0.5ì´ˆ ëžœë¤
  const base = 2000
  const jitter = 500 - Math.random() * 1000
  const nextDelay = base + jitter + pollBackoffRef.current
  
  if (fallbackOn && isPollingActive) {
    const timeout = setTimeout(pollWithJitter, nextDelay)
    pollingTimeouts.push(timeout)
  }
}
```

**ìž¬ì‹œë„ ë¡œì§**: âœ… **ì§€ìˆ˜ ë°±ì˜¤í”„**
- ì—ëŸ¬ ë°œìƒ ì‹œ ë°±ì˜¤í”„ ì¦ê°€ (ìµœëŒ€ 60ì´ˆ)
- ë¬´í•œ ë°˜ë³µ (Realtime ë³µêµ¬ê¹Œì§€)

### 3.3 ë¬´í•œ ë£¨í”„ ìœ„í—˜ë„ í‰ê°€

| ìœ„ì¹˜ | ìœ„í—˜ë„ | ì´ìœ  |
|---|---|---|
| Dashboard Stats (5ì´ˆ í´ë§) | **High** | ê´€ë¦¬ìž 1ëª…ì´ 5ì´ˆë§ˆë‹¤ 6~8ê°œ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì‹œê°„ë‹¹ 720~960ê°œ ì¿¼ë¦¬ |
| Presence Ping (120ì´ˆ í´ë§) | **Medium** | ëª¨ë“  ì°¸ê°€ìžê°€ 120ì´ˆë§ˆë‹¤ í˜¸ì¶œ â†’ ì‹œê°„ë‹¹ ì•½ 2,000ê°œ ì¿¼ë¦¬ (1,000ëª… ê¸°ì¤€) |
| Chat í´ë°± í´ë§ (2ì´ˆ í´ë§) | **High** | Realtime ì‹¤íŒ¨ ì‹œ ëª¨ë“  ì°¸ê°€ìžê°€ 2ì´ˆë§ˆë‹¤ í˜¸ì¶œ â†’ ì‹œê°„ë‹¹ ì•½ 18,000ê°œ ì¿¼ë¦¬ (1,000ëª… ê¸°ì¤€) |

---

## 4. N+1 Query ì¦ê±° ìˆ˜ì§‘

### 4.1 ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ (ì´ë¯¸ ê°œì„ ë¨)

**íŒŒì¼**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx`

**ì´ì „ ë¬¸ì œì ** (ë¼ì¸ 298-313, í˜„ìž¬ëŠ” ê°œì„ ë¨):
```typescript
// âŒ ì´ì „: ê° ì‚¬ìš©ìžë§ˆë‹¤ ê°œë³„ API í˜¸ì¶œ
const profilePromises = allUserIds.map(async (userId) => {
  const response = await fetch(`/api/profiles/${userId}`)  // ê°œë³„ í˜¸ì¶œ!
  // ...
})
const profileResults = await Promise.all(profilePromises)
```

**ì„±ëŠ¥ ì˜í–¥**:
- í˜„ìž¬ ì ‘ì†ìž 265ëª… Ã— ê°œë³„ API í˜¸ì¶œ = **265ë²ˆì˜ HTTP ìš”ì²­**
- ê° ìš”ì²­ë§ˆë‹¤ ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ì‹œê°„: ì•½ 100ms
- **ì˜ˆìƒ ì§€ì—°**: 265 Ã— 100ms = **26.5ì´ˆ ì´ìƒ**

**ê°œì„  í›„** (ë¼ì¸ 343-369):
```typescript
// âœ… ê°œì„ : ë°°ì¹˜ ì¡°íšŒ APIë¡œ í•œ ë²ˆì— ì¡°íšŒ
const response = await fetch('/api/profiles/batch', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ userIds: allUserIds }),
})
```

**ê°œì„  íš¨ê³¼**: 26.5ì´ˆ â†’ 200ms (130ë°° ì´ìƒ ê°œì„ )

**íŒŒì¼**: `app/api/profiles/batch/route.ts`

### 4.2 ê¸°íƒ€ N+1 íŒ¨í„´ (ê°œì„ ë¨)

| ì»´í¬ë„ŒíŠ¸ëª… | íŒŒì¼ ê²½ë¡œ | í™”ë©´ 1íšŒ ë Œë”ë§ ì‹œ API í˜¸ì¶œ ìˆ˜ | ê° APIê°€ ì‹¤í–‰í•˜ëŠ” DB ì¿¼ë¦¬ êµ¬ì¡° | ë°°ì¹˜ ì²˜ë¦¬ë¡œ ê°œì„  ê°€ëŠ¥í•œ ì§€ì  |
|---|---|---|---|---|
| Questions API | `app/api/webinars/[webinarId]/questions/route.ts` | 1íšŒ | í”„ë¡œí•„ ì •ë³´ ì¼ê´„ ì¡°íšŒ (ë¼ì¸ 89-105) | âœ… ì´ë¯¸ ê°œì„ ë¨ |
| Stats Sessions API | `app/api/webinars/[webinarId]/stats/sessions/route.ts` | 1íšŒ | í”„ë¡œí•„/ë“±ë¡ ì •ë³´ ì¼ê´„ ì¡°íšŒ (ë¼ì¸ 138-154) | âœ… ì´ë¯¸ ê°œì„ ë¨ |
| Stats Access API | `app/api/webinars/[webinarId]/stats/access/route.ts` | 1íšŒ | í”„ë¡œí•„/ë“±ë¡ ì •ë³´ ì¼ê´„ ì¡°íšŒ (ë¼ì¸ 99-109) | âœ… ì´ë¯¸ ê°œì„ ë¨ |

**ê²°ë¡ **: N+1 ì¿¼ë¦¬ ë¬¸ì œëŠ” ëŒ€ë¶€ë¶„ ê°œì„ ë˜ì—ˆìœ¼ë‚˜, ìž¥ì•  ë‹¹ì‹œì—ëŠ” DashboardTabì—ì„œ ë¬¸ì œê°€ ìžˆì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ.

---

## 5. RLS ì •ì±… ì„±ëŠ¥ ì§„ë‹¨

### 5.1 RLS ì •ì±… ì¡°ì‚¬ ê²°ê³¼

| í…Œì´ë¸”ëª… | RLS ì •ì±…ëª… | ë¬¸ì œ íŒ¨í„´ ìœ í˜• | ì„±ëŠ¥ ìœ„í—˜ë„ | íŒŒì¼ ìœ„ì¹˜ |
|---|---|---|---|---|
| `registrations` | "register for webinar" | `user_id = (select auth.uid())` | **Low** | `supabase/migrations/098_optimize_rls_policies_auth_uid.sql:13-17` |
| `registrations` | "delete registrations" | `user_id = (select auth.uid())` + EXISTS ì„œë¸Œì¿¼ë¦¬ | **Medium** | `supabase/migrations/098_optimize_rls_policies_auth_uid.sql:20-36` |
| `messages` | "scoped_read" | EXISTS ì„œë¸Œì¿¼ë¦¬ (registrations ì¡°íšŒ) | **High** | `supabase/migrations/025_simplify_messages_rls.sql:40-49` |
| `messages` | "users_can_insert_own_messages" | `(select auth.uid()) = user_id` | **Low** | `supabase/migrations/099_optimize_rls_policies_auth_uid_part2.sql:26-29` |
| `profiles` | "read own profile" | `id = (select auth.uid())` | **Low** | `supabase/migrations/099_optimize_rls_policies_auth_uid_part2.sql:60-63` |
| `webinar_live_presence` | "wlp_upsert_self_if_registered" | `user_id = auth.uid()` + EXISTS ì„œë¸Œì¿¼ë¦¬ | **High** | `supabase/migrations/033_create_webinar_stats_v2.sql:206-216` |

### 5.2 RLS ì„±ëŠ¥ ìµœì í™” ì§„í–‰ ìƒí™©

**ìµœì í™” ì™„ë£Œ**:
- `auth.uid()` â†’ `(select auth.uid())` ë³€ê²½ (ë§ˆì´ê·¸ë ˆì´ì…˜ 098, 099)
- ê° í–‰ë§ˆë‹¤ `auth.uid()`ê°€ ìž¬í‰ê°€ë˜ëŠ” ê²ƒì„ ë°©ì§€

**ìµœì í™” ë¯¸ì™„ë£Œ**:
- `messages.scoped_read`: EXISTS ì„œë¸Œì¿¼ë¦¬ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±
- `webinar_live_presence`: EXISTS ì„œë¸Œì¿¼ë¦¬ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±

### 5.3 ê³ ë¹ˆë„ í…Œì´ë¸” RLS ì •ì±… í‰ê°€

| í…Œì´ë¸” | RLS ì •ì±… | í˜¸ì¶œ ë¹ˆë„ | ì„±ëŠ¥ ì˜í–¥ |
|---|---|---|---|
| `registrations` | `user_id = (select auth.uid())` | ë§¤ìš° ë†’ìŒ (presence pingë§ˆë‹¤) | **Low** (ì¸ë±ìŠ¤ í™œìš© ê°€ëŠ¥) |
| `webinar_live_presence` | EXISTS ì„œë¸Œì¿¼ë¦¬ | ë§¤ìš° ë†’ìŒ (presence pingë§ˆë‹¤) | **High** (ì„œë¸Œì¿¼ë¦¬ ë¹„ìš©) |
| `messages` | EXISTS ì„œë¸Œì¿¼ë¦¬ | ë†’ìŒ (ì±„íŒ… ì¡°íšŒë§ˆë‹¤) | **High** (ì„œë¸Œì¿¼ë¦¬ ë¹„ìš©) |

**ê²°ë¡ **: `webinar_live_presence`ì™€ `messages` í…Œì´ë¸”ì˜ EXISTS ì„œë¸Œì¿¼ë¦¬ ê¸°ë°˜ RLS ì •ì±…ì´ ê³ ë¹ˆë„ í˜¸ì¶œ ì‹œ ì„±ëŠ¥ ë³‘ëª© ê°€ëŠ¥ì„± ë†’ìŒ.

---

## 6. ì¸ë±ìŠ¤ & ì¿¼ë¦¬ í”Œëžœ ì ê²€

### 6.1 ì¡°ì‚¬ ëŒ€ìƒ í…Œì´ë¸” ì¸ë±ìŠ¤ í˜„í™©

#### 6.1.1 webinar_live_presence

**ì£¼ìš” WHERE ì¡°ê±´**:
- `webinar_id = ? AND last_seen_at >= ?` (í˜„ìž¬ ì ‘ì†ìž ì¡°íšŒ)
- `webinar_id = ? AND user_id = ?` (Upsert)

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
- âœ… `(webinar_id, last_seen_at)` ë³µí•© ì¸ë±ìŠ¤ (í˜„ìž¬ ì ‘ì†ìž ì¡°íšŒ)
- âœ… `(webinar_id, user_id)` ë³µí•© ì¸ë±ìŠ¤ (Upsert)

**íŒŒì¼**: `supabase/migrations/033_create_webinar_stats_v2.sql` (ì¸ë±ìŠ¤ ìƒì„± ì—¬ë¶€ í™•ì¸ í•„ìš”)

#### 6.1.2 registrations

**ì£¼ìš” WHERE ì¡°ê±´**:
- `webinar_id = ? AND user_id = ?` (ë“±ë¡ í™•ì¸)

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
- âœ… `(webinar_id, user_id)` ë³µí•© ì¸ë±ìŠ¤ (Primary Keyë¡œ ì´ë¯¸ ì¡´ìž¬)

**íŒŒì¼**: `supabase/migrations/025_simplify_messages_rls.sql:23-26`

#### 6.1.3 event_survey_entries

**ì£¼ìš” WHERE ì¡°ê±´**:
- `campaign_id = ?` (ìº íŽ˜ì¸ë³„ ì¡°íšŒ)

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
- í™•ì¸ í•„ìš” (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ í™•ì¸)

#### 6.1.4 event_access_logs

**ì£¼ìš” WHERE ì¡°ê±´**:
- `webinar_id = ? AND time_bucket >= ? AND time_bucket < ?` (í†µê³„ ì¡°íšŒ)

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
- í™•ì¸ í•„ìš” (ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ í™•ì¸)

#### 6.1.5 profiles

**ì£¼ìš” WHERE ì¡°ê±´**:
- `id IN (?)` (ë°°ì¹˜ ì¡°íšŒ)

**í•„ìš”í•œ ì¸ë±ìŠ¤**:
- âœ… `id` ì¸ë±ìŠ¤ (Primary Keyë¡œ ì´ë¯¸ ì¡´ìž¬)
- âœ… `email` ì¸ë±ìŠ¤ (ë§ˆì´ê·¸ë ˆì´ì…˜ 095ì—ì„œ ìƒì„± ì‹œë„, ì£¼ì„ ì²˜ë¦¬ë¨)

**íŒŒì¼**: `supabase/migrations/095_add_performance_indexes.sql`

### 6.2 ì¸ë±ìŠ¤ ëˆ„ë½ìœ¼ë¡œ í’€ìŠ¤ìº” ê°€ëŠ¥ì„± ìžˆëŠ” ì¿¼ë¦¬

| í…Œì´ë¸” | ì¿¼ë¦¬ íŒ¨í„´ | ì¸ë±ìŠ¤ ì¡´ìž¬ ì—¬ë¶€ | í’€ìŠ¤ìº” ìœ„í—˜ë„ |
|---|---|---|---|
| `webinar_live_presence` | `webinar_id = ? AND last_seen_at >= ?` | í™•ì¸ í•„ìš” | **High** (í˜„ìž¬ ì ‘ì†ìž ì¡°íšŒê°€ 5ì´ˆë§ˆë‹¤ ì‹¤í–‰) |
| `event_access_logs` | `webinar_id = ? AND time_bucket >= ? AND time_bucket < ?` | í™•ì¸ í•„ìš” | **Medium** (í†µê³„ ì¡°íšŒ) |

**ê¶Œìž¥ ì¡°ì¹˜**: ì¸ë±ìŠ¤ ì¡´ìž¬ ì—¬ë¶€ í™•ì¸ ë° ëˆ„ë½ ì‹œ ìƒì„±

---

## 7. ì¸ì¦/ë¡œê·¸ì¸ ê²½ë¡œ ë¶„ì„

### 7.1 ì°¸ê°€ìž ë¡œê·¸ì¸ ê²½ë¡œ

**íŒŒì¼**: `app/api/auth/email-signup/route.ts`

**ë‹¨ê³„ë³„ ë¶„ì„**:

| ë‹¨ê³„ | ìž‘ì—… | JWTë¡œ ëŒ€ì²´ ê°€ëŠ¥í•œê°€? | ë°˜ë“œì‹œ DB ì¡°íšŒ í•„ìš”í•œê°€? | íŒŒì¼ ìœ„ì¹˜ |
|---|---|---|---|---|
| 1 | JWT ê²€ì¦ | âœ… JWT ìžì²´ | âŒ í•„ìš” ì—†ìŒ | `createServerSupabase()` |
| 2 | ì‚¬ìš©ìž ì¡´ìž¬ í™•ì¸ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `auth.users` í…Œì´ë¸” ì¡°íšŒ |
| 3 | í”„ë¡œí•„ ìƒì„±/ì¡°íšŒ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `profiles` í…Œì´ë¸” ì¡°íšŒ |
| 4 | ì›¨ë¹„ë‚˜ ë“±ë¡ í™•ì¸ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `registrations` í…Œì´ë¸” ì¡°íšŒ |
| 5 | ì„¸ì…˜ ìƒì„± | âœ… JWT í† í° | âŒ í•„ìš” ì—†ìŒ | Supabase Auth |

**DB ì¡°íšŒ ë‹¨ê³„**:
1. `auth.users` ì¡°íšŒ (ì‚¬ìš©ìž ì¡´ìž¬ í™•ì¸)
2. `profiles` ì¡°íšŒ (í”„ë¡œí•„ ì •ë³´)
3. `registrations` ì¡°íšŒ (ì›¨ë¹„ë‚˜ ë“±ë¡ í™•ì¸)

**ì´ DB ì¿¼ë¦¬ ìˆ˜**: 3íšŒ (ë¡œê·¸ì¸ ì‹œ)

### 7.2 ê´€ë¦¬ìž ë¡œê·¸ì¸ ê²½ë¡œ

**íŒŒì¼**: `app/api/auth/dashboard/route.ts`

**ë‹¨ê³„ë³„ ë¶„ì„**:

| ë‹¨ê³„ | ìž‘ì—… | JWTë¡œ ëŒ€ì²´ ê°€ëŠ¥í•œê°€? | ë°˜ë“œì‹œ DB ì¡°íšŒ í•„ìš”í•œê°€? | íŒŒì¼ ìœ„ì¹˜ |
|---|---|---|---|---|
| 1 | JWT ê²€ì¦ | âœ… JWT ìžì²´ | âŒ í•„ìš” ì—†ìŒ | `createServerSupabase()` |
| 2 | ìŠˆí¼ ê´€ë¦¬ìž í™•ì¸ | âœ… JWT app_metadata | âŒ í•„ìš” ì—†ìŒ | `user.app_metadata.is_super_admin` |
| 3 | í”„ë¡œí•„ ì¡°íšŒ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `profiles` í…Œì´ë¸” ì¡°íšŒ |
| 4 | ì—ì´ì „ì‹œ ë©¤ë²„ì‹­ í™•ì¸ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `agency_members` í…Œì´ë¸” ì¡°íšŒ |
| 5 | í´ë¼ì´ì–¸íŠ¸ ë©¤ë²„ì‹­ í™•ì¸ | âŒ ë¶ˆê°€ëŠ¥ | âœ… í•„ìš” | `client_members` í…Œì´ë¸” ì¡°íšŒ |

**DB ì¡°íšŒ ë‹¨ê³„**:
1. `profiles` ì¡°íšŒ (í”„ë¡œí•„ ì •ë³´)
2. `agency_members` ì¡°íšŒ (ì—ì´ì „ì‹œ ë©¤ë²„ì‹­)
3. `client_members` ì¡°íšŒ (í´ë¼ì´ì–¸íŠ¸ ë©¤ë²„ì‹­)

**ì´ DB ì¿¼ë¦¬ ìˆ˜**: 3íšŒ (ë¡œê·¸ì¸ ì‹œ)

**ìž¬ì‹œë„ ë¡œì§**: âœ… ìžˆìŒ (ë¼ì¸ 34-58, ì§€ìˆ˜ ë°±ì˜¤í”„)

### 7.3 ì¸ì¦ì´ ëŠë¦° ì´ìœ 

**JWTë¡œ ëŒ€ì²´ ê°€ëŠ¥í•œ ë‹¨ê³„**:
- âœ… ìŠˆí¼ ê´€ë¦¬ìž í™•ì¸: `user.app_metadata.is_super_admin` (ì´ë¯¸ êµ¬í˜„ë¨)

**ë°˜ë“œì‹œ DB ì¡°íšŒê°€ í•„ìš”í•œ ë‹¨ê³„**:
- âŒ í”„ë¡œí•„ ì •ë³´: `profiles` í…Œì´ë¸” ì¡°íšŒ
- âŒ ë©¤ë²„ì‹­ í™•ì¸: `agency_members`, `client_members` í…Œì´ë¸” ì¡°íšŒ
- âŒ ì›¨ë¹„ë‚˜ ë“±ë¡ í™•ì¸: `registrations` í…Œì´ë¸” ì¡°íšŒ

**ê²°ë¡ **: ì¸ì¦ì´ ëŠë¦° ì´ìœ ëŠ” JWTê°€ ì•„ë‹ˆë¼ **DB ì˜ì¡´ êµ¬ì¡°**ìž…ë‹ˆë‹¤. ë©¤ë²„ì‹­ ì •ë³´ë¥¼ JWTì— í¬í•¨ì‹œí‚¤ë©´ ì¼ë¶€ DB ì¡°íšŒë¥¼ ì œê±°í•  ìˆ˜ ìžˆìœ¼ë‚˜, í”„ë¡œí•„ ì •ë³´ëŠ” ì—¬ì „ížˆ DB ì¡°íšŒê°€ í•„ìš”í•©ë‹ˆë‹¤.

---

## 8. ìµœì¢… ìš”ì•½

### 8.1 ì§ì ‘ íŠ¸ë¦¬ê±° TOP 3

#### 1ìœ„: registrations.id ì°¸ì¡°ë¡œ ì¸í•œ 400 ì—ëŸ¬ í­ë°œ

**ìœ„ì¹˜**: 
- `app/api/webinars/[webinarId]/presence/ping/route.ts:69, 117, 148`
- `app/api/webinars/[webinarId]/access/track/route.ts:52`

**ì˜í–¥**:
- 1,000ëª… ë™ì‹œ ì ‘ì† ì‹œ 1ë¶„ë‹¹ ì•½ 1,700ê±´ì˜ 400 ì—ëŸ¬ ë°œìƒ
- ì›¨ë¹„ë‚˜ ì‹œìž‘ í›„ ì²« 2ë¶„ ë™ì•ˆ ì•½ 2,000ê±´ì˜ 400 ì—ëŸ¬ ì§‘ì¤‘ ë°œìƒ

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- Presence ping (120ì´ˆ ì£¼ê¸°) + Access track (ìž…ìž¥ ì‹œ) ë™ì‹œ í˜¸ì¶œ
- ìž¬ì‹œë„ ë¡œì§ ì—†ìŒ â†’ ë‹¤ìŒ ì£¼ê¸°ê¹Œì§€ ëŒ€ê¸°í•˜ì§€ë§Œ ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ì§§ì€ ì‹œê°„ ë‚´ ì§‘ì¤‘ ë°œìƒ

#### 2ìœ„: ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ 5ì´ˆ í´ë§

**ìœ„ì¹˜**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx:530-533`

**ì˜í–¥**:
- ê´€ë¦¬ìž 1ëª…ì´ 5ì´ˆë§ˆë‹¤ 6~8ê°œ ì¿¼ë¦¬ ì‹¤í–‰
- ì‹œê°„ë‹¹ 720~960ê°œ ì¿¼ë¦¬ ë°œìƒ
- ë™ì¼ DBë¥¼ ê³µìœ í•˜ë¯€ë¡œ ì°¸ê°€ìž ìš”ì²­ê³¼ ê²½í•©

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- ë¬´í•œ ë°˜ë³µ (ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€)
- ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë‹¤ìŒ ì£¼ê¸°ê¹Œì§€ ëŒ€ê¸° í›„ ê³„ì† ì‹¤í–‰

#### 3ìœ„: ì¤‘ë³µ ë“±ë¡ ì‹œë„ë¡œ ì¸í•œ 409 ì—ëŸ¬

**ìœ„ì¹˜**:
- `app/api/webinars/[webinarId]/presence/ping/route.ts:98-105`
- `app/api/webinars/[webinarId]/register/route.ts:60-68`

**ì˜í–¥**:
- ë™ì‹œì— ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì¼í•œ `(webinar_id, user_id)` ì¡°í•©ìœ¼ë¡œ INSERT ì‹œë„
- ì¤‘ë³µ í‚¤ ì—ëŸ¬ ë°œìƒ â†’ DB ë¶€í•˜ ì¦ê°€

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- ì›¨ë¹„ë‚˜ ì‹œìž‘ ì‹œ ëª¨ë“  ì‚¬ìš©ìžê°€ ë™ì‹œì— ë“±ë¡ ì‹œë„
- Race conditionìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ í‚¤ ì—ëŸ¬

### 8.2 íŠ¸ëž˜í”½ ì¦í­ê¸° TOP 3

#### 1ìœ„: Presence Ping (120ì´ˆ ì£¼ê¸°)

**ìœ„ì¹˜**: `components/webinar/hooks/usePresencePing.ts`

**ì¦í­ ë°°ìœ¨**: 
- 1,000ëª… ë™ì‹œ ì ‘ì† ì‹œ ì‹œê°„ë‹¹ ì•½ 30,000íšŒ ìš”ì²­
- ê° ìš”ì²­ë§ˆë‹¤ 4~10ê°œ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì‹œê°„ë‹¹ ì•½ 120,000~300,000ê°œ ì¿¼ë¦¬

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- ëª¨ë“  ì°¸ê°€ìžê°€ ë™ì‹œì— í˜¸ì¶œ (ì§€í„° Â±10ì´ˆë¡œ ì•½ê°„ ë¶„ì‚°)
- ë¬´í•œ ë°˜ë³µ (íŽ˜ì´ì§€ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€)

#### 2ìœ„: ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ (5ì´ˆ ì£¼ê¸°)

**ìœ„ì¹˜**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx`

**ì¦í­ ë°°ìœ¨**:
- ê´€ë¦¬ìž 1ëª…ì´ 5ì´ˆë§ˆë‹¤ í˜¸ì¶œ
- ì‹œê°„ë‹¹ 720íšŒ ìš”ì²­
- ê° ìš”ì²­ë§ˆë‹¤ 6~8ê°œ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì‹œê°„ë‹¹ ì•½ 4,320~5,760ê°œ ì¿¼ë¦¬

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- ë¬´í•œ ë°˜ë³µ (ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ê¹Œì§€)
- ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ê³„ì† ì‹¤í–‰

#### 3ìœ„: Chat í´ë°± í´ë§ (2ì´ˆ ì£¼ê¸°, Realtime ì‹¤íŒ¨ ì‹œ)

**ìœ„ì¹˜**: `components/webinar/Chat.tsx:1275-1424`

**ì¦í­ ë°°ìœ¨**:
- Realtime ì‹¤íŒ¨ ì‹œ ëª¨ë“  ì°¸ê°€ìžê°€ 2ì´ˆë§ˆë‹¤ í˜¸ì¶œ
- 1,000ëª… ë™ì‹œ ì ‘ì† ì‹œ ì‹œê°„ë‹¹ ì•½ 1,800,000íšŒ ìš”ì²­
- ê° ìš”ì²­ë§ˆë‹¤ 1ê°œ ì¿¼ë¦¬ ì‹¤í–‰ â†’ ì‹œê°„ë‹¹ ì•½ 1,800,000ê°œ ì¿¼ë¦¬

**ì¦í­ ë©”ì»¤ë‹ˆì¦˜**:
- Realtime ì‹¤íŒ¨ ì‹œ ìžë™ìœ¼ë¡œ í´ë°± í´ë§ í™œì„±í™”
- ì§€ìˆ˜ ë°±ì˜¤í”„ ì ìš© (ìµœëŒ€ 60ì´ˆ)í•˜ì§€ë§Œ ì—¬ì „ížˆ ë†’ì€ ë¹ˆë„

### 8.3 êµ¬ì¡°ì  ì›ì¸

#### 1. ë©€í‹°í…Œë„Œì‹œ êµ¬ì¡°

**ë¬¸ì œì **:
- ëª¨ë“  ì›¨ë¹„ë‚˜ê°€ ë™ì¼ DBë¥¼ ê³µìœ 
- í•œ ì›¨ë¹„ë‚˜ì˜ íŠ¸ëž˜í”½ì´ ë‹¤ë¥¸ ì›¨ë¹„ë‚˜ì— ì˜í–¥

**ì˜í–¥**:
- ì›¨ë¹„ë‚˜ ì‹œìž‘ ì‹œ ì§‘ì¤‘ëœ íŠ¸ëž˜í”½ì´ ì „ì²´ DB ì„±ëŠ¥ ì €í•˜

#### 2. RLS ì •ì±… ì„±ëŠ¥

**ë¬¸ì œì **:
- `webinar_live_presence`, `messages` í…Œì´ë¸”ì˜ EXISTS ì„œë¸Œì¿¼ë¦¬ ê¸°ë°˜ RLS ì •ì±…
- ê³ ë¹ˆë„ í˜¸ì¶œ ì‹œ ì„œë¸Œì¿¼ë¦¬ ë¹„ìš© ì¦ê°€

**ì˜í–¥**:
- Presence pingë§ˆë‹¤ EXISTS ì„œë¸Œì¿¼ë¦¬ ì‹¤í–‰ â†’ ì„±ëŠ¥ ì €í•˜

#### 3. N+1 ì¿¼ë¦¬ (ìž¥ì•  ë‹¹ì‹œ)

**ë¬¸ì œì **:
- DashboardTabì—ì„œ í”„ë¡œí•„ ì •ë³´ë¥¼ ê°œë³„ APIë¡œ ì¡°íšŒ (í˜„ìž¬ëŠ” ê°œì„ ë¨)

**ì˜í–¥**:
- í˜„ìž¬ ì ‘ì†ìž 265ëª… Ã— ê°œë³„ API í˜¸ì¶œ = 26.5ì´ˆ ì´ìƒ ì§€ì—°

#### 4. ìž¬ì‹œë„ ë¡œì§ ë¶€ìž¬

**ë¬¸ì œì **:
- 400 ì—ëŸ¬ ë°œìƒ ì‹œ ìž¬ì‹œë„ ì—†ìŒ
- ë‹¤ìŒ ì£¼ê¸°ê¹Œì§€ ëŒ€ê¸°í•˜ì§€ë§Œ ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ì§§ì€ ì‹œê°„ ë‚´ ì§‘ì¤‘ ë°œìƒ

**ì˜í–¥**:
- ì—ëŸ¬ê°€ ëˆ„ì ë˜ì§€ ì•Šì§€ë§Œ ë™ì‹œ ìš”ì²­ìœ¼ë¡œ ì¸í•´ ì§§ì€ ì‹œê°„ ë‚´ ì§‘ì¤‘ ë°œìƒ

### 8.4 ìš°ì„  ìˆ˜ì • ëŒ€ìƒ TOP 5

#### 1ìœ„: registrations.id ì°¸ì¡° ì œê±°

**íŒŒì¼**:
- `app/api/webinars/[webinarId]/presence/ping/route.ts:69, 117, 148`
- `app/api/webinars/[webinarId]/access/track/route.ts:52`

**ìˆ˜ì • ë‚´ìš©**:
- `.select('id')` â†’ `.select('webinar_id, user_id')` ë˜ëŠ” ì œê±°

**ê¸°ëŒ€ íš¨ê³¼**: 400 ì—ëŸ¬ ì™„ì „ ì œê±° â†’ ìš”ì²­ ìˆ˜ ê°ì†Œ ë°°ìœ¨: **ë¬´í•œëŒ€** (ì—ëŸ¬ ì œê±°)

#### 2ìœ„: ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ ì£¼ê¸° ì¦ê°€

**íŒŒì¼**: `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx:530-533`

**ìˆ˜ì • ë‚´ìš©**:
- 5ì´ˆ â†’ 10ì´ˆ ë˜ëŠ” 15ì´ˆë¡œ ì¦ê°€
- ë˜ëŠ” Realtime Presenceë¡œ ì „í™˜

**ê¸°ëŒ€ íš¨ê³¼**: ìš”ì²­ ìˆ˜ 50~66% ê°ì†Œ â†’ ì‹œê°„ë‹¹ ì¿¼ë¦¬ ìˆ˜: 4,320~5,760ê°œ â†’ 2,160~2,880ê°œ

#### 3ìœ„: Presence Ping ìµœì í™”

**íŒŒì¼**: `app/api/webinars/[webinarId]/presence/ping/route.ts`

**ìˆ˜ì • ë‚´ìš©**:
- ë“±ë¡ í™•ì¸ ê²°ê³¼ ìºì‹± (ì§§ì€ TTL, ì˜ˆ: 60ì´ˆ)
- ìžë™ ë“±ë¡ ë¡œì§ ìµœì í™” (ì¤‘ë³µ ì²´í¬ ì œê±°)

**ê¸°ëŒ€ íš¨ê³¼**: ì¿¼ë¦¬ ìˆ˜ 30~50% ê°ì†Œ â†’ ì‹œê°„ë‹¹ ì¿¼ë¦¬ ìˆ˜: 120,000~300,000ê°œ â†’ 60,000~150,000ê°œ

#### 4ìœ„: RLS ì •ì±… ìµœì í™”

**íŒŒì¼**: `supabase/migrations/033_create_webinar_stats_v2.sql`

**ìˆ˜ì • ë‚´ìš©**:
- `webinar_live_presence` RLS ì •ì±…ì˜ EXISTS ì„œë¸Œì¿¼ë¦¬ ìµœì í™”
- ì¸ë±ìŠ¤ í™œìš© ê°€ëŠ¥í•˜ë„ë¡ ì •ì±… ìˆ˜ì •

**ê¸°ëŒ€ íš¨ê³¼**: ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ 50~70% ê°ì†Œ

#### 5ìœ„: ìž¬ì‹œë„ ë¡œì§ ì¶”ê°€

**íŒŒì¼**: `components/webinar/hooks/usePresencePing.ts`

**ìˆ˜ì • ë‚´ìš©**:
- 400 ì—ëŸ¬ ë°œìƒ ì‹œ ì§€ìˆ˜ ë°±ì˜¤í”„ë¡œ ìž¬ì‹œë„ (ìµœëŒ€ 2íšŒ)

**ê¸°ëŒ€ íš¨ê³¼**: 400 ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ìž¬ì‹œë„ â†’ ì—ëŸ¬ í•´ê²° ê°€ëŠ¥ì„± ì¦ê°€

### 8.5 ìˆ˜ì • ì‹œ ê¸°ëŒ€ íš¨ê³¼ (ìš”ì²­ ìˆ˜ ê°ì†Œ ë°°ìœ¨ ì¶”ì •)

| ìˆ˜ì • í•­ëª© | í˜„ìž¬ ìš”ì²­ ìˆ˜ (ì‹œê°„ë‹¹) | ìˆ˜ì • í›„ ìš”ì²­ ìˆ˜ (ì‹œê°„ë‹¹) | ê°ì†Œ ë°°ìœ¨ |
|---|---|---|---|
| registrations.id ì°¸ì¡° ì œê±° | 400 ì—ëŸ¬ 1,700ê±´/ë¶„ | **0ê±´** | **ë¬´í•œëŒ€** (ì—ëŸ¬ ì œê±°) |
| ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ (5ì´ˆ â†’ 10ì´ˆ) | 720íšŒ | **360íšŒ** | **2ë°°** |
| Presence Ping ìµœì í™” | 30,000íšŒ | **15,000íšŒ** | **2ë°°** |
| RLS ì •ì±… ìµœì í™” | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ê¸°ì¤€ | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ 50~70% ê°ì†Œ | **2~3ë°°** (ì‹¤í–‰ ì‹œê°„ ê¸°ì¤€) |
| ìž¬ì‹œë„ ë¡œì§ ì¶”ê°€ | 400 ì—ëŸ¬ ëˆ„ì  | 400 ì—ëŸ¬ ì¦‰ì‹œ í•´ê²° | **ì—ëŸ¬ í•´ê²°ìœ¨ ì¦ê°€** |

**ì´ ê¸°ëŒ€ íš¨ê³¼**: 
- 400 ì—ëŸ¬ ì™„ì „ ì œê±°
- ì‹œê°„ë‹¹ ìš”ì²­ ìˆ˜ ì•½ **50% ê°ì†Œ**
- ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ì•½ **50~70% ê°ì†Œ**

---

## 9. ê²°ë¡ 

### 9.1 ìž¥ì•  ì›ì¸ ìš”ì•½

1. **ì§ì ‘ íŠ¸ë¦¬ê±°**: `registrations.id` ì°¸ì¡°ë¡œ ì¸í•œ 400 ì—ëŸ¬ í­ë°œ
2. **íŠ¸ëž˜í”½ ì¦í­ê¸°**: Presence Ping (120ì´ˆ ì£¼ê¸°) + ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ (5ì´ˆ ì£¼ê¸°)
3. **êµ¬ì¡°ì  ì›ì¸**: ë©€í‹°í…Œë„Œì‹œ êµ¬ì¡°, RLS ì •ì±… ì„±ëŠ¥, ìž¬ì‹œë„ ë¡œì§ ë¶€ìž¬

### 9.2 ê¶Œìž¥ ì¡°ì¹˜

1. **ì¦‰ì‹œ ìˆ˜ì •** (ê¸´ê¸‰):
   - `registrations.id` ì°¸ì¡° ì œê±°
   - ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ í´ë§ ì£¼ê¸° ì¦ê°€ (5ì´ˆ â†’ 10ì´ˆ)

2. **ë‹¨ê¸° ìˆ˜ì •** (1ì£¼ì¼ ë‚´):
   - Presence Ping ìµœì í™” (ë“±ë¡ í™•ì¸ ìºì‹±)
   - ìž¬ì‹œë„ ë¡œì§ ì¶”ê°€

3. **ì¤‘ê¸° ìˆ˜ì •** (1ê°œì›” ë‚´):
   - RLS ì •ì±… ìµœì í™”
   - ì¸ë±ìŠ¤ ì¶”ê°€/ìµœì í™”

### 9.3 ì˜ˆë°© ì¡°ì¹˜

1. **ëª¨ë‹ˆí„°ë§ ê°•í™”**:
   - 400/409 ì—ëŸ¬ ì‹¤ì‹œê°„ ì•Œë¦¼
   - DB ì¿¼ë¦¬ ìˆ˜ ëª¨ë‹ˆí„°ë§

2. **ë¶€í•˜ í…ŒìŠ¤íŠ¸**:
   - ëŒ€ê·œëª¨ ë™ì‹œ ì ‘ì† ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
   - íŠ¸ëž˜í”½ ì¦í­ ì‹œë®¬ë ˆì´ì…˜

3. **ì½”ë“œ ë¦¬ë·°**:
   - í´ë§ ë¡œì§ ì£¼ê¸° ê²€í† 
   - ìž¬ì‹œë„ ë¡œì§ ê²€í† 

---

**ë³´ê³ ì„œ ìž‘ì„± ì™„ë£Œì¼**: 2026-02-07  
**ë¶„ì„ìž**: AI Assistant (Composer)  
**ì°¸ê³  ë¬¸ì„œ**:
- `docs/ì›¨ë¹„ë‚˜_íŠ¸ëž˜í”½_ì¦í­_ë§µ.md`
- `docs/400_Bad_Request_ê·¼ê±°_ìˆ˜ì§‘_ë¶„ì„.md`
- `docs/ì„œë²„_ë¶€í•˜_ë¡œê·¸_ë¶„ì„_2026-02-06.md`
