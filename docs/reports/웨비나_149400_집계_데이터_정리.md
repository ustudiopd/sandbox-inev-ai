# 웨비나 149400 집계 데이터 정리

## 개요
- 웨비나: [테스트] 149400 웨비나
- 경로: `/149400`
- 수집 기간: 웨비나 시작 시간 1시간 전 ~ 웨비나 종료 시간 (또는 현재 시간)

---

## 1. 접속 통계 (Access)

### 1.1 실시간 데이터
- **현재 접속자 수**: `webinar_live_presence` 테이블에서 `last_seen_at >= now() - 3 minutes`인 사용자 수
- **현재 접속자 목록**: 
  - 사용자 ID, 표시 이름, 이메일, 역할, 마지막 활동 시간, 입장 시간
  - `profiles`, `registrations` 테이블과 조인하여 정보 제공

### 1.2 집계 데이터
- **입장한 사람 수**: `webinar_live_presence`에서 `joined_at`이 있는 고유 `user_id` 수
- **최대 동시 접속자 수**: `webinar_access_logs.max_participants`의 최대값
- **평균 동시 접속자 수**: `webinar_access_logs.sum_participants / sample_count`의 평균

### 1.3 타임라인 데이터
- **시간대별 접속 통계**: `webinar_access_logs` 테이블 기반
  - 시간대별 평균 접속자 수
  - 시간대별 최대 접속자 수
  - 시간대별 최소 접속자 수
  - 시간대별 마지막 접속자 수
- **피크 시간대**: 최대 동시 접속자가 발생한 시간

### 데이터 소스
- `webinar_live_presence` (실시간 접속 정보)
- `webinar_access_logs` (시간대별 집계 로그)

---

## 2. 채팅 통계 (Chat)

### 2.1 기본 통계
- **총 메시지 수**: `messages` 테이블에서 `webinar_id = 149400`, `hidden = false`인 메시지 수
- **고유 발신자 수**: 메시지를 보낸 고유 `user_id` 수
- **채팅 참여율**: (고유 발신자 수 / 총 등록자 수) × 100

### 2.2 타임라인 데이터
- **시간대별 메시지 수**: 5분 단위 버킷별 집계
- **시간대별 발신자 수**: 각 시간대에 메시지를 보낸 고유 사용자 수
- **피크 시간대**: 메시지 수가 가장 많았던 시간

### 2.3 상위 발신자
- **Top 10 발신자**: 메시지 수가 많은 상위 10명
  - 사용자 ID, 닉네임, 메시지 수
  - `registrations.nickname` 또는 `profiles.nickname` 우선 사용

### 데이터 소스
- `messages` 테이블
- `registrations` 테이블 (닉네임 조회)
- `profiles` 테이블 (닉네임 조회)

---

## 3. Q&A 통계 (QA)

### 3.1 기본 통계
- **총 질문 수**: `questions` 테이블에서 `webinar_id = 149400`, `status != 'hidden'`인 질문 수
- **답변된 질문 수**: `answered_at`이 있는 질문 수
- **고유 질문자 수**: 질문을 작성한 고유 `user_id` 수

### 3.2 답변 시간 통계
- **평균 답변 시간**: 질문 작성부터 답변까지의 평균 시간 (분 단위)
- **최소 답변 시간**: 가장 빠른 답변 시간
- **최대 답변 시간**: 가장 느린 답변 시간

### 3.3 타임라인 데이터
- **시간대별 질문 수**: 5분 단위 버킷별 집계
- **시간대별 답변 수**: 각 시간대에 답변된 질문 수

### 3.4 답변 시간 분포
- 5분 이내
- 10분 이내
- 30분 이내
- 1시간 이내
- 1시간 이상

### 3.5 상위 질문자
- **Top 10 질문자**: 질문 수가 많은 상위 10명
  - 사용자 ID, 닉네임, 질문 수

### 데이터 소스
- `questions` 테이블
- `registrations` 테이블 (닉네임 조회)
- `profiles` 테이블 (닉네임 조회)

---

## 4. 폼/퀴즈 통계 (Forms)

### 4.1 기본 통계
- **총 설문 수**: `forms` 테이블에서 `webinar_id = 149400`, `kind = 'survey'`인 폼 수
- **총 퀴즈 수**: `forms` 테이블에서 `webinar_id = 149400`, `kind = 'quiz'`인 폼 수

### 4.2 설문 제출 통계
- **총 제출 수**: `form_submissions` 테이블에서 해당 설문 폼들의 제출 수
- **고유 응답자 수**: 설문에 응답한 고유 `participant_id` 수

### 4.3 퀴즈 시도 통계
- **총 시도 수**: `quiz_attempts` 테이블에서 해당 퀴즈 폼들의 시도 수
- **고유 참여자 수**: 퀴즈에 참여한 고유 `participant_id` 수
- **평균 점수**: 모든 시도의 평균 점수
- **최고 점수**: 가장 높은 점수
- **최저 점수**: 가장 낮은 점수

### 데이터 소스
- `forms` 테이블
- `form_submissions` 테이블
- `quiz_attempts` 테이블

---

## 5. 추첨 통계 (Giveaways)

### 5.1 기본 통계
- **총 추첨 수**: `giveaways` 테이블에서 `webinar_id = 149400`인 추첨 수
- **완료된 추첨 수**: `status = 'drawn'`인 추첨 수
- **총 참여 수**: `giveaway_entries` 테이블에서 해당 추첨들의 참여 수
- **고유 참여자 수**: 추첨에 참여한 고유 `participant_id` 수

### 5.2 타임라인 데이터
- **시간대별 참여 수**: 5분 단위 버킷별 집계
- **시간대별 참여자 수**: 각 시간대에 참여한 고유 사용자 수

### 데이터 소스
- `giveaways` 테이블
- `giveaway_entries` 테이블

---

## 6. 파일 통계 (Files)

### 6.1 기본 통계
- **총 파일 수**: `webinar_files` 테이블에서 `webinar_id = 149400`인 파일 수
- **총 다운로드 수**: `webinar_downloads` 테이블에서 해당 웨비나의 다운로드 수
- **고유 다운로더 수**: 파일을 다운로드한 고유 `user_id` 수

### 6.2 파일별 다운로드 통계
- **파일별 다운로드 수**: 각 파일의 다운로드 횟수
  - 파일 ID, 파일명, 파일 크기, 다운로드 수
  - 다운로드 수 기준 내림차순 정렬

### 데이터 소스
- `webinar_files` 테이블
- `webinar_downloads` 테이블

---

## 7. 등록자 통계 (Registrants)

### 7.1 기본 통계
- **총 등록자 수**: 
  - `registration_campaign_id`가 있으면: `event_survey_entries` 테이블에서 `campaign_id`로 조회
  - 없으면: `registrations` 테이블에서 `webinar_id = 149400`으로 조회
- **최대 동시 접속자 수**: `webinar_access_logs.max_participants`의 최대값

### 7.2 등록 출처별 통계
- **등록 출처별 수**: `registrations.registered_via` 기준 집계
  - `webinar`: 웨비나 직접 등록
  - `registration_page`: 등록 페이지를 통한 등록
  - `manual`: 수동 등록
  - 기타

### 데이터 소스
- `registrations` 테이블
- `event_survey_entries` 테이블 (등록 캠페인이 있는 경우)
- `webinar_access_logs` 테이블

---

## 8. 설문조사 통계 (Survey)

### 8.1 기본 정보
- **설문조사 캠페인 존재 여부**: `webinar.registration_campaign_id` 확인
- **캠페인 제목**: `event_survey_campaigns.title`
- **캠페인 상태**: `event_survey_campaigns.status`

### 8.2 통계 데이터
- **완료 수**: `event_survey_entries` 테이블에서 `campaign_id`로 조회한 총 수
- **검증 완료 수**: `verified_at`이 있는 항목 수
- **경품 기록 수**: `prize_recorded_at`이 있는 항목 수

### 데이터 소스
- `event_survey_campaigns` 테이블
- `event_survey_entries` 테이블

---

## 9. 통계 조회 API 엔드포인트

### 통합 통계 API
```
GET /api/webinars/149400/stats?sections=chat,qa,forms,giveaways,files,registrants,access,survey&interval=5m
```

### 개별 통계 API
- 접속 통계: `GET /api/webinars/149400/stats/access`
- 채팅 통계: `GET /api/webinars/149400/stats/chat`
- Q&A 통계: `GET /api/webinars/149400/stats/qa`
- 폼/퀴즈 통계: `GET /api/webinars/149400/stats/forms`
- 추첨 통계: `GET /api/webinars/149400/stats/giveaways`
- 파일 통계: `GET /api/webinars/149400/stats/files`
- 등록자 통계: `GET /api/webinars/149400/stats/registrants`
- 설문조사 통계: `GET /api/webinars/149400/stats/survey`

---

## 10. 데이터 수집 주기

### 실시간 데이터
- 현재 접속자 수: 실시간 (Presence 기반)
- 현재 접속자 목록: 실시간 (Presence 기반)

### 집계 데이터
- 접속 로그: 5분마다 집계 (`webinar_access_logs` 테이블에 저장)
- 타임라인 데이터: 5분 단위 버킷으로 집계
- 기본 통계: 실시간 조회 (필요 시)

---

## 11. 주요 테이블

1. **webinar_live_presence**: 실시간 접속 정보
2. **webinar_access_logs**: 시간대별 접속 집계 로그
3. **messages**: 채팅 메시지
4. **questions**: Q&A 질문
5. **forms**: 설문/퀴즈 폼
6. **form_submissions**: 설문 제출
7. **quiz_attempts**: 퀴즈 시도
8. **giveaways**: 추첨
9. **giveaway_entries**: 추첨 참여
10. **webinar_files**: 웨비나 파일
11. **webinar_downloads**: 파일 다운로드
12. **registrations**: 웨비나 등록
13. **event_survey_campaigns**: 설문조사 캠페인
14. **event_survey_entries**: 설문조사 응답
15. **profiles**: 사용자 프로필
16. **giveaway_winners**: 추첨 당첨자

---

## 12. 통계 표시 위치

### 관리자 대시보드
- **대시보드 탭**: 실시간 통계 및 요약 정보
- **통계 탭**: 상세 통계 및 차트

### 통계 카드
- 접속자 수
- 채팅 메시지 수
- Q&A 질문 수
- 설문/퀴즈 제출 수
- 추첨 참여 수
- 파일 다운로드 수

### 차트
- 시간대별 접속자 수 (라인 차트)
- 시간대별 메시지 수 (바 차트)
- 시간대별 질문 수 (바 차트)
- 시간대별 추첨 참여 수 (바 차트)
