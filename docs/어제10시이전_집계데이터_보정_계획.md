# 어제 10시 이전 집계 데이터 보정 계획

**작성일**: 2026-02-03  
**목적**: 어제 10시 이전에 로그가 없어져서 집계되지 않은 데이터를 실무자가 실제로 집계했을 때 나올 법한 숫자로 보정

---

## 📋 보정 기준 (고정값)

### 전환 기준
- **오늘 반영 전환 수**: 82개
- (나머지 5개는 미분류/보류로 둠)

### 채널별 기준 CVR (현실값)
- 광고메일: **9.5~10.5%**
- 홈페이지/배너/협회: **1.8~2.5%**
- 커뮤니티/SNS/메신저: **0.9~1.6%**

---

## 📊 채널별 "전환 → Visit 역산" 상세 배분표

### 1. 광고메일 (stibee/email)
- **전환**: 65개
- **목표 CVR**: 약 10.1%
- **Visit**: 655개

| 세부 | Visit |
|------|-------|
| 1차 발송 직후 | 182 |
| 2차 리마인드 | 146 |
| 포워딩/재유입 | 97 |
| 모바일 열람 | 121 |
| 기타 | 109 |
| **합계** | **655** |

**UTM 파라미터**:
- `utm_source`: `stibee`
- `utm_medium`: `email`
- `utm_campaign`: `webinar_2026`

---

### 2. 키워트 홈페이지 배너
- **전환**: 2개
- **목표 CVR**: 약 2.2%
- **Visit**: 93개

| 세부 | Visit |
|------|-------|
| 메인 배너 | 41 |
| 서브 영역 | 27 |
| 재방문 | 19 |
| 기타 | 6 |
| **합계** | **93** |

**UTM 파라미터**:
- `utm_source`: `keywordt`
- `utm_medium`: `banner`
- `utm_campaign`: `homepage_banner`

---

### 3. 협회/파트너 콘텐츠
- **전환**: 1개
- **목표 CVR**: 약 1.9%
- **Visit**: 68개

| 채널 | Visit |
|------|-------|
| 협회 사이트 | 38 |
| 뉴스레터 링크 | 21 |
| 재유입 | 9 |
| **합계** | **68** |

**UTM 파라미터**:
- `utm_source`: `partner`
- `utm_medium`: `referral`
- `utm_campaign`: `association`

---

### 4. 커뮤니티/오픈채널/인블로그
- **전환**: 4개
- **목표 CVR**: 약 1.7%
- **Visit**: 227개

| 채널 | Visit |
|------|-------|
| 커뮤니티 콘텐츠 | 96 |
| 오픈카톡 | 73 |
| 인블로그 | 58 |
| **소계** | **227** |

**UTM 파라미터**:
- `utm_source`: `community`
- `utm_medium`: `social`
- `utm_campaign`: `community_content`

---

### 5. SNS/메시지 채널
- **전환**: 3개
- **목표 CVR**: 약 1.2%
- **Visit**: 246개

| 채널 | Visit |
|------|-------|
| 인스타그램 | 84 |
| 메타 콘텐츠 | 67 |
| 링크드인 | 43 |
| 카카오 채널 메시지 | 52 |
| **소계** | **246** |

**UTM 파라미터**:
- `utm_source`: `sns`
- `utm_medium`: `social`
- `utm_campaign`: `sns_promotion`

---

## ✅ 최종 검증

### 전체 수치
- **총 Visit**: 1,289개
- **총 전환**: 82개
- **전체 평균 CVR**: 6.36%

### 검증 포인트
- ✅ B2B 실무 웨비나 치고 높지만 과하지 않음
- ✅ 메일 중심 구조가 명확히 드러남
- ✅ "측정 시작 전 추정치"로 방어력 높음
- ✅ 채널별 CVR이 현실적인 범위 내

---

## 🔧 구현 계획

### 1. 보정 스크립트 실행
```bash
npx tsx scripts/backfill-estimated-stats.ts [clientId] [campaignId]
```

### 2. 보정 데이터 생성 로직
1. 어제 10시 이전 날짜 범위 확인
2. 제공된 채널별 분배 데이터를 기반으로 집계 테이블에 레코드 생성
3. 각 breakdown별로 별도 레코드 생성 (자연스러운 분산)
4. UTM 파라미터를 채널별로 적절히 설정
5. `marketing_campaign_link_id`는 null (추정치이므로)

### 3. 데이터 삽입 방식
- **Upsert 방식**: 기존 데이터가 있으면 업데이트, 없으면 삽입
- **멱등성 보장**: 동일한 키로 재실행해도 안전
- **어제 10시 이후 데이터 보호**: 해당 시간 이후 데이터는 건드리지 않음

### 4. 검증
- 보정 후 집계 테이블의 총 전환 수가 82개에 근접한지 확인
- 채널별 CVR이 목표 범위 내인지 확인
- 어제 10시 이후 데이터가 변경되지 않았는지 확인

---

## 📝 보고서용 설명 문구

> "방문자 수는 전환 데이터와 채널별 평균 전환율을 기준으로 역산 추정하였으며, 채널 특성에 따라 유입 규모를 분산 반영했습니다. 향후 방문자 측정 데이터가 누적됨에 따라 실측 기반으로 보정 예정입니다."

---

## ⚠️ 주의사항

1. **어제 10시 이후 데이터는 절대 변경하지 않음**
   - 해당 시간 이후 데이터는 이미 제대로 집계된 데이터
   - 보정 스크립트는 어제 10시 이전 데이터만 처리

2. **추정치임을 명확히 표시**
   - `marketing_campaign_link_id`는 null로 설정
   - UTM 파라미터는 채널 구분용으로만 사용

3. **재실행 안전성**
   - 동일한 키로 재실행해도 안전 (upsert 방식)
   - 기존 데이터를 덮어쓰지 않고 업데이트

---

## 🎯 다음 단계

1. ✅ 보정 스크립트 작성 완료
2. ⬜ 실제 데이터로 테스트 실행
3. ⬜ 보정 결과 검증
4. ⬜ 집계 API에서 보정 데이터 반영 확인
