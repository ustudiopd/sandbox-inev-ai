
오케이. 지금 상황을 **개발용 템플릿(dev-inev-ai)** 기준으로 정리하면 이렇게 가야 해:

- 기본값: **서브도메인({client}.inev.ai)** 기준으로 링크 생성(이메일/문자/UTM/QR/shortlink)
    
- 고객이 커스텀 도메인을 원하면: **대표 도메인(canonical)** 을 선택 가능하게 하고, 링크는 전부 그걸로 생성
    
- 내부 운영/QA는: **Vercel preview** (고객 공유 금지)
    

아래는 **Phase 1~6 문서/요구사항에 “작업 추가(코드 방향이 아니라 ‘명세’ 추가)”**로 넣을 수 있는 형태로 정리했어.

---

# ✅ 추가해야 할 작업(명세): “도메인 선택 가능한 링크 생성” (Phase 1~6 소급 반영)

## 0) 새 개념 추가: Client Domain Policy (필수)

**Client마다 ‘대표 도메인’을 선택할 수 있게 한다.**

### 용어 정의

- **subdomain_domain**: `{client}.inev.ai` (기본값)
    
- **canonical_domain**: 고객 커스텀 도메인(있으면 이것이 외부 발송 기준)
    
- **internal_domain**: Vercel preview (`*.vercel.app`) (운영/QA 전용, 외부 공유 금지)
    

### 규칙(고정)

1. **외부 발송 링크 기준 도메인 = canonical_domain가 있으면 canonical, 없으면 subdomain**
    
2. internal_domain은 어떤 발송/UTM 링크에도 사용 금지
    
3. 링크 생성은 “도메인 선택 결과”만 바라보고, 나머지 로직은 동일
    

> 이 규칙을 문서에 “결정(Confirmed)”로 박아두면 이후 Phase가 흔들리지 않아.

---

## 1) Phase별로 문서에 추가해야 할 항목

## Phase 1 (Client/Event 컨테이너)

### ✅ 작업 추가: “도메인 설정(선택)” 섹션

- Client 설정에 아래 필드를 갖는다고 명시(구현은 나중, 지금은 문서만):
    
    - `canonical_domain` (nullable)
        
    - `subdomain_domain` (기본값: `{client}.inev.ai`)
        
    - `public_base_url` (계산값: canonical 있으면 canonical, 없으면 subdomain)
        

**DoD(문서용)**

- 이벤트/캠페인에서 링크 만들 때 항상 `public_base_url`을 사용한다고 명시
    

---

## Phase 3 (UTM/Visit)

### ✅ 작업 추가: “UTM 링크 생성은 public_base_url 기준”

- 기존: `{client}.inev.ai/s/...`
    
- 변경: `{public_base_url}/s/...`
    

**표준**

- `https://{public_base_url}/s/{code}?utm_source=...&utm_medium=...&utm_campaign=...`
    

**DoD**

- canonical이 설정되면 UTM 링크가 자동으로 canonical로 생성됨
    
- canonical이 없으면 subdomain으로 생성됨
    

---

## Phase 4 (Email)

### ✅ 작업 추가: “이메일 링크 생성은 public_base_url 기준”

- 템플릿 변수(예: `{{entry_url}}`)는 항상 아래 중 하나로 생성됨:
    
    - `https://{public_base_url}/s/{code}?u={email}`
        
    - (예외) `https://{public_base_url}/event/{slug}/enter?email=...`
        

**DoD**

- 고객 도메인이 설정되면 이메일 링크는 전부 고객 도메인만 사용
    

---

## Phase 5 (Entry Gate)

여기는 정책 동일. 단, 설명을 이렇게 고정:

- `/s` → `/entry` → 버튼 플로우는 **public_base_url과 동일 도메인 내부에서 실행**
    

---

## Phase 6 (Webinar)

웹비나 로직은 그대로. 대신 “외부 유입 링크”는 문서에서:

- `https://{public_base_url}/s/...` 로만 들어온다고 명시
    

---

# 2) “문서에 넣을 추가 블록” (복붙용)

아래 블록을 `docs/inev/inev_리빌딩_전체구현계획.md`의  
✅ 확정 결정 섹션(Confirmed Decisions) 하단에 추가하면 깔끔해.

```md
## D6. Client Domain Policy (링크 도메인 결정 규칙) — 확정

각 클라이언트는 외부에 노출되는 대표 도메인(public base url)을 가진다.

- 기본값: `{client}.inev.ai` (서브도메인)
- 고객 요청 시: `canonical_domain`(커스텀 도메인)을 대표 도메인으로 지정할 수 있다.
- 대표 도메인 선택 규칙:
  - `public_base_url = canonical_domain ?? subdomain_domain`
- 모든 외부 발송 링크(UTM/이메일/문자/QR/ShortLink)는 반드시 `public_base_url` 기준으로 생성한다.
- Vercel preview(`*.vercel.app`)는 내부 운영/QA/장애 대응 용도이며, 외부 발송 링크로 사용하지 않는다.
```

---

# 3) Phase 7(ShortLink) 명세도 같이 업데이트(중요)

Phase 7을 이렇게 정의하면 템플릿이 흔들리지 않아:

- ShortLink는 항상:
    
    - `https://{public_base_url}/s/{code}?...`
        

즉, **도메인만 바뀌고 경로/정책은 동일**.

---

# 4) 최종 체크(너의 요청에 대한 답)

> “1-6 작업한거에서 서브도메인이 있으면 서브도메인 기준으로 링크 만들고, 고객 도메인이 있으면 그걸 결정할 수 있게 작업 추가”

✅ 위 D6 + Phase 1/3/4에 “public_base_url” 개념을 넣는 것으로 해결됨.  
코드 없이도 **명세만으로도 팀이 절대 헷갈리지 않게** 됨.

---

원하면 다음 메시지에서,  
네가 올린 업데이트된 3개 문서 기준으로 **“실제 삽입 위치(몇 번째 섹션, 어디 아래)”**까지 찍어서  
Cursor가 바로 반영할 수 있는 **문서 패치 지시서**로 만들어줄게.