아래는 네가 적은 **Phase 10(대시보드/통계 재디자인)** 계획을, “inev.ai 리빌딩 원칙(이벤트 컨테이너 최상위, 실시간/비실시간 분리, fact 로그 기반)”에 맞춰 **문서 관점(누락/충돌/리스크/DoD/테스트)**로 검토한 내용이야.
(지금 갖고 있는 문서가 EventFlow(EventLive) 기준이라, 그걸 그대로 끌고 오면 다시 “통계/UTM 뷰가 제각각”이 재발할 가능성이 큼)  

---

## 1) Phase 10 추가 자체는 “필수”이고 방향도 맞아

* Phase 0~8로 **새 스키마(events, leads, event_visits, short_links, event_access_logs…)**로 갈아탔는데,
* 대시보드/통계가 여전히 EventFlow(=캠페인/웨비나 중심) 관성으로 남아 있으면
  **운영자가 보는 숫자/화면이 모듈마다 출처가 달라져서** 다시 혼선이 생김. 

네가 Phase 10에서 하려는 축(클라이언트 대시보드 → events 기준 / 이벤트 대시보드에 통계 탭 / 통계 API 분리)은 정답 방향이야.

---

## 2) Phase 10에서 “반드시 문장으로 확정”해야 하는 4개 결정

이 4개를 문서에 못 박지 않으면, 구현이 잘 돼도 시간이 지나면 다시 제각각으로 흩어져.

### D10-1. 대시보드의 최상위 단위는 무조건 Event

* Client 대시보드는 “웹비나 목록/캠페인 목록”이 아니라 **이벤트 목록 + 이벤트 요약 KPI**가 기본.
* Webinar는 **Event의 모듈**이지만, “콘솔/통계는 별도 화면”으로 분리.

> 이건 리빌딩의 “Event 컨테이너 최상위 강제” 원칙을 대시보드에도 적용하는 거야. 

### D10-2. 통계는 “이벤트 통계”와 “웨비나 통계”를 분리한다

EventFlow 문서에서 통계가 섞여 있던 게 문제였지. 
inev.ai는 아래 2레인으로 강제하는 게 좋다:

* **Event 통계(비실시간)**: 등록/설문/Email/Visit/UTM/ShortLink 클릭 등
* **Webinar 통계(실시간/준실시간)**: presence/세션/동시접속/시청시간/채팅/Q&A 등

그리고 웨비나 통계는 기존 원칙처럼 **라이브 화면 집계 금지, ping + 크론/버킷 기반** 유지.  

### D10-3. “UTM/Visit/ShortLink 클릭”의 소스 정의를 통일한다

지금 Phase 7에서 `/s` 클릭 로그를 `event_access_logs`에 쌓는다고 했잖아.
그런데 스키마에 `event_visits`도 있음(Phase 8 export 대상).
이 둘이 **정의가 분리되지 않으면** 대시보드에서 “Visit 수”가 어디서 나왔는지 다시 헷갈린다.

권장 정의(문서로 고정):

* `event_visits` = **페이지 방문(랜딩/등록/완료 등 page view 성격)**
* `event_access_logs` = **게이트(/s) 클릭, entry 진입 등 “접근 로그”**

  * 여기에 `source`/`action` 의미(예: `shortlink_click`, `entry_open`)를 문서로 고정

(테이블 변경이 아니라 **의미 체계**를 고정하는 게 핵심)

### D10-4. 통계 화면은 “탭 클릭 시 로드 + 자동 갱신 최소화”

EventFlow에서는 웨비나 콘솔이 5초 폴링 같은 핫패스가 있었고, 그 경험이 리빌드 원칙에 반영돼있어.  
Phase 10에서도 이 원칙을 유지해야 해:

* Client Dashboard: 기본 KPI는 캐시/지연 로드
* Event Dashboard: 탭 눌렀을 때만 API 호출
* Webinar Stats: 별도 페이지, 새로고침/수동 갱신 중심

---

## 3) 정보구조(IA) 제안: “이벤트 중심 + 웨비나는 별도 콘솔”

네가 말한 요구(“이벤트 안에서 웨비나 콘솔/웨비나 통계 별도”)를 가장 안정적으로 구현하는 구조야.

### A. Client Dashboard (클라이언트 한 눈에)

**목표**: “지금 이 클라이언트에서 어떤 이벤트가 있고, 각각 상태가 어떤가”

* KPI 카드 (기간 필터 기본 제공 권장)

  * 총 이벤트 수
  * 총 등록자(lead/participation 정의 필요)
  * 총 Visits (event_visits 기준)
  * 총 ShortLink 클릭 (event_access_logs 중 shortlink_click)
* 이벤트 테이블

  * 이벤트명 / 상태(Live/Closed) / 등록자 / Visits / UTM top source / Webinar 유무 / 최근 활동

### B. Event Dashboard (이벤트 상세)

**탭 구조(권장)**

1. Overview

* 이벤트 KPI + 최근 추이(있으면)

2. Registration

* leads/participations 리스트/요약

3. Marketing (UTM/Visits/ShortLinks)

* Visits / shortlink clicks / UTM breakdown / cid breakdown

4. Survey

* 응답 수 / 캠페인/폼(있으면)

5. Email

* 발송/오픈(있으면), 최소는 “캠페인/로그”

6. Webinar (모듈 ON일 때만 노출)

* “콘솔 열기” 버튼
* “웨비나 통계 보기” 버튼
* (선택) 요약 KPI만 3~4개 (동시접속 peak, 고유참석 등)

> Webinar 탭 안에서 실시간 상세를 다 해결하려고 하면, 결국 콘솔과 통계가 섞이면서 예전 구조로 회귀함.
> “요약 + 링크”로 제한하는 게 안정적이야. 

---

## 4) Phase 10 네 구현 계획에 대한 “수정/보완 제안”

네가 적은 항목을 기준으로, **바로 문서에 추가하면 좋은 보완점**만 짚을게.

### (1) Client Dashboard 수정 — OK, 근데 “기간 필터”와 “event 기준 KPI 정의”가 먼저

`webinars, event_survey_campaigns` → `events`로 바꾸는 건 맞아.
여기서 빠지면 안 되는 건 2가지:

* **기간 필터(from/to, KST 기준)**: 통계는 기간이 없으면 항상 의미가 흔들림
* **등록자 수 정의**:

  * `leads` 카운트인지
  * `event_participations` 카운트인지
  * 중복 이메일/중복 lead 처리 규칙은?
    → 이걸 문서로 1줄로 못 박고 API도 그 정의를 따르게 해야 해.

### (2) Event Dashboard 확장 — “통계 탭” 하나로 다 담지 말고 ‘모듈 탭’으로

네가 쓴 “통계 탭(등록자, Visit, 설문 응답, UTM 집계)”은 좋지만, 운영 UX는 더 깔끔하게:

* 통계는 “탭”이 아니라 **모듈 탭들(Registration/Marketing/Survey/Email/Webinar)** 에서 각각 보여주기
* Overview는 정말 요약만

이게 Event 중심 + 모듈 ON/OFF 구조랑 1:1로 맞물림. 

### (3) 통계 API 구현 — “한 방에 다 주는 API” 금지

`/statistics/overview` 같은 엔드포인트는 필요하지만, 다음을 권장:

* Overview API는 **가벼운 KPI만**
* UTM breakdown, CID breakdown 같은 무거운 집계는 **별도 endpoint/별도 include**
  예:

  * `/statistics/overview?from&to`
  * `/statistics/marketing?from&to&groupBy=utm_source`
  * `/statistics/marketing?from&to&groupBy=cid`

이렇게 해야 대시보드가 “항상 무거운 GROUP BY”를 때리지 않게 됨.

### (4) 통계 사전집계(선택적) — Phase 10에서는 “조건부”로만 열어두기

사전 집계 테이블은 좋은데, 바로 넣으면 Phase 10 범위가 커질 수 있어.

권장 문서화:

* Phase 10: **온디맨드 집계 + 인덱스**로 먼저
* 조건(예: event_access_logs 100만 row 이상 / 응답 2초↑)이 되면 Phase 10.1로 사전 집계 도입

---

## 5) 중요한 “문서 정합성 이슈” 2개 (Phase 10 전에 정리 추천)

통합 계획 문서가 이미 많은 부분 업데이트됐는데, 남아있는 문장 몇 개가 Phase 10 구현자 판단을 흔들 수 있어.

* (A) 도메인 역할 섹션에 **`inev.ai = 게이트`** 같은 표현 잔재
* (B) “/s는 inev.ai에서만…” 같은 실행 지시 잔재

이건 지금 너희가 확정한 “public_base_url(서브도메인 또는 커스텀) + vercel preview 내부용” 정책과 충돌 여지가 있어.
Phase 10 시작 전에 해당 문장만 정리해두는 게 좋아. 

---

## 6) Phase 10 DoD 제안(문서에 그대로 넣기 좋게)

Phase 10은 “화면 만들기”가 아니라 “운영 숫자의 정의를 고정”하는 단계야. 그래서 DoD는 이렇게 잡는 게 좋아.

### 기능 DoD

* Client Dashboard에서 events 기준 KPI/리스트 노출
* Event Dashboard에서 모듈별 탭(Registration/Marketing/Survey/Email/Webinar) 노출
* Webinar 탭은 “요약 + 콘솔/통계 링크”만 제공(상세는 별도)
* UTM/Visit/ShortLink 클릭의 정의가 문서에 고정되고, 화면/API가 그 정의를 따름

### 보안/RLS DoD

* client_id 범위 밖 데이터는 어떤 API에서도 조회 불가
* event_id를 바꿔 호출해도 다른 client의 이벤트 통계가 나오지 않음

### 성능 DoD

* Overview API는 가벼운 쿼리(카운트/간단 집계)로 제한
* UTM breakdown 등 무거운 집계는 탭 클릭 시에만 호출
* Webinar 통계는 라이브 화면 핫패스에 영향을 주지 않음(원칙 유지) 

---

## 7) “어떤 것부터?”에 대한 추천 우선순위

네가 적은 우선순위(클라 대시보드 → 통계 API → 이벤트 대시보드)도 일리는 있는데, **재작업을 줄이려면** 이렇게 가는 게 안전해:

1. **통계 정의/데이터 계약(문서) 먼저**

   * “등록자/Visit/Click/UTM” 정의를 확정
2. **Client Dashboard 수정**

   * 가장 많이 쓰고, KPI가 명확하면 UI는 빠르게 나옴
3. **Event Dashboard 확장(모듈 탭 구조로)**
4. **Webinar 통계는 별도 페이지/콘솔 연결**

   * 웨비나 통계는 기존 원칙(핑/크론/버킷) 그대로 가져오되 이벤트에서 연결만 깔끔히 

---

## 다음 액션(코드 없이 문서로)

원하면 내가 바로 Phase 10을 “문서 4종(Plan/Routes/StatsContract/Test)”으로 써줄게.
특히 **StatsContract(지표 정의 + 어떤 테이블에서 어떤 방식으로 집계)** 이게 Phase 10의 핵심이야.

원하는 출력 형태를 고르지 않아도 돼—나는 아래 형태로 바로 만들어서 줄게:

* `docs/phase-10-plan.md`
* `docs/phase-10-routes.md`
* `docs/phase-10-statistics-contract.md`
* `docs/phase-10-test.md`

이대로 가면 “대시보드/UTM가 제각각” 문제를 **구조적으로 재발 불가**하게 만들 수 있어.
