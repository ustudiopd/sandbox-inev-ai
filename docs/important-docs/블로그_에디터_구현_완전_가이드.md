# ë¸”ë¡œê·¸ ì—ë””í„° êµ¬í˜„ ì™„ì „ ê°€ì´ë“œ

**ì‘ì„± ì¼ì**: 2025-01-16  
**í”„ë¡œì íŠ¸**: ustudio-web  
**ì—ë””í„°**: Novel.sh (Tiptap ê¸°ë°˜)  
**ëª©í‘œ**: ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œë„ ì‹œí–‰ì°©ì˜¤ ì—†ì´ ì‰½ê²Œ ì´ì‹í•  ìˆ˜ ìˆëŠ” ì™„ì „í•œ ê°€ì´ë“œ

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
3. [íŒ¨í‚¤ì§€ ì„¤ì¹˜](#íŒ¨í‚¤ì§€-ì„¤ì¹˜)
4. [ê¸°ë³¸ ì—ë””í„° êµ¬í˜„](#ê¸°ë³¸-ì—ë””í„°-êµ¬í˜„)
5. [ìŠ¬ë˜ì‹œ ë©”ë‰´ êµ¬í˜„](#ìŠ¬ë˜ì‹œ-ë©”ë‰´-êµ¬í˜„)
6. [ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì²˜ë¦¬](#ì´ë¯¸ì§€-ì—…ë¡œë“œ-ë°-ì²˜ë¦¬)
7. [YouTube ì„ë² ë“œ](#youtube-ì„ë² ë“œ)
8. [ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ](#ì´ë¯¸ì§€-ë¦¬ì‚¬ì´ì¦ˆ)
9. [ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬](#ë¼ì´íŠ¸ë°•ìŠ¤-ëª¨ë‹¬)
10. [AI ìŠ¬ëŸ¬ê·¸ ìƒì„±](#ai-ìŠ¬ëŸ¬ê·¸-ìƒì„±)
11. [ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ (ì˜µì…˜)](#ì‹¤ì‹œê°„-ì €ì¥-ê¸°ëŠ¥-ì˜µì…˜)
12. [ì‹œí–‰ì°©ì˜¤ ë° í•´ê²° ë°©ë²•](#ì‹œí–‰ì°©ì˜¤-ë°-í•´ê²°-ë°©ë²•)
13. [ì´ì‹ ê°€ì´ë“œ](#ì´ì‹-ê°€ì´ë“œ)

---

## í”„ë¡œì íŠ¸ ê°œìš”

### ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë ˆì„ì›Œí¬**: Next.js 16.0.10+ (App Router)
- **ì—ë””í„°**: Novel.sh (Tiptap ê¸°ë°˜)
- **ì–¸ì–´**: TypeScript 5.5.4
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS
- **ì•„ì´ì½˜**: Lucide React
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase (PostgreSQL, Storage)
- **AI**: Google Gemini 2.0 Flash (Vercel AI SDK)

### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
ustudio-web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ë¸”ë¡œê·¸ ëª©ë¡
â”‚   â”‚   â”œâ”€â”€ write/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # ë¸”ë¡œê·¸ ì‘ì„±
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx        # ì¸ì¦ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”œâ”€â”€ edit/[id]/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # ë¸”ë¡œê·¸ ìˆ˜ì •
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx        # ì¸ì¦ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â”‚       â””â”€â”€ page.tsx          # ë¸”ë¡œê·¸ ìƒì„¸
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ posts/
â”‚       â”‚   â”œâ”€â”€ route.ts          # GET: ëª©ë¡, POST: ìƒì„±
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â”œâ”€â”€ route.ts       # GET: ì¡°íšŒ, PUT: ìˆ˜ì •, DELETE: ì‚­ì œ
â”‚       â”‚       â””â”€â”€ view/route.ts  # ì¡°íšŒìˆ˜ ì¦ê°€
â”‚       â””â”€â”€ blog/
â”‚           â””â”€â”€ generate-slug/route.ts  # AI ìŠ¬ëŸ¬ê·¸ ìƒì„±
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ editor/
â”‚   â”‚   â”œâ”€â”€ BlogEditor.tsx        # ë©”ì¸ ì—ë””í„° ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ BubbleMenu.tsx        # í…ìŠ¤íŠ¸ ì„ íƒ ë©”ë‰´
â”‚   â”‚   â”œâ”€â”€ extensions.tsx        # Tiptap í™•ì¥ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ extensions-server.tsx # ì„œë²„ìš© í™•ì¥ (SSR)
â”‚   â”‚   â”œâ”€â”€ ImageResizePlugin.tsx # ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ í”ŒëŸ¬ê·¸ì¸
â”‚   â”‚   â””â”€â”€ extensions/
â”‚   â”‚       â””â”€â”€ ImageResizeExtension.ts  # ë¦¬ì‚¬ì´ì¦ˆ Extension
â”‚   â””â”€â”€ blog/
â”‚       â””â”€â”€ PostViewer.tsx        # ë¸”ë¡œê·¸ ë·°ì–´ (ë¼ì´íŠ¸ë°•ìŠ¤ í¬í•¨)
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useAutoSave.ts        # ì‹¤ì‹œê°„ ì €ì¥ í›… (ì˜µì…˜)
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ blog.ts               # ë¸”ë¡œê·¸ íƒ€ì… ì •ì˜
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ client.ts              # í´ë¼ì´ì–¸íŠ¸ Supabase
â”‚       â”œâ”€â”€ server.ts              # ì„œë²„ Supabase
â”‚       â””â”€â”€ public.ts             # ê³µê°œ Supabase
â””â”€â”€ supabase/
    â””â”€â”€ migrations/
        â””â”€â”€ 20250113_create_ustudio_posts.sql  # ë¸”ë¡œê·¸ í…Œì´ë¸” ìƒì„±
```

---

## í™˜ê²½ ì„¤ì •

### 1. í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜

`.env.local` íŒŒì¼ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”:

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Google Gemini AI (ìŠ¬ëŸ¬ê·¸ ìƒì„±ìš©)
GOOGLE_API_KEY=your_google_api_key
# ë˜ëŠ”
GOOGLE_GENERATIVE_AI_API_KEY=your_google_api_key

# ì‚¬ì´íŠ¸ URL (ì„ íƒì‚¬í•­)
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

### 2. Supabase Storage ë²„í‚· ìƒì„±

Supabase ëŒ€ì‹œë³´ë“œì—ì„œ `blog-images` ë²„í‚·ì„ ìƒì„±í•˜ê³  Public ì½ê¸° ê¶Œí•œì„ ì„¤ì •í•˜ì„¸ìš”.

---

## íŒ¨í‚¤ì§€ ì„¤ì¹˜

### í•„ìˆ˜ íŒ¨í‚¤ì§€

```bash
npm install novel @tiptap/core @tiptap/react @tiptap/starter-kit @tiptap/html
npm install @tiptap/extension-image @tiptap/extension-link
npm install @tiptap/extension-task-list @tiptap/extension-task-item
npm install @tiptap/extension-youtube @tiptap/extension-color
npm install @tiptap/extension-text-style @tiptap/extension-highlight
npm install @tailwindcss/typography
npm install lucide-react jotai
```

### AI ìŠ¬ëŸ¬ê·¸ ìƒì„±ìš© (ì„ íƒì‚¬í•­)

```bash
npm install @ai-sdk/google ai zod
```

### package.json ì˜ˆì‹œ

```json
{
  "dependencies": {
    "novel": "^1.0.2",
    "@tiptap/core": "^3.14.0",
    "@tiptap/react": "^3.14.0",
    "@tiptap/starter-kit": "^3.14.0",
    "@tiptap/html": "^3.14.0",
    "@tiptap/extension-image": "^3.14.0",
    "@tiptap/extension-link": "^3.14.0",
    "@tiptap/extension-task-list": "^3.14.0",
    "@tiptap/extension-task-item": "^3.14.0",
    "@tiptap/extension-youtube": "^3.14.0",
    "@tiptap/extension-color": "^3.14.0",
    "@tiptap/extension-text-style": "^3.14.0",
    "@tiptap/extension-highlight": "^3.14.0",
    "@tailwindcss/typography": "^0.5.19",
    "lucide-react": "^0.427.0",
    "jotai": "^2.0.0",
    "@ai-sdk/google": "^2.0.46",
    "ai": "^5.0.113",
    "zod": "^4.1.13"
  }
}
```

---

## ê¸°ë³¸ ì—ë””í„° êµ¬í˜„

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

**íŒŒì¼**: `supabase/migrations/20250113_create_ustudio_posts.sql`

```sql
CREATE TABLE ustudio_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  slug TEXT NOT NULL,
  title TEXT NOT NULL,
  content JSONB NOT NULL,
  thumbnail_url TEXT,
  locale TEXT DEFAULT 'ko' CHECK (locale IN ('ko', 'en')),
  seo_title TEXT,
  seo_description TEXT,
  seo_keywords TEXT[],
  is_published BOOLEAN DEFAULT false,
  published_at TIMESTAMPTZ,
  view_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  author_id UUID REFERENCES auth.users(id)
);

CREATE UNIQUE INDEX ustudio_idx_posts_locale_slug ON ustudio_posts(locale, slug);
CREATE INDEX ustudio_idx_posts_published ON ustudio_posts(is_published, published_at DESC);

-- RLS ì •ì±…
ALTER TABLE ustudio_posts ENABLE ROW LEVEL SECURITY;

-- ê³µê°œ ì½ê¸° (ë°œí–‰ëœ í¬ìŠ¤íŠ¸ë§Œ)
CREATE POLICY "Public posts are viewable by everyone"
  ON ustudio_posts FOR SELECT
  USING (is_published = true);

-- ì‘ì„±ì ì½ê¸° (ë¯¸ë°œí–‰ í¬ìŠ¤íŠ¸)
CREATE POLICY "Authors can view their own posts"
  ON ustudio_posts FOR SELECT
  USING (auth.uid() = author_id);

-- ì‘ì„±ìë§Œ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
CREATE POLICY "Authors can insert their own posts"
  ON ustudio_posts FOR INSERT
  WITH CHECK (auth.uid() = author_id);

CREATE POLICY "Authors can update their own posts"
  ON ustudio_posts FOR UPDATE
  USING (auth.uid() = author_id);

CREATE POLICY "Authors can delete their own posts"
  ON ustudio_posts FOR DELETE
  USING (auth.uid() = author_id);
```

### 2. íƒ€ì… ì •ì˜

**íŒŒì¼**: `lib/types/blog.ts`

```typescript
import type { JSONContent } from '@tiptap/core';

export interface BlogPost {
  id: string;
  slug: string;
  title: string;
  content: JSONContent;
  thumbnail_url: string | null;
  locale: 'ko' | 'en';
  seo_title: string | null;
  seo_description: string | null;
  seo_keywords: string[] | null;
  is_published: boolean;
  published_at: string | null;
  view_count: number;
  created_at: string;
  updated_at: string;
  author_id: string | null;
}

export interface CreatePostInput {
  title: string;
  slug: string;
  content: JSONContent;
  thumbnail_url?: string | null;
  locale?: 'ko' | 'en';
  is_published?: boolean;
}

export interface UpdatePostInput extends Partial<CreatePostInput> {}
```

### 3. ê¸°ë³¸ í™•ì¥ ì„¤ì •

**íŒŒì¼**: `components/editor/extensions.tsx`

```typescript
'use client';

import { Command, createSuggestionItems, renderItems } from 'novel';
import StarterKit from '@tiptap/starter-kit';
import Image from '@tiptap/extension-image';
import Link from '@tiptap/extension-link';
import TaskList from '@tiptap/extension-task-list';
import TaskItem from '@tiptap/extension-task-item';
import YouTube from '@tiptap/extension-youtube';
import { Color } from '@tiptap/extension-color';
import { TextStyle } from '@tiptap/extension-text-style';
import Highlight from '@tiptap/extension-highlight';
import {
  CheckSquare, Code, Heading1, Heading2, Heading3,
  List, ListOrdered, Text, TextQuote, Image as ImageIcon, Youtube,
} from 'lucide-react';
import type { JSONContent } from '@tiptap/core';

// ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ ì•„ì´í…œ ìƒì„± í•¨ìˆ˜ (ì—…ë¡œë“œ í•¨ìˆ˜ í¬í•¨)
export const createSuggestionItemsWithUpload = (
  uploadFn?: (file: File) => Promise<string>,
  onEditorReady?: (editor: any) => void
) => {
  return createSuggestionItems([
    {
      title: 'Text',
      description: 'ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.',
      searchTerms: ['p', 'paragraph', 'í…ìŠ¤íŠ¸'],
      icon: <Text size={18} />,
      command: ({ editor, range }) => {
        editor.chain().focus().deleteRange(range).toggleNode('paragraph', 'paragraph').run();
      },
    },
    {
      title: 'Heading 1',
      description: 'í° ì„¹ì…˜ ì œëª©.',
      searchTerms: ['title', 'big', 'h1', 'ì œëª©1'],
      icon: <Heading1 size={18} />,
      command: ({ editor, range }) => {
        if (editor && range) {
          editor.chain().focus().deleteRange(range).toggleHeading({ level: 1 }).run();
        }
      },
    },
    {
      title: 'Heading 2',
      description: 'ì¤‘ê°„ ì„¹ì…˜ ì œëª©.',
      searchTerms: ['subtitle', 'medium', 'h2', 'ì œëª©2'],
      icon: <Heading2 size={18} />,
      command: ({ editor, range }) => {
        if (editor && range) {
          editor.chain().focus().deleteRange(range).toggleHeading({ level: 2 }).run();
        }
      },
    },
    {
      title: 'Heading 3',
      description: 'ì‘ì€ ì„¹ì…˜ ì œëª©.',
      searchTerms: ['subtitle', 'small', 'h3', 'ì œëª©3'],
      icon: <Heading3 size={18} />,
      command: ({ editor, range }) => {
        if (editor && range) {
          editor.chain().focus().deleteRange(range).toggleHeading({ level: 3 }).run();
        }
      },
    },
    {
      title: 'Bullet List',
      description: 'ìˆœì„œ ì—†ëŠ” ëª©ë¡ì„ ë§Œë“­ë‹ˆë‹¤.',
      searchTerms: ['unordered', 'point', 'ëª©ë¡'],
      icon: <List size={18} />,
      command: ({ editor, range }) => {
        editor.chain().focus().deleteRange(range).toggleBulletList().run();
      },
    },
    {
      title: 'Numbered List',
      description: 'ìˆœì„œ ìˆëŠ” ëª©ë¡ì„ ë§Œë“­ë‹ˆë‹¤.',
      searchTerms: ['ordered', 'ë²ˆí˜¸'],
      icon: <ListOrdered size={18} />,
      command: ({ editor, range }) => {
        editor.chain().focus().deleteRange(range).toggleOrderedList().run();
      },
    },
    {
      title: 'To-do List',
      description: 'í•  ì¼ ëª©ë¡ì„ ë§Œë“­ë‹ˆë‹¤.',
      searchTerms: ['todo', 'task', 'list', 'check', 'checkbox', 'í• ì¼'],
      icon: <CheckSquare size={18} />,
      command: ({ editor, range }) => {
        editor.chain().focus().deleteRange(range).toggleTaskList().run();
      },
    },
    {
      title: 'Quote',
      description: 'ì¸ìš©êµ¬ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.',
      searchTerms: ['blockquote', 'ì¸ìš©'],
      icon: <TextQuote size={18} />,
      command: ({ editor, range }) =>
        editor.chain().focus().deleteRange(range).toggleNode('paragraph', 'paragraph').toggleBlockquote().run(),
    },
    {
      title: 'Code',
      description: 'ì½”ë“œ ë¸”ë¡ì„ ì‚½ì…í•©ë‹ˆë‹¤.',
      searchTerms: ['codeblock', 'ì½”ë“œ'],
      icon: <Code size={18} />,
      command: ({ editor, range }) =>
        editor.chain().focus().deleteRange(range).toggleCodeBlock().run(),
    },
    {
      title: 'Image',
      description: 'ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤.',
      searchTerms: ['image', 'img', 'picture', 'photo', 'ì´ë¯¸ì§€'],
      icon: <ImageIcon size={18} />,
      command: ({ editor, range }) => {
        editor.chain().focus().deleteRange(range).run();
        if (onEditorReady) {
          onEditorReady(editor);
        }
        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = async (e) => {
          const file = (e.target as HTMLInputElement).files?.[0];
          if (file && uploadFn) {
            // íŒŒì¼ í¬ê¸° ê²€ì¦ (50MB)
            const maxSize = 50 * 1024 * 1024;
            if (file.size > maxSize) {
              alert(`ì´ë¯¸ì§€ í¬ê¸°ëŠ” 50MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤. í˜„ì¬ í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
              return;
            }

            try {
              const url = await uploadFn(file);
              // ProseMirror ë…¸ë“œë¡œ ì§ì ‘ ì‚½ì…
              editor.chain().focus().insertContent({
                type: 'image',
                attrs: {
                  src: url,
                },
              }).run();
            } catch (error: any) {
              console.error('Image upload error:', error);
              alert(error.message || 'ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
          }
        };
        input.click();
      },
    },
    {
      title: 'YouTube',
      description: 'ìœ íŠœë¸Œ ë™ì˜ìƒì„ ì‚½ì…í•©ë‹ˆë‹¤.',
      searchTerms: ['youtube', 'video', 'embed', 'ìœ íŠœë¸Œ', 'ë™ì˜ìƒ'],
      icon: <Youtube size={18} />,
      command: ({ editor, range }) => {
        const url = prompt('YouTube URLì„ ì…ë ¥í•˜ì„¸ìš”:');
        if (!url) return;
        
        // YouTube URLì—ì„œ ë¹„ë””ì˜¤ ID ì¶”ì¶œ
        const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
        const match = url.match(youtubeRegex);
        
        if (match) {
          const videoId = match[1];
          editor
            .chain()
            .focus()
            .deleteRange(range)
            .insertContent({
              type: 'youtube',
              attrs: {
                src: `https://www.youtube.com/embed/${videoId}`,
              },
            })
            .run();
        } else {
          alert('ìœ íš¨í•œ YouTube URLì´ ì•„ë‹™ë‹ˆë‹¤.\nì˜ˆ: https://www.youtube.com/watch?v=VIDEO_ID ë˜ëŠ” https://youtu.be/VIDEO_ID');
        }
      },
    },
  ]);
};

// ê¸°ë³¸ suggestionItems (ì—…ë¡œë“œ í•¨ìˆ˜ ì—†ì´)
export const suggestionItems = createSuggestionItems([
  // ... ë™ì¼í•œ í•­ëª©ë“¤ (Image í•­ëª©ì€ íŒŒì¼ ì„ íƒë§Œ, ì—…ë¡œë“œ ì—†ìŒ)
]);

// ìŠ¬ë˜ì‹œ ëª…ë ¹ì–´ í™•ì¥ ì„¤ì •
export const createSlashCommand = (items: typeof suggestionItems) => {
  return Command.configure({
    suggestion: {
      items: () => items,
      render: renderItems, // â† í•„ìˆ˜! ì´ê²Œ ì—†ìœ¼ë©´ ë©”ë‰´ ìì²´ê°€ ì•ˆ ë‚˜ì˜´
    },
  });
};

// ê¸°ë³¸ slashCommand
export const slashCommand = createSlashCommand(suggestionItems);

// Tiptap í™•ì¥ ì„¤ì •
export const extensions = [
  StarterKit.configure({
    heading: {
      levels: [1, 2, 3],
    },
    link: false, // Link í™•ì¥ ë¹„í™œì„±í™” (ì¤‘ë³µ ë°©ì§€)
  }),
  TextStyle,
  Color,
  Highlight.configure({
    multicolor: true,
  }),
  Image.configure({
    inline: true,
    allowBase64: true,
    HTMLAttributes: {
      class: 'rounded-lg',
    },
  }),
  Link.configure({
    openOnClick: false,
    HTMLAttributes: {
      class: 'text-cyan-400 hover:text-cyan-300 underline',
    },
  }),
  YouTube.configure({
    width: 640,
    height: 480,
    HTMLAttributes: {
      class: 'rounded-lg',
    },
  }),
  TaskList,
  TaskItem.configure({
    nested: true,
  }),
  slashCommand,
];
```

### 4. ì„œë²„ìš© í™•ì¥ ì„¤ì • (SSR)

**íŒŒì¼**: `components/editor/extensions-server.tsx`

```typescript
// ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ìš© extensions (slashCommand ì œì™¸)
import StarterKit from '@tiptap/starter-kit';
import Image from '@tiptap/extension-image';
import Link from '@tiptap/extension-link';
import TaskList from '@tiptap/extension-task-list';
import TaskItem from '@tiptap/extension-task-item';
import YouTube from '@tiptap/extension-youtube';
import { Color } from '@tiptap/extension-color';
import { TextStyle } from '@tiptap/extension-text-style';
import Highlight from '@tiptap/extension-highlight';

// ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ìš© extensions (slashCommand ì œì™¸)
// generateHTMLì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ ì „ìš© ê¸°ëŠ¥ ì œê±°
export const extensions = [
  StarterKit.configure({
    heading: {
      levels: [1, 2, 3],
    },
    link: false, // Link í™•ì¥ ë¹„í™œì„±í™” (ì¤‘ë³µ ë°©ì§€)
  }),
  TextStyle,
  Color,
  Highlight.configure({
    multicolor: true,
  }),
  Image.configure({
    inline: true,
    allowBase64: true,
    HTMLAttributes: {
      class: 'rounded-lg',
    },
  }),
  Link.configure({
    openOnClick: false,
    HTMLAttributes: {
      class: 'text-cyan-400 hover:text-cyan-300 underline',
    },
  }),
  YouTube.configure({
    width: 640,
    height: 480,
    HTMLAttributes: {
      class: 'rounded-lg',
    },
  }),
  TaskList,
  TaskItem.configure({
    nested: true,
  }),
];
```

**ì¤‘ìš”**: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ `generateHTML`ì„ ì‚¬ìš©í•  ë•ŒëŠ” í´ë¼ì´ì–¸íŠ¸ ì „ìš© í™•ì¥(`slashCommand`)ì„ ì œì™¸í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ìŠ¬ë˜ì‹œ ë©”ë‰´ êµ¬í˜„

### ë¬¸ì œì  ë° í•´ê²° ë°©ë²•

#### âŒ ë¬¸ì œ 1: ìŠ¬ë˜ì‹œ ë©”ë‰´ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ì›ì¸**: `renderItems` import ëˆ„ë½ ë˜ëŠ” ì„¤ì • ëˆ„ë½

**í•´ê²°**:
```typescript
// âœ… ì˜¬ë°”ë¥¸ import
import { Command, createSuggestionItems, renderItems } from 'novel';

// âœ… ì˜¬ë°”ë¥¸ ì„¤ì •
export const slashCommand = Command.configure({
  suggestion: {
    items: () => suggestionItems,
    render: renderItems, // â† í•„ìˆ˜!
  },
});
```

#### âŒ ë¬¸ì œ 2: ìŠ¬ë˜ì‹œ ë©”ë‰´ëŠ” ë‚˜íƒ€ë‚˜ì§€ë§Œ ëª…ë ¹ì´ ì ìš©ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `onCommand` í•¸ë“¤ëŸ¬ì—ì„œ `editor`ì™€ `range`ë¥¼ ì œëŒ€ë¡œ ì „ë‹¬í•˜ì§€ ì•ŠìŒ

**í•´ê²°**: í•˜ì´ë¸Œë¦¬ë“œ ë Œë”ë§ ë°©ì‹ ì‚¬ìš©

**íŒŒì¼**: `components/editor/BlogEditor.tsx`

```typescript
<EditorCommand className="z-50 h-auto max-h-[330px] w-72 overflow-y-auto rounded-md border border-slate-700 bg-slate-900 px-1 py-2 shadow-md">
  <EditorCommandEmpty className="px-2 text-sm text-slate-400">ê²°ê³¼ ì—†ìŒ</EditorCommandEmpty>
  <EditorCommandList>
    {editorSuggestionItems.map((item) => (
      <EditorCommandItem
        value={item.title}
        onCommand={(val: any) => {
          // valì—ì„œ editorì™€ range ì¶”ì¶œ
          const commandEditor = val?.editor || editor;
          const commandRange = val?.range || range;

          if (!commandEditor || !commandRange) {
            console.error('[SlashMenu] editor/range missing');
            return;
          }

          if (item.command && commandEditor && commandRange) {
            try {
              item.command({ editor: commandEditor, range: commandRange });
            } catch (error) {
              console.error('[BlogEditor] Command execution error:', error);
            }
          }
        }}
        className="flex w-full items-center space-x-2 rounded-md px-2 py-1 text-left text-sm hover:bg-slate-800 aria-selected:bg-slate-800"
        key={item.title}>
        <div className="flex h-10 w-10 items-center justify-center rounded-md border border-slate-700 bg-slate-800">
          {item.icon}
        </div>
        <div>
          <p className="font-medium text-slate-200">{item.title}</p>
          <p className="text-xs text-slate-400">{item.description}</p>
        </div>
      </EditorCommandItem>
    ))}
  </EditorCommandList>
</EditorCommand>
```

#### âŒ ë¬¸ì œ 3: Heading ëª…ë ¹ ì‹¤í–‰ ì‹œ "Empty text nodes are not allowed" ì—ëŸ¬

**ì›ì¸**: `insertContent`ì— ë¹ˆ í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í¬í•¨í•œ content ì „ë‹¬

**í•´ê²°**: `toggleHeading` ì‚¬ìš©

```typescript
// âŒ ì˜ëª»ëœ ë°©ë²•
command: ({ editor, range }) => {
  editor.chain().focus().deleteRange(range).insertContent({
    type: 'heading',
    attrs: { level: 1 },
    content: [{ type: 'text', text: '' }], // â† ë¹ˆ í…ìŠ¤íŠ¸ ë…¸ë“œ ì—ëŸ¬
  }).run();
}

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
command: ({ editor, range }) => {
  if (editor && range) {
    editor.chain().focus().deleteRange(range).toggleHeading({ level: 1 }).run();
  }
}
```

---

## ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì²˜ë¦¬

### Novel.sh í‘œì¤€ ë°©ì‹ ì‚¬ìš©

**ì¤‘ìš”**: Novel.shì˜ í‘œì¤€ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•˜ë©´ `addNodeView` ì—ëŸ¬ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**íŒŒì¼**: `components/editor/BlogEditor.tsx`

```typescript
import { createImageUpload, handleImagePaste, handleImageDrop, UpdatedImage, UploadImagesPlugin } from 'novel';

// ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜ ìƒì„±
const supabase = createClient();
const imageUploadFn = useMemo(() => {
  return createImageUpload({
    validateFn: (file: File) => {
      // íŒŒì¼ íƒ€ì… ê²€ì¦
      if (!file.type.startsWith('image/')) {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return false;
      }
      // íŒŒì¼ í¬ê¸° ê²€ì¦ (ìµœëŒ€ 50MB)
      if (file.size > 50 * 1024 * 1024) {
        alert('íŒŒì¼ í¬ê¸°ëŠ” 50MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return false;
      }
      return true;
    },
    onUpload: async (file: File): Promise<string> => {
      // ì‚¬ìš©ì ì œê³µ uploadFnê°€ ìˆìœ¼ë©´ ì‚¬ìš©
      if (uploadFn) {
        return uploadFn(file);
      }

      // ê¸°ë³¸ ì—…ë¡œë“œ êµ¬í˜„ (Supabase Storage)
      const fileExt = file.name.split('.').pop();
      const fileName = `${Math.random()}.${fileExt}`;
      const filePath = `blog-images/${fileName}`;

      const { data, error } = await supabase.storage.from('blog-images').upload(filePath, file);

      if (error) {
        console.error('Image upload error:', error);
        throw error;
      }

      const {
        data: { publicUrl },
      } = supabase.storage.from('blog-images').getPublicUrl(filePath);

      return publicUrl;
    },
  });
}, [uploadFn, supabase]);

// UpdatedImage í™•ì¥ ì‚¬ìš©
const imageExtension = useMemo(() => {
  return UpdatedImage.extend({
    addProseMirrorPlugins() {
      return [
        UploadImagesPlugin({
          imageClass: 'opacity-40 rounded-lg border border-slate-300',
        }),
      ];
    },
  }).configure({
    allowBase64: false, // Base64 ì¸ì½”ë”© ë¹„í™œì„±í™” (URLë§Œ ì‚¬ìš©)
    HTMLAttributes: {
      class: 'rounded-lg border border-slate-300',
      style: 'max-width: 100%; height: auto; max-height: 600px; object-fit: contain; cursor: pointer;',
    },
    inline: false, // ë¸”ë¡ ë ˆë²¨ ì´ë¯¸ì§€
  });
}, []);

// editorProps ì„¤ì •
editorProps={{
  handlePaste: (view, event) => {
    // Novel.shì˜ handleImagePaste ì‚¬ìš©
    const handled = handleImagePaste(view, event, imageUploadFn);
    if (handled) return true;

    // URL ë¶™ì—¬ë„£ê¸° ê°ì§€ (ì´ë¯¸ì§€ URL ë˜ëŠ” YouTube URL)
    const text = event.clipboardData?.getData('text/plain');
    if (!text) return false;

    // ì´ë¯¸ì§€ URLì¸ ê²½ìš°
    if (/\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i.test(text)) {
      event.preventDefault();
      const { state, dispatch } = view;
      const { selection } = state;
      const imageNode = state.schema.nodes.image.create({
        src: text,
      });
      const transaction = state.tr.replaceSelectionWith(imageNode);
      dispatch(transaction);
      return true;
    }

    // YouTube URLì¸ ê²½ìš°
    const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
    const youtubeMatch = text.match(youtubeRegex);
    if (youtubeMatch) {
      event.preventDefault();
      const { state, dispatch } = view;
      const { selection } = state;
      const videoId = youtubeMatch[1];
      const youtubeNode = state.schema.nodes.youtube.create({
        src: `https://www.youtube.com/embed/${videoId}`,
      });
      const transaction = state.tr.replaceSelectionWith(youtubeNode);
      dispatch(transaction);
      return true;
    }

    return false;
  },
  handleDrop: (view, event, slice, moved) => {
    // Novel.shì˜ handleImageDrop ì‚¬ìš©
    return handleImageDrop(view, event, moved, imageUploadFn);
  },
}}
```

### ì‹œí–‰ì°©ì˜¤: `addNodeView(...) is not a function` ì—ëŸ¬

**ì›ì¸**: ì¼ë°˜ `Image` extensionì„ ì‚¬ìš©í•˜ê³  `setImage` ëª…ë ¹ì„ ì‚¬ìš©í•  ë•Œ ë°œìƒ

**í•´ê²°**: `UpdatedImage`ì™€ `createImageUpload` ì‚¬ìš©

```typescript
// âŒ ì˜ëª»ëœ ë°©ë²•
import Image from '@tiptap/extension-image';
const imageExtension = Image.configure({ ... });
editor.chain().focus().setImage({ src: url }).run(); // â† ì—ëŸ¬ ë°œìƒ

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
import { UpdatedImage, createImageUpload } from 'novel';
const imageUploadFn = createImageUpload({ ... });
const imageExtension = UpdatedImage.extend({ ... });
// insertContentë¡œ ì‚½ì…í•˜ê±°ë‚˜ handleImagePaste/handleImageDrop ì‚¬ìš©
```

---

## YouTube ì„ë² ë“œ

### ìŠ¬ë˜ì‹œ ë©”ë‰´ì— ì¶”ê°€

`extensions.tsx`ì˜ `suggestionItems`ì— YouTube í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤ (ìœ„ ì½”ë“œ ì°¸ì¡°).

### URL ë¶™ì—¬ë„£ê¸° ê°ì§€

`handlePaste`ì—ì„œ YouTube URLì„ ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ ì„ë² ë“œí•©ë‹ˆë‹¤ (ìœ„ ì½”ë“œ ì°¸ì¡°).

---

## ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ

### 1. ImageResizePlugin ìƒì„±

**íŒŒì¼**: `components/editor/ImageResizePlugin.tsx`

```typescript
/**
 * ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ProseMirror Plugin
 * ì´ë¯¸ì§€ í´ë¦­ ì‹œ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ì„ í‘œì‹œí•˜ê³ , ë“œë˜ê·¸ë¡œ í¬ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆê²Œ í•¨
 */

'use client';

import { Plugin, PluginKey } from '@tiptap/pm/state';
import { EditorView } from '@tiptap/pm/view';
import { NodeSelection } from '@tiptap/pm/state';
import type { Node as ProseMirrorNode } from '@tiptap/pm/model';

const MIN = 50;
const MAX = 1200;
const HANDLE_SIZE = 16;

// ì´ë¯¸ì§€ ë…¸ë“œì¸ì§€ í™•ì¸
function isImageNode(node: ProseMirrorNode): boolean {
  return node.type.name === 'image';
}

// ì„ íƒëœ ì´ë¯¸ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
function getSelectedImage(view: EditorView): {
  pos: number;
  node: ProseMirrorNode;
  img: HTMLImageElement;
} | null {
  const sel = view.state.selection;
  if (!(sel instanceof NodeSelection)) return null;
  if (!isImageNode(sel.node)) return null;

  const pos = sel.from;
  const dom = view.nodeDOM(pos) as unknown;

  let img: HTMLImageElement | null = null;
  if (dom instanceof HTMLImageElement) {
    img = dom;
  } else if (dom instanceof HTMLElement) {
    img = dom.querySelector('img');
  }

  if (!img) return null;
  return { pos, node: sel.node, img };
}

// ê°’ ì œí•œ í•¨ìˆ˜
function clamp(value: number, min: number, max: number): number {
  return Math.max(min, Math.min(max, value));
}

export function createImageResizePlugin() {
  let active: { pos: number; node: ProseMirrorNode; img: HTMLImageElement } | null = null;
  let container: HTMLElement | null = null;
  let handle: HTMLButtonElement | null = null;
  let dragging = false;
  let startX = 0;
  let startY = 0;
  let startW = 0;
  let startH = 0;
  let aspect = 1;

  // í•¸ë“¤ í‘œì‹œ
  const show = (info: { pos: number; node: ProseMirrorNode; img: HTMLImageElement }) => {
    if (!container || !handle) return;

    active = info;
    const img = info.img;

    // ì›ë³¸ í¬ê¸° ê°€ì ¸ì˜¤ê¸°
    const currentWidth = parseInt(img.style.width, 10) || img.naturalWidth || img.width || 300;
    const currentHeight = parseInt(img.style.height, 10) || img.naturalHeight || img.height || 200;
    aspect = currentWidth / currentHeight;

    // ì´ë¯¸ì§€ì— ìŠ¤íƒ€ì¼ ì ìš©
    img.style.width = `${currentWidth}px`;
    img.style.height = `${currentHeight}px`;
    img.style.maxWidth = '100%';
    img.style.objectFit = 'contain';

    handle.style.display = 'block';
    positionHandle();
  };

  // í•¸ë“¤ ìˆ¨ê¹€
  const hide = () => {
    if (handle) {
      handle.style.display = 'none';
    }
    active = null;
  };

  // í•¸ë“¤ ìœ„ì¹˜ ê³„ì‚°
  const positionHandle = () => {
    if (!active || !container || !handle) return;
    const imgRect = active.img.getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();

    const left =
      imgRect.right - containerRect.left + container.scrollLeft - HANDLE_SIZE / 2;
    const top =
      imgRect.bottom - containerRect.top + container.scrollTop - HANDLE_SIZE / 2;

    handle.style.left = `${left}px`;
    handle.style.top = `${top}px`;
  };

  // ë§ˆìš°ìŠ¤ ì´ë™ í•¸ë“¤ëŸ¬
  const onMouseMove = (e: MouseEvent) => {
    if (!dragging || !active) return;

    const dx = e.clientX - startX;
    const dy = e.clientY - startY;

    let nextW = clamp(startW + dx, MIN, MAX);
    let nextH = clamp(startH + dy, MIN, MAX);

    // Shift: ë¹„ìœ¨ ìœ ì§€
    if (e.shiftKey) {
      nextH = clamp(nextW / aspect, MIN, MAX);
    }

    active.img.style.width = `${Math.round(nextW)}px`;
    active.img.style.height = `${Math.round(nextH)}px`;
    positionHandle();
  };

  // ë§ˆìš°ìŠ¤ ì—… í•¸ë“¤ëŸ¬
  const onMouseUp = (view: EditorView) => {
    return () => {
      if (!dragging || !active) return;
      dragging = false;

      window.removeEventListener('mousemove', onMouseMove);
      window.removeEventListener('mouseup', onMouseUp(view));

      // ìµœì¢… í¬ê¸°ë¥¼ ë…¸ë“œ attrsë¡œ ì €ì¥
      const width = parseInt(active.img.style.width, 10) || Math.round(startW);
      const height = parseInt(active.img.style.height, 10) || Math.round(startH);

      const { state } = view;
      const nodeNow = state.doc.nodeAt(active.pos);
      if (!nodeNow) return;

      const tr = state.tr.setNodeMarkup(active.pos, undefined, {
        ...nodeNow.attrs,
        width,
        height,
      });
      view.dispatch(tr);
    };
  };

  return new Plugin({
    key: new PluginKey('imageResize'),
    view(editorView) {
      // ì»¨í…Œì´ë„ˆ ì°¾ê¸°
      container = editorView.dom.closest('.ProseMirror')?.parentElement || editorView.dom.parentElement;
      if (!container) {
        console.error('[ImageResize] ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return {};
      }

      // ì»¨í…Œì´ë„ˆì— relative í¬ì§€ì…”ë‹ ì¶”ê°€
      if (getComputedStyle(container).position === 'static') {
        container.style.position = 'relative';
      }

      // í•¸ë“¤ ìƒì„±
      handle = document.createElement('button');
      handle.type = 'button';
      handle.className = 'resize-handle';
      Object.assign(handle.style, {
        position: 'absolute',
        width: `${HANDLE_SIZE}px`,
        height: `${HANDLE_SIZE}px`,
        backgroundColor: '#3b82f6',
        border: '2px solid white',
        borderRadius: '50%',
        cursor: 'se-resize',
        display: 'none',
        zIndex: '1000',
        boxShadow: '0 2px 4px rgba(0, 0, 0, 0.2)',
        transition: 'transform 0.1s',
        pointerEvents: 'auto',
      });
      container.appendChild(handle);

      // í•¸ë“¤ ë“œë˜ê·¸ ì‹œì‘
      handle.addEventListener('mousedown', (e) => {
        if (!active) return;
        e.preventDefault();
        e.stopPropagation();

        dragging = true;
        startX = e.clientX;
        startY = e.clientY;
        startW = parseInt(active.img.style.width, 10) || active.img.naturalWidth || 300;
        startH = parseInt(active.img.style.height, 10) || active.img.naturalHeight || 200;

        window.addEventListener('mousemove', onMouseMove);
        window.addEventListener('mouseup', onMouseUp(editorView));
      });

      // ìŠ¤í¬ë¡¤ ì‹œ í•¸ë“¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      const onScroll = () => {
        if (active) {
          positionHandle();
        }
      };
      container.addEventListener('scroll', onScroll);

      return {
        destroy() {
          if (handle && handle.parentElement) {
            handle.parentElement.removeChild(handle);
          }
          container?.removeEventListener('scroll', onScroll);
        },
        update(view, prevState) {
          // ì„ íƒ ìƒíƒœ ë³€ê²½ ê°ì§€
          const next = getSelectedImage(view);
          if (!next) {
            if (active) {
              hide();
            }
            return;
          }

          if (!active || active.pos !== next.pos) {
            show(next);
          } else {
            positionHandle(); // ê°™ì€ ì´ë¯¸ì§€ë©´ ìœ„ì¹˜ë§Œ ì—…ë°ì´íŠ¸
          }
        },
      };
    },
    props: {
      handleDOMEvents: {
        click(view, event) {
          // ì´ë¯¸ì§€ í´ë¦­ ì‹œ NodeSelection ìƒì„±
          const target = event.target as HTMLElement;
          const img = target.closest('img');
          if (!img) return false;

          const pos = view.posAtCoords({ left: event.clientX, top: event.clientY });
          if (!pos) return false;

          const $pos = view.state.doc.resolve(pos.pos);
          let imagePos = $pos.pos;
          
          // ì´ë¯¸ì§€ ë…¸ë“œ ì°¾ê¸°
          for (let i = 0; i < 10; i++) {
            const node = view.state.doc.nodeAt(imagePos);
            if (node && isImageNode(node)) {
              const tr = view.state.tr.setSelection(NodeSelection.create(view.state.doc, imagePos));
              view.dispatch(tr);
              return true;
            }
            // ì´ì „/ë‹¤ìŒ ë…¸ë“œ í™•ì¸
            const prevNode = view.state.doc.nodeAt(imagePos - 1);
            const nextNode = view.state.doc.nodeAt(imagePos + 1);
            if (prevNode && isImageNode(prevNode)) {
              const tr = view.state.tr.setSelection(NodeSelection.create(view.state.doc, imagePos - 1));
              view.dispatch(tr);
              return true;
            }
            if (nextNode && isImageNode(nextNode)) {
              const tr = view.state.tr.setSelection(NodeSelection.create(view.state.doc, imagePos + 1));
              view.dispatch(tr);
              return true;
            }
            break;
          }
          return false;
        },
      },
    },
  });
}
```

### 2. ImageResizeExtension ìƒì„±

**íŒŒì¼**: `components/editor/extensions/ImageResizeExtension.ts`

```typescript
/**
 * ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ Extension
 * ProseMirror Pluginì„ Tiptap Extensionìœ¼ë¡œ ê°ì‹¸ì„œ í™•ì‹¤íˆ ë“±ë¡
 */

'use client';

import { Extension } from '@tiptap/core';
import { createImageResizePlugin } from '../ImageResizePlugin';

export const ImageResizeExtension = Extension.create({
  name: 'imageResizeExtension',
  addProseMirrorPlugins() {
    return [createImageResizePlugin()];
  },
});
```

### 3. BlogEditorì— ì¶”ê°€

```typescript
import { ImageResizeExtension } from './extensions/ImageResizeExtension';

const editorExtensions = useMemo(() => {
  // ... ê¸°ì¡´ í™•ì¥ë“¤ ...
  return [...mappedExtensions, ImageResizeExtension];
}, [imageExtension, editorSuggestionItems]);
```

---

## ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬

### PostViewer ì»´í¬ë„ŒíŠ¸

**íŒŒì¼**: `components/blog/PostViewer.tsx`

```typescript
'use client';

import { useState, useEffect, useRef } from 'react';

interface PostViewerProps {
  htmlContent: string;
}

export default function PostViewer({ htmlContent }: PostViewerProps) {
  const [lightboxImage, setLightboxImage] = useState<string | null>(null);
  const contentRef = useRef<HTMLDivElement>(null);

  // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬ ì—´ê¸° (ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©)
  useEffect(() => {
    if (!contentRef.current) return;

    // ëª¨ë“  ì´ë¯¸ì§€ì— ì»¤ì„œ ìŠ¤íƒ€ì¼ ì¶”ê°€
    const images = contentRef.current.querySelectorAll('img');
    images.forEach((img) => {
      (img as HTMLImageElement).style.cursor = 'pointer';
    });

    // ì´ë²¤íŠ¸ ìœ„ì„: contentRefì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡
    const handleContentClick = (e: MouseEvent) => {
      const target = e.target as HTMLElement;
      const image = target.closest('img');
      if (image && image.src) {
        e.preventDefault();
        e.stopPropagation();
        setLightboxImage(image.src);
      }
    };

    contentRef.current.addEventListener('click', handleContentClick);

    return () => {
      if (contentRef.current) {
        contentRef.current.removeEventListener('click', handleContentClick);
      }
    };
  }, [htmlContent]);

  // ESC í‚¤ë¡œ ë¼ì´íŠ¸ë°•ìŠ¤ ë‹«ê¸°
  useEffect(() => {
    if (!lightboxImage) return;

    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') {
        setLightboxImage(null);
      }
    };

    window.addEventListener('keydown', handleEscape);
    return () => window.removeEventListener('keydown', handleEscape);
  }, [lightboxImage]);

  return (
    <>
      <div
        ref={contentRef}
        className="prose prose-invert dark:prose-invert prose-headings:text-white prose-p:text-gray-200 prose-strong:text-white prose-code:text-gray-100 prose-li:text-gray-200 max-w-none"
        dangerouslySetInnerHTML={{ __html: htmlContent }}
      />

      {/* ì´ë¯¸ì§€ ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬ */}
      {lightboxImage && (
        <div
          className="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm"
          onClick={() => setLightboxImage(null)}
        >
          {/* ë‹«ê¸° ë²„íŠ¼ */}
          <button
            onClick={() => setLightboxImage(null)}
            className="absolute top-4 right-4 p-3 rounded-full bg-slate-800/80 hover:bg-slate-700/80 text-white transition-colors z-10"
            aria-label="ë‹«ê¸°"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              strokeWidth="2"
              strokeLinecap="round"
              strokeLinejoin="round"
            >
              <path d="M18 6 6 18" />
              <path d="m6 6 12 12" />
            </svg>
          </button>

          {/* ì´ë¯¸ì§€ */}
          <div
            className="max-w-[90vw] max-h-[90vh] flex items-center justify-center"
            onClick={(e) => e.stopPropagation()}
          >
            <img
              src={lightboxImage}
              alt="í™•ëŒ€ ì´ë¯¸ì§€"
              className="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl"
            />
          </div>
        </div>
      )}
    </>
  );
}
```

### ë¸”ë¡œê·¸ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‚¬ìš©

**íŒŒì¼**: `app/blog/[slug]/page.tsx`

```typescript
import PostViewer from '@/components/blog/PostViewer';

// ...
const html = generateHTML(post.content, extensions as Extensions);

return (
  <div className="container mx-auto px-4 py-12 max-w-4xl">
    {/* ... */}
    <PostViewer htmlContent={html} />
  </div>
);
```

---

## AI ìŠ¬ëŸ¬ê·¸ ìƒì„±

### API ì—”ë“œí¬ì¸íŠ¸

**íŒŒì¼**: `app/api/blog/generate-slug/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { google } from '@ai-sdk/google';
import { generateText } from 'ai';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const title = body.title;
    const locale = body.locale || 'ko';

    if (!title || typeof title !== 'string' || title.trim().length === 0) {
      return NextResponse.json(
        { error: 'ì œëª©ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
        { status: 400 }
      );
    }

    // Gemini API í‚¤ í™•ì¸
    const apiKey = process.env.GOOGLE_API_KEY || process.env.GOOGLE_GENERATIVE_AI_API_KEY;
    if (!apiKey) {
      // API í‚¤ê°€ ì—†ìœ¼ë©´ fallback ìŠ¬ëŸ¬ê·¸ ìƒì„±
      const fallbackSlug = title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '')
        .trim()
        .substring(0, 50);
      
      if (!fallbackSlug || fallbackSlug.length === 0) {
        return NextResponse.json(
          { error: 'ìŠ¬ëŸ¬ê·¸ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' },
          { status: 400 }
        );
      }
      
      return NextResponse.json({ slug: fallbackSlug });
    }

    // í•­ìƒ ì˜ì–´ ìŠ¬ëŸ¬ê·¸ ìƒì„± (í•œêµ­ì–´ ì œëª©ë„ ì˜ì–´ë¡œ ë²ˆì—­ í›„ ìŠ¬ëŸ¬ê·¸ ìƒì„±)
    const prompt = `Generate a URL-friendly English slug for the following blog post title.

Requirements:
- If the title is in Korean or other languages, first translate it to English, then create the slug
- Use ONLY English letters (a-z), numbers (0-9), and hyphens (-)
- Convert to lowercase
- Replace spaces with hyphens
- Remove all special characters and non-English characters
- Keep it under 50 characters
- Make it SEO-friendly and concise
- The slug must be in English only, no Korean or other language characters

Title: "${title}"

Output ONLY the slug (no explanation, no quotes, just the slug text):`;

    const { text: slug } = await generateText({
      model: google('gemini-2.0-flash', { apiKey }),
      prompt,
      maxTokens: 50,
    });

    // ìƒì„±ëœ ìŠ¬ëŸ¬ê·¸ ì •ì œ
    const cleanedSlug = slug
      .trim()
      .toLowerCase()
      .replace(/[^a-z0-9-]/g, '')
      .replace(/-+/g, '-')
      .replace(/^-|-$/g, '')
      .substring(0, 50);

    if (!cleanedSlug || cleanedSlug.length === 0) {
      // AIê°€ ì œëŒ€ë¡œ ìƒì„±í•˜ì§€ ëª»í•œ ê²½ìš° ê¸°ë³¸ ìŠ¬ëŸ¬ê·¸ ìƒì„±
      const fallbackSlug = title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '')
        .trim()
        .substring(0, 50);
      
      return NextResponse.json({ slug: fallbackSlug });
    }

    return NextResponse.json({ slug: cleanedSlug });
  } catch (error: any) {
    console.error('Error generating slug:', error);
    
    // API í‚¤ ê´€ë ¨ ì—ëŸ¬ì¸ ê²½ìš° fallback ìŠ¬ëŸ¬ê·¸ ìƒì„±
    if (error.message?.includes('API key')) {
      const body = await request.json().catch(() => ({}));
      if (body.title) {
        const fallbackSlug = body.title
          .toLowerCase()
          .replace(/[^a-z0-9\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '')
          .trim()
          .substring(0, 50);
        
        if (fallbackSlug && fallbackSlug.length > 0) {
          return NextResponse.json({ slug: fallbackSlug });
        }
      }
    }
    
    return NextResponse.json(
      { error: error.message || 'ìŠ¬ëŸ¬ê·¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}
```

### ë¸”ë¡œê·¸ ì‘ì„± í˜ì´ì§€ì—ì„œ ì‚¬ìš©

**íŒŒì¼**: `app/blog/write/page.tsx`

```typescript
// slug ìë™ ìƒì„± (Gemini API ì‚¬ìš©)
useEffect(() => {
  if (!title || title.trim().length === 0) {
    return;
  }

  // debounce: 1ì´ˆ í›„ì— ìŠ¬ëŸ¬ê·¸ ìƒì„±
  const timeoutId = setTimeout(async () => {
    // ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ìŠ¬ëŸ¬ê·¸ë¥¼ ìˆ˜ì •í•œ ê²½ìš° ìë™ ìƒì„±í•˜ì§€ ì•ŠìŒ
    if (slug && slug.trim().length > 0) {
      return;
    }

    setGeneratingSlug(true);
    try {
      const response = await fetch('/api/blog/generate-slug', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, locale }),
      });

      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        if (errorData.error) {
          console.error('Slug generation error:', errorData.error);
          return;
        }
        throw new Error('ìŠ¬ëŸ¬ê·¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }

      const data = await response.json();
      if (data.slug) {
        setSlug(data.slug);
      }
    } catch (error: any) {
      console.error('Error generating slug:', error);
      // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ìŠ¬ëŸ¬ê·¸ ìƒì„± (ì˜ì–´ë§Œ)
      const fallbackSlug = title
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-|-$/g, '')
        .trim();
      setSlug(fallbackSlug);
    } finally {
      setGeneratingSlug(false);
    }
  }, 1000); // 1ì´ˆ debounce

  return () => clearTimeout(timeoutId);
}, [title, locale, slug]);
```

---

## ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ (ì˜µì…˜)

Notion ìŠ¤íƒ€ì¼ì˜ ì‹¤ì‹œê°„ ìë™ ì €ì¥ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ `useAutoSave` í›…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ê°œìš”

**ì£¼ìš” íŠ¹ì§•**:
- âœ… **ì €ì¥ ë²„íŠ¼ ì—†ìŒ**: Notionì²˜ëŸ¼ ìë™ ì €ì¥
- âœ… **Debounce ê¸°ë°˜**: 2ì´ˆ ëŒ€ê¸° í›„ ì €ì¥ (ë¶ˆí•„ìš”í•œ ìš”ì²­ ë°©ì§€)
- âœ… **localStorage ë°±ì—…**: ì˜¤í”„ë¼ì¸/ì—ëŸ¬ ì‹œ ë¡œì»¬ ë°±ì—…
- âœ… **ì €ì¥ ìƒíƒœ í‘œì‹œ**: ì €ì¥ ì¤‘, ì €ì¥ë¨, ì €ì¥ ì‹¤íŒ¨, ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
- âœ… **ì˜¤í”„ë¼ì¸ ì§€ì›**: ì˜¤í”„ë¼ì¸ ì‹œ ë¡œì»¬ ë°±ì—…, ì˜¨ë¼ì¸ ë³µê·€ ì‹œ ìë™ ë™ê¸°í™”

### 1. useAutoSave í›… ìƒì„±

**íŒŒì¼**: `lib/hooks/useAutoSave.ts`

```typescript
import { useState, useEffect, useRef, useCallback } from 'react';
import type { JSONContent } from '@tiptap/core';

export type SaveStatus = 'saved' | 'saving' | 'error' | 'offline';

interface UseAutoSaveOptions {
  docId: string;
  debounceMs?: number;
  onSave?: (content: JSONContent, title?: string) => Promise<void>;
}

export function useAutoSave({
  docId,
  debounceMs = 2000,
  onSave,
}: UseAutoSaveOptions) {
  const [saveStatus, setSaveStatus] = useState<SaveStatus>('saved');
  const [lastSaved, setLastSaved] = useState<Date | null>(null);
  const timeoutRef = useRef<NodeJS.Timeout | null>(null);
  const isOnlineRef = useRef(navigator.onLine);

  // ë°±ì—… í‚¤ ìƒì„±
  const getBackupKey = useCallback(
    (type: 'content' | 'title') => `blog-post-${docId}-${type}`,
    [docId]
  );

  // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
  useEffect(() => {
    const handleOnline = () => {
      isOnlineRef.current = true;
      setSaveStatus((prev) => (prev === 'offline' ? 'saved' : prev));
    };

    const handleOffline = () => {
      isOnlineRef.current = false;
      setSaveStatus('offline');
    };

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  // localStorage ë°±ì—…
  const backupToLocal = useCallback(
    (content: JSONContent, title?: string) => {
      try {
        localStorage.setItem(getBackupKey('content'), JSON.stringify(content));
        if (title) {
          localStorage.setItem(getBackupKey('title'), title);
        }
      } catch (error) {
        console.error('Error backing up to localStorage:', error);
      }
    },
    [getBackupKey]
  );

  // localStorageì—ì„œ ë³µì›
  const restoreFromLocal = useCallback((): { content: JSONContent | null; title: string | null } => {
    try {
      const contentStr = localStorage.getItem(getBackupKey('content'));
      const title = localStorage.getItem(getBackupKey('title'));
      return {
        content: contentStr ? JSON.parse(contentStr) : null,
        title,
      };
    } catch (error) {
      console.error('Error restoring from localStorage:', error);
      return { content: null, title: null };
    }
  }, [getBackupKey]);

  // ì €ì¥ ì‹¤í–‰
  const performSave = useCallback(
    async (content: JSONContent, title?: string) => {
      if (!isOnlineRef.current) {
        setSaveStatus('offline');
        backupToLocal(content, title);
        return;
      }

      if (!onSave) {
        backupToLocal(content, title);
        return;
      }

      setSaveStatus('saving');

      try {
        await onSave(content, title);
        setSaveStatus('saved');
        setLastSaved(new Date());
        backupToLocal(content, title);
      } catch (error) {
        console.error('Error saving:', error);
        setSaveStatus('error');
        backupToLocal(content, title);
      }
    },
    [onSave, backupToLocal]
  );

  // ìë™ì €ì¥ íŠ¸ë¦¬ê±° (debounce)
  const triggerSave = useCallback(
    (content: JSONContent, title?: string) => {
      // ê¸°ì¡´ íƒ€ì´ë¨¸ ì·¨ì†Œ
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }

      // ì¦‰ì‹œ localStorage ë°±ì—…
      backupToLocal(content, title);

      // debounce í›„ ì„œë²„ ì €ì¥
      timeoutRef.current = setTimeout(() => {
        performSave(content, title);
      }, debounceMs);
    },
    [debounceMs, backupToLocal, performSave]
  );

  // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ íƒ€ì´ë¨¸ ì •ë¦¬
  useEffect(() => {
    return () => {
      if (timeoutRef.current) {
        clearTimeout(timeoutRef.current);
      }
    };
  }, []);

  return {
    saveStatus,
    lastSaved,
    triggerSave,
    restoreFromLocal,
  };
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **Debounce**: 2ì´ˆ ëŒ€ê¸° í›„ ì €ì¥í•˜ì—¬ ë¶ˆí•„ìš”í•œ ìš”ì²­ ë°©ì§€
- **ì¦‰ì‹œ ë¡œì»¬ ë°±ì—…**: ì…ë ¥ ì¦‰ì‹œ localStorageì— ë°±ì—…í•˜ì—¬ ë°ì´í„° ì†ì‹¤ ë°©ì§€
- **ì˜¤í”„ë¼ì¸ ì§€ì›**: ì˜¤í”„ë¼ì¸ ì‹œì—ë„ ë¡œì»¬ ë°±ì—… ìˆ˜í–‰
- **ìƒíƒœ ê´€ë¦¬**: 4ê°€ì§€ ìƒíƒœ (`saved`, `saving`, `error`, `offline`)ë¡œ ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°± ì œê³µ

### 2. ë¸”ë¡œê·¸ ì‘ì„± í˜ì´ì§€ì— ì ìš©

**íŒŒì¼**: `app/blog/write/page.tsx`

```typescript
import { useAutoSave } from '@/lib/hooks/useAutoSave';
import { createClient } from '@/lib/supabase/client';

export default function BlogWritePage() {
  const supabase = createClient();
  const [postId, setPostId] = useState<string | null>(null);
  
  // ì‹¤ì‹œê°„ ì €ì¥ (ì´ˆì•ˆ ì €ì¥ìš©)
  const { saveStatus, lastSaved, triggerSave } = useAutoSave({
    docId: postId || 'draft',
    debounceMs: 2000,
    onSave: async (savedContent, savedTitle) => {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      }

      // ì´ˆì•ˆ ì €ì¥ API í˜¸ì¶œ (PATCH ë˜ëŠ” POST)
      const url = postId ? `/api/posts/${postId}` : '/api/posts';
      const method = postId ? 'PATCH' : 'POST';
      
      const response = await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${session.access_token}`,
        },
        body: JSON.stringify({
          title: savedTitle || title,
          content: savedContent,
          is_published: false, // ì´ˆì•ˆìœ¼ë¡œ ì €ì¥
        }),
      });

      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || 'ì €ì¥ ì‹¤íŒ¨');
      }

      const data = await response.json();
      if (data.post && !postId) {
        setPostId(data.post.id);
      }
    },
  });

  // ì œëª© ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleTitleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const newTitle = e.target.value;
    setTitle(newTitle);
    if (content) {
      triggerSave(content, newTitle);
    }
  };

  // ë³¸ë¬¸ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleContentChange = (newContent: JSONContent) => {
    setContent(newContent);
    triggerSave(newContent, title);
  };

  return (
    <div>
      {/* ì €ì¥ ìƒíƒœ í‘œì‹œ */}
      <div className="flex items-center gap-2 text-xs mb-4">
        {saveStatus === 'saving' && (
          <span className="text-yellow-600">ì €ì¥ ì¤‘...</span>
        )}
        {saveStatus === 'saved' && lastSaved && (
          <span className="text-green-600">
            ì €ì¥ë¨ {lastSaved.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })}
          </span>
        )}
        {saveStatus === 'error' && (
          <span className="text-red-600">ì €ì¥ ì‹¤íŒ¨</span>
        )}
        {saveStatus === 'offline' && (
          <span className="text-slate-600">ì˜¤í”„ë¼ì¸ - ë™ê¸°í™” ëŒ€ê¸° ì¤‘</span>
        )}
      </div>

      {/* ì œëª© ì…ë ¥ */}
      <input
        type="text"
        value={title}
        onChange={handleTitleChange}
        // ...
      />

      {/* ì—ë””í„° */}
      <BlogEditor
        content={content}
        onChange={handleContentChange}
      />
    </div>
  );
}
```

**ì°¸ê³ **: ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ì€ ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤. í•„ìš”í•˜ì§€ ì•Šë‹¤ë©´ ì¼ë°˜ì ì¸ ì €ì¥ ë²„íŠ¼ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ì‹œí–‰ì°©ì˜¤ ë° í•´ê²° ë°©ë²•

### 1. ìŠ¬ë˜ì‹œ ë©”ë‰´ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: `/` ì…ë ¥ ì‹œ ë©”ë‰´ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ì›ì¸**: `renderItems` import ëˆ„ë½ ë˜ëŠ” ì„¤ì • ëˆ„ë½

**í•´ê²°**:
```typescript
// âœ… ì˜¬ë°”ë¥¸ import
import { Command, createSuggestionItems, renderItems } from 'novel';

// âœ… ì˜¬ë°”ë¥¸ ì„¤ì •
export const slashCommand = Command.configure({
  suggestion: {
    items: () => suggestionItems,
    render: renderItems, // â† í•„ìˆ˜!
  },
});
```

### 2. ìŠ¬ë˜ì‹œ ë©”ë‰´ëŠ” ë‚˜íƒ€ë‚˜ì§€ë§Œ ëª…ë ¹ì´ ì ìš©ë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ë©”ë‰´ëŠ” ë³´ì´ì§€ë§Œ Heading 1 ë“±ì„ ì„ íƒí•´ë„ ì ìš©ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `onCommand` í•¸ë“¤ëŸ¬ì—ì„œ `editor`ì™€ `range`ë¥¼ ì œëŒ€ë¡œ ì „ë‹¬í•˜ì§€ ì•ŠìŒ

**í•´ê²°**: í•˜ì´ë¸Œë¦¬ë“œ ë Œë”ë§ ë°©ì‹ ì‚¬ìš© (ìœ„ ì½”ë“œ ì°¸ì¡°)

### 3. "Empty text nodes are not allowed" ì—ëŸ¬

**ì¦ìƒ**: Heading ëª…ë ¹ ì‹¤í–‰ ì‹œ ì—ëŸ¬ ë°œìƒ

**ì›ì¸**: `insertContent`ì— ë¹ˆ í…ìŠ¤íŠ¸ ë…¸ë“œ í¬í•¨

**í•´ê²°**: `toggleHeading` ì‚¬ìš©
```typescript
// âŒ ì˜ëª»ëœ ë°©ë²•
editor.chain().focus().insertContent({
  type: 'heading',
  attrs: { level: 1 },
  content: [{ type: 'text', text: '' }], // â† ì—ëŸ¬
}).run();

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
editor.chain().focus().deleteRange(range).toggleHeading({ level: 1 }).run();
```

### 4. `addNodeView(...) is not a function` ì—ëŸ¬

**ì¦ìƒ**: ì´ë¯¸ì§€ ë¶™ì—¬ë„£ê¸° ì‹œ ì—ëŸ¬ ë°œìƒ

**ì›ì¸**: ì¼ë°˜ `Image` extensionê³¼ `setImage` ëª…ë ¹ ì‚¬ìš©

**í•´ê²°**: `UpdatedImage`ì™€ `createImageUpload` ì‚¬ìš©
```typescript
// âŒ ì˜ëª»ëœ ë°©ë²•
import Image from '@tiptap/extension-image';
editor.chain().focus().setImage({ src: url }).run(); // â† ì—ëŸ¬

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
import { UpdatedImage, createImageUpload, handleImagePaste } from 'novel';
const imageUploadFn = createImageUpload({ ... });
// handleImagePaste ë˜ëŠ” insertContent ì‚¬ìš©
```

### 5. SSR ì—ëŸ¬: `extensions.map is not a function`

**ì¦ìƒ**: ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ `generateHTML` ì‚¬ìš© ì‹œ ì—ëŸ¬

**ì›ì¸**: í´ë¼ì´ì–¸íŠ¸ ì „ìš© í™•ì¥(`slashCommand`)ì„ ì„œë²„ì—ì„œ ì‚¬ìš©

**í•´ê²°**: ì„œë²„ìš© í™•ì¥ íŒŒì¼ ë¶„ë¦¬ (`extensions-server.tsx`)

### 6. ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ì´ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì´ë¯¸ì§€ í´ë¦­ ì‹œ í•¸ë“¤ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ì›ì¸**: ì´ë¯¸ì§€ í´ë¦­ ì‹œ `NodeSelection`ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ

**í•´ê²°**: `handleDOMEvents.click`ì—ì„œ ì´ë¯¸ì§€ ë…¸ë“œ ì°¾ê¸° ë¡œì§ ê°œì„  (ìœ„ ì½”ë“œ ì°¸ì¡°)

### 7. ìŠ¬ëŸ¬ê·¸ ìƒì„± API í‚¤ ì—ëŸ¬

**ì¦ìƒ**: "Google Generative AI API key is missing" ì—ëŸ¬

**ì›ì¸**: í™˜ê²½ ë³€ìˆ˜ ì´ë¦„ ë¶ˆì¼ì¹˜

**í•´ê²°**:
```typescript
// GOOGLE_API_KEY ë˜ëŠ” GOOGLE_GENERATIVE_AI_API_KEY ëª¨ë‘ ì§€ì›
const apiKey = process.env.GOOGLE_API_KEY || process.env.GOOGLE_GENERATIVE_AI_API_KEY;

// ëª…ì‹œì ìœ¼ë¡œ apiKey ì „ë‹¬
model: google('gemini-2.0-flash', { apiKey })
```

---

## ì´ì‹ ê°€ì´ë“œ

### ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¡œ ì´ì‹í•˜ëŠ” ë°©ë²•

#### 1ë‹¨ê³„: íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install novel @tiptap/core @tiptap/react @tiptap/starter-kit @tiptap/html
npm install @tiptap/extension-image @tiptap/extension-link
npm install @tiptap/extension-task-list @tiptap/extension-task-item
npm install @tiptap/extension-youtube @tiptap/extension-color
npm install @tiptap/extension-text-style @tiptap/extension-highlight
npm install @tailwindcss/typography lucide-react jotai
```

#### 2ë‹¨ê³„: íŒŒì¼ ë³µì‚¬

ë‹¤ìŒ íŒŒì¼ë“¤ì„ ìƒˆ í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬:

```
components/editor/
â”œâ”€â”€ BlogEditor.tsx
â”œâ”€â”€ BubbleMenu.tsx
â”œâ”€â”€ extensions.tsx
â”œâ”€â”€ extensions-server.tsx
â”œâ”€â”€ ImageResizePlugin.tsx
â””â”€â”€ extensions/
    â””â”€â”€ ImageResizeExtension.ts

components/blog/
â””â”€â”€ PostViewer.tsx

lib/types/
â””â”€â”€ blog.ts

lib/hooks/ (ì˜µì…˜)
â””â”€â”€ useAutoSave.ts
```

#### 3ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.local`ì— Supabase ë° Google API í‚¤ ì„¤ì •

#### 4ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

`supabase/migrations/20250113_create_ustudio_posts.sql` ì‹¤í–‰

#### 5ë‹¨ê³„: Supabase Storage ì„¤ì •

`blog-images` ë²„í‚· ìƒì„± ë° Public ì½ê¸° ê¶Œí•œ ì„¤ì •

#### 6ë‹¨ê³„: Tailwind ì„¤ì •

`tailwind.config.ts`ì— `@tailwindcss/typography` í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€:

```typescript
import type { Config } from "tailwindcss";

const config: Config = {
  // ...
  plugins: [
    require('@tailwindcss/typography'),
  ],
};
```

#### 7ë‹¨ê³„: API ë¼ìš°íŠ¸ ìƒì„±

`app/api/posts/` ë””ë ‰í† ë¦¬ì— API ë¼ìš°íŠ¸ ìƒì„± (ê¸°ì¡´ ì½”ë“œ ì°¸ì¡°)

#### 8ë‹¨ê³„: í˜ì´ì§€ ìƒì„±

ë¸”ë¡œê·¸ ì‘ì„±/ìˆ˜ì •/ì¡°íšŒ í˜ì´ì§€ ìƒì„± (ê¸°ì¡´ ì½”ë“œ ì°¸ì¡°)

### ì£¼ì˜ì‚¬í•­

1. **Supabase í´ë¼ì´ì–¸íŠ¸**: í”„ë¡œì íŠ¸ì˜ Supabase ì„¤ì •ì— ë§ê²Œ ìˆ˜ì •
2. **ì¸ì¦ ë°©ì‹**: í”„ë¡œì íŠ¸ì˜ ì¸ì¦ ì‹œìŠ¤í…œì— ë§ê²Œ ìˆ˜ì •
3. **ìŠ¤íƒ€ì¼ë§**: í”„ë¡œì íŠ¸ì˜ ë””ìì¸ ì‹œìŠ¤í…œì— ë§ê²Œ Tailwind í´ë˜ìŠ¤ ìˆ˜ì •
4. **íƒ€ì… ì •ì˜**: í”„ë¡œì íŠ¸ì˜ íƒ€ì… ì‹œìŠ¤í…œì— ë§ê²Œ ìˆ˜ì •

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ ê¸°ëŠ¥
- [ ] íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] Supabase Storage ë²„í‚· ìƒì„±
- [ ] ê¸°ë³¸ ì—ë””í„° ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] ìŠ¬ë˜ì‹œ ë©”ë‰´ êµ¬í˜„
- [ ] Bubble Menu êµ¬í˜„

### ì´ë¯¸ì§€ ê¸°ëŠ¥
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ êµ¬í˜„
- [ ] ì´ë¯¸ì§€ ë³µì‚¬-ë¶™ì—¬ë„£ê¸° êµ¬í˜„
- [ ] ì´ë¯¸ì§€ ë“œë˜ê·¸ ì•¤ ë“œë¡­ êµ¬í˜„
- [ ] ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ êµ¬í˜„
- [ ] ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬ êµ¬í˜„

### ì¶”ê°€ ê¸°ëŠ¥
- [ ] YouTube ì„ë² ë“œ êµ¬í˜„
- [ ] AI ìŠ¬ëŸ¬ê·¸ ìƒì„± êµ¬í˜„ (ì„ íƒì‚¬í•­)
- [ ] ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„ (ì„ íƒì‚¬í•­)

### í…ŒìŠ¤íŠ¸
- [ ] ìŠ¬ë˜ì‹œ ë©”ë‰´ ë™ì‘ í™•ì¸
- [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ ë™ì‘ í™•ì¸
- [ ] ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë™ì‘ í™•ì¸
- [ ] ë¼ì´íŠ¸ë°•ìŠ¤ ëª¨ë‹¬ ë™ì‘ í™•ì¸
- [ ] ë¸”ë¡œê·¸ ì‘ì„±/ìˆ˜ì •/ì¡°íšŒ ë™ì‘ í™•ì¸

---

## ì°¸ê³  ìë£Œ

- [Novel.sh ê³µì‹ ë¬¸ì„œ](https://novel.sh/docs)
- [Tiptap ë¬¸ì„œ](https://tiptap.dev/docs)
- [Supabase Storage ë¬¸ì„œ](https://supabase.com/docs/guides/storage)
- [Vercel AI SDK ë¬¸ì„œ](https://sdk.vercel.ai/docs)
- [ìš´ì˜ì§„ ê²Œì‹œíŒ ì‹¤ì‹œê°„ ì €ì¥ ê¸°ëŠ¥ ë³´ê³ ì„œ](./ìš´ì˜ì§„_ê²Œì‹œíŒ_ì‹¤ì‹œê°„_ì €ì¥_ê¸°ëŠ¥_ë³´ê³ ì„œ.md)

---

**ì‘ì„± ì™„ë£Œ**: 2025-01-16  
**ë²„ì „**: 1.0  
**ì‘ì„±ì**: AI Assistant

