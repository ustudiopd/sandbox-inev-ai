# μ„¤λ¬Έμ΅°μ‚¬ νΌ λ΅λ”© μ„±λ¥ λ¶„μ„ λ¦¬ν¬νΈ

## π“ ν„μ¬ μƒνƒ λ¶„μ„

### 1. μ‚¬μ©μ ν”λ΅μ°
```
μ‚¬μ©μ ν΄λ¦­ β†’ νμ—… ν‘μ‹ β†’ FormWidget λ§μ΄νΈ β†’ API νΈμ¶ β†’ νΌ λ°μ΄ν„° λ΅λ“ β†’ UI λ λ”λ§
```

### 2. ν„μ¬ κµ¬ν„ μƒνƒ

#### β… μ΄λ―Έ μµμ ν™”λ λ¶€λ¶„
1. **λ³‘λ ¬ μΏΌλ¦¬ μ²λ¦¬**: νΌκ³Ό λ¬Έν•­ μ΅°νλ¥Ό `Promise.all`λ΅ λ³‘λ ¬ μ‹¤ν–‰
2. **Admin Supabase μ‚¬μ©**: RLS μ°νλ΅ μ΅°ν μ„±λ¥ ν–¥μƒ
3. **μ μ¶ μ—¬λ¶€ ν™•μΈ μµμ ν™”**: ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€ μΏΌλ¦¬ μ κ±°, APIμ—μ„ μ²λ¦¬
4. **μΈλ±μ¤ μ΅΄μ¬**: `form_questions_form_id_order_idx` μΈλ±μ¤λ΅ λ¬Έν•­ μ΅°ν μµμ ν™”

#### β οΈ κ°μ„  κ°€λ¥ν• λ¶€λ¶„
1. **μμ°¨μ  κ¶ν• ν™•μΈ**: ν€΄μ¦μ κ²½μ° κ¶ν• ν™•μΈμ΄ μμ°¨μ μΌλ΅ μ‹¤ν–‰λ¨
2. **μ μ¶ μ—¬λ¶€ ν™•μΈ μ§€μ—°**: μ„¤λ¬Έμ κ²½μ° νΌ/λ¬Έν•­ μ΅°ν ν›„ μ μ¶ μ—¬λ¶€ ν™•μΈ
3. **λ¶ν•„μ”ν• λ°μ΄ν„° μ΅°ν**: `select('*')`λ΅ λ¨λ“  μ»¬λΌ μ΅°ν
4. **ν΄λΌμ΄μ–ΈνΈ μΈ΅ μ¶”κ°€ μΏΌλ¦¬ μ—†μ**: μ΄λ―Έ μµμ ν™”λ¨

## π€ μ„±λ¥ μµμ ν™” λ°©μ•

### λ°©μ• 1: λ¨λ“  μΏΌλ¦¬λ¥Ό λ³‘λ ¬λ΅ μ²λ¦¬
**ν„μ¬**: νΌ/λ¬Έν•­μ€ λ³‘λ ¬, κ¶ν•/μ μ¶ μ—¬λ¶€λ” μμ°¨
**κ°μ„ **: λ¨λ“  μΏΌλ¦¬λ¥Ό λ³‘λ ¬λ΅ μ²λ¦¬

```typescript
// κ°μ„  μ „ (ν„μ¬)
const [formResult, questionsResult] = await Promise.all([...])
// μ΄ν›„ μμ°¨μ μΌλ΅ κ¶ν• ν™•μΈ λ° μ μ¶ μ—¬λ¶€ ν™•μΈ

// κ°μ„  ν›„
const [formResult, questionsResult, submissionResult, profileResult] = await Promise.all([
  admin.from('forms').select('*').eq('id', formId).eq('webinar_id', webinarId).single(),
  admin.from('form_questions').select('*').eq('form_id', formId).order('order_no', { ascending: true }),
  // μ„¤λ¬ΈμΈ κ²½μ° μ μ¶ μ—¬λ¶€ ν™•μΈ
  form.kind === 'survey' && user 
    ? admin.from('form_submissions').select('id').eq('form_id', formId).eq('participant_id', user.id).maybeSingle()
    : Promise.resolve({ data: null }),
  // ν€΄μ¦μΈ κ²½μ° κ¶ν• ν™•μΈ
  form.kind === 'quiz' && form.status !== 'closed' && user
    ? supabase.from('profiles').select('is_super_admin').eq('id', user.id).maybeSingle()
    : Promise.resolve({ data: null })
])
```

**μμƒ κ°μ„ **: μ•½ 30-50% μ†λ„ ν–¥μƒ (κ¶ν• ν™•μΈ λ° μ μ¶ μ—¬λ¶€ ν™•μΈ λ³‘λ ¬ν™”)

### λ°©μ• 2: ν•„μ”ν• μ»¬λΌλ§ μ„ νƒ
**ν„μ¬**: `select('*')`λ΅ λ¨λ“  μ»¬λΌ μ΅°ν
**κ°μ„ **: ν•„μ”ν• μ»¬λΌλ§ μ„ νƒ

```typescript
// κ°μ„  μ „
admin.from('forms').select('*')

// κ°μ„  ν›„
admin.from('forms').select('id, webinar_id, title, description, kind, status, time_limit_sec, max_attempts, created_by, created_at, opened_at, closed_at')
```

**μμƒ κ°μ„ **: μ•½ 10-20% μ†λ„ ν–¥μƒ (λ„¤νΈμ›ν¬ μ „μ†΅λ‰ κ°μ†)

### λ°©μ• 3: ν”„λ¦¬λ΅λ”© (Prefetching)
**ν„μ¬**: λ²„νΌ ν΄λ¦­ μ‹μ—λ§ λ°μ΄ν„° λ΅λ“
**κ°μ„ **: λ²„νΌμ— λ§μ°μ¤ μ¤λ²„ μ‹ λ―Έλ¦¬ λ΅λ“

```typescript
// μ„Έμ…μ†κ° μ„Ήμ…μ λ²„νΌμ— onMouseEnter μ΄λ²¤νΈ μ¶”κ°€
<button
  onMouseEnter={() => {
    // μ„¤λ¬Έ λ°μ΄ν„° ν”„λ¦¬λ΅λ“ (μΊμ‹μ— μ €μ¥)
    prefetchFormData(survey.id)
  }}
  onClick={() => {
    // μΊμ‹λ λ°μ΄ν„° μ‚¬μ© λλ” μƒλ΅ λ΅λ“
    setPopupContent({ type: 'form', id: survey.id, title: survey.title })
  }}
>
```

**μμƒ κ°μ„ **: μ‚¬μ©μ μ²΄κ° μ†λ„ 50-70% ν–¥μƒ (λ²„νΌ ν΄λ¦­ μ‹ μ¦‰μ‹ ν‘μ‹)

### λ°©μ• 4: λ°μ΄ν„°λ² μ΄μ¤ μΈλ±μ¤ μµμ ν™”
**ν„μ¬ μΈλ±μ¤**:
- `form_questions_form_id_order_idx` (form_id, order_no)
- `idx_forms_webinar_id` (webinar_id)
- `idx_form_submissions_form_id` (form_id)

**μ¶”κ°€ μΈλ±μ¤ μ μ•**:
```sql
-- form_submissions μ΅°ν μµμ ν™” (μ μ¶ μ—¬λ¶€ ν™•μΈ)
CREATE INDEX IF NOT EXISTS idx_form_submissions_form_participant 
ON public.form_submissions(form_id, participant_id);

-- forms μ΅°ν μµμ ν™” (λ³µν•© μΈλ±μ¤)
CREATE INDEX IF NOT EXISTS idx_forms_id_webinar_id 
ON public.forms(id, webinar_id);
```

**μμƒ κ°μ„ **: μ•½ 20-30% μ†λ„ ν–¥μƒ (μΈλ±μ¤ ν™μ©λ„ ν–¥μƒ)

### λ°©μ• 5: React Query λλ” SWR μ‚¬μ©
**ν„μ¬**: useState + useEffectλ΅ λ°μ΄ν„° κ΄€λ¦¬
**κ°μ„ **: React Queryλ΅ μΊμ‹± λ° μλ™ μ¬κ²€μ¦

```typescript
// React Query μ‚¬μ© μμ‹
const { data: form, isLoading } = useQuery({
  queryKey: ['form', formId],
  queryFn: () => fetchForm(formId),
  staleTime: 5 * 60 * 1000, // 5λ¶„κ°„ μΊμ‹ μ μ§€
  cacheTime: 10 * 60 * 1000, // 10λ¶„κ°„ λ©”λ¨λ¦¬ λ³΄κ΄€
})
```

**μμƒ κ°μ„ **: 
- μ²« λ΅λ”©: λ™μΌ
- μ¬λ°©λ¬Έ: 90% μ΄μƒ μ†λ„ ν–¥μƒ (μΊμ‹ ν™μ©)

## π“ μ°μ„ μμ„λ³„ κ°μ„  κ³„ν

### π”΄ High Priority (μ¦‰μ‹ μ μ© κ°€λ¥)
1. **λ°©μ• 1: λ¨λ“  μΏΌλ¦¬ λ³‘λ ¬ μ²λ¦¬** - κµ¬ν„ λ‚μ΄λ„: λ‚®μ, ν¨κ³Ό: λ†’μ
2. **λ°©μ• 2: ν•„μ”ν• μ»¬λΌλ§ μ„ νƒ** - κµ¬ν„ λ‚μ΄λ„: λ‚®μ, ν¨κ³Ό: μ¤‘κ°„

### π΅ Medium Priority (λ‹¨κΈ° κ°μ„ )
3. **λ°©μ• 4: λ°μ΄ν„°λ² μ΄μ¤ μΈλ±μ¤ μµμ ν™”** - κµ¬ν„ λ‚μ΄λ„: λ‚®μ, ν¨κ³Ό: μ¤‘κ°„
4. **λ°©μ• 3: ν”„λ¦¬λ΅λ”©** - κµ¬ν„ λ‚μ΄λ„: μ¤‘κ°„, ν¨κ³Ό: λ†’μ (μ²΄κ°)

### πΆ Low Priority (μ¥κΈ° κ°μ„ )
5. **λ°©μ• 5: React Query λ„μ…** - κµ¬ν„ λ‚μ΄λ„: λ†’μ, ν¨κ³Ό: λ†’μ (μ¬λ°©λ¬Έ μ‹)

## π― μμƒ μ„±λ¥ κ°μ„  ν¨κ³Ό

### ν„μ¬ μμƒ λ΅λ”© μ‹κ°„
- API νΈμ¶: 200-500ms (λ„¤νΈμ›ν¬ + DB μΏΌλ¦¬)
- UI λ λ”λ§: 50-100ms
- **μ΄ μμƒ μ‹κ°„: 250-600ms**

### κ°μ„  ν›„ μμƒ λ΅λ”© μ‹κ°„
- **λ°©μ• 1+2 μ μ©**: 150-350ms (μ•½ 40% κ°μ„ )
- **λ°©μ• 1+2+4 μ μ©**: 120-280ms (μ•½ 50% κ°μ„ )
- **λ°©μ• 1+2+3+4 μ μ©**: μ‚¬μ©μ μ²΄κ° 50-100ms (ν”„λ¦¬λ΅λ”©μΌλ΅ μΈν• μ¦‰μ‹ ν‘μ‹)

## π“ κµ¬ν„ κ¶μ¥μ‚¬ν•­

### μ¦‰μ‹ μ μ© κ°€λ¥ν• μµμ ν™”
1. λ¨λ“  μΏΌλ¦¬λ¥Ό λ³‘λ ¬λ΅ μ²λ¦¬
2. ν•„μ”ν• μ»¬λΌλ§ μ„ νƒ
3. μΈλ±μ¤ μ¶”κ°€

### λ‹¨κ³„λ³„ μ μ©
1. **1λ‹¨κ³„**: λ°©μ• 1, 2, 4 μ μ© (μ½”λ“ λ³€κ²½ + λ§μ΄κ·Έλ μ΄μ…)
2. **2λ‹¨κ³„**: λ°©μ• 3 μ μ© (UX κ°μ„ )
3. **3λ‹¨κ³„**: λ°©μ• 5 μ μ© (μ¥κΈ°μ  μ•„ν‚¤ν…μ² κ°μ„ )

## π” λ¨λ‹ν„°λ§ ν¬μΈνΈ

μ„±λ¥ κ°μ„  ν›„ λ‹¤μ μ§€ν‘λ¥Ό λ¨λ‹ν„°λ§ν•΄μ•Ό ν•©λ‹λ‹¤:
1. API μ‘λ‹µ μ‹κ°„ (P50, P95, P99)
2. λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ μ‹¤ν–‰ μ‹κ°„
3. ν΄λΌμ΄μ–ΈνΈ μΈ΅ λ΅λ”© μ‹κ°„
4. μ‚¬μ©μ μ²΄κ° μ†λ„

---

**μ‘μ„±μΌ**: 2025-01-XX
**λ¶„μ„ λ€μƒ**: μ„¤λ¬Έμ΅°μ‚¬ νΌ λ΅λ”© μ„±λ¥
**ν„μ¬ μƒνƒ**: κΈ°λ³Έ μµμ ν™” μ™„λ£, μ¶”κ°€ μµμ ν™” κ°€λ¥

