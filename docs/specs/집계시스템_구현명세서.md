# ì›¨ë¹„ë‚˜ ì§‘ê³„ ì‹œìŠ¤í…œ êµ¬í˜„ ëª…ì„¸ì„œ

**ì‘ì„±ì¼**: 2026ë…„ 2ì›” 6ì¼  
**ë²„ì „**: 1.0  
**ìƒíƒœ**: êµ¬í˜„ ì™„ë£Œ

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ë°ì´í„° ìˆ˜ì§‘ (Collection)](#2-ë°ì´í„°-ìˆ˜ì§‘-collection)
3. [ë°ì´í„° ì €ì¥ (Storage)](#3-ë°ì´í„°-ì €ì¥-storage)
4. [ë°ì´í„° ì§‘ê³„ (Aggregation)](#4-ë°ì´í„°-ì§‘ê³„-aggregation)
5. [ë°ì´í„° ì •ë¦¬ (Cleanup)](#5-ë°ì´í„°-ì •ë¦¬-cleanup)
6. [API ì—”ë“œí¬ì¸íŠ¸](#6-api-ì—”ë“œí¬ì¸íŠ¸)
7. [ì„±ëŠ¥ ìµœì í™”](#7-ì„±ëŠ¥-ìµœì í™”)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ëª©ì 

ì›¨ë¹„ë‚˜ ì°¸ì—¬ìì˜ ì ‘ì†, ì‹œì²­, ìƒí˜¸ì‘ìš© ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ì§‘ê³„í•˜ì—¬ í†µê³„ ëŒ€ì‹œë³´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### 1.2 ì•„í‚¤í…ì²˜

```
[í´ë¼ì´ì–¸íŠ¸] 
    â†“
[ìˆ˜ì§‘ API] â†’ [ë°ì´í„°ë² ì´ìŠ¤] â†’ [ì§‘ê³„ API] â†’ [í†µê³„ ëŒ€ì‹œë³´ë“œ]
    â†“                              â†‘
[í¬ë¡  ì‘ì—…] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ì£¼ìš” ê¸°ëŠ¥

- âœ… ì„¸ì…˜ ì¶”ì  (ì…ì¥/í‡´ì¥ ì‹œê°„, ì²´ë¥˜ ì‹œê°„)
- âœ… Heartbeat ê¸°ë°˜ ì‹œì²­ì‹œê°„ ì¶”ì 
- âœ… ì‹¤ì‹œê°„ ì ‘ì†ì ìˆ˜ ì§‘ê³„
- âœ… ê°œì¸ë³„ ì‹œì²­ì‹œê°„ í†µê³„
- âœ… ì¬ì…ì¥ í†µê³„
- âœ… ì‹œì²­ì‹œê°„ ë¶„í¬ ë¶„ì„

---

## 2. ë°ì´í„° ìˆ˜ì§‘ (Collection)

### 2.1 ì„¸ì…˜ ì¶”ì 

#### 2.1.1 ì„¸ì…˜ ìƒì„±

**API**: `POST /api/webinars/[webinarId]/access/track`

**í˜¸ì¶œ ì‹œì **:
- ì›¨ë¹„ë‚˜ ì ‘ì† í˜ì´ì§€(`/webinar/[id]`) ì§„ì… ì‹œ
- Live í˜ì´ì§€(`/webinar/[id]/live`) ì§„ì… ì‹œ

**ìš”ì²­ Body**:
```typescript
{
  sessionId?: string  // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•œ ì„¸ì…˜ ID (ì˜µì…˜)
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. í´ë¼ì´ì–¸íŠ¸ì—ì„œ `sessionId` ì „ë‹¬ ë˜ëŠ” ì„œë²„ì—ì„œ ìƒì„±
2. `webinar_user_sessions` í…Œì´ë¸”ì— ì„¸ì…˜ ê¸°ë¡
3. ë¡œê·¸ì¸ ì‚¬ìš©ìëŠ” `webinar_live_presence`ì—ë„ ê¸°ë¡
4. ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ìë™ ë“±ë¡ ì²˜ë¦¬

**ì„¸ì…˜ ID ìƒì„± ê·œì¹™**:
```typescript
sessionId = `session_${Date.now()}_${Math.random().toString(36).substring(7)}`
```

**ì €ì¥ ìœ„ì¹˜**: `localStorage.getItem('webinar_session_${webinarId}')`

#### 2.1.2 ì„¸ì…˜ ì¢…ë£Œ

**API**: `POST /api/webinars/[webinarId]/access/exit`

**í˜¸ì¶œ ì‹œì **:
- í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ (`beforeunload`, `pagehide` ì´ë²¤íŠ¸)
- ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ

**ìš”ì²­ Body**:
```typescript
{
  sessionId: string
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. `exited_at` í•„ë“œ ì—…ë°ì´íŠ¸
2. `duration_seconds` ìë™ ê³„ì‚° (íŠ¸ë¦¬ê±°)

**ì „ì†¡ ë°©ì‹**:
- `navigator.sendBeacon()` ìš°ì„  ì‚¬ìš© (í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œì—ë„ ì „ì†¡ ë³´ì¥)
- ë¯¸ì§€ì› ì‹œ `fetch()` with `keepalive: true`

### 2.2 Heartbeat ê¸°ë°˜ ì‹œì²­ì‹œê°„ ì¶”ì 

#### 2.2.1 Presence Ping

**API**: `POST /api/webinars/[webinarId]/presence/ping`

**í˜¸ì¶œ ì£¼ê¸°**: 120ì´ˆ (2ë¶„) Â± 10ì´ˆ ì§€í„°

**ìš”ì²­ Body** (ì˜µì…˜):
```typescript
{
  session_id?: string  // ì„¸ì…˜ ì¶”ì  í™œì„±í™” ì‹œ
}
```

**ì²˜ë¦¬ ë¡œì§**:
1. ë“±ë¡ í™•ì¸ (ì—†ìœ¼ë©´ ìë™ ë“±ë¡ ì‹œë„)
2. `webinar_presence_ping` RPC í˜¸ì¶œ (presence ì—…ë°ì´íŠ¸)
3. `session_id`ê°€ ìˆìœ¼ë©´ heartbeat ì—…ë°ì´íŠ¸

#### 2.2.2 Heartbeat ì—…ë°ì´íŠ¸

**RPC í•¨ìˆ˜**: `update_session_heartbeat`

**íŒŒë¼ë¯¸í„°**:
```sql
p_webinar_id UUID
p_session_id TEXT
p_now TIMESTAMPTZ
```

**ì²˜ë¦¬ ë¡œì§**:
1. í™œì„± ì„¸ì…˜ ì¡°íšŒ (`exited_at IS NULL`)
2. ë§ˆì§€ë§‰ heartbeatì™€ì˜ ì‹œê°„ ì°¨ì´(Î”t) ê³„ì‚°
3. Î”t Cap ì ìš© (ìµœëŒ€ 360ì´ˆ = 6ë¶„)
4. `watched_seconds_raw` ëˆ„ì 
5. `last_heartbeat_at` ì—…ë°ì´íŠ¸

**Î”t Cap ì •ì±…**:
- ê¸°ë³¸ê°’: 360ì´ˆ (heartbeat ê°„ê²© 120ì´ˆ Ã— 3ë°°)
- ëª©ì : íƒ­ ë°±ê·¸ë¼ìš´ë“œ/ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ ì¸í•œ ê³¼ëŒ€ê³„ìƒ ë°©ì§€

**Throttle ì •ì±…**:
- ìµœì†Œ ê°±ì‹  ê°„ê²©: 60ì´ˆ
- RPC í•¨ìˆ˜: `check_heartbeat_throttle`
- ëª©ì : ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€

---

## 3. ë°ì´í„° ì €ì¥ (Storage)

### 3.1 í…Œì´ë¸” êµ¬ì¡°

#### 3.1.1 `webinar_user_sessions`

**ëª©ì **: ì‚¬ìš©ì ì„¸ì…˜ ì¶”ì  (ì…ì¥/í‡´ì¥, ì‹œì²­ì‹œê°„)

**ìŠ¤í‚¤ë§ˆ**:
```sql
CREATE TABLE webinar_user_sessions (
  id UUID PRIMARY KEY,
  webinar_id UUID NOT NULL,
  user_id UUID,  -- nullable (ê²ŒìŠ¤íŠ¸ ì§€ì›)
  session_id TEXT NOT NULL,
  
  -- ì‹œê°„ ì •ë³´
  entered_at TIMESTAMPTZ NOT NULL,
  exited_at TIMESTAMPTZ,  -- nullì´ë©´ ì•„ì§ ì‹œì²­ ì¤‘
  duration_seconds INTEGER,  -- ìë™ ê³„ì‚°
  last_heartbeat_at TIMESTAMPTZ,  -- ë§ˆì§€ë§‰ heartbeat ì‹œê°„
  watched_seconds_raw INTEGER,  -- heartbeat ê¸°ë°˜ ëˆ„ì  ì‹œì²­ì‹œê°„
  
  -- ë©”íƒ€ë°ì´í„°
  user_agent TEXT,
  referrer TEXT,
  ip_address TEXT,
  
  -- org fields
  agency_id UUID,
  client_id UUID,
  
  created_at TIMESTAMPTZ NOT NULL,
  updated_at TIMESTAMPTZ NOT NULL
);
```

**ì¸ë±ìŠ¤**:
```sql
-- ì›¨ë¹„ë‚˜ë³„ ì‚¬ìš©ì ì¡°íšŒ
idx_wus_webinar_user (webinar_id, user_id)

-- ì›¨ë¹„ë‚˜ë³„ ì…ì¥ ì‹œê°„ ì¡°íšŒ
idx_wus_webinar_entered (webinar_id, entered_at DESC)

-- ì‚¬ìš©ìë³„ ì…ì¥ ì‹œê°„ ì¡°íšŒ
idx_wus_user_entered (user_id, entered_at DESC)

-- ì„¸ì…˜ ID ì¡°íšŒ
idx_wus_session (session_id)

-- í™œì„± ì„¸ì…˜ ì¡°íšŒ (partial index)
idx_wus_active (webinar_id, exited_at) WHERE exited_at IS NULL

-- ì¢…ë£Œëœ ì„¸ì…˜ ì¡°íšŒ (partial index)
idx_wus_webinar_user_closed (webinar_id, user_id, exited_at) 
  WHERE exited_at IS NOT NULL
```

**íŠ¸ë¦¬ê±°**:
- `calculate_duration_trigger`: `exited_at` ì—…ë°ì´íŠ¸ ì‹œ `duration_seconds` ìë™ ê³„ì‚°

#### 3.1.2 `webinar_live_presence`

**ëª©ì **: ì‹¤ì‹œê°„ ì ‘ì†ì ìˆ˜ ì§‘ê³„

**ìŠ¤í‚¤ë§ˆ**:
```sql
CREATE TABLE webinar_live_presence (
  webinar_id UUID NOT NULL,
  user_id UUID NOT NULL,
  joined_at TIMESTAMPTZ NOT NULL,
  last_seen_at TIMESTAMPTZ NOT NULL,
  agency_id UUID,
  client_id UUID,
  PRIMARY KEY (webinar_id, user_id)
);
```

**í™œì„± ê¸°ì¤€**: `last_seen_at >= now() - 3 minutes`

### 3.2 RPC í•¨ìˆ˜

#### 3.2.1 `update_session_heartbeat`

**ëª©ì **: ì„¸ì…˜ heartbeat ì—…ë°ì´íŠ¸ (SELECT ì—†ì´ UPDATE)

**íŒŒë¼ë¯¸í„°**:
```sql
p_webinar_id UUID
p_session_id TEXT
p_now TIMESTAMPTZ
```

**ë°˜í™˜ê°’**:
```json
{
  "success": true,
  "watched_seconds_raw": 120,
  "last_heartbeat_at": "2026-02-06T13:05:25Z"
}
```

**ì²˜ë¦¬ ë¡œì§**:
```sql
UPDATE webinar_user_sessions
SET 
  last_heartbeat_at = p_now,
  watched_seconds_raw = watched_seconds_raw + LEAST(
    EXTRACT(EPOCH FROM (p_now - COALESCE(last_heartbeat_at, entered_at)))::integer,
    360  -- Î”t Cap
  ),
  updated_at = p_now
WHERE webinar_id = p_webinar_id 
  AND session_id = p_session_id 
  AND exited_at IS NULL
RETURNING id, last_heartbeat_at, watched_seconds_raw, entered_at;
```

#### 3.2.2 `check_heartbeat_throttle`

**ëª©ì **: ìµœì†Œ ê°±ì‹  ê°„ê²© ì²´í¬

**íŒŒë¼ë¯¸í„°**:
```sql
p_webinar_id UUID
p_session_id TEXT
p_min_interval_seconds INTEGER DEFAULT 60
```

**ë°˜í™˜ê°’**: `BOOLEAN` (trueë©´ ì—…ë°ì´íŠ¸ ê°€ëŠ¥)

#### 3.2.3 `batch_close_stale_sessions`

**ëª©ì **: ì˜¤ë˜ëœ í™œì„± ì„¸ì…˜ ë°°ì¹˜ ì¢…ë£Œ

**íŒŒë¼ë¯¸í„°**:
```sql
p_stale_timeout TIMESTAMPTZ
```

**ì²˜ë¦¬ ë¡œì§**:
```sql
UPDATE webinar_user_sessions
SET 
  exited_at = COALESCE(last_heartbeat_at, entered_at),
  updated_at = now()
WHERE exited_at IS NULL
  AND (
    (last_heartbeat_at IS NOT NULL AND last_heartbeat_at < p_stale_timeout)
    OR (last_heartbeat_at IS NULL AND entered_at < p_stale_timeout)
  )
RETURNING id;
```

**ë°˜í™˜ê°’**:
```json
{
  "success": true,
  "closed_count": 5
}
```

---

## 4. ë°ì´í„° ì§‘ê³„ (Aggregation)

### 4.1 í†µí•© í†µê³„ API

**API**: `GET /api/webinars/[webinarId]/stats`

**íŒŒë¼ë¯¸í„°**:
- `sections`: ì¡°íšŒí•  ì„¹ì…˜ ëª©ë¡ (ì‰¼í‘œë¡œ êµ¬ë¶„)
  - `chat`: ì±„íŒ… í†µê³„
  - `qa`: Q&A í†µê³„
  - `forms`: í¼/í€´ì¦ˆ í†µê³„
  - `giveaways`: ì¶”ì²¨ í†µê³„
  - `files`: íŒŒì¼ í†µê³„
  - `registrants`: ë“±ë¡ì í†µê³„
  - `access`: ì ‘ì† í†µê³„
  - `survey`: ì„¤ë¬¸ í†µê³„
  - `sessions`: ì„¸ì…˜/ì‹œì²­ì‹œê°„ í†µê³„

**ì‘ë‹µ êµ¬ì¡°**:
```json
{
  "success": true,
  "data": {
    "chat": { ... },
    "qa": { ... },
    "sessions": { ... }
  }
}
```

### 4.2 ì„¸ì…˜ í†µê³„ API

**API**: `GET /api/webinars/[webinarId]/stats/sessions`

**íŒŒë¼ë¯¸í„°**:
- `from`: ì‹œì‘ ì‹œê°„ (ISO 8601)
- `to`: ì¢…ë£Œ ì‹œê°„ (ISO 8601)

**ì‘ë‹µ êµ¬ì¡°**:
```json
{
  "success": true,
  "data": {
    // ì „ì²´ í†µê³„
    "totalSessions": 100,
    "completedSessions": 95,
    "activeSessions": 5,
    "uniqueUsers": 80,
    "totalWatchSeconds": 36000,
    "totalWatchedSecondsRaw": 35000,
    "avgWatchSeconds": 360,
    "avgWatchedSecondsRaw": 350,
    "avgWatchMinutes": 6,
    "avgWatchedMinutesRaw": 5,
    
    // ì¬ì…ì¥ í†µê³„
    "returningUsers": 20,
    "returningRate": 25,
    "avgVisitsPerUser": 1.25,
    
    // ì‹œì²­ì‹œê°„ ë¶„í¬
    "watchTimeDistribution": [
      { "range": "5ë¶„ ë¯¸ë§Œ", "count": 30, "percentage": 30 },
      { "range": "5-10ë¶„", "count": 25, "percentage": 25 },
      ...
    ],
    
    // ì‹œì²­ ì™„ë£Œìœ¨
    "completionRate": 75,
    
    // ì‹œê°„ëŒ€ë³„ ì…ì¥ ë¶„í¬
    "timeline": [
      { "time": "2026-02-06T13:00:00Z", "entryCount": 10 },
      ...
    ],
    
    // ê°œì¸ë³„ í†µê³„ (ìƒìœ„ 20ëª…)
    "topUsers": [
      {
        "userId": "...",
        "displayName": "í™ê¸¸ë™",
        "email": "hong@example.com",
        "visitCount": 3,
        "totalWatchMinutes": 45,
        "totalWatchedMinutesRaw": 42,
        "avgWatchMinutes": 15,
        "avgWatchedMinutesRaw": 14,
        "firstEnteredAt": "2026-02-06T13:00:00Z",
        "lastExitedAt": "2026-02-06T13:45:00Z"
      },
      ...
    ]
  }
}
```

**ì§‘ê³„ ë¡œì§**:

1. **ê°œì¸ë³„ ì‹œì²­ì‹œê°„**:
   ```typescript
   // ëª¨ë“  ì„¸ì…˜ì˜ ì‹œì²­ì‹œê°„ í•©ê³„
   totalWatchedSecondsRaw = sum(watched_seconds_raw)
   ```

2. **ì¬ì…ì¥ í†µê³„**:
   ```typescript
   returningUsers = count(users where visitCount >= 2)
   returningRate = (returningUsers / uniqueUsers) * 100
   ```

3. **ì‹œì²­ ì™„ë£Œìœ¨**:
   ```typescript
   // ì›¨ë¹„ë‚˜ ê¸¸ì´ê°€ ìˆì„ ë•Œë§Œ ê³„ì‚°
   contentDurationSeconds = webinarEndTime - webinarStartTime
   completionRate = min(1, totalWatchedSecondsRaw / contentDurationSeconds) * 100
   ```

### 4.3 ì ‘ì† í†µê³„ API

**API**: `GET /api/webinars/[webinarId]/stats/access`

**ì‘ë‹µ êµ¬ì¡°**:
```json
{
  "success": true,
  "data": {
    "currentParticipantCount": 50,
    "currentParticipantList": [
      {
        "userId": "...",
        "displayName": "í™ê¸¸ë™",
        "email": "hong@example.com",
        "role": "attendee",
        "lastSeenAt": "2026-02-06T13:05:00Z",
        "joinedAt": "2026-02-06T13:00:00Z"
      },
      ...
    ]
  }
}
```

**í™œì„± ê¸°ì¤€**: `last_seen_at >= now() - 3 minutes`

---

## 5. ë°ì´í„° ì •ë¦¬ (Cleanup)

### 5.1 ì„¸ì…˜ Sweeper

**í¬ë¡ **: `GET /api/cron/webinar-session-sweeper`

**ì‹¤í–‰ ì£¼ê¸°**: 10ë¶„ë§ˆë‹¤ (Vercel Cron)

**ì¸ì¦**:
- Vercel Cron ìë™ ì¸ì¦: `Authorization: Bearer ${CRON_SECRET}`
- ìˆ˜ë™ í˜¸ì¶œ: `?secret=${CRON_SECRET}`

**ì²˜ë¦¬ ë¡œì§**:
1. Stale timeout ê³„ì‚°: `now() - 5 minutes`
2. `batch_close_stale_sessions` RPC í˜¸ì¶œ
3. ì¢…ë£Œëœ ì„¸ì…˜ ìˆ˜ ë°˜í™˜

**Stale ê¸°ì¤€**:
- `exited_at IS NULL` (í™œì„± ì„¸ì…˜)
- `last_heartbeat_at < stale_timeout` ë˜ëŠ”
- `last_heartbeat_at IS NULL AND entered_at < stale_timeout`

---

## 6. API ì—”ë“œí¬ì¸íŠ¸

### 6.1 ìˆ˜ì§‘ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ëª©ì  | ì¸ì¦ |
|-----------|--------|------|------|
| `/api/webinars/[webinarId]/access/track` | POST | ì„¸ì…˜ ìƒì„± | ì„ íƒ |
| `/api/webinars/[webinarId]/access/exit` | POST | ì„¸ì…˜ ì¢…ë£Œ | ì„ íƒ |
| `/api/webinars/[webinarId]/presence/ping` | POST | Heartbeat ì—…ë°ì´íŠ¸ | í•„ìˆ˜ |

### 6.2 ì§‘ê³„ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ëª©ì  | ì¸ì¦ |
|-----------|--------|------|------|
| `/api/webinars/[webinarId]/stats` | GET | í†µí•© í†µê³„ | í•„ìˆ˜ |
| `/api/webinars/[webinarId]/stats/sessions` | GET | ì„¸ì…˜ í†µê³„ | í•„ìˆ˜ |
| `/api/webinars/[webinarId]/stats/access` | GET | ì ‘ì† í†µê³„ | í•„ìˆ˜ |

### 6.3 í¬ë¡  API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ëª©ì  | ì¸ì¦ |
|-----------|--------|------|------|
| `/api/cron/webinar-session-sweeper` | GET | ì„¸ì…˜ ì •ë¦¬ | CRON_SECRET |

---

## 7. ì„±ëŠ¥ ìµœì í™”

### 7.1 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

#### 7.1.1 ì¸ë±ìŠ¤ ì „ëµ

- **Partial Index**: í™œì„±/ì¢…ë£Œ ì„¸ì…˜ ë¶„ë¦¬ ì¸ë±ìŠ¤
- **ë³µí•© ì¸ë±ìŠ¤**: ìì£¼ í•¨ê»˜ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ ì¡°í•©
- **ì •ë ¬ ì¸ë±ìŠ¤**: ì‹œê°„ ê¸°ë°˜ ì¡°íšŒ ìµœì í™” (`DESC`)

#### 7.1.2 RPC í•¨ìˆ˜ ìµœì í™”

- **SELECT ì œê±°**: `UPDATE ... RETURNING` ì‚¬ìš©
- **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ ì„¸ì…˜ì„ í•œ ë²ˆì— ì²˜ë¦¬
- **ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸**: Throttleë¡œ ë¶ˆí•„ìš”í•œ ì—…ë°ì´íŠ¸ ë°©ì§€

### 7.2 í´ë¼ì´ì–¸íŠ¸ ìµœì í™”

#### 7.2.1 Heartbeat ì£¼ê¸°

- **ê¸°ë³¸ê°’**: 120ì´ˆ (2ë¶„)
- **ì§€í„°**: Â±10ì´ˆ (ë™ì‹œ í­ì£¼ ë°©ì§€)
- **Throttle**: ì„œë²„ì¸¡ 60ì´ˆ ìµœì†Œ ê°„ê²©

#### 7.2.2 ì„¸ì…˜ ID ê´€ë¦¬

- **localStorage ì €ì¥**: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ìœ ì§€
- **ì¬ì‚¬ìš©**: ê°™ì€ ì„¸ì…˜ IDë¡œ ì¤‘ë³µ ìƒì„± ë°©ì§€

### 7.3 ë¶€í•˜ ì˜ˆì¸¡

**ë™ì‹œ ì ‘ì†ì 500ëª… ê¸°ì¤€**:
- Heartbeat ìš”ì²­: 500ëª… / 120ì´ˆ = **ì•½ 4.2 RPS**
- DB Write: heartbeatë‹¹ 2ê±´ (presence + session) = **ì•½ 8.4 WPS**
- Sweeper í¬ë¡ : 10ë¶„ë§ˆë‹¤ 1íšŒ ì‹¤í–‰

**ë™ì‹œ ì ‘ì†ì 1000ëª… ê¸°ì¤€**:
- Heartbeat ìš”ì²­: **ì•½ 8.3 RPS**
- DB Write: **ì•½ 16.6 WPS**

---

## 8. êµ¬í˜„ í˜„í™©

### 8.1 ì™„ë£Œëœ ê¸°ëŠ¥

- âœ… `webinar_user_sessions` í…Œì´ë¸” ìƒì„±
- âœ… ì„¸ì…˜ ìƒì„±/ì¢…ë£Œ API
- âœ… Heartbeat ê¸°ë°˜ ì‹œì²­ì‹œê°„ ì¶”ì 
- âœ… ì„¸ì…˜ í†µê³„ ì§‘ê³„ API
- âœ… ì„¸ì…˜ Sweeper í¬ë¡ 
- âœ… Throttle ë° Î”t Cap ì ìš©
- âœ… ë°°ì¹˜ ì—…ë°ì´íŠ¸ ìµœì í™”

### 8.2 í–¥í›„ ê°œì„  ì‚¬í•­

- â³ ì›¨ë¹„ë‚˜ ì¢…ë£Œì‹œê°„ í•„ë“œ ì¶”ê°€ (`webinar_scheduled_end_time`, `webinar_actual_end_time`)
- â³ ë³¸í¸ êµ¬ê°„ ë³´ì • (ì¢…ë£Œì‹œê°„ ê¸°ì¤€ ì‹œì²­ì‹œê°„ ê³„ì‚°)
- â³ ëŒ€ìš©ëŸ‰ ì›¨ë¹„ë‚˜ í…ŒìŠ¤íŠ¸ (1000+ ë™ì‹œ ì ‘ì†ì)
- â³ ë°ì´í„° ì •ë¦¬ ì •ì±… (90ì¼ ì´ìƒ ëœ ì„¸ì…˜ ë°ì´í„° ì‚­ì œ)

---

## 9. ì°¸ê³  ë¬¸ì„œ

- [ì›¨ë¹„ë‚˜ ì§‘ê³„ ê²€í†  ê¶Œì¥ì•ˆ](./ì›¨ë¹„ë‚˜ì§‘ê²Œ_ê²€í† _ê¶Œì¥ì•ˆ.md)
- [ì„¸ì…˜ ë¶€í•˜ ë¶„ì„](./session-load-analysis.md)
- [ì›¨ë¹„ë‚˜ í†µê³„ ì§‘ê³„ ìˆ˜ì§‘ ëª…ì„¸ì„œ](./ì›¨ë¹„ë‚˜_í†µê³„_ì§‘ê³„_ìˆ˜ì§‘_ëª…ì„¸ì„œ.md)

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026ë…„ 2ì›” 6ì¼
