EventLive 이메일 제작/발송 대시보드 명세서 v1.0 (uslab.ai 방식 준용)
1. 목적

클라이언트(고객사)가 메일 초안 작성/수정을 직접 할 수 있게 대시보드 제공

운영자는 테스트 발송 → 승인 → 실발송을 통제

멀티테넌시 환경에서 클라이언트별 발송 도메인/Reply-To 요구를 설정 기반으로 처리

“바이브코딩”에서도 꼬이지 않도록 상태/로그/중복방지를 강제

2. 핵심 컨셉 (uslab.ai 뉴스레터 패턴을 EventLive로 일반화)

uslab.ai의 구조(템플릿 DB + 초안 생성 + 편집 + test/send + run 로그 + 상태 전이)를 그대로 가져오되, EventLive는 “뉴스레터”가 아니라 이벤트/웨비나/등록캠페인 단위의 트랜잭션/리마인드 메일로 확장한다. 

뉴스레터_웰컴메일_제작_발송_명세서

3. 사용자/권한 (멀티테넌시 불변)
대상 사용자

Client 멤버: owner/admin/operator(편집/승인/발송)

analyst/viewer: 조회만

권한 원칙

“누가/어느 클라이언트의 캠페인에 대해/어디까지”를 명확히

발송 권한은 최소 owner/admin/operator만

4. 데이터 모델 (최소 스키마)

하드코딩 금지: 발송 도메인/Reply-To/표시명은 “정책 테이블” 또는 “클라이언트 설정”에서 가져오고, 캠페인은 override만 허용

4.1 email_templates (클라이언트별 템플릿)

용도: “리마인드/등록확인/후속안내” 같은 유형별 기본 템플릿 관리

필드(권장)

id

client_id, agency_id

template_key (예: webinar_reminder_d1, webinar_confirmation)

subject_template

body_md_template (마크다운)

footer_md

created_at, updated_at

4.2 email_campaigns (메일 초안/발송 단위)

이게 uslab_newsletters에 해당하는 개념 

뉴스레터_웰컴메일_제작_발송_명세서

필드(권장)

id

client_id, agency_id

scope_type: webinar | registration_campaign | survey_campaign

scope_id: UUID (webinarId 등)

send_type: test_send | send

campaign_type: reminder_d1 | reminder_h1 | confirmation | custom

status: draft | ready | sending | sent | failed | canceled

subject (편집 가능)

preheader (선택)

body_md (편집 가능)

variables_json (템플릿 변수 미리보기용: title, date, url 등)

audience_query_json (대상자 규칙: 등록자 전체/미입장자 등)

scheduled_send_at (선택: 지금은 수동 발송만, 추후 자동화)

approved_at, approved_by

sent_at, sending_started_at

created_at, updated_at

4.3 email_runs (실행 로그)

uslab_newsletter_runs에 해당 

뉴스레터_웰컴메일_제작_발송_명세서

필드

id

email_campaign_id

run_type: generate | test_send | send

status: success | failed

provider: resend | smtp

meta_json (총 발송수/성공/실패, 실패 이메일 리스트 샘플)

error (실패 요약)

created_at

4.4 email_send_logs (수신자 단위 로그: 중복방지 핵심)

필드

id

email_campaign_id

recipient_email

status: queued | sent | failed

provider_message_id

error_message

dedupe_key (유니크)

created_at

dedupe_key 권장

client_id + scope_id + campaign_type + recipient_email

유니크 인덱스로 중복발송 방지

5. 발송 정책 (클라이언트별 요구를 “설정”으로 수용)
ClientEmailPolicy (클라이언트 설정)

send_mode: platform | white_label | customer_smtp

from_domain

from_localpart_default (allowlist: no-reply/notify/reports/security)

from_name_default

reply_to_default

link_base_url_default

WERT 확정값 (이번 요청)

Reply-To: connect@wert.co.kr

From domain: eventflow.kr (단기 운영)

From localpart: notify (리마인드용)

고객이 대시보드에서 “문구 수정”은 가능하되, From/Reply-To는 “정책 값”으로 기본 고정하고, 필요 시 운영자가 override하도록 분리(안전).

6. 화면/UX (대시보드 플로우)

uslab.ai의 /admin/newsletters/new + /admin/newsletters/[id] 패턴을 그대로 가져온다. 

뉴스레터_웰컴메일_제작_발송_명세서

6.1 초안 생성 페이지

경로 예시: /client/[clientId]/emails/new

입력:

대상(scope): 웨비나 선택

유형(campaign_type): reminder_d1 등

발송 예정일(선택)

버튼:

“초안 생성” (template 기반 or AI 기반(추후))

결과: draft 생성 후 상세 편집 페이지로 이동

6.2 상세/편집 페이지

경로 예시: /client/[clientId]/emails/[campaignId]

편집 필드:

subject, preheader, body_md

미리보기:

HTML preview modal(iframe)

액션 버튼(상태에 따라 enable/disable)

저장 (draft/ready)

승인(approve): draft → ready

승인취소: ready → draft

테스트 발송: ready 상태에서만 (수신자 입력)

실발송: ready 상태에서만 (확인 모달 + Dry-run count 표시)

취소: ready 상태에서만

7. API 설계 (Route Handlers)

POST /api/client/emails/generate

템플릿 기반 초안 생성, status=draft 저장, run 로그 남김(run_type=generate)

PUT /api/client/emails/[id]

subject/body 저장

POST /api/client/emails/[id]/approve

draft→ready

POST /api/client/emails/[id]/cancel-approval

ready→draft

POST /api/client/emails/[id]/test-send

지정 이메일로만 발송, 상태 변화 없음, run 로그(run_type=test_send)

POST /api/client/emails/[id]/send

원자적 lock: ready→sending

대상자 조회(audience_query_json 기준)

배치 발송

sent/failed로 종료, run 로그(run_type=send)

(선택) GET /api/client/emails/[id]/audience-preview

Dry-run: 예상 발송 대상 수/샘플 10명

8. 발송 프로세스 (성능/안정성)

uslab.ai처럼 “응답 지연 방지 + 배치 발송 + 로그”를 유지 

뉴스레터_웰컴메일_제작_발송_명세서

8.1 배치 기준

50개씩, 0.5~1초 간격(서버리스 타임아웃 고려)

실패는 개별 로깅, 전체 실패율에 따라 campaign 상태 결정

8.2 실시간 화면 영향 금지

참가자 화면에서 발송/집계 금지(이미 프로젝트 원칙과 일치)

9. WERT 리마인드 적용(이번 건을 이 모듈로 처리)
WERT 캠페인 생성

scope_type=webinar

campaign_type=reminder_d1

Reply-To=connect@wert.co.kr
 (policy)

From=notify@eventflow.kr
 (policy)

운영 플로우

초안 생성(draft)

고객 문구 수정

승인(ready)

테스트 발송(오늘)

실발송(내일)

10. 리스크/가드레일

도메인 인증 안 된 from_domain은 선택 불가(화이트라벨)

From localpart allowlist 강제

dedupe_key 유니크로 중복 방지

“현재 접속 도메인(host)”로 링크/From 결정 금지

send는 반드시 ready에서만, lock 실패 시 중복 실행 방지

11. DoD (완료 기준)

 고객이 대시보드에서 subject/body를 수정할 수 있다

 테스트 발송이 가능하다(ready 상태)

 승인/승인취소가 가능하다

 실발송 시 중복 발송이 발생하지 않는다(dedupe)

 발송 결과가 run/log로 추적된다(성공/실패/카운트)

 WERT 리마인드가 이 플로우로 오늘 테스트 가능

다음 액션(중요)

이걸 “바로” 만들려면, Cursor Agent에게 아래 2가지만 먼저 지시하면 돼:

email_campaigns + email_runs + email_send_logs 최소 스키마부터 추가

WERT용으로 초안 생성(템플릿 기반) + 편집 + 테스트발송 + 실발송 API를 먼저 구현

(나머지 클라이언트/화이트라벨/AI 초안 생성은 Phase 2)

원하면, 너가 준 uslab.ai 명세서 스타일 그대로(상태 전이/페이지 구성/테이블/런 타입) EventLive 버전 문서로 완전한 형태(목차/파일경로/페이지/UI 컴포넌트/SQL 마이그레이션 포함)로 확장해서 “최종 명세서”로 써줄게.