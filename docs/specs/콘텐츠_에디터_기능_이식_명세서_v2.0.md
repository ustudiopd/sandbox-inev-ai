# 콘텐츠 에디터 기능 이식 명세서 v2.0

**버전**: v2.0  
**작성일**: 2025-01-27  
**목적**: Novel.sh 기반 콘텐츠 에디터의 전체 기능을 다른 시스템에서도 활용할 수 있도록 명세  
**기반 라이브러리**: Novel.sh (Tiptap 기반), React, TypeScript

---

## 목차

1. [시스템 개요](#1-시스템-개요)
2. [구현 완료 기능](#2-구현-완료-기능)
3. [아키텍처 구조](#3-아키텍처-구조)
4. [핵심 컴포넌트 명세](#4-핵심-컴포넌트-명세)
5. [확장(Extension) 명세](#5-확장extension-명세)
6. [API 및 유틸리티](#6-api-및-유틸리티)
7. [데이터 모델](#7-데이터-모델)
8. [스타일링 및 테마](#8-스타일링-및-테마)
9. [이식 가이드](#9-이식-가이드)
10. [참고 자료](#10-참고-자료)

---

## 1. 시스템 개요

### 1.1 목적
Notion 스타일의 리치 텍스트 에디터를 제공하여 블로그 포스트, 문서, 콘텐츠 작성을 지원하는 시스템

### 1.2 핵심 특징
- **Notion 스타일 UI**: 슬래시 명령어, Bubble Menu, 드래그 핸들
- **리치 텍스트 편집**: 마크다운 단축 입력, 다양한 블록 타입 지원
- **이미지 관리**: 드래그 앤 드롭, 클립보드 붙여넣기, 리사이즈 기능
- **마크다운 호환**: Import/Export, 실시간 변환
- **자동 저장**: Debounce 기반 자동 저장, localStorage 백업

### 1.3 기술 스택
- **에디터**: Novel.sh (Tiptap 기반)
- **프레임워크**: Next.js 14+ (App Router)
- **언어**: TypeScript
- **스타일**: Tailwind CSS
- **저장소**: Supabase (PostgreSQL + Storage)
- **상태 관리**: React Hooks

---

## 2. 구현 완료 기능

### 2.1 기본 편집 기능 ✅

#### 텍스트 서식
- **Bold** (`**text**` 또는 `Ctrl+B`)
- **Italic** (`*text*` 또는 `Ctrl+I`)
- **Underline** (`Ctrl+U`)
- **Strikethrough** (`~~text~~`)
- **Inline Code** (`` `code` ``)
- **Small** (`Ctrl+Shift+S`)

#### 블록 타입
- **Paragraph** (일반 텍스트)
- **Heading 1** (`# `)
- **Heading 2** (`## `)
- **Heading 3** (`### `)
- **Bullet List** (`- ` 또는 `* `)
- **Ordered List** (`1. `)
- **Task List** (`- [ ]` / `- [x]`)
- **Blockquote** (`> `)
- **Code Block** (```)
- **Horizontal Rule** (`---`)

### 2.2 슬래시 명령어 메뉴 ✅

#### 구현 상태
- `/` 입력 시 블록 타입 선택 메뉴 표시
- 키보드 네비게이션 지원 (↑↓, Enter)
- 검색 기능 (제목, 설명, 검색어 기반)

#### 지원 명령어
| 명령어 | 설명 | 아이콘 |
|--------|------|--------|
| `/text` | 일반 텍스트 | Text |
| `/h1` | 큰 제목 | Heading1 |
| `/h2` | 중간 제목 | Heading2 |
| `/h3` | 작은 제목 | Heading3 |
| `/bullet` | 불릿 리스트 | List |
| `/numbered` | 번호 리스트 | ListOrdered |
| `/todo` | 할 일 리스트 | CheckSquare |
| `/quote` | 인용구 | TextQuote |
| `/code` | 코드 블록 | Code |
| `/youtube` | YouTube 임베드 | Youtube |
| `/section` | 구조화된 섹션 | FileText |
| `/ces` | CES 분석 템플릿 | Layout |

#### 구현 파일
- `components/editor/extensions.tsx`: `suggestionItems`, `slashCommand`

### 2.3 Bubble Menu ✅

#### 구현 상태
- 텍스트 선택 시 자동 표시
- 서식 버튼 제공 (Bold, Italic, Underline, Strike, Code, Small)
- 링크 추가/편집/제거 기능

#### 기능 상세
- **서식 토글**: 각 버튼 클릭 시 서식 적용/해제
- **활성 상태 표시**: 현재 적용된 서식은 배경색으로 표시
- **링크 관리**: 
  - 텍스트 선택 후 링크 추가
  - 링크 선택 시 편집/제거
  - URL 입력 폼 제공

#### 구현 파일
- `components/editor/BubbleMenu.tsx`

### 2.4 이미지 관리 ✅

#### 업로드 방식
1. **드래그 앤 드롭**: 파일을 에디터에 드래그
2. **클립보드 붙여넣기**: `Ctrl+V` 또는 이미지 복사 후 붙여넣기
3. **슬래시 명령어**: `/image` (향후 구현 예정)
4. **URL 붙여넣기**: 이미지 URL 붙여넣기 시 자동 삽입

#### 이미지 리사이즈 ✅
- **선택 기반**: 이미지 클릭 시 리사이즈 핸들 표시
- **드래그 조절**: 우측 하단 핸들을 드래그하여 크기 조절
- **비율 유지**: `Shift` 키 누른 상태에서 드래그 시 원본 비율 유지
- **크기 제한**: 최소 50px, 최대 1200px
- **자동 저장**: 크기 조절 후 노드 속성에 저장

#### 업로드 플로우
```
사용자 액션 (드래그/붙여넣기)
  ↓
파일 검증 (타입, 크기)
  ↓
Supabase Storage 업로드
  ↓
Public URL 반환
  ↓
에디터에 이미지 노드 삽입
  ↓
업로드 중 placeholder 표시
```

#### 구현 파일
- `components/editor/BlogEditor.tsx`: 이미지 업로드 핸들러
- `components/editor/ImageResizePlugin.tsx`: 리사이즈 플러그인
- `components/editor/extensions/ImageResizeExtension.ts`: 리사이즈 Extension
- `app/api/upload/route.ts`: 이미지 업로드 API

### 2.5 마크다운 Import/Export ✅

#### Import 기능
- **파일 업로드**: `.md` 파일 선택하여 Import
- **마크다운 텍스트**: 마크다운 텍스트를 Tiptap JSON으로 변환
- **자동 감지**: 마크다운 형식 자동 인식

#### Export 기능
- **마크다운 복사**: 클립보드에 마크다운 복사
- **파일 다운로드**: `.md` 파일로 다운로드
- **JSON 변환**: Tiptap JSON을 마크다운으로 변환

#### 구현 파일
- `lib/utils/markdown.ts`: 변환 유틸리티

### 2.6 YouTube 임베드 ✅

#### 기능
- **URL 감지**: YouTube URL 붙여넣기 시 자동 임베드
- **슬래시 명령어**: `/youtube` 명령어로 삽입
- **반응형**: 16:9 비율 유지, 반응형 크기 조절

#### 지원 URL 형식
- `https://www.youtube.com/watch?v=VIDEO_ID`
- `https://youtu.be/VIDEO_ID`
- `https://www.youtube.com/embed/VIDEO_ID`

### 2.7 커스텀 블록 타입 ✅

#### StructuredSection (구조화된 섹션)
- **타입**: info, warning, constraint, highlight
- **제목**: 선택적 섹션 제목
- **용도**: 정보, 경고, 제약사항, 하이라이트 표시

#### InfoItem (정보 아이템)
- **아이콘**: 선택적 아이콘 표시
- **제목**: 선택적 제목
- **내용**: 블록 콘텐츠

#### 구현 파일
- `components/editor/extensions/StructuredSection.ts`
- `components/editor/extensions/InfoItem.ts`

### 2.8 자동 링크 변환 ✅

#### 기능
- **URL 감지**: `http://` 또는 `https://`로 시작하는 URL 자동 감지
- **자동 변환**: URL을 자동으로 링크 마크로 변환
- **중복 방지**: 이미 링크인 경우 변환하지 않음

#### 구현 파일
- `components/editor/extensions/AutoLink.ts`

### 2.9 자동 저장 기능 ✅

#### 기능
- **Debounce 기반**: 2초 대기 후 자동 저장
- **localStorage 백업**: 즉시 로컬 백업
- **오프라인 지원**: 오프라인 시 로컬 백업만 수행
- **상태 표시**: 저장 중, 저장됨, 오류, 오프라인 상태 표시
- **복원 기능**: 페이지 로드 시 로컬 백업에서 복원

#### 구현 파일
- `lib/hooks/useAutoSave.ts`

### 2.10 HTML 생성 ✅

#### 기능
- **서버 사이드 렌더링**: Tiptap JSON을 HTML로 변환
- **확장 지원**: 모든 커스텀 확장 포함
- **에러 처리**: 변환 실패 시 Fallback 제공

#### 구현 파일
- `lib/utils/generate-html.ts`

---

## 3. 아키텍처 구조

### 3.1 컴포넌트 계층

```
BlogEditor (메인 컴포넌트)
├── EditorRoot (Novel.sh 루트)
│   └── EditorContent (에디터 컨텐츠)
│       ├── BubbleMenu (텍스트 선택 메뉴)
│       └── EditorCommand (슬래시 명령어 메뉴)
│           └── EditorCommandList
│               └── EditorCommandItem[]
```

### 3.2 확장(Extension) 구조

```
Extensions 배열
├── StarterKit (기본 블록)
├── Markdown (마크다운 변환)
├── UpdatedImage (이미지)
├── Youtube (YouTube 임베드)
├── Link (링크)
├── TaskList/TaskItem (할 일 리스트)
├── HorizontalRule (구분선)
├── CustomKeymap (커스텀 키맵)
├── Small (작은 글씨)
├── AutoLink (자동 링크)
├── StructuredSection (구조화된 섹션)
├── InfoItem (정보 아이템)
├── slashCommand (슬래시 명령어)
└── ImageResizeExtension (이미지 리사이즈)
```

### 3.3 데이터 흐름

```
사용자 입력
  ↓
Tiptap Editor (ProseMirror)
  ↓
onUpdate 콜백
  ↓
JSONContent 변환
  ↓
onChange Prop 전달
  ↓
부모 컴포넌트 상태 업데이트
  ↓
자동 저장 (useAutoSave)
  ↓
서버 저장 (API)
```

---

## 4. 핵심 컴포넌트 명세

### 4.1 BlogEditor

#### Props 인터페이스
```typescript
interface BlogEditorProps {
  initialContent?: JSONContent | null;  // 초기 콘텐츠
  onChange: (content: JSONContent) => void;  // 콘텐츠 변경 콜백
  onSetThumbnail?: (url: string) => void;  // 썸네일 설정 콜백
  editorKey?: string | number;  // 에디터 재생성 키
}
```

#### 주요 기능
1. **에디터 초기화**: `initialContent`로 초기 콘텐츠 설정
2. **콘텐츠 변경 감지**: `onUpdate`에서 JSON 변환 후 `onChange` 호출
3. **썸네일 자동 설정**: 첫 번째 이미지를 썸네일로 설정
4. **이미지 업로드**: Supabase Storage 연동
5. **키보드 단축키**: `handleCommandNavigation` 지원

#### 파일 위치
- `components/editor/BlogEditor.tsx`

---

### 4.2 BubbleMenu

#### 기능
- 텍스트 선택 시 자동 표시
- 서식 버튼 제공
- 링크 추가/편집 UI

#### 구현 상세
```typescript
export function BubbleMenu() {
  const { editor } = useEditor();
  const [showLinkInput, setShowLinkInput] = useState(false);
  // ... 링크 관리 로직
}
```

#### 파일 위치
- `components/editor/BubbleMenu.tsx`

---

### 4.3 Extensions (슬래시 명령어)

#### suggestionItems 구조
```typescript
export const suggestionItems = createSuggestionItems([
  {
    title: 'Text',
    description: 'Just start typing with plain text.',
    searchTerms: ['p', 'paragraph'],
    icon: <Text size={18} />,
    command: ({ editor, range }) => { /* ... */ },
  },
  // ... 더 많은 항목들
]);
```

#### 파일 위치
- `components/editor/extensions.tsx`

---

## 5. 확장(Extension) 명세

### 5.1 기본 확장 (Novel.sh 제공)

#### StarterKit
- Paragraph, Heading, Bold, Italic, Strike, Code, Blockquote, BulletList, OrderedList, ListItem, CodeBlock

#### UpdatedImage
- 이미지 노드 지원
- 업로드 플러그인 통합
- 드래그 앤 드롭 지원

#### TaskList / TaskItem
- 체크박스 리스트 지원
- 마크다운 `- [ ]` / `- [x]` 변환

#### HorizontalRule
- 구분선 (`---`) 지원

#### CustomKeymap
- `Ctrl+Z` / `Ctrl+Y`: Undo/Redo
- 기타 커스텀 단축키

---

### 5.2 커스텀 확장

#### Small (작은 글씨)
```typescript
export const Small = Mark.create({
  name: 'small',
  addCommands() {
    return {
      setSmall: () => ({ commands }) => commands.setMark(this.name),
      toggleSmall: () => ({ commands }) => commands.toggleMark(this.name),
      unsetSmall: () => ({ commands }) => commands.unsetMark(this.name),
    };
  },
  addKeyboardShortcuts() {
    return {
      'Mod-Shift-S': () => this.editor.commands.toggleSmall(),
    };
  },
});
```

**키보드 단축키**: `Ctrl+Shift+S` (Mac: `Cmd+Shift+S`)

**파일 위치**: `components/editor/extensions/Small.ts`

---

#### ImageResizeExtension (이미지 리사이즈)
```typescript
export const ImageResizeExtension = Extension.create({
  name: 'imageResizeExtension',
  addProseMirrorPlugins() {
    return [createImageResizePlugin()];
  },
});
```

**기능**:
- 이미지 선택 시 리사이즈 핸들 표시
- 드래그로 크기 조절 (50px ~ 1200px)
- `Shift` 키로 비율 유지
- 크기 정보를 노드 속성에 저장

**파일 위치**: 
- `components/editor/extensions/ImageResizeExtension.ts`
- `components/editor/ImageResizePlugin.tsx`

---

#### AutoLink (자동 링크 변환)
```typescript
export const AutoLink = Extension.create({
  name: 'autoLink',
  addProseMirrorPlugins() {
    return [
      new Plugin({
        appendTransaction: (transactions, oldState, newState) => {
          // URL 패턴 감지 및 링크 변환
        },
      }),
    ];
  },
});
```

**기능**:
- `http://` 또는 `https://`로 시작하는 URL 자동 감지
- 자동으로 링크 마크 적용
- 이미 링크인 경우 중복 변환 방지

**파일 위치**: `components/editor/extensions/AutoLink.ts`

---

#### StructuredSection (구조화된 섹션)
```typescript
export const StructuredSection = Node.create({
  name: 'structuredSection',
  group: 'block',
  content: 'block+',
  addAttributes() {
    return {
      title: { default: null },
      type: { default: 'info' }, // 'info' | 'warning' | 'constraint' | 'highlight'
    };
  },
});
```

**타입**:
- `info`: 정보 (파란색 테두리)
- `warning`: 경고 (노란색 테두리)
- `constraint`: 제약사항 (회색 테두리)
- `highlight`: 하이라이트 (보라색 테두리)

**슬래시 명령어**: `/section`

**파일 위치**: `components/editor/extensions/StructuredSection.ts`

---

#### InfoItem (정보 아이템)
```typescript
export const InfoItem = Node.create({
  name: 'infoItem',
  group: 'block',
  content: 'block+',
  addAttributes() {
    return {
      icon: { default: null },
      title: { default: null },
    };
  },
});
```

**기능**:
- 아이콘 + 제목 + 내용 구조
- 정보 표시용 블록

**파일 위치**: `components/editor/extensions/InfoItem.ts`

---

## 6. API 및 유틸리티

### 6.1 이미지 업로드 API

#### 엔드포인트
```
POST /api/upload
```

#### 요청
- **Content-Type**: `multipart/form-data`
- **Authorization**: `Bearer {token}` (필수)
- **Body**: `FormData` with `file` field

#### 응답
```json
{
  "url": "https://storage.supabase.co/...",
  "path": "uslab/{timestamp}-{random}.{ext}"
}
```

#### 에러 응답
```json
{
  "error": "에러 메시지"
}
```

#### 파일 위치
- `app/api/upload/route.ts`

---

### 6.2 마크다운 유틸리티

#### 함수 목록

##### markdownToJSON
```typescript
function markdownToJSON(markdown: string): JSONContent
```
마크다운 텍스트를 Tiptap JSON으로 변환

##### jsonToMarkdown
```typescript
function jsonToMarkdown(json: JSONContent): string
```
Tiptap JSON을 마크다운 텍스트로 변환

##### readMarkdownFile
```typescript
async function readMarkdownFile(file: File): Promise<JSONContent>
```
`.md` 파일을 읽어서 Tiptap JSON으로 변환

##### copyMarkdownToClipboard
```typescript
async function copyMarkdownToClipboard(markdown: string): Promise<void>
```
마크다운을 클립보드에 복사

##### downloadMarkdownFile
```typescript
function downloadMarkdownFile(markdown: string, filename?: string): void
```
마크다운을 `.md` 파일로 다운로드

#### 파일 위치
- `lib/utils/markdown.ts`

---

### 6.3 HTML 생성 유틸리티

#### generateContentHTML
```typescript
function generateContentHTML(content: JSONContent): string
```

**기능**:
- Tiptap JSON을 HTML로 변환
- 서버 사이드 렌더링 지원
- 모든 커스텀 확장 포함

**사용 예시**:
```typescript
const html = generateContentHTML(post.content);
// HTML 문자열 반환
```

#### 파일 위치
- `lib/utils/generate-html.ts`

---

### 6.4 자동 저장 훅

#### useAutoSave
```typescript
function useAutoSave({
  docId: string,
  debounceMs?: number,
  onSave?: (content: JSONContent, title?: string) => Promise<void>,
}): {
  saveStatus: 'saved' | 'saving' | 'error' | 'offline',
  lastSaved: Date | null,
  triggerSave: (content: JSONContent, title?: string) => void,
  restoreFromLocal: () => { content: JSONContent | null; title: string | null },
  performSave: (content: JSONContent, title?: string) => Promise<void>,
}
```

**기능**:
- Debounce 기반 자동 저장
- localStorage 백업
- 오프라인 감지 및 처리
- 저장 상태 관리

**사용 예시**:
```typescript
const { saveStatus, triggerSave } = useAutoSave({
  docId: 'doc-123',
  debounceMs: 2000,
  onSave: async (content, title) => {
    await fetch('/api/save', {
      method: 'POST',
      body: JSON.stringify({ content, title }),
    });
  },
});

// 콘텐츠 변경 시
triggerSave(content, title);
```

#### 파일 위치
- `lib/hooks/useAutoSave.ts`

---

## 7. 데이터 모델

### 7.1 JSONContent 타입

#### 기본 구조
```typescript
interface JSONContent {
  type: string;
  attrs?: Record<string, any>;
  content?: JSONContent[];
  marks?: Mark[];
  text?: string;
}
```

#### 주요 노드 타입

##### Paragraph
```json
{
  "type": "paragraph",
  "content": [
    { "type": "text", "text": "텍스트 내용" }
  ]
}
```

##### Heading
```json
{
  "type": "heading",
  "attrs": { "level": 1 },
  "content": [
    { "type": "text", "text": "제목" }
  ]
}
```

##### Image
```json
{
  "type": "image",
  "attrs": {
    "src": "https://...",
    "width": 800,
    "height": 600
  }
}
```

##### Link
```json
{
  "type": "text",
  "text": "링크 텍스트",
  "marks": [
    {
      "type": "link",
      "attrs": { "href": "https://example.com" }
    }
  ]
}
```

##### StructuredSection
```json
{
  "type": "structuredSection",
  "attrs": {
    "title": "섹션 제목",
    "type": "info"
  },
  "content": [
    { "type": "paragraph", "content": [] }
  ]
}
```

##### YouTube
```json
{
  "type": "youtube",
  "attrs": {
    "src": "https://www.youtube.com/embed/VIDEO_ID"
  }
}
```

---

### 7.2 데이터베이스 스키마

#### uslab_posts 테이블
```sql
CREATE TABLE uslab_posts (
  id UUID PRIMARY KEY,
  title TEXT NOT NULL,
  slug TEXT UNIQUE,
  content JSONB NOT NULL,  -- Tiptap JSON 저장
  thumbnail_url TEXT,
  locale TEXT DEFAULT 'ko',
  published_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 저장 형식
- **content**: JSONB 타입으로 Tiptap JSON 저장
- **thumbnail_url**: 첫 번째 이미지 URL (자동 설정)

---

## 8. 스타일링 및 테마

### 8.1 Tailwind CSS 클래스

#### 에디터 컨테이너
```typescript
className="prose max-w-none focus:outline-none min-h-[350px] 
  sm:min-h-[450px] lg:min-h-[500px] 
  prose-sm sm:prose-base 
  [&_img]:max-w-full [&_img]:h-auto [&_img]:max-h-[600px] 
  [&_img]:object-contain 
  prose-slate 
  prose-p:my-6 
  prose-code:text-cyan-600 prose-code:dark:text-cyan-400 
  prose-code:bg-slate-100 prose-code:dark:bg-slate-800 
  prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded 
  prose-code:font-mono prose-code:text-sm 
  prose-pre:bg-slate-50 prose-pre:dark:bg-slate-900 
  prose-pre:border-2 prose-pre:border-slate-200 
  prose-pre:dark:border-slate-800 prose-pre:rounded-lg"
```

### 8.2 커스텀 CSS

#### 이미지 리사이즈 핸들
```css
.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  background-color: #3b82f6;
  border: 2px solid white;
  border-radius: 50%;
  cursor: se-resize;
  z-index: 1000;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: transform 0.1s;
}

.resize-handle:hover {
  transform: scale(1.2);
  background-color: #2563eb;
}
```

#### 구조화된 섹션
```css
.structured-section {
  @apply bg-slate-50 dark:bg-slate-900 rounded-lg p-6 my-6 
    border border-slate-200 dark:border-slate-700;
}

.structured-section[data-section-type="info"] {
  @apply bg-white dark:bg-slate-900 border-blue-200/70 dark:border-blue-800/70;
}

.structured-section[data-section-type="warning"] {
  @apply bg-amber-50/70 dark:bg-amber-900/15 border-amber-200/70 dark:border-amber-800/70;
}
```

---

## 9. 이식 가이드

### 9.1 필수 패키지 설치

```json
{
  "dependencies": {
    "novel": "^1.0.2",
    "@tiptap/react": "^2.x.x",
    "@tiptap/starter-kit": "^2.x.x",
    "@tiptap/markdown": "^2.x.x",
    "@tiptap/extension-image": "^2.x.x",
    "@tiptap/extension-link": "^2.x.x",
    "@tiptap/extension-youtube": "^2.x.x",
    "@tiptap/extension-task-list": "^2.x.x",
    "@tiptap/extension-task-item": "^2.x.x",
    "@tiptap/extension-horizontal-rule": "^2.x.x",
    "@tiptap/html": "^2.x.x",
    "lucide-react": "^0.x.x"
  }
}
```

### 9.2 파일 구조

```
components/
  editor/
    BlogEditor.tsx          # 메인 에디터 컴포넌트
    BubbleMenu.tsx          # 텍스트 선택 메뉴
    extensions.tsx          # 슬래시 명령어 정의
    ImageResizePlugin.tsx   # 이미지 리사이즈 플러그인
    extensions/
      Small.ts              # 작은 글씨 확장
      ImageResizeExtension.ts  # 이미지 리사이즈 Extension
      AutoLink.ts           # 자동 링크 확장
      StructuredSection.ts  # 구조화된 섹션 확장
      InfoItem.ts           # 정보 아이템 확장

lib/
  utils/
    markdown.ts             # 마크다운 변환 유틸리티
    generate-html.ts        # HTML 생성 유틸리티
  hooks/
    useAutoSave.ts          # 자동 저장 훅

app/
  api/
    upload/
      route.ts              # 이미지 업로드 API
```

### 9.3 기본 사용법

#### 1. 에디터 컴포넌트 사용
```typescript
import BlogEditor from '@/components/editor/BlogEditor';
import type { JSONContent } from 'novel';

function MyPage() {
  const [content, setContent] = useState<JSONContent | null>(null);

  return (
    <BlogEditor
      initialContent={content}
      onChange={(newContent) => setContent(newContent)}
      onSetThumbnail={(url) => console.log('Thumbnail:', url)}
    />
  );
}
```

#### 2. 자동 저장 연동
```typescript
import { useAutoSave } from '@/lib/hooks/useAutoSave';

const { saveStatus, triggerSave } = useAutoSave({
  docId: 'my-doc-id',
  debounceMs: 2000,
  onSave: async (content, title) => {
    await saveToServer(content, title);
  },
});

// 콘텐츠 변경 시
<BlogEditor
  onChange={(content) => triggerSave(content, title)}
/>
```

#### 3. 마크다운 Import/Export
```typescript
import { 
  readMarkdownFile, 
  jsonToMarkdown, 
  copyMarkdownToClipboard,
  downloadMarkdownFile 
} from '@/lib/utils/markdown';

// Import
const handleFileUpload = async (file: File) => {
  const json = await readMarkdownFile(file);
  setContent(json);
};

// Export
const handleExport = () => {
  const markdown = jsonToMarkdown(content);
  copyMarkdownToClipboard(markdown); // 또는
  downloadMarkdownFile(markdown, 'post.md');
};
```

#### 4. HTML 렌더링
```typescript
import { generateContentHTML } from '@/lib/utils/generate-html';

const html = generateContentHTML(post.content);
<div dangerouslySetInnerHTML={{ __html: html }} />
```

### 9.4 Supabase Storage 설정

#### 버킷 생성
1. Supabase Dashboard → Storage
2. 버킷 생성: `uslab-images`
3. Public 버킷으로 설정 (또는 RLS 정책 설정)

#### RLS 정책 (Public 버킷인 경우 불필요)
```sql
-- 업로드 허용 (인증된 사용자만)
CREATE POLICY "Allow authenticated uploads"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'uslab-images');

-- 읽기 허용 (모든 사용자)
CREATE POLICY "Allow public reads"
ON storage.objects FOR SELECT
TO public
USING (bucket_id = 'uslab-images');
```

### 9.5 환경 변수 설정

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx  # 이미지 업로드 API용
```

---

## 10. 참고 자료

### 10.1 공식 문서
- [Novel.sh 공식 문서](https://novel.sh/docs)
- [Novel.sh GitHub](https://github.com/steven-tey/novel)
- [Tiptap 문서](https://tiptap.dev/docs)
- [ProseMirror 문서](https://prosemirror.net/docs/)

### 10.2 주요 파일 위치

#### 컴포넌트
- `components/editor/BlogEditor.tsx`: 메인 에디터 컴포넌트
- `components/editor/BubbleMenu.tsx`: 텍스트 선택 메뉴
- `components/editor/extensions.tsx`: 슬래시 명령어 정의

#### 확장
- `components/editor/extensions/Small.ts`
- `components/editor/extensions/ImageResizeExtension.ts`
- `components/editor/extensions/AutoLink.ts`
- `components/editor/extensions/StructuredSection.ts`
- `components/editor/extensions/InfoItem.ts`

#### 플러그인
- `components/editor/ImageResizePlugin.tsx`

#### 유틸리티
- `lib/utils/markdown.ts`: 마크다운 변환
- `lib/utils/generate-html.ts`: HTML 생성
- `lib/hooks/useAutoSave.ts`: 자동 저장 훅

#### API
- `app/api/upload/route.ts`: 이미지 업로드

---

## 부록: 기능 체크리스트

### 기본 편집 기능 ✅
- [x] 텍스트 서식 (Bold, Italic, Underline, Strike, Code, Small)
- [x] 블록 타입 (Paragraph, Heading, List, Quote, Code Block, HR)
- [x] 할 일 리스트 (TaskList/TaskItem)
- [x] 마크다운 단축 입력

### 고급 기능 ✅
- [x] 슬래시 명령어 메뉴 (`/`)
- [x] Bubble Menu (텍스트 선택 메뉴)
- [x] 이미지 업로드 (드래그 앤 드롭, 붙여넣기)
- [x] 이미지 리사이즈 (드래그 핸들)
- [x] YouTube 임베드
- [x] 링크 추가/편집
- [x] 자동 링크 변환

### 커스텀 블록 ✅
- [x] StructuredSection (구조화된 섹션)
- [x] InfoItem (정보 아이템)
- [x] CES 분석 템플릿

### Import/Export ✅
- [x] 마크다운 Import (파일 업로드)
- [x] 마크다운 Export (복사/다운로드)
- [x] HTML 생성 (서버 사이드 렌더링)

### 자동 저장 ✅
- [x] Debounce 기반 자동 저장
- [x] localStorage 백업
- [x] 오프라인 지원
- [x] 저장 상태 표시

---

## 부록: 키보드 단축키

| 단축키 | 기능 |
|--------|------|
| `Ctrl+B` / `Cmd+B` | Bold |
| `Ctrl+I` / `Cmd+I` | Italic |
| `Ctrl+U` / `Cmd+U` | Underline |
| `Ctrl+Shift+S` / `Cmd+Shift+S` | Small |
| `Ctrl+Z` / `Cmd+Z` | Undo |
| `Ctrl+Y` / `Cmd+Y` | Redo |
| `Ctrl+V` / `Cmd+V` | 붙여넣기 (이미지 자동 업로드) |
| `/` | 슬래시 명령어 메뉴 |
| `Shift` + 드래그 | 이미지 비율 유지 리사이즈 |

---

## 부록: 알려진 제한사항

### 현재 미구현 기능
1. **드래그 핸들 (블록 이동)**: Novel.sh의 DragHandle 확장 미사용
2. **텍스트 색상/하이라이트**: Color, Highlight 확장 미구현
3. **테이블**: Table 확장 미구현
4. **AI 명령어**: `/ai` 명령어 미구현

### 향후 개선 사항
1. **이미지 캡션**: Figure/Figcaption 지원
2. **이미지 갤러리**: 여러 이미지 그리드 레이아웃
3. **코드 하이라이팅**: 언어별 문법 강조
4. **수식 입력**: LaTeX 수식 지원

---

**문서 버전**: v2.0  
**최종 업데이트**: 2025-01-27  
**작성자**: AI Assistant  
**검토 필요**: 성능 최적화, 접근성, 모바일 지원
