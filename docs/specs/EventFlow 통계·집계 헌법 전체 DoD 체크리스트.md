좋아, 그럼 **지금 시점에서 “끝났는지 / 아직인지”를 누구나 동일하게 판단할 수 있는
📜 *EventFlow 통계·집계 헌법 전체 DoD 체크리스트***를 정리해줄게.

이 체크리스트는 **의견이나 감각이 아니라 “예/아니오”로 판정**하게 설계했어.
→ 이걸로 보면 *지금 상태가 어디까지 왔는지* 바로 보일 거야.

---

# 📜 EventFlow 통계·집계 헌법 전체 DoD 체크리스트 (v1)

> 기준:
>
> * Serverless / B2B2C / 라이브 안정성
> * Phase2 구현 완료 보고서
> * 통계 명세 v2
> * 최근 Visit 장애(cID) 사고 반영

---

## 0️⃣ 메타 판정 규칙 (중요)

* **아래 DoD는 “모두 YES”일 때만 `완료`**
* 하나라도 ❌면 → **“부분 완료 / 운영 리스크 있음”**
* “임시”, “나중에”, “운영자가 주의”는 ❌로 간주

---

## 1️⃣ Fact 수집 계층 DoD (집계의 전제조건)

### 1-1. 핵심 경로 Visit 커버리지

| 항목                                                        | 판정 |
| --------------------------------------------------------- | -- |
| `/event/{path}` (Welcome/Landing) 진입 시 Visit가 **항상** 기록된다 | ⬜  |
| `/webinar/{id}` (정보 페이지) Visit가 기록된다                      | ⬜  |
| `/webinar/{id}/live` (라이브 시청) Visit가 기록된다                 | ⬜  |
| 등록/라이브 UX는 Visit 실패와 **완전히 분리**되어 있다 (non-blocking)       | ⬜  |

**DoD 기준**
→ 위 4개가 모두 YES여야 함
→ 하나라도 누락 시: **집계 숫자는 구조적으로 왜곡**

---

### 1-2. Dimension(차원) 의존성 방어 (이번 cID 사고 핵심)

| 항목                                   | 판정 |
| ------------------------------------ | -- |
| CID/링크/UTM 메타가 없어도 Visit Fact는 저장된다  | ⬜  |
| 차원 부재 시 `unknown / unresolved`로 흡수된다 | ⬜  |
| 차원 테이블 누락으로 Visit가 0이 되는 구조가 아니다     | ⬜  |
| Fact 저장 실패가 UX/등록 흐름으로 전파되지 않는다      | ⬜  |

**DoD 기준**
→ “차원이 없어서 Fact가 깨질 수 있는가?”에 대해 **완전히 NO**

---

### 1-3. 장애 가시성 (조용히 망가지지 않기)

| 항목                                   | 판정 |
| ------------------------------------ | -- |
| Visit 실패 시 **구조화 로그(JSON)** 가 남는다    | ⬜  |
| 성공 로그는 운영 환경에서 폭주하지 않는다              | ⬜  |
| “오늘 Visit 0” 같은 상태를 **로그로 사후 추적 가능** | ⬜  |

---

## 2️⃣ 데이터 품질 DoD (집계 신뢰도)

### 2-1. session_id 연결 규칙

| 항목                                     | 판정 |
| -------------------------------------- | -- |
| 모든 Visit에 session_id가 저장된다             | ⬜  |
| 모든 등록(entry)에 session_id가 저장된다         | ⬜  |
| session_id는 서버 기준으로 보강된다 (쿠키 fallback) | ⬜  |
| Visit ↔ Entry 연결률을 계산할 수 있다            | ⬜  |

**DoD 기준**
→ “등록은 있는데 Visit이 연결 안 되는 상태”가 구조적으로 불가능

---

### 2-2. UTM / 유입 정보 보존

| 항목                          | 판정 |
| --------------------------- | -- |
| first-touch UTM 규칙이 정의되어 있다 | ⬜  |
| last-touch UTM 규칙이 정의되어 있다  | ⬜  |
| 리다이렉트/CSR에서도 UTM이 유실되지 않는다  | ⬜  |
| UTM 누락 비율을 지표로 확인할 수 있다     | ⬜  |

---

## 3️⃣ Aggregation Engine DoD (집계 시스템 핵심)

### 3-1. 집계 실행 위치

| 항목                            | 판정 |
| ----------------------------- | -- |
| 참가자/라이브 페이지에서 집계 쿼리를 실행하지 않는다 | ⬜  |
| 집계는 cron/백그라운드에서만 수행된다        | ⬜  |
| 집계 job은 **멱등(idempotent)** 이다 | ⬜  |
| 동일 기간 재실행(backfill)이 가능하다     | ⬜  |

---

### 3-2. 집계 구조

| 항목                                  | 판정 |
| ----------------------------------- | -- |
| 웨비나 접속 통계는 v2 패턴(핑 + 크론 + 버킷)을 따른다  | ⬜  |
| 마케팅/캠페인 통계도 동일한 패턴을 따른다             | ⬜  |
| raw vs aggregate 값이 샘플 기간에서 일치한다    | ⬜  |
| aggregate가 없을 경우 raw fallback이 동작한다 | ⬜  |

---

### 3-3. Materialized View 사용 판단

| 항목                            | 판정 |
| ----------------------------- | -- |
| MV 사용 여부가 “선택 기준 문서”로 고정되어 있다 | ⬜  |
| refresh 실패/지연이 운영에서 감지 가능하다   | ⬜  |
| staleness(지연 허용 범위)가 합의되어 있다  | ⬜  |
| 기본값은 증분 집계 테이블이다              | ⬜  |

---

## 4️⃣ Admin / Overview API DoD (Phase2 영역)

### 4-1. API 구조

| 항목                                             | 판정 |
| ---------------------------------------------- | -- |
| 통합 Overview API가 존재한다                          | ⬜  |
| aggregate 우선 + raw fallback 구조다                | ⬜  |
| 부분 실패 시에도 전체 응답이 깨지지 않는다                       | ⬜  |
| response에 메타데이터(response_time, source 등)가 포함된다 | ⬜  |

👉 **Phase2 보고서 기준: 대부분 YES**

---

### 4-2. 성능/운영

| 항목                                    | 판정 |
| ------------------------------------- | -- |
| 기본 기간(7/30일) 조회가 목표 응답시간 내다           | ⬜  |
| aggregate 미존재 시 fallback 빈도를 파악할 수 있다 | ⬜  |
| 대시보드 조회가 raw full-scan에 의존하지 않는다      | ⬜  |

---

## 5️⃣ 운영 안정성 DoD (완료 선언의 핵심)

| 항목                                     | 판정 |
| -------------------------------------- | -- |
| “오늘 Visit 0” 상태를 **자동 또는 즉시 인지**할 수 있다 | ⬜  |
| 집계 실패/지연을 알 수 있는 로그 또는 알림이 있다          | ⬜  |
| 특정 날짜/캠페인 재집계(backfill) 절차가 문서화돼 있다    | ⬜  |
| 운영자가 “숫자가 이상할 때” 확인할 진단 루트가 있다         | ⬜  |

---

# 🧮 최종 판정 가이드

### ✅ **전체 헌법 구현 완료**

* 모든 항목 ⬜ → ☑️ YES

### ⚠️ **Phase2 완료 / 시스템 전체 미완**

* 4️⃣은 대부분 YES
* 1️⃣ / 2️⃣ / 3️⃣ 중 하나라도 ❌

### ❌ **운영 리스크 상태**

* 1️⃣ Fact 수집 또는 2️⃣ 데이터 품질에서 ❌ 존재

---

## 📌 지금 상태를 솔직히 대입하면 (내 판단)

* **Phase2(Overview/API)** → ✅ 거의 완료
* **Fact 커버리지 + session/UTM 품질** → ❌ 일부 미완
* **Aggregation Engine 전면 안정화** → ⚠️ 부분 완료

➡️ **결론**

> “아키텍처는 완성됐고,
> 구현은 Phase2까지 끝났지만,
> **운영 기준으로 ‘완료 선언’은 아직이다.**”

---

원하면 다음으로:

* 이 체크리스트를 기준으로 **지금 코드/DB 기준에 ☑️/❌ 실제 체크해주는 리뷰**
* 또는 **‘완료 선언까지 남은 최소 작업 5개’만 뽑아서 P0/P1로 정리**

어느 쪽으로 갈지 말해줘.
