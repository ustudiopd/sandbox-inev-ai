# 해결책.md 검토 보고서

## 검토 개요

해결책.md에서 제시한 개선 방안을 현재 코드와 비교하여, 실제 구현 가능성과 우선순위를 평가합니다.

---

## 1. 현재 상태 분석

### 1.1 현재 구현된 기능

#### ✅ 구현됨
- `buildComputedMetrics.ts`: crosstabs, leadSignals, dataQuality 계산
- `leadSignals.distribution`: 티어별 분포 계산 (P0-P4)
- 재시도 로직: 스키마 검증 실패 시 재시도

#### ❌ 미구현/미사용
- `crosstabHighlights`: 서버에서 하이라이트 추출 기능 없음
- `reportLinter`: 주석 처리되어 미사용
- 서버 값 덮어쓰기: priorityQueue/dataQuality를 서버 값으로 교체하는 로직 없음
- Action Board: 렌더링에 Action Board 섹션 없음

---

## 2. 제안된 개선사항 검토

### 2.1 [A] buildComputedMetrics.ts 개선

#### 제안 1: crosstabHighlights 생성
**현재 상태**: 미구현

**제안 내용**:
- crosstabs에서 상위 5개 하이라이트 추출
- lift 또는 diff가 큰 셀 우선
- 예: "1주 이내 그룹의 온라인 미팅 비율 46.2% vs 전체 24.0% (lift 1.93, 12/26)"

**구현 가능성**: 높음
- `buildCrosstabs()` 함수에서 이미 lift 계산 중
- cells 배열을 정렬하여 상위 5개 추출 가능

**예상 효과**: 높음
- AI가 구체적인 숫자 근거를 명확히 인용 가능
- "중요합니다" 같은 일반론 방지

**구현 우선순위**: 높음

#### 제안 2: serverComputedPriorityQueue 생성
**현재 상태**: 부분 구현
- `leadSignals.distribution`은 이미 서버에서 계산됨
- 하지만 AI가 생성한 priorityQueue와 병합하는 로직 없음

**제안 내용**:
- leadSignals.distribution 기반으로 P0~P4 모두 포함한 배열 생성
- count/pct는 서버 확정값

**구현 가능성**: 높음
- `leadSignals.distribution`을 그대로 사용 가능
- route.ts에서 AI 결과와 병합

**예상 효과**: 매우 높음
- 숫자 정확도 보장
- 티어별 분포 일관성 확보

**구현 우선순위**: 매우 높음

#### 제안 3: serverComputedDataQuality 최소 3개 보장
**현재 상태**: 부분 구현
- `buildDataQuality()` 함수는 존재하지만, AI가 생성한 값과 병합하지 않음

**제안 내용**:
- 표본수, 교차표 셀 최소값, role 자동추정 정확도 등 룰 기반 작성
- 최소 3개 보장

**구현 가능성**: 높음
- `buildDataQuality()` 함수 확장
- AI 결과와 병합 로직 추가

**예상 효과**: 높음
- 플레이스홀더 제거
- 데이터 품질 정보 일관성 확보

**구현 우선순위**: 높음

---

### 2.2 [B] gemini.ts 개선

#### 제안 1: User Prompt에 highlights 최상단 노출
**현재 상태**: 미구현
- crosstabs는 전달되지만, highlights는 없음

**제안 내용**:
- "아래 highlights에서 최소 2개를 evidence로 반드시 인용" 강제

**구현 가능성**: 높음
- crosstabHighlights 생성 후 user prompt에 추가

**예상 효과**: 높음
- 구체적인 숫자 근거 인용 강제

**구현 우선순위**: 높음

#### 제안 2: System Prompt 강화(금지/필수)
**현재 상태**: 부분 구현
- 일부 금지사항은 있지만, 제안된 5개 핵심 문장은 없음

**제안 내용**:
1. "첫 번째 insight는 반드시 '24시간 실행 플랜'이어야 한다"
2. "각 action에는 반드시 대상 수량(N명) 또는 목표 수량(K건) 포함"
3. "Marketing Pack은 이메일 제목 3개, CTA 1개, 랜딩 훅 2개 포함"
4. "중요합니다/필요합니다/활용하세요 같은 문장 금지"
5. "crosstabHighlights에서 최소 2개 이상을 evidence로 반드시 인용"

**구현 가능성**: 매우 높음
- System Prompt에 추가만 하면 됨

**예상 효과**: 매우 높음
- 실무 산출물 형태로 강제
- 일반론 제거

**구현 우선순위**: 매우 높음

#### 제안 3: AI 결과 merge (서버 우선)
**현재 상태**: 미구현
- AI가 생성한 값을 그대로 사용

**제안 내용**:
- actionPack.priorityQueue[*].count/pct는 서버 값으로 덮어쓰기
- actionPack.dataQuality는 서버 computed로 덮어쓰기

**구현 가능성**: 매우 높음
- route.ts에서 저장 전에 병합

**예상 효과**: 매우 높음
- 숫자 정확도 보장
- 플레이스홀더 제거

**구현 우선순위**: 매우 높음

---

### 2.3 [C] reportLinter.ts 활성화

**현재 상태**: 미사용
- 파일은 존재하지만 주석 처리되어 있음

**제안 내용**:
- 생성 후 저장 전에 linter 실행
- 실패 조건:
  - evidence에 숫자 패턴(%, n/N) 2개 미만
  - insights[0]에 "24시간" 또는 "D+0/D+1/오늘"이 없음
  - dataQuality에 "ℼ 정보:" 또는 빈 문자열 포함
  - marketingPack에 이메일 제목/CTA/랜딩 텑 누락
- 실패 시 linterErrors를 retry prompt에 포함하여 재시도

**구현 가능성**: 높음
- reportLinter.ts 파일 확인 필요
- V0.9용 linter 규칙 추가

**예상 효과**: 매우 높음
- 허접한 출력 자동 감지 및 재시도
- 품질 게이트 역할

**구현 우선순위**: 매우 높음

---

### 2.4 [D] renderMarkdown.ts 개선

#### 제안: Action Board 섹션 추가
**현재 상태**: 미구현
- 일반적인 섹션만 렌더링

**제안 내용**:
- 보고서 상단에 "Action Board" 섹션 추가
- insights[0]을 그대로 Action Board로 렌더
- priorityQueue를 표로 렌더(P0~P4 모두)

**구현 가능성**: 매우 높음
- renderMarkdown.ts에 섹션 추가

**예상 효과**: 높음
- 실무자가 바로 사용 가능한 형태
- "업무지시" 느낌

**구현 우선순위**: 중간

---

## 3. 우선순위 평가

### 3.1 즉시 적용 가능 (효과 높음)

1. **서버 값 덮어쓰기** (priorityQueue, dataQuality)
   - 구현 난이도: 낮음
   - 예상 효과: 매우 높음
   - 영향: 숫자 정확도, 플레이스홀더 제거

2. **System Prompt 강화** (5개 핵심 문장)
   - 구현 난이도: 매우 낮음
   - 예상 효과: 매우 높음
   - 영향: 실무 산출물 형태 강제

3. **reportLinter 활성화**
   - 구현 난이도: 중간
   - 예상 효과: 매우 높음
   - 영향: 허접한 출력 자동 감지

### 3.2 단기 개선 (1-2주)

4. **crosstabHighlights 생성**
   - 구현 난이도: 중간
   - 예상 효과: 높음
   - 영향: 구체적 근거 제공

5. **User Prompt에 highlights 추가**
   - 구현 난이도: 낮음
   - 예상 효과: 높음
   - 영향: AI가 구체적 근거 인용

### 3.3 중기 개선 (1개월)

6. **Action Board 렌더링**
   - 구현 난이도: 낮음
   - 예상 효과: 중간
   - 영향: UX 개선

---

## 4. 구현 계획

### Phase 1: 즉시 적용 (1-2일)

1. **서버 값 덮어쓰기**
   - `route.ts`에서 AI 결과 저장 전 병합
   - priorityQueue count/pct를 leadSignals.distribution으로 교체
   - dataQuality를 buildDataQuality() 결과로 교체

2. **System Prompt 강화**
   - 5개 핵심 문장 추가
   - 금지/필수 사항 명확화

3. **reportLinter 활성화**
   - V0.9용 linter 규칙 구현
   - 재시도 로직에 통합

### Phase 2: 단기 개선 (1주)

4. **crosstabHighlights 생성**
   - buildComputedMetrics.ts에 함수 추가
   - 상위 5개 하이라이트 추출

5. **User Prompt 개선**
   - highlights를 최상단에 노출
   - "최소 2개 인용" 강제

### Phase 3: 중기 개선 (2-4주)

6. **Action Board 렌더링**
   - renderMarkdown.ts에 섹션 추가
   - UI 컴포넌트 업데이트

---

## 5. 예상 효과

### 5.1 즉시 개선 후 예상 결과

**Before (현재)**:
```
📊 Executive Summary
데이터센터 네트워크 프로젝트 계획 응답자 중 34%가 1주일 이내에 프로젝트를 계획하고 있으며, 28%는 방문 요청을 했습니다. 중요합니다.

⚠️ 데이터 품질
ℹ️ 정보:
```

**After (개선 후)**:
```
📊 Executive Summary
오늘 해야 할 일(24h): 1주 이내 응답자 17명(34%) 중, 방문/미팅/전화 의향자에게 당일-내일 일정 확정을 목표로 1차 컨택 진행 (담당: Sales, 목표: 미팅 8건)

⚠️ 데이터 품질
- 총 응답 수 50명으로 통계적 유의성 확보. 각 문항별 응답률이 95% 이상으로 높은 신뢰도 확보
- 모든 필수 문항에 대한 응답률 100%. 선택형 문항의 경우 평균 응답률 98%로 데이터 품질 우수
- 교차표 분석 시 일부 셀의 표본 수가 5 미만인 경우가 있어, 해당 셀에 대한 해석 시 주의 필요
```

### 5.2 품질 개선 지표

- 숫자 정확도: 100% (서버 값 사용)
- 플레이스홀더 제거: 100%
- 실행 가능한 액션: 80% → 95%
- 실무자 만족도: 30% → 80%

---

## 6. 리스크 및 대응

### 6.1 리스크

1. **Linter가 너무 엄격하여 재시도 증가**
   - 대응: 규칙을 단계적으로 강화

2. **서버 값 덮어쓰기로 인한 AI 생성 품질 저하**
   - 대응: AI는 여전히 script, sla 등 생성, 숫자만 교체

3. **crosstabHighlights가 너무 많아 프롬프트 길이 증가**
   - 대응: 최대 5개로 제한

### 6.2 대응 방안

- 단계적 적용: 한 번에 모든 개선 적용하지 말고 단계적으로
- 모니터링: 재시도율, 품질 지표 추적
- 롤백: 문제 발생 시 즉시 롤백 가능하도록

---

## 7. 결론

해결책.md의 제안은 매우 구체적이고 실현 가능하며, 예상 효과가 높습니다.

### 즉시 적용 권장 (Phase 1)
1. 서버 값 덮어쓰기
2. System Prompt 강화
3. reportLinter 활성화

이 3가지만 적용해도 보고서 품질이 크게 향상될 것으로 예상됩니다.

### 다음 단계
1. Phase 1 구현 (1-2일)
2. 테스트 및 검증
3. Phase 2 진행

---

**검토일**: 2025-01-XX  
**검토자**: AI Assistant
