# ì„¤ë¬¸/í€´ì¦ˆ/ì¶”ì²¨ ì‹œìŠ¤í…œ ì•ˆì •ì„± ê²€í†  ë³´ê³ ì„œ v2 (ì‹¤í–‰ ê°€ëŠ¥ ë²„ì „)

**ì‘ì„±ì¼**: 2026-02-08  
**ìˆ˜ì •ì¼**: 2026-02-08 (ê¸°ìˆ  ê²€í†  ë°˜ì˜)  
**ê²€í†  ê¸°ì¤€**: ë¼ì´ë¸Œ ì•ˆì •ì„±/ì •í•©ì„±/ê³µì •ì„±/í™•ì¥ì„±  
**ìš°ì„ ìˆœìœ„**: P0 (í•„ìˆ˜ ìˆ˜ì •) / P1 (ê¶Œì¥ ê°œì„ ) / P2 (ì„ íƒ ê°œì„ )

---

## ğŸ“‹ ì‹¤í–‰ ìš”ì•½

ì „ì²´ ì„¤ê³„ ë°©í–¥ì€ **ìš´ì˜ ê°€ëŠ¥í•œ ìˆ˜ì¤€**ì´ë©°, íŠ¹íˆ ì„¤ë¬¸/í€´ì¦ˆ í†µí•© êµ¬ì¡°ì™€ commit-reveal ì¶”ì²¨ ë°©ì‹ì€ ê³µê³µ/ê¸°ì—… í–‰ì‚¬ ìš´ì˜ì— ì í•©í•©ë‹ˆë‹¤. ë‹¤ë§Œ **P0ê¸‰ ì´ìŠˆ 2ê±´**ì´ ë°œê²¬ë˜ì–´ ì¦‰ì‹œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

**âš ï¸ ìš°ì„ ìˆœìœ„ ì¡°ì •**: ì„¤ë¬¸ 1íšŒ ì œì¶œ ì œí•œì€ í˜„ì¬ ë¬¸ì œê°€ ì—†ìœ¼ë¯€ë¡œ P1(ì„ íƒì )ë¡œ ì¡°ì •. ì‹¤ì œ ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ ìˆ˜ì •.

**âš ï¸ ì¤‘ìš” ë³€ê²½ì‚¬í•­ (v2)**:
- ì„¤ë¬¸ UNIQUE ì¸ë±ìŠ¤: ì„œë¸Œì¿¼ë¦¬ ì°¸ì¡° ë¶ˆê°€ëŠ¥ â†’ `form_submissions`ì— `form_kind` ìŠ¤ëƒ…ìƒ· ì»¬ëŸ¼ ì¶”ê°€ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
- í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ: ì œí’ˆ ì •ì±… ê²°ì • í•„ìš” â†’ ì„¤ì • ê¸°ë°˜ ì •ë‹µ ê³µê°œ ì •ì±…ìœ¼ë¡œ ë³€ê²½
- ì¶”ì²¨ commit-reveal: CSPRNG ì‚¬ìš©, ì¬ì¶”ì²¨ ì •ì±… ëª…í™•í™”
- RLS í˜„ì‹¤ ì²´í¬: ì»¬ëŸ¼ ë‹¨ìœ„ ë³´í˜¸ ë¶ˆê°€ â†’ API ë ˆë²¨ í•„í„°ë§ ê°•í™”

### ë°œê²¬ëœ ì´ìŠˆ ìš”ì•½

| ìš°ì„ ìˆœìœ„ | ì´ìŠˆ | ìƒíƒœ | ì˜í–¥ë„ | ì‹¤í–‰ í‹°ì¼“ | ë¹„ê³  |
|---------|------|------|--------|----------|------|
| **P0** | í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ (ì œì¶œ í›„) | ğŸ”´ **ìœ„í—˜** | ë³´ì•ˆ ì·¨ì•½ì  | í‹°ì¼“ #2 | ì¦‰ì‹œ ìˆ˜ì • |
| **P0** | ì¶”ì²¨ commit-reveal ê²€ì¦ ëˆ„ë½ | ğŸ”´ **ìœ„í—˜** | ê³µì •ì„± í›¼ì† ê°€ëŠ¥ | í‹°ì¼“ #3 | ì¦‰ì‹œ ìˆ˜ì • |
| P1 | ì„¤ë¬¸ 1íšŒ ì œì¶œ ì œí•œì˜ ë™ì‹œì„± ì·¨ì•½ì  | ğŸŸ¡ **ì´ë¡ ì ** | ì¤‘ë³µ ì œì¶œ ê°€ëŠ¥ | í‹°ì¼“ #1 | **í˜„ì¬ ë¬¸ì œ ì—†ìŒ â†’ ì„ íƒì ** |
| P1 | í€´ì¦ˆ max_attempts ê²½ìŸ ìƒíƒœ | ğŸŸ¡ **ì£¼ì˜** | ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ê°€ëŠ¥ | í‹°ì¼“ #4 | |
| P1 | ì¶”ì²¨ ì¬ì¶”ì²¨ ë°©ì§€ ë¯¸í¡ | ğŸŸ¡ **ì£¼ì˜** | ê°ì‚¬ ì¶”ì  ì–´ë ¤ì›€ | í‹°ì¼“ #5 | |

---

## ğŸ« í‹°ì¼“ #1: ì„¤ë¬¸ 1íšŒ ì œì¶œ ì œí•œ ë™ì‹œì„± ë³´ê°• (P1 â†’ ì„ íƒì )

### âš ï¸ ìš°ì„ ìˆœìœ„ ì¡°ì • ì‚¬ìœ 

**í˜„ì¬ ìƒíƒœ**: ì„¤ë¬¸ ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì´ë©°, ì‹¤ì œ ì¤‘ë³µ ì œì¶œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ.

**íŒë‹¨ ê¸°ì¤€**:
- âœ… í˜„ì¬ íŠ¸ë¦¬ê±°ë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ì‘ë™ ì¤‘
- âš ï¸ ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ ë¦¬ìŠ¤í¬ê°€ ìˆìŒ (ê¸°ì¡´ ë°ì´í„° ë°±í•„, íŠ¸ë¦¬ê±° ìˆ˜ì • ë“±)
- ğŸ“Š ì‹¤ì œ ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•ˆì „

**ê¶Œì¥ ì‚¬í•­**: 
- **í˜„ì¬ëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒ** (í˜„ì¬ ë¬¸ì œ ì—†ìŒ)
- ì‹¤ì œ ì¤‘ë³µ ì œì¶œ ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜, ëŒ€ê·œëª¨ ë™ì‹œ ì œì¶œ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì˜ˆìƒë  ë•Œë§Œ ìˆ˜ì •
- ë‹¤ë¥¸ P0 ì´ìŠˆë“¤(í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ, ì¶”ì²¨ commit-reveal)ì— ìš°ì„  ì§‘ì¤‘

### ë¬¸ì œì  (ì´ë¡ ì  ì·¨ì•½ì )

- `check_survey_submission_once` íŠ¸ë¦¬ê±°ë§Œ ì¡´ì¬, **UNIQUE ì¸ë±ìŠ¤ ì—†ìŒ**
- íŠ¸ë¦¬ê±°ëŠ” BEFORE INSERTì—ì„œ ì‹¤í–‰ë˜ì§€ë§Œ, íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì— ë”°ë¼ ë™ì‹œ ì œì¶œì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŒ (ì´ë¡ ìƒ)
- ë‘ ê°œì˜ íƒ­ì—ì„œ ë™ì‹œì— ì œì¶œí•˜ë©´ ë‘˜ ë‹¤ ì„±ê³µí•  ìˆ˜ ìˆìŒ (ì´ë¡ ìƒ)

### ê¸°ìˆ ì  ì œì•½ì‚¬í•­

**âš ï¸ ì›ë˜ ì œì•ˆì˜ ë¬¸ì œì **:
- Partial unique indexì—ì„œ `WHERE EXISTS (SELECT ... FROM forms ...)` í˜•íƒœëŠ” **Postgresì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŒ**
- ì¸ë±ìŠ¤ ì¡°ê±´(predicate)ì—ì„œ ë‹¤ë¥¸ í…Œì´ë¸”ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŒ

### í•´ê²° ë°©ì•ˆ (ìˆ˜ì •ë¨)

**ì˜µì…˜ A: form_kind ìŠ¤ëƒ…ìƒ· ì»¬ëŸ¼ ì¶”ê°€ (ê¶Œì¥)**

`form_submissions` í…Œì´ë¸”ì— `form_kind` ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ì—¬ ì„¤ë¬¸/í€´ì¦ˆ êµ¬ë¶„ì„ ì €ì¥í•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ partial unique index ìƒì„±.

**ì¥ì **:
- ë™ì‹œì„±ì— ê°•í•¨ (DB ë ˆë²¨ ì œì•½)
- íŠ¸ë¦¬ê±°ë³´ë‹¤ ì„±ëŠ¥/ì˜ˆì¸¡ì„±ì´ ì¢‹ìŒ
- ë¼ì´ë¸Œ ì•ˆì •ì„±ì— ìœ ë¦¬

**ë§ˆì´ê·¸ë ˆì´ì…˜**:
```sql
-- 1. form_kind ì»¬ëŸ¼ ì¶”ê°€ (NULL í—ˆìš©, ê¸°ì¡´ ë°ì´í„°ëŠ” íŠ¸ë¦¬ê±°ë¡œ ì±„ì›€)
ALTER TABLE public.form_submissions
ADD COLUMN form_kind text CHECK (form_kind IN ('survey', 'quiz'));

-- 2. ê¸°ì¡´ ë°ì´í„° ë°±í•„ (forms í…Œì´ë¸”ì—ì„œ ì¡°íšŒ)
UPDATE public.form_submissions fs
SET form_kind = f.kind
FROM public.forms f
WHERE fs.form_id = f.id
AND fs.form_kind IS NULL;

-- 3. NOT NULL ì œì•½ ì¶”ê°€
ALTER TABLE public.form_submissions
ALTER COLUMN form_kind SET NOT NULL;

-- 4. íŠ¸ë¦¬ê±°: INSERT ì‹œ ìë™ìœ¼ë¡œ form_kind ì±„ì›€
CREATE OR REPLACE FUNCTION public.set_form_kind_on_submission()
RETURNS TRIGGER AS $$
DECLARE
  form_kind_val text;
BEGIN
  SELECT kind INTO form_kind_val
  FROM public.forms
  WHERE id = NEW.form_id;
  
  NEW.form_kind := form_kind_val;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER tg_set_form_kind_on_submission
BEFORE INSERT ON public.form_submissions
FOR EACH ROW
EXECUTE FUNCTION public.set_form_kind_on_submission();

-- 5. ì„¤ë¬¸ë§Œ 1íšŒ ì œí•œí•˜ëŠ” partial unique index ìƒì„±
CREATE UNIQUE INDEX uniq_survey_submission_once
ON public.form_submissions(form_id, participant_id)
WHERE form_kind = 'survey';

-- 6. ê¸°ì¡´ íŠ¸ë¦¬ê±°ëŠ” ìœ ì§€ (ì´ì¤‘ ë°©ì–´)
-- check_survey_submission_once íŠ¸ë¦¬ê±°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
```

**ì£¼ì˜ì‚¬í•­**:
- ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ë¯€ë¡œ **ë³€ê²½ ì‚¬ìœ /ì˜í–¥/ë¡¤ë°±**ì„ PR ì„¤ëª…ì— ëª…ì‹œ
- ë³€ê²½ ì‚¬ìœ : ë™ì‹œ ì œì¶œ ì¤‘ë³µ ë°©ì§€(ì •í•©ì„±)
- ì˜í–¥ ë²”ìœ„: `form_submissions` insert ê²½ë¡œ
- ë¡¤ë°±: ì»¬ëŸ¼/ì¸ë±ìŠ¤ ì œê±° + ê¸°ì¡´ íŠ¸ë¦¬ê±° ìœ ì§€

### API ì½”ë“œ ìˆ˜ì •

**ë³€ê²½ ë¶ˆí•„ìš”**: `form_kind`ëŠ” íŠ¸ë¦¬ê±°ë¡œ ìë™ ì„¤ì •ë˜ë¯€ë¡œ API ì½”ë“œ ë³€ê²½ ì—†ìŒ.

### DoD (Definition of Done)

- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì™„ë£Œ (ê¸°ì¡´ ë°ì´í„° ë°±í•„ í¬í•¨)
- [ ] ê°™ì€ ì‚¬ìš©ìê°€ **5~10ê°œ íƒ­**ì—ì„œ ë™ì‹œì— ì œì¶œí•´ë„ ì œì¶œ 1ê±´ë§Œ ì €ì¥ë¨
- [ ] ë‚˜ë¨¸ì§€ ìš”ì²­ì€ ëª…í™•í•œ ì—ëŸ¬ ì‘ë‹µ (409 Conflict ë˜ëŠ” íŠ¸ë¦¬ê±° ì˜ˆì™¸) ë°˜í™˜
- [ ] **ì¶”ê°€ side effect ì—†ìŒ**: `form_answers` ì¤‘ë³µ ë“± ë°œìƒí•˜ì§€ ì•ŠìŒ
- [ ] í…ŒìŠ¤íŠ¸: ë™ì‹œ ì œì¶œ ì‹œë‚˜ë¦¬ì˜¤ (2íƒ­, 5íƒ­, 10íƒ­) + ì§€ì—°/ì¬ì‹œë„ í¬í•¨ìœ¼ë¡œ ê²€ì¦ ì™„ë£Œ

### íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì¼€ì´ìŠ¤**: ì„¤ë¬¸ 1íšŒ ì œì¶œ ì„±ê³µ
2. **ì¤‘ë³µ ì œì¶œ**: ê°™ì€ ì‚¬ìš©ìê°€ 2íšŒ ì œì¶œ ì‹œë„ â†’ 2ë²ˆì§¸ëŠ” ì‹¤íŒ¨
3. **ë™ì‹œ ì œì¶œ**: 5ê°œ íƒ­ì—ì„œ ë™ì‹œ ì œì¶œ â†’ 1ê±´ë§Œ ì„±ê³µ
4. **í€´ì¦ˆ ì˜í–¥ ì—†ìŒ**: í€´ì¦ˆëŠ” ì—¬ëŸ¬ ë²ˆ ì œì¶œ ê°€ëŠ¥ (ì¸ë±ìŠ¤ ì¡°ê±´ì— í•´ë‹¹ ì•ˆ ë¨)

---

## ğŸ« í‹°ì¼“ #2: í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ ë°©ì§€ (P0)

### ë¬¸ì œì 

- í€´ì¦ˆ ì œì¶œ í›„ **ì •ë‹µ(`answer_key`)ì´ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜ë¨**
- ì œì¶œí•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì •ë‹µì„ ìˆ¨ê¸°ì§€ë§Œ, ì œì¶œ í›„ì—ëŠ” ì •ë‹µì´ ë…¸ì¶œë¨
- ê³µì •ì„± ê´€ì ì—ì„œ ì·¨ì•½: ì œì¶œìê°€ ì •ë‹µì„ ê³µìœ í•˜ì—¬ ì´í›„ ì°¸ê°€ìê°€ ìœ ë¦¬í•´ì§ˆ ìˆ˜ ìˆìŒ

### ì œí’ˆ ì •ì±… ê²°ì • í•„ìš”

**âš ï¸ ê²°ì • í¬ì¸íŠ¸**:
- í€´ì¦ˆê°€ ì§„í–‰ ì¤‘ì¼ ë•Œ(OPEN ìƒíƒœ) "ì œì¶œí•œ ì‚¬ëŒì—ê²Œ ì •ë‹µì„ ë³´ì—¬ì¤„ ê²ƒì¸ê°€?"
  - **ë³´ì—¬ì£¼ë©´**: UXëŠ” ì¢‹ì§€ë§Œ ê³µì •ì„± ì €í•˜ (ì •ë‹µ ê³µìœ  ê°€ëŠ¥)
  - **ì•ˆ ë³´ì—¬ì£¼ë©´**: UXëŠ” ì•½ê°„ ë–¨ì–´ì§€ì§€ë§Œ ê³µì •ì„±/ìš´ì˜ ì•ˆì „ í–¥ìƒ

**ê¶Œì¥ ê¸°ë³¸ ì •ì±…**:
- **í€´ì¦ˆê°€ closed ë˜ê¸° ì „ì—ëŠ” ì°¸ê°€ìì—ê²Œ answer_key(ì •ë‹µ ì„ íƒì§€ ID) ë¯¸ë…¸ì¶œ**
- ëŒ€ì‹  `isCorrect`, `pointsAwarded` ì •ë„ë§Œ ì œê³µ
- í€´ì¦ˆ ì¢…ë£Œ í›„(`status = 'closed'`)ì—ëŠ” ì •ë‹µ ê³µê°œ ê°€ëŠ¥ (ì„¤ì • ê¸°ë°˜)

### í•´ê²° ë°©ì•ˆ

**1. forms í…Œì´ë¸”ì— ì •ë‹µ ê³µê°œ ì •ì±… ì»¬ëŸ¼ ì¶”ê°€** (ì„ íƒ, í–¥í›„ í™•ì¥ìš©):

```sql
-- ì •ë‹µ ê³µê°œ ì •ì±… ì¶”ê°€ (ì„ íƒì‚¬í•­)
ALTER TABLE public.forms
ADD COLUMN answer_reveal_policy text 
DEFAULT 'after_closed' 
CHECK (answer_reveal_policy IN ('never', 'after_submit', 'after_closed', 'immediate'));

-- ê¸°ë³¸ê°’: 'after_closed' (í€´ì¦ˆ ì¢…ë£Œ í›„ ê³µê°œ)
COMMENT ON COLUMN public.forms.answer_reveal_policy IS 
'ì •ë‹µ ê³µê°œ ì •ì±…: never(ê³µê°œ ì•ˆ í•¨), after_submit(ì œì¶œ í›„), after_closed(ì¢…ë£Œ í›„), immediate(ì¦‰ì‹œ)';
```

**2. ì œì¶œ API ìˆ˜ì •** (`app/api/webinars/[webinarId]/forms/[formId]/submit/route.ts`):

```typescript
// í€´ì¦ˆ ì±„ì  í›„ ì •ë‹µ ì •ë³´ ë°˜í™˜ (ìˆ˜ì •)
questionResults.push({
  questionId: q.id,
  isCorrect,
  pointsAwarded: awarded,
  // correctAnswer ì œê±° (ìš´ì˜ìë§Œ ë³¼ ìˆ˜ ìˆìŒ)
  // ì°¸ê°€ìëŠ” isCorrect, pointsAwardedë§Œ í™•ì¸ ê°€ëŠ¥
  userAnswer: ans ? {
    choiceIds: ans.choice_ids,
    textAnswer: ans.text_answer,
  } : null,
})
```

**3. ì¡°íšŒ API ìˆ˜ì •** (`app/api/webinars/[webinarId]/forms/[formId]/route.ts`):

```typescript
// ì œì¶œí•œ í€´ì¦ˆì¸ ê²½ìš° ì •ë‹µ ì •ë³´ ì¡°íšŒ (ìˆ˜ì •)
if (form.kind === 'quiz' && isSubmitted && submissionData?.submissionId) {
  // ì‚¬ìš©ìì˜ ë‹µì•ˆ ì¡°íšŒ
  const { data: answers } = await admin
    .from('form_answers')
    .select('question_id, choice_ids, text_answer, is_correct, points_awarded')
    .eq('submission_id', submissionData.submissionId)
  
  userAnswers = answers || []
  
  // ê° ë¬¸í•­ë³„ ê²°ê³¼ ì •ë³´ êµ¬ì„± (ì •ë‹µì€ ìš´ì˜ìë§Œ)
  for (const q of questions || []) {
    const userAnswer = userAnswers.find((a: any) => a.question_id === q.id)
    
    // ì •ë‹µ ê³µê°œ ì •ì±… í™•ì¸
    const canRevealAnswer = 
      form.status === 'closed' || // í€´ì¦ˆ ì¢…ë£Œ í›„
      canViewAnswers || // ìš´ì˜ì/ê´€ë¦¬ì
      form.answer_reveal_policy === 'after_submit' || // ì •ì±…ìƒ ì œì¶œ í›„ ê³µê°œ
      form.answer_reveal_policy === 'immediate'; // ì •ì±…ìƒ ì¦‰ì‹œ ê³µê°œ
    
    questionResults.push({
      questionId: q.id,
      isCorrect: userAnswer?.is_correct ?? null,
      pointsAwarded: userAnswer?.points_awarded ?? 0,
      // ì •ë‹µì€ ì¡°ê±´ë¶€ë¡œë§Œ í¬í•¨
      ...(canRevealAnswer ? { correctAnswer: q.answer_key } : {}),
      userAnswer: userAnswer ? {
        choiceIds: userAnswer.choice_ids,
        textAnswer: userAnswer.text_answer,
      } : null,
    })
  }
}

// ì •ë‹µí‚¤ ì œê±° (ê¶Œí•œì´ ì—†ê³  ì•„ì§ ì œì¶œí•˜ì§€ ì•Šì€ ê²½ìš°)
if (form.kind === 'quiz' && form.status !== 'closed' && !canViewAnswers && !isSubmitted) {
  questions?.forEach((q: any) => {
    delete q.answer_key
  })
}
```

**4. RLS í˜„ì‹¤ ì²´í¬ ë³´ì™„**:

- **Postgres RLSëŠ” ì»¬ëŸ¼ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ row ë‹¨ìœ„**ì´ë¯€ë¡œ, ì»¬ëŸ¼ ìì²´ë¥¼ RLSë¡œ "ìˆ¨ê¸°ëŠ”" ê²ƒì€ ë¶ˆê°€ëŠ¥
- ì•ˆì „í•œ íŒ¨í„´: **API ë ˆë²¨ì—ì„œ í•„í„°ë§** (í˜„ì¬ ë°©ì‹ ìœ ì§€)
- ì°¸ê°€ìê°€ ì§ì ‘ `form_questions`ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ê²½ë¡œê°€ ìˆë‹¤ë©´ **ê·¸ ê²½ë¡œì—ì„œ answer_keyê°€ ì ˆëŒ€ selectë˜ì§€ ì•Šê²Œ** í•´ì•¼ í•¨

### DoD (Definition of Done)

- [ ] ì°¸ê°€ì ê¶Œí•œ í† í°ìœ¼ë¡œ ì œì¶œ API ì‘ë‹µ, ì¡°íšŒ API ì‘ë‹µ, ë„¤íŠ¸ì›Œí¬ íƒ­ ì–´ë””ì—ì„œë„ `answer_key`/ì •ë‹µ IDê°€ ë³´ì´ì§€ ì•ŠìŒ (**í€´ì¦ˆ open ìƒíƒœ ê¸°ì¤€**)
- [ ] ìš´ì˜ì/ê´€ë¦¬ìë§Œ ì •ë‹µ ì¡°íšŒ ê°€ëŠ¥ (ê¶Œí•œ ê²€ì¦ ë¡œê·¸ í¬í•¨)
- [ ] í€´ì¦ˆ ì¢…ë£Œ í›„(`status = 'closed'`) ì •ë‹µ ê³µê°œ ê°€ëŠ¥ (ì„¤ì • ê¸°ë°˜)
- [ ] í…ŒìŠ¤íŠ¸: ì œì¶œ í›„ ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ì •ë‹µ í™•ì¸ ë¶ˆê°€

### íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì¼€ì´ìŠ¤**: í€´ì¦ˆ ì œì¶œ í›„ `isCorrect`, `pointsAwarded`ë§Œ í™•ì¸ ê°€ëŠ¥
2. **ì •ë‹µ ë¯¸ë…¸ì¶œ**: ì œì¶œ í›„ì—ë„ `correctAnswer` í•„ë“œ ì—†ìŒ
3. **ìš´ì˜ì í™•ì¸**: ìš´ì˜ì í† í°ìœ¼ë¡œëŠ” ì •ë‹µ í™•ì¸ ê°€ëŠ¥
4. **í€´ì¦ˆ ì¢…ë£Œ í›„**: `status = 'closed'`ì¼ ë•Œ ì •ë‹µ ê³µê°œ ê°€ëŠ¥ (ì„¤ì •ì— ë”°ë¼)

---

## ğŸ« í‹°ì¼“ #3: ì¶”ì²¨ commit-reveal ê²€ì¦ êµ¬í˜„ (P0)

### ë¬¸ì œì 

- `seed_commit`ì´ ìˆì–´ë„ **ê²€ì¦í•˜ì§€ ì•Šê³ ** ë§¤ë²ˆ ìƒˆë¡œìš´ `seed_reveal` ìƒì„±
- `drawn` ìƒíƒœì—ì„œ ì¬ì¶”ì²¨ ë°©ì§€ ë¡œì§ì´ ë¯¸í¡ (ìƒíƒœ ì²´í¬ë§Œ ìˆìŒ)
- commit-reveal íŒ¨í„´ì´ í˜•ì‹ì ìœ¼ë¡œë§Œ ì¡´ì¬í•˜ê³  ì‹¤ì œ ê³µì •ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŒ

### í•´ê²° ë°©ì•ˆ

**1. seed_commit ê²€ì¦ ë¡œì§ ì¶”ê°€** (`app/api/webinars/[webinarId]/giveaways/[giveawayId]/draw/route.ts`):

```typescript
// draw API ìˆ˜ì •
if (!isManualDraw) {
  // seed_commitì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ seed_revealì„ ë°›ì•„ì„œ ê²€ì¦
  if (giveaway.seed_commit) {
    const { seedReveal } = await req.json().catch(() => ({}))
    
    if (!seedReveal) {
      return NextResponse.json(
        { error: 'seed_reveal is required when seed_commit exists' },
        { status: 400 }
      )
    }
    
    // ê²€ì¦ (ê¸°ì¡´ verify_seed_commit í•¨ìˆ˜ ì‚¬ìš©)
    const { data: verifyResult, error: verifyError } = await admin.rpc('verify_seed_commit', {
      seed_commit: giveaway.seed_commit,
      seed_reveal: seedReveal,
    })
    
    if (verifyError || !verifyResult?.ok) {
      return NextResponse.json(
        { error: 'seed_reveal does not match seed_commit' },
        { status: 400 }
      )
    }
    
    // ê²€ì¦ëœ seed ì‚¬ìš©
    const { data: drawnWinners, error: drawError } = await admin.rpc('draw_giveaway', {
      p_giveaway_id: giveawayId,
      p_seed: seedReveal, // ê²€ì¦ëœ seed ì‚¬ìš©
    })
    
    if (drawError) {
      return NextResponse.json(
        { error: drawError.message },
        { status: 500 }
      )
    }
    
    winners = drawnWinners || []
    updateData.seed_reveal = seedReveal // ê²€ì¦ëœ seed ì €ì¥
  } else {
    // seed_commitì´ ì—†ìœ¼ë©´ ìë™ ìƒì„± (CSPRNG ì‚¬ìš©)
    // Node.js crypto.randomBytes ì‚¬ìš© (Math.random ëŒ€ì‹ )
    const crypto = require('crypto')
    const randomBytes = crypto.randomBytes(32) // 256-bit CSPRNG
    const autoSeed = `${giveawayId}-${Date.now()}-${randomBytes.toString('hex')}`
    
    const { data: drawnWinners, error: drawError } = await admin.rpc('draw_giveaway', {
      p_giveaway_id: giveawayId,
      p_seed: autoSeed,
    })
    
    if (drawError) {
      return NextResponse.json(
        { error: drawError.message },
        { status: 500 }
      )
    }
    
    winners = drawnWinners || []
    updateData.seed_reveal = autoSeed
  }
}
```

**2. ì¬ì¶”ì²¨ ë°©ì§€ ê°•í™”**:

```typescript
// drawn ìƒíƒœì—ì„œëŠ” ì¬ì¶”ì²¨ ë¶ˆê°€ (ê¸°ë³¸ ì •ì±…)
if (giveaway.status === 'drawn') {
  return NextResponse.json(
    { error: 'Giveaway has already been drawn. Re-draw is not allowed.' },
    { status: 400 }
  )
}

// ë˜ëŠ” ì¬ì¶”ì²¨ì„ í—ˆìš©í•˜ë˜ ê°ì‚¬ ë¡œê·¸ ê°•ì œ (ì„ íƒ ì •ì±…)
// if (giveaway.status === 'drawn') {
//   const { reason } = await req.json()
//   if (!reason || reason.trim().length < 10) {
//     return NextResponse.json(
//       { error: 'Re-draw reason is required (min 10 characters)' },
//       { status: 400 }
//     )
//   }
//   
//   // ì´ì „ ë‹¹ì²¨ì ì •ë³´ ì¡°íšŒ
//   const { data: previousWinners } = await admin
//     .from('giveaway_winners')
//     .select('participant_id, rank, proof_json')
//     .eq('giveaway_id', giveawayId)
//     .order('rank', { ascending: true })
//   
//   // ê°ì‚¬ ë¡œê·¸ì— ì¬ì¶”ì²¨ ê¸°ë¡
//   await admin.from('audit_logs').insert({
//     actor_user_id: user.id,
//     action: 'GIVEAWAY_RE_DRAW',
//     payload: {
//       giveaway_id: giveawayId,
//       reason,
//       previous_winners: previousWinners,
//       previous_drawn_at: giveaway.drawn_at,
//     },
//   })
// }
```

**3. ìƒíƒœ ì „ì´ í™•ì¸**:

- draw APIì—ì„œ `status = 'drawn'`ìœ¼ë¡œ ì •í™•íˆ ì „ì´ë˜ëŠ”ì§€ í™•ì¸
- `giveaway_winners` í…Œì´ë¸”ì— ë‹¹ì²¨ìê°€ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸

### DoD (Definition of Done)

- [ ] `seed_commit`ì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ `seed_reveal` ê²€ì¦ í†µê³¼ í›„ ì¶”ì²¨ ì‹¤í–‰
- [ ] `seed_reveal`ì´ commit ê²€ì¦ì„ í†µê³¼í•˜ì§€ ëª»í•˜ë©´ ì¶”ì²¨ ì‹¤íŒ¨
- [ ] ê²€ì¦ í†µê³¼ ì‹œ ê·¸ seedë¡œ draw + seed_reveal ì €ì¥ + ìƒíƒœ drawn ì „ì´
- [ ] `drawn` ì´í›„ ì¬ì¶”ì²¨ì´ ì •ì±…ì ìœ¼ë¡œ í†µì œë¨ (ê¸°ë³¸: ë¶ˆê°€, ì˜ˆì™¸: ê°ì‚¬ ë¡œê·¸ ê°•ì œ)
- [ ] seed ìƒì„±ì€ CSPRNG ì‚¬ìš© (Math.random ëŒ€ì‹  `crypto.randomBytes`)
- [ ] í…ŒìŠ¤íŠ¸: commit-reveal ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì¶”ì²¨ ë¶ˆê°€ í™•ì¸

### íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì¼€ì´ìŠ¤**: seed_commit ì—†ì´ ì¶”ì²¨ â†’ ìë™ ìƒì„±ëœ seed ì‚¬ìš©
2. **commit-reveal**: seed_commit ìˆìœ¼ë©´ seed_reveal í•„ìˆ˜, ê²€ì¦ í†µê³¼ í›„ ì¶”ì²¨
3. **ê²€ì¦ ì‹¤íŒ¨**: seed_revealì´ commitê³¼ ë¶ˆì¼ì¹˜ â†’ ì¶”ì²¨ ì‹¤íŒ¨
4. **ì¬ì¶”ì²¨ ë°©ì§€**: drawn ìƒíƒœì—ì„œ ì¬ì¶”ì²¨ ì‹œë„ â†’ ì‹¤íŒ¨

---

## ğŸ« í‹°ì¼“ #4: í€´ì¦ˆ max_attempts ì›ìì  ì²˜ë¦¬ (P1)

### ë¬¸ì œì 

- `attempt_no` ê³„ì‚°ì´ SELECT í›„ INSERT ì‚¬ì´ì— ìˆì–´ ê²½ìŸ ìƒíƒœ ê°€ëŠ¥
- ë‘ íƒ­ì—ì„œ ë™ì‹œì— ì œì¶œí•˜ë©´ `attempt_no`ê°€ ì¤‘ë³µë˜ê±°ë‚˜ ì´ˆê³¼ ê°€ëŠ¥

### í•´ê²° ë°©ì•ˆ

**ë°©ë²• 1: DB í•¨ìˆ˜ë¡œ ì›ìì  ì²˜ë¦¬ (ê¶Œì¥)**:

```sql
CREATE OR REPLACE FUNCTION get_next_attempt_no(
  p_form_id uuid,
  p_participant_id uuid,
  p_max_attempts int
) RETURNS int AS $$
DECLARE
  next_no int;
  current_max int;
BEGIN
  -- FOR UPDATEë¡œ ë½ (participant ë‹¨ìœ„)
  SELECT COALESCE(MAX(attempt_no), 0) INTO current_max
  FROM public.quiz_attempts
  WHERE form_id = p_form_id 
    AND participant_id = p_participant_id
  FOR UPDATE; -- participant ë‹¨ìœ„ ë½ (form ì „ì²´ ë½ ì•„ë‹˜)
  
  next_no := current_max + 1;
  
  IF p_max_attempts IS NOT NULL AND next_no > p_max_attempts THEN
    RAISE EXCEPTION 'Max attempts reached: % (current: %)', p_max_attempts, current_max;
  END IF;
  
  RETURN next_no;
END;
$$ LANGUAGE plpgsql;
```

**API ì½”ë“œ ìˆ˜ì •** (`app/api/webinars/[webinarId]/forms/[formId]/submit/route.ts`):

```typescript
// í€´ì¦ˆ: ì‹œë„ íšŸìˆ˜ í™•ì¸ (ì›ìì  ì²˜ë¦¬)
if (form.kind === 'quiz') {
  // DB í•¨ìˆ˜ë¡œ ì›ìì ìœ¼ë¡œ attempt_no ë°°ì •
  const { data: attemptNoResult, error: attemptNoError } = await admin.rpc('get_next_attempt_no', {
    p_form_id: formId,
    p_participant_id: user.id,
    p_max_attempts: form.max_attempts || null,
  })
  
  if (attemptNoError) {
    // max_attempts ì´ˆê³¼ ë˜ëŠ” ê¸°íƒ€ ì˜¤ë¥˜
    if (attemptNoError.message?.includes('Max attempts reached')) {
      return NextResponse.json(
        { error: 'Max attempts reached' },
        { status: 403 }
      )
    }
    return NextResponse.json(
      { error: attemptNoError.message },
      { status: 500 }
    )
  }
  
  const nextAttempt = attemptNoResult
  
  // í€´ì¦ˆ ì‹œë„ ìƒì„±
  const { data: attempt, error: attemptError } = await admin
    .from('quiz_attempts')
    .insert({
      form_id: formId,
      participant_id: user.id,
      attempt_no: nextAttempt, // ì›ìì ìœ¼ë¡œ ë°°ì •ëœ ë²ˆí˜¸
    })
    .select()
    .single()
  
  // ... ë‚˜ë¨¸ì§€ ë¡œì§
}
```

**ë°©ë²• 2: ìœ ë‹ˆí¬ ì¶©ëŒ ì‹œ ì¬ì‹œë„ (ëŒ€ì•ˆ)**:

```typescript
// ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ ì¶©ëŒ ì‹œ ì§§ì€ ì¬ì‹œë„ (ë©±ë“±ì„± íŒ¨í„´)
let retries = 3
let nextAttempt: number | null = null

while (retries > 0) {
  try {
    const { data: prevAttempts } = await supabase
      .from('quiz_attempts')
      .select('attempt_no')
      .eq('form_id', formId)
      .eq('participant_id', user.id)
      .order('attempt_no', { ascending: false })
      .limit(1)
      .maybeSingle()
    
    nextAttempt = (prevAttempts?.attempt_no || 0) + 1
    
    if (form.max_attempts && nextAttempt > form.max_attempts) {
      return NextResponse.json(
        { error: 'Max attempts reached' },
        { status: 403 }
      )
    }
    
    const { data: attempt, error: attemptError } = await admin
      .from('quiz_attempts')
      .insert({
        form_id: formId,
        participant_id: user.id,
        attempt_no: nextAttempt,
      })
      .select()
      .single()
    
    if (attemptError) {
      if (attemptError.code === '23505') { // ìœ ë‹ˆí¬ ì¶©ëŒ
        retries--
        if (retries > 0) {
          await new Promise(resolve => setTimeout(resolve, 50)) // ì§§ì€ ëŒ€ê¸°
          continue
        }
      }
      throw attemptError
    }
    
    break // ì„±ê³µ
  } catch (error) {
    if (retries === 0) throw error
    retries--
  }
}
```

### DoD (Definition of Done)

- [ ] ë™ì‹œ ì œì¶œì—ë„ `max_attempts`ê°€ í™•ì‹¤íˆ ì§€ì¼œì§
- [ ] `attempt_no` ì¤‘ë³µì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
- [ ] ë¬´í•œ ì¬ì‹œë„ ë°©ì§€ (ìµœëŒ€ 1~2íšŒ ë‚´ì—ì„œë§Œ ìˆ˜ìŠµ)
- [ ] í…ŒìŠ¤íŠ¸: ë™ì‹œ ì œì¶œ ì‹œë‚˜ë¦¬ì˜¤ (2íƒ­, 5íƒ­)ë¡œ ê²€ì¦ ì™„ë£Œ

### íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì¼€ì´ìŠ¤**: í€´ì¦ˆ ì œì¶œ ì‹œ attempt_no ìˆœì°¨ ì¦ê°€
2. **ë™ì‹œ ì œì¶œ**: 2ê°œ íƒ­ì—ì„œ ë™ì‹œ ì œì¶œ â†’ attempt_no ì¤‘ë³µ ì—†ìŒ
3. **max_attempts ì´ˆê³¼**: ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ì œì¶œ ì‹¤íŒ¨

---

## ğŸ« í‹°ì¼“ #5: ì¶”ì²¨ ì¬ì¶”ì²¨ ë°©ì§€ ê°•í™” (P1)

### ë¬¸ì œì 

- `drawn` ìƒíƒœì—ì„œë„ ì¬ì¶”ì²¨ ê°€ëŠ¥ (ì¡°ê±´ ì²´í¬ ë¯¸í¡)
- ì¬ì¶”ì²¨ ì‹œ ê°ì‚¬ ë¡œê·¸ê°€ ìˆì§€ë§Œ, ì´ì „ ë‹¹ì²¨ì ì •ë³´ê°€ ë³´ì¡´ë˜ì§€ ì•ŠìŒ

### í•´ê²° ë°©ì•ˆ

**1. ìƒíƒœ ì²´í¬ ê°•í™”** (`app/api/webinars/[webinarId]/giveaways/[giveawayId]/draw/route.ts`):

```typescript
// drawn ìƒíƒœì—ì„œëŠ” ì¬ì¶”ì²¨ ë¶ˆê°€ (ê¸°ë³¸ ì •ì±…)
if (giveaway.status === 'drawn') {
  return NextResponse.json(
    { error: 'Giveaway has already been drawn. Re-draw is not allowed.' },
    { status: 400 }
  )
}

// open/closed ìƒíƒœë§Œ í—ˆìš©
if (giveaway.status !== 'open' && giveaway.status !== 'closed') {
  return NextResponse.json(
    { error: 'Giveaway must be open or closed to draw' },
    { status: 400 }
  )
}
```

**2. ì¬ì¶”ì²¨ í—ˆìš© ì‹œ ê°ì‚¬ ë¡œê·¸ ê°•í™”** (ì„ íƒ ì •ì±…):

```typescript
// ì¬ì¶”ì²¨ì„ í—ˆìš©í•˜ëŠ” ê²½ìš° (ì •ì±… ê²°ì • í•„ìš”)
if (giveaway.status === 'drawn' && allowReDraw) {
  // ì´ì „ ë‹¹ì²¨ì ì •ë³´ ì¡°íšŒ
  const { data: previousWinners } = await admin
    .from('giveaway_winners')
    .select('participant_id, rank, proof_json')
    .eq('giveaway_id', giveawayId)
    .order('rank', { ascending: true })
  
  // ì¬ì¶”ì²¨ ì‚¬ìœ  í•„ìˆ˜
  const { reason } = await req.json()
  if (!reason || reason.trim().length < 10) {
    return NextResponse.json(
      { error: 'Re-draw reason is required (min 10 characters)' },
      { status: 400 }
    )
  }
  
  // ê°ì‚¬ ë¡œê·¸ì— ì¬ì¶”ì²¨ ê¸°ë¡
  await admin.from('audit_logs').insert({
    actor_user_id: user.id,
    agency_id: giveaway.agency_id,
    client_id: giveaway.client_id,
    webinar_id: webinarId,
    action: 'GIVEAWAY_RE_DRAW',
    payload: {
      giveaway_id: giveawayId,
      reason,
      previous_winners: previousWinners,
      previous_drawn_at: giveaway.drawn_at,
      previous_seed_reveal: giveaway.seed_reveal,
    },
  })
  
  // ê¸°ì¡´ ë‹¹ì²¨ì ì‚­ì œ (ì¬ì¶”ì²¨ ì „)
  await admin
    .from('giveaway_winners')
    .delete()
    .eq('giveaway_id', giveawayId)
}
```

### DoD (Definition of Done)

- [ ] `drawn` ìƒíƒœì—ì„œ ì¬ì¶”ì²¨ ì‹œë„ ì‹œ ì‹¤íŒ¨ (ê¸°ë³¸ ì •ì±…)
- [ ] ì¬ì¶”ì²¨ í—ˆìš© ì‹œ ê°ì‚¬ ë¡œê·¸ì— ì´ì „ ë‹¹ì²¨ì ì •ë³´ í¬í•¨
- [ ] ì¬ì¶”ì²¨ ì‚¬ìœ  í•„ìˆ˜ (ìµœì†Œ 10ì)
- [ ] í…ŒìŠ¤íŠ¸: drawn ìƒíƒœì—ì„œ ì¬ì¶”ì²¨ ì‹œë„ â†’ ì‹¤íŒ¨ í™•ì¸

### íšŒê·€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. **ì •ìƒ ì¼€ì´ìŠ¤**: open/closed ìƒíƒœì—ì„œ ì¶”ì²¨ ì„±ê³µ
2. **ì¬ì¶”ì²¨ ë°©ì§€**: drawn ìƒíƒœì—ì„œ ì¬ì¶”ì²¨ ì‹œë„ â†’ ì‹¤íŒ¨
3. **ê°ì‚¬ ë¡œê·¸**: ì¬ì¶”ì²¨ ì‹œ ì´ì „ ë‹¹ì²¨ì ì •ë³´ ê¸°ë¡

---

## ğŸ“Š ì¢…í•© í‰ê°€

### ê°•ì  âœ…

1. **ì„¤ê³„ ë°©í–¥**: ì„¤ë¬¸/í€´ì¦ˆ í†µí•©, commit-reveal ì¶”ì²¨ êµ¬ì¡°ëŠ” ìš´ì˜ ê°€ëŠ¥í•œ ìˆ˜ì¤€
2. **ë°ì´í„° ì •ê·œí™”**: `form_submissions`, `form_answers`, `quiz_attempts` ë¶„ë¦¬ê°€ ì ì ˆ
3. **RLS ì •ì±…**: ê¸°ë³¸ì ì¸ ê¶Œí•œ ê´€ë¦¬ê°€ êµ¬í˜„ë¨
4. **ê°ì‚¬ ë¡œê·¸**: ì£¼ìš” ì‘ì—…ì— ê°ì‚¬ ë¡œê·¸ ê¸°ë¡

### ê°œì„  í•„ìš” ğŸ”´

1. **ë™ì‹œì„± ì²˜ë¦¬**: ì„¤ë¬¸/í€´ì¦ˆ ì œì¶œ, ì¶”ì²¨ ì‹¤í–‰ ì‹œ ì›ìì„± ë³´ì¥ í•„ìš”
2. **ë³´ì•ˆ**: í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ ë°©ì§€ í•„ìš”
3. **ê³µì •ì„±**: commit-reveal ê²€ì¦ ë¡œì§ êµ¬í˜„ í•„ìš”

---

## ğŸ¯ ìˆ˜ì • ìš°ì„ ìˆœìœ„

### ì¦‰ì‹œ ìˆ˜ì • (P0)

1. âœ… **í‹°ì¼“ #2**: í€´ì¦ˆ ì •ë‹µ ë…¸ì¶œ ë°©ì§€ (ì œì¶œ í›„ì—ë„, ì„¤ì • ê¸°ë°˜)
2. âœ… **í‹°ì¼“ #3**: ì¶”ì²¨ commit-reveal ê²€ì¦ ë¡œì§ êµ¬í˜„

### ê¶Œì¥ ê°œì„  (P1)

3. âšª **í‹°ì¼“ #1**: ì„¤ë¬¸ 1íšŒ ì œì¶œ UNIQUE ì¸ë±ìŠ¤ ì¶”ê°€ (í˜„ì¬ ë¬¸ì œ ì—†ìŒ â†’ ì„ íƒì )
4. âœ… **í‹°ì¼“ #4**: í€´ì¦ˆ max_attempts ì›ìì  ì²˜ë¦¬
5. âœ… **í‹°ì¼“ #5**: ì¶”ì²¨ ì¬ì¶”ì²¨ ë°©ì§€ ê°•í™”

### ì„ íƒ ê°œì„  (P2)

6. âšª **ì„¤ë¬¸ ì œì¶œ ê¸°ì¤€ ëª…í™•í™”** (user_id vs email/phone)
7. âšª **ê°€ì¤‘ì¹˜(weight) ì‚¬ìš© ì‹œ ì•Œê³ ë¦¬ì¦˜ ì¬ì •ì˜**
8. âšª **Realtime ëŒ€ì‹  Broadcast ì´ë²¤íŠ¸ ì‚¬ìš©** (ì„±ëŠ¥ ìµœì í™”)

---

## ğŸ“ ì‹¤í–‰ ê³„íš

### Phase 1: P0 ì´ìŠˆ ìˆ˜ì • (ì˜ˆìƒ ì†Œìš”: 1-2ì‹œê°„)

1. **í‹°ì¼“ #2**: API ì½”ë“œ ìˆ˜ì •
   - ì œì¶œ APIì—ì„œ `correctAnswer` ì œê±°
   - ì¡°íšŒ APIì—ì„œ ì •ë‹µ ê³µê°œ ì •ì±… ì ìš©
   - í…ŒìŠ¤íŠ¸: ì°¸ê°€ì í† í°ìœ¼ë¡œ ì •ë‹µ ë¯¸ë…¸ì¶œ í™•ì¸

2. **í‹°ì¼“ #3**: ì¶”ì²¨ API ìˆ˜ì •
   - `seed_commit` ê²€ì¦ ë¡œì§ ì¶”ê°€
   - CSPRNG ì‚¬ìš© (crypto.randomBytes)
   - ì¬ì¶”ì²¨ ë°©ì§€ ë¡œì§ ê°•í™”
   - í…ŒìŠ¤íŠ¸: commit-reveal ê²€ì¦ í™•ì¸

### Phase 2: P1 ì´ìŠˆ ìˆ˜ì • (ì˜ˆìƒ ì†Œìš”: 1-2ì‹œê°„)

3. **í‹°ì¼“ #1**: ì„¤ë¬¸ UNIQUE ì¸ë±ìŠ¤ ì¶”ê°€ (ì„ íƒì , ë¬¸ì œ ë°œìƒ ì‹œì—ë§Œ)
   - ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì„± ë° ì‹¤í–‰
   - `form_kind` ì»¬ëŸ¼ ì¶”ê°€
   - íŠ¸ë¦¬ê±° ìƒì„±
   - Partial unique index ìƒì„±
   - ê¸°ì¡´ ë°ì´í„° ë°±í•„

4. **í‹°ì¼“ #4**: í€´ì¦ˆ attempt_no ì›ìì  ì²˜ë¦¬
   - DB í•¨ìˆ˜ ìƒì„± (`get_next_attempt_no`)
   - API ì½”ë“œ ìˆ˜ì •
   - í…ŒìŠ¤íŠ¸: ë™ì‹œ ì œì¶œ ì‹œë‚˜ë¦¬ì˜¤

5. **í‹°ì¼“ #5**: ì¬ì¶”ì²¨ ë°©ì§€ ê°•í™”
   - ìƒíƒœ ì²´í¬ ê°•í™”
   - ê°ì‚¬ ë¡œê·¸ ê°•í™” (ì„ íƒ)

### Phase 3: íšŒê·€ í…ŒìŠ¤íŠ¸ (ì˜ˆìƒ ì†Œìš”: 1ì‹œê°„)

- ê¸°ì¡´ ê¸°ëŠ¥ ë™ì‘ í™•ì¸
- ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (2íƒ­, 5íƒ­, 10íƒ­)
- ì •ë‹µ ë…¸ì¶œ í…ŒìŠ¤íŠ¸
- commit-reveal ê²€ì¦ í…ŒìŠ¤íŠ¸

---

## ğŸ” ê¸°ìˆ ì  ì£¼ì˜ì‚¬í•­

### 1. Partial Unique Index ì œì•½

- **PostgresëŠ” ì¸ë±ìŠ¤ ì¡°ê±´(predicate)ì—ì„œ ë‹¤ë¥¸ í…Œì´ë¸”ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ìŒ**
- í•´ê²°: `form_kind` ìŠ¤ëƒ…ìƒ· ì»¬ëŸ¼ ì¶”ê°€ ë°©ì‹ ì‚¬ìš©

### 2. RLS í˜„ì‹¤ ì²´í¬

- **Postgres RLSëŠ” ì»¬ëŸ¼ ë‹¨ìœ„ê°€ ì•„ë‹ˆë¼ row ë‹¨ìœ„**
- ì»¬ëŸ¼ ìì²´ë¥¼ RLSë¡œ "ìˆ¨ê¸°ëŠ”" ê²ƒì€ ë¶ˆê°€ëŠ¥
- í•´ê²°: API ë ˆë²¨ì—ì„œ í•„í„°ë§ (í˜„ì¬ ë°©ì‹ ìœ ì§€)

### 3. ë½ ë²”ìœ„

- **form ì „ì²´ ë½ì€ ë³‘ëª© ë°œìƒ ê°€ëŠ¥**
- í•´ê²°: participant ë‹¨ìœ„ ë½ ì‚¬ìš© (FOR UPDATE)

### 4. CSPRNG ì‚¬ìš©

- **Math.random()ì€ ì˜ˆì¸¡ ê°€ëŠ¥í•  ìˆ˜ ìˆìŒ**
- í•´ê²°: Node.js `crypto.randomBytes` ì‚¬ìš©

---

**ì‘ì„±ì**: Cursor AI Agent  
**ê²€í†  ì™„ë£Œ**: 2026-02-08  
**ìˆ˜ì • ì™„ë£Œ**: 2026-02-08 (ê¸°ìˆ  ê²€í†  ë°˜ì˜)
