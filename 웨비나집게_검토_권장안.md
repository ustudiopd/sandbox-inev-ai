# ì›¨ë¹„ë‚˜ ì§‘ê³„ ëª…ì„¸ì„œ ê²€í†  ë° ê¶Œì¥ì•ˆ

**ê²€í† ì¼**: 2026ë…„ 2ì›” 5ì¼  
**ê²€í†  ëŒ€ìƒ**: `ì›¨ë¹„ë‚˜ì§‘ê²Œ.md` (ê°œì¸ ì‹œì²­ì‹œê°„ & ì„¸ì…˜ íŠ¸ë˜í‚¹ ì „ì²´ ëª…ì„¸ì„œ)

---

## ğŸ“‹ ê²€í†  ìš”ì•½

### âœ… ê°•ì  (ì˜ ì„¤ê³„ëœ ë¶€ë¶„)

1. **í˜„ ì‹œìŠ¤í…œê³¼ì˜ ì¼ê´€ì„± ìœ ì§€**
   - ê¸°ì¡´ `presence/ping` API í™•ì¥ ë°©ì‹ ì±„íƒ
   - ê¸°ì¡´ í¬ë¡ /ë²„í‚· êµ¬ì¡° ìœ ì§€
   - `webinar_live_presence`ì˜ ëª©ì  ë³´ì¡´

2. **ë¶€í•˜ ìµœì†Œí™” ì„¤ê³„**
   - heartbeat ê¸°ë°˜ O(1) write êµ¬ì¡°
   - ì„œë²„ ì¤‘ì‹¬ ì‹œì²­ì‹œê°„ ê³„ì‚° (ì¡°ì‘ ë°©ì§€)
   - ë¼ì´ë¸Œ í™”ë©´ ì§‘ê³„ ì¿¼ë¦¬ ê¸ˆì§€ ì›ì¹™ ì¤€ìˆ˜

3. **ë‹¨ê³„ì  êµ¬í˜„ ì „ëµ**
   - Phase 0 â†’ Phase 1 â†’ Phase 2ë¡œ ëª…í™•í•œ ë‹¨ê³„ êµ¬ë¶„
   - ê° Phaseë³„ DoD ì •ì˜

---

## âš ï¸ ê°œì„  ê¶Œì¥ ì‚¬í•­

### 1. Heartbeat ì£¼ê¸° ì •ì±… (7.1ì ˆ)

**í˜„ì¬ ì œì•ˆ**: 60ì´ˆ ê¶Œì¥ (30ì´ˆëŠ” ì •í™•í•˜ì§€ë§Œ ë¹„ìš©â†‘, 120ì´ˆëŠ” ì˜¤ì°¨â†‘)

**ê¶Œì¥ ìˆ˜ì •**:
- **ê¸°ë³¸ê°’: 120ì´ˆ (í˜„ì¬ presence pingê³¼ ë™ì¼)**
  - ì´ìœ : ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ìˆ˜ ìµœì†Œí™” (ë¶€í•˜ ê°ì†Œ)
  - ì‹œì²­ì‹œê°„ ì •í™•ë„ëŠ” Â±2ë¶„ ì˜¤ì°¨ë¡œ ì¶©ë¶„ (ìš´ì˜ KPI ëª©ì )
- **ì„¤ì • ê°€ëŠ¥**: env ë³€ìˆ˜ë¡œ ê´€ë¦¬ (`SESSION_HEARTBEAT_INTERVAL_SECONDS`)
- **ì •í™•ë„ê°€ ì¤‘ìš”í•œ ê²½ìš°**: Phase 2ì—ì„œ ì„ íƒì ìœ¼ë¡œ 60ì´ˆë¡œ ì¡°ì • ê°€ëŠ¥

**ê·¼ê±°**:
- í˜„ì¬ ì‹œìŠ¤í…œì´ ì´ë¯¸ 120ì´ˆ ì£¼ê¸°ë¡œ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘ ì¤‘
- ê°œì¸ ì‹œì²­ì‹œê°„ì€ "ëŒ€ëµì ì¸ ì°¸ì—¬ë„" ì§€í‘œë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ Â±2ë¶„ ì˜¤ì°¨ëŠ” í—ˆìš© ê°€ëŠ¥
- 60ì´ˆë¡œ ì¤„ì´ë©´ ìš”ì²­ ìˆ˜ê°€ 2ë°° ì¦ê°€ (ë¹„ìš©/ë¶€í•˜ ì¦ê°€)

---

### 2. ì›¨ë¹„ë‚˜ ì¢…ë£Œì‹œê°„ í•„ë“œ ì„¤ê³„ (4.1ì ˆ)

**í˜„ì¬ ì œì•ˆ**: `scheduled_end_time`, `actual_end_time` 2ê°œ í•„ë“œ

**ê¶Œì¥ ìˆ˜ì •**:
```sql
-- ê¸°ì¡´: webinar_start_time (ì´ë¯¸ ì¡´ì¬)
-- ì¶”ê°€: 
webinar_scheduled_end_time TIMESTAMPTZ,  -- ì˜ˆì • ì¢…ë£Œì‹œê°„
webinar_actual_end_time TIMESTAMPTZ,     -- ì‹¤ì œ ì¢…ë£Œì‹œê°„
```

**ì´ìœ **:
- ê¸°ì¡´ ë„¤ì´ë° ì»¨ë²¤ì…˜(`webinar_start_time`)ê³¼ ì¼ê´€ì„± ìœ ì§€
- `scheduled_end` / `actual_end`ë³´ë‹¤ ëª…í™•í•¨

**ì§‘ê³„ ìœˆë„ìš° ê³„ì‚°**:
```sql
-- ë³¸í¸ ì¢…ë£Œì‹œê°„ (ìš°ì„ ìˆœìœ„: actual > scheduled)
content_to = COALESCE(webinar_actual_end_time, webinar_scheduled_end_time)

-- ìˆ˜ì§‘ ì¢…ë£Œì‹œê°„
collect_to = content_to + post_window_minutes
```

---

### 3. ì„¸ì…˜ í…Œì´ë¸” ì„¤ê³„ ë³´ì™„ (5.1ì ˆ)

**âœ… êµ¬í˜„ ì™„ë£Œ (2026-02-06)**

**ì‹¤ì œ êµ¬í˜„ëœ êµ¬ì¡°**:
```sql
CREATE TABLE webinar_user_sessions (
  id UUID PRIMARY KEY,
  webinar_id UUID NOT NULL,
  user_id UUID,  -- nullable (ê²ŒìŠ¤íŠ¸ ì§€ì›)
  session_id TEXT NOT NULL,  -- í´ë¼ì´ì–¸íŠ¸ ìƒì„± (localStorage ê¸°ë°˜)
  entered_at TIMESTAMPTZ NOT NULL,
  exited_at TIMESTAMPTZ,  -- nullì´ë©´ ì•„ì§ ì‹œì²­ ì¤‘
  duration_seconds INTEGER,  -- ìë™ ê³„ì‚° (íŠ¸ë¦¬ê±°)
  user_agent TEXT,
  referrer TEXT,
  ip_address TEXT,
  agency_id UUID,
  client_id UUID,
  created_at TIMESTAMPTZ NOT NULL,
  updated_at TIMESTAMPTZ NOT NULL
);
```

**ì¸ë±ìŠ¤**:
- âœ… `idx_wus_webinar_user` (webinar_id, user_id)
- âœ… `idx_wus_webinar_entered` (webinar_id, entered_at desc)
- âœ… `idx_wus_user_entered` (user_id, entered_at desc)
- âœ… `idx_wus_session` (session_id)
- âœ… `idx_wus_active` (webinar_id, exited_at) WHERE exited_at IS NULL

**ì„¸ì…˜ ID ìƒì„± ê·œì¹™** (í˜„ì¬ êµ¬í˜„):
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ `session_${Date.now()}_${random}` í˜•ì‹ ì‚¬ìš©
- í˜ì´ì§€ ì§„ì… ì‹œ 1íšŒ ìƒì„±, localStorageì— ì €ì¥
- ì¬ì…ì¥ ì‹œ ìƒˆ session_id ìƒì„± (ìƒˆ ì„¸ì…˜ìœ¼ë¡œ ê¸°ë¡)

**â³ Phase 1ì—ì„œ ì¶”ê°€ ì˜ˆì •**:
- `last_heartbeat_at` í•„ë“œ
- `watched_seconds_raw` í•„ë“œ (heartbeat ê¸°ë°˜ ëˆ„ì )

---

### 4. Presence/Ping API í™•ì¥ ë°©ì‹ (6.2ì ˆ)

**í˜„ì¬ ì œì•ˆ**: `presence/ping`ì— `session_key` ì˜µì…˜ í•„ë“œ ì¶”ê°€

**ê¶Œì¥ êµ¬í˜„**:

```typescript
// Request (í•˜ìœ„í˜¸í™˜)
POST /api/webinars/[webinarId]/presence/ping
Body: {
  session_key?: string,  // ì˜µì…˜: ì„¸ì…˜ ì¶”ì  í™œì„±í™” ì‹œ
  view_state?: {
    is_visible?: boolean,
    is_active?: boolean
  }
}

// ì„œë²„ ë™ì‘
1. ê¸°ì¡´ presence ping ì²˜ë¦¬ (ë³€ê²½ ì—†ìŒ)
2. session_keyê°€ ìˆìœ¼ë©´:
   - ì„¸ì…˜ ì¡°íšŒ/ìƒì„±
   - heartbeat ì—…ë°ì´íŠ¸ (Î”t ëˆ„ì )
3. view_stateê°€ falseë©´ ëˆ„ì  ì¤‘ì§€ (ì •ì±… 1: íƒ­ visibleë§Œ)
```

**ì¤‘ìš”**: 
- `session_key`ê°€ ì—†ì–´ë„ ê¸°ì¡´ ë™ì‘ ìœ ì§€ (í•˜ìœ„í˜¸í™˜)
- ì„¸ì…˜ ì¶”ì ì€ "ì˜µíŠ¸ì¸" ë°©ì‹ (í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ì•¼ í™œì„±í™”)

---

### 5. ì„¸ì…˜ Sweeper í¬ë¡  ì„¤ê³„ (8.2ì ˆ)

**í˜„ì¬ ì œì•ˆ**: 5ë¶„ ë˜ëŠ” 10ë¶„ ì£¼ê¸°

**ê¶Œì¥**:
- **ì£¼ê¸°: 10ë¶„** (ê¸°ì¡´ access-snapshot í¬ë¡ ê³¼ ë¶„ë¦¬)
- **ëŒ€ìƒ**: `exited_at IS NULL AND last_heartbeat_at < now() - interval '5 minutes'`
- **ì²˜ë¦¬**: 
  ```sql
  UPDATE webinar_user_sessions
  SET 
    exited_at = last_heartbeat_at,  -- now()ê°€ ì•„ë‹ˆë¼ last_heartbeatë¡œ (ê³¼ëŒ€ê³„ìƒ ë°©ì§€)
    closed_reason = 'timeout',
    updated_at = now()
  WHERE exited_at IS NULL 
    AND last_heartbeat_at < now() - interval '5 minutes'
  ```

**ì´ìœ **:
- 5ë¶„ì€ ë„ˆë¬´ ë¹ˆë²ˆ (ë¹„ìš© ì¦ê°€)
- 10ë¶„ì´ë©´ ì¶©ë¶„íˆ stale ì„¸ì…˜ ì •ë¦¬ ê°€ëŠ¥
- ê¸°ì¡´ access-snapshot í¬ë¡ (1ë¶„)ê³¼ ë¶„ë¦¬í•˜ì—¬ ë¶€í•˜ ë¶„ì‚°

---

### 6. Î”t Cap ì •ì±… ëª…í™•í™” (7.1ì ˆ)

**í˜„ì¬ ì œì•ˆ**: heartbeat ê°„ê²©ì˜ 2~3ë°°

**ê¶Œì¥ ìˆ˜ì •**:
```typescript
// í™˜ê²½ ë³€ìˆ˜
SESSION_HEARTBEAT_INTERVAL_SECONDS=120  // ê¸°ë³¸ê°’
SESSION_DELTA_CAP_MULTIPLIER=3          // ê°„ê²©ì˜ 3ë°°

// ê³„ì‚°
const deltaCap = SESSION_HEARTBEAT_INTERVAL_SECONDS * SESSION_DELTA_CAP_MULTIPLIER
// ì˜ˆ: 120 * 3 = 360ì´ˆ (6ë¶„)

// ì ìš©
const delta = Math.min(
  (now - last_heartbeat_at) / 1000,  // ì´ˆ ë‹¨ìœ„
  deltaCap
)
```

**ì´ìœ **:
- íƒ­ ë°±ê·¸ë¼ìš´ë“œ/ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ í•œ ë²ˆì— 20ë¶„ ëˆ„ì  ë°©ì§€
- ì„¤ì • ê°€ëŠ¥í•˜ë„ë¡ env ë³€ìˆ˜ë¡œ ê´€ë¦¬

---

### 7. í†µê³„ ì§‘ê³„ ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™” (9.4ì ˆ)

**í˜„ì¬ ì œì•ˆ**: ì¸ë±ì‹±ìœ¼ë¡œ í•´ê²°, í•„ìš” ì‹œ Phase 2ì—ì„œ ì‚¬ì „ì§‘ê³„

**ê¶Œì¥ ë³´ì™„**:

**ì¸ë±ìŠ¤ ì¶”ê°€**:
```sql
-- ê°œì¸ë³„ ì‹œì²­ì‹œê°„ ì§‘ê³„ìš©
CREATE INDEX idx_wus_webinar_user_watched 
  ON webinar_user_sessions(webinar_id, user_id, exited_at)
  WHERE exited_at IS NOT NULL;

-- ë³¸í¸ ì‹œì²­ì‹œê°„ ê³„ì‚°ìš© (ì‹œê°„ ë²”ìœ„ ì¿¼ë¦¬)
CREATE INDEX idx_wus_webinar_entered_exited 
  ON webinar_user_sessions(webinar_id, entered_at, exited_at)
  WHERE exited_at IS NOT NULL;
```

**ì§‘ê³„ ì¿¼ë¦¬ ìµœì í™”**:
```sql
-- ê°œì¸ë³„ ì‹œì²­ì‹œê°„ (ë³¸í¸ êµ¬ê°„ ë³´ì •)
WITH content_window AS (
  SELECT 
    webinar_start_time as content_from,
    COALESCE(webinar_actual_end_time, webinar_scheduled_end_time) as content_to
  FROM webinars
  WHERE id = $1
),
session_overlaps AS (
  SELECT 
    wus.user_id,
    GREATEST(wus.entered_at, cw.content_from) as overlap_start,
    LEAST(COALESCE(wus.exited_at, now()), cw.content_to) as overlap_end
  FROM webinar_user_sessions wus
  CROSS JOIN content_window cw
  WHERE wus.webinar_id = $1
    AND wus.entered_at < cw.content_to
    AND COALESCE(wus.exited_at, now()) > cw.content_from
)
SELECT 
  user_id,
  SUM(EXTRACT(EPOCH FROM (overlap_end - overlap_start)))::int as watched_seconds
FROM session_overlaps
GROUP BY user_id;
```

---

### 8. Multi-tab/Multi-device ì •ì±… ëª…í™•í™” (12ì ˆ)

**í˜„ì¬ ì œì•ˆ**: "ì„¸ì…˜ì€ ì¤‘ë³µ í—ˆìš©(ë¡œê·¸)" + "ê°œì¸ KPIëŠ” ë³¸í¸ ê¸¸ì´ë¡œ ìƒí•œ(ë³´ì •)"

**ê¶Œì¥ ì •ì±… ë¬¸ì„œí™”**:

```markdown
## Multi-tab/Multi-device ì •ì±…

### ì„¸ì…˜ ë ˆë²¨
- ê° íƒ­/ë””ë°”ì´ìŠ¤ë§ˆë‹¤ ë³„ë„ session_key ìƒì„±
- ì¤‘ë³µ ì„¸ì…˜ í—ˆìš© (ë¡œê·¸ ëª©ì )

### ê°œì¸ KPI ì§‘ê³„
- ê°œì¸ë³„ ì´ ì‹œì²­ì‹œê°„ = ëª¨ë“  ì„¸ì…˜ì˜ ë³¸í¸ êµ¬ê°„ overlap í•©ê³„
- ìƒí•œ: `min(ì´ ì‹œì²­ì‹œê°„, content_duration_seconds)` (ê³¼ëŒ€ê³„ìƒ ë°©ì§€)
- ì˜ˆ: ì›¨ë¹„ë‚˜ 60ë¶„ì¸ë° 2ê°œ íƒ­ìœ¼ë¡œ 90ë¶„ ì‹œì²­ â†’ 60ë¶„ìœ¼ë¡œ cap

### ë™ì‹œ ì ‘ì†ì ìˆ˜
- ê¸°ì¡´ `webinar_live_presence` ê¸°ë°˜ ì§‘ê³„ ìœ ì§€ (ë³€ê²½ ì—†ìŒ)
- ì„¸ì…˜ í…Œì´ë¸”ê³¼ëŠ” ë³„ê°œ
```

---

## ğŸ”§ êµ¬í˜„ ìš°ì„ ìˆœìœ„ ì¡°ì •

### Phase 0 (ìŠ¤ì¼€ì¤„ ì„ ì–¸) - **ìš°ì„ ìˆœìœ„ ìƒí–¥ ê¶Œì¥**

**ì´ìœ **:
- ì¢…ë£Œì‹œê°„ í•„ë“œê°€ ì—†ìœ¼ë©´ Phase 1ì—ì„œ "ë³¸í¸ êµ¬ê°„ ë³´ì •" ë¶ˆê°€ëŠ¥
- UI ì‘ì—…ì´ í•„ìš”í•˜ë¯€ë¡œ ê°œë°œ ë¦¬ë“œíƒ€ì„ ê³ ë ¤

**ê¶Œì¥ ìˆœì„œ**:
1. DB ë§ˆì´ê·¸ë ˆì´ì…˜ (ì¢…ë£Œì‹œê°„ í•„ë“œ ì¶”ê°€)
2. ì›¨ë¹„ë‚˜ ì„¤ì • UI ìˆ˜ì • (ì¢…ë£Œì‹œê°„ ì…ë ¥)
3. í†µê³„ APIì—ì„œ ì¢…ë£Œì‹œê°„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì¤€ë¹„

---

### Phase 1 (ì„¸ì…˜ í…Œì´ë¸” + heartbeat) - **í•˜ìœ„í˜¸í™˜ì„± ê°•í™”**

**âœ… ë¶€ë¶„ êµ¬í˜„ ì™„ë£Œ (2026-02-06)**
- âœ… `webinar_user_sessions` í…Œì´ë¸” ìƒì„± ì™„ë£Œ
- âœ… `/api/webinars/[webinarId]/access/track`ì— ì„¸ì…˜ ê¸°ë¡ ì¶”ê°€
- âœ… `/api/webinars/[webinarId]/access/exit` API ìƒì„±
- âœ… í´ë¼ì´ì–¸íŠ¸ í‡´ì¥ ì´ë²¤íŠ¸ ì²˜ë¦¬

**â³ ë‚¨ì€ ì‘ì—…**
- â³ `presence/ping`ì— `session_id` ì˜µì…˜ í•„ë“œ ì¶”ê°€ (í•˜ìœ„í˜¸í™˜)
- â³ heartbeat ê¸°ë°˜ `watched_seconds_raw` ëˆ„ì  ë¡œì§
- â³ `last_heartbeat_at` í•„ë“œ ì¶”ê°€ ë° ì—…ë°ì´íŠ¸

**ê¶Œì¥ ìˆ˜ì •**:
- `session_id`ëŠ” **ì˜µì…˜**ìœ¼ë¡œ ì²˜ë¦¬ (ì—†ì–´ë„ ê¸°ì¡´ ë™ì‘ ìœ ì§€) - êµ¬í˜„ ì˜ˆì •
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì ì§„ì ìœ¼ë¡œ `session_id` ì „ì†¡ ì‹œì‘
- ê¸°ì¡´ `presence/ping` ë™ì‘ì€ ë³€ê²½ ì—†ìŒ

---

### Phase 2 (Sweeper + í†µê³„ UX) - **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¶”ê°€**

**ê¶Œì¥ ì¶”ê°€**:
- ì„¸ì…˜ sweeper í¬ë¡  ì‹¤í–‰ ì‹œê°„ ëª¨ë‹ˆí„°ë§
- í†µê³„ ì¿¼ë¦¬ ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§ (ëª©í‘œ: 500ms ì´ë‚´)
- ëŒ€ìš©ëŸ‰ ì›¨ë¹„ë‚˜(1000+ ì„¸ì…˜) í…ŒìŠ¤íŠ¸

---

## ğŸ“Š ì˜ˆìƒ ë¶€í•˜ ì¬ê²€í† 

### í˜„ì¬ ì œì•ˆ vs ê¶Œì¥ ìˆ˜ì • ë¹„êµ

| í•­ëª© | í˜„ì¬ ì œì•ˆ | ê¶Œì¥ ìˆ˜ì • | ì˜í–¥ |
|------|----------|----------|------|
| Heartbeat ì£¼ê¸° | 60ì´ˆ | 120ì´ˆ | ìš”ì²­ ìˆ˜ 50% ê°ì†Œ |
| Sweeper ì£¼ê¸° | 5ë¶„ | 10ë¶„ | í¬ë¡  ì‹¤í–‰ 50% ê°ì†Œ |
| Î”t Cap | ê°„ê²©ì˜ 2~3ë°° | ê°„ê²©ì˜ 3ë°° (ëª…í™•í™”) | ë™ì¼ |

**ì˜ˆìƒ ë¶€í•˜ (ë™ì‹œ ì‹œì²­ì 600ëª…)**:
- Heartbeat 60ì´ˆ: 10 RPS
- Heartbeat 120ì´ˆ: **5 RPS** (ê¶Œì¥)
- DB Write: heartbeatë‹¹ 2ê±´ (presence upsert + session update)

**ê²°ë¡ **: ê¶Œì¥ ìˆ˜ì •ì•ˆì´ ë¶€í•˜ë¥¼ ë” ì¤„ì´ë©´ì„œë„ ìš´ì˜ ëª©ì ì— ì¶©ë¶„í•¨

---

## âœ… ìµœì¢… ê¶Œì¥ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 0 (ìŠ¤ì¼€ì¤„ ì„ ì–¸)
- [ ] `webinar_scheduled_end_time`, `webinar_actual_end_time` í•„ë“œ ì¶”ê°€
- [ ] ì›¨ë¹„ë‚˜ ì„¤ì • UIì— ì¢…ë£Œì‹œê°„ ì…ë ¥ í•„ë“œ ì¶”ê°€
- [ ] í†µê³„ APIì—ì„œ ì¢…ë£Œì‹œê°„ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì¤€ë¹„

### Phase 1 (ì„¸ì…˜ í…Œì´ë¸” + heartbeat)
- [x] `webinar_user_sessions` í…Œì´ë¸” ìƒì„± (ì¸ë±ìŠ¤ í¬í•¨) âœ… **ì™„ë£Œ**
- [x] `/api/webinars/[webinarId]/access/track`ì— ì„¸ì…˜ ê¸°ë¡ ì¶”ê°€ âœ… **ì™„ë£Œ**
- [x] `/api/webinars/[webinarId]/access/exit` API ìƒì„± âœ… **ì™„ë£Œ**
- [x] í´ë¼ì´ì–¸íŠ¸ì—ì„œ í‡´ì¥ ì´ë²¤íŠ¸ ì²˜ë¦¬ âœ… **ì™„ë£Œ**
- [ ] `presence/ping` APIì— `session_id` ì˜µì…˜ í•„ë“œ ì¶”ê°€ (í•˜ìœ„í˜¸í™˜) â³ **ì§„í–‰ ì¤‘**
- [ ] `last_heartbeat_at`, `watched_seconds_raw` í•„ë“œ ì¶”ê°€ â³ **ì§„í–‰ ì¤‘**
- [ ] í´ë¼ì´ì–¸íŠ¸ì—ì„œ heartbeat ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ â³ **ì§„í–‰ ì¤‘**
- [ ] Heartbeat ì£¼ê¸°: **120ì´ˆ** (env ë³€ìˆ˜ë¡œ ì„¤ì • ê°€ëŠ¥) â³ **ì§„í–‰ ì¤‘**
- [ ] Î”t Cap: ê°„ê²©ì˜ 3ë°° (env ë³€ìˆ˜ë¡œ ì„¤ì • ê°€ëŠ¥) â³ **ì§„í–‰ ì¤‘**

### Phase 2 (Sweeper + í†µê³„ UX)
- [ ] ì„¸ì…˜ sweeper í¬ë¡  ì¶”ê°€ (10ë¶„ ì£¼ê¸°)
- [ ] í†µê³„ APIì— ê°œì¸ë³„ ì‹œì²­ì‹œê°„ ì§‘ê³„ ì¶”ê°€
- [ ] í†µê³„ UIì— ì‹œì²­ì‹œê°„ ì„¹ì…˜ ì¶”ê°€
- [ ] ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¶”ê°€

---

## ğŸ¯ í•µì‹¬ ê¶Œì¥ ì‚¬í•­ ìš”ì•½

1. **Heartbeat ì£¼ê¸°: 120ì´ˆ ìœ ì§€** (60ì´ˆ â†’ 120ì´ˆë¡œ ë³€ê²½)
   - ë¶€í•˜ ê°ì†Œ, ì •í™•ë„ëŠ” ì¶©ë¶„

2. **ì¢…ë£Œì‹œê°„ í•„ë“œëª…: `webinar_scheduled_end_time`, `webinar_actual_end_time`**
   - ê¸°ì¡´ ë„¤ì´ë° ì»¨ë²¤ì…˜ê³¼ ì¼ê´€ì„±

3. **ì„¸ì…˜ sweeper: 10ë¶„ ì£¼ê¸°** (5ë¶„ â†’ 10ë¶„)
   - ë¶€í•˜ ê°ì†Œ, ì¶©ë¶„í•œ ì •ë¦¬ ì£¼ê¸°

4. **í•˜ìœ„í˜¸í™˜ì„± ë³´ì¥**
   - `session_key`ëŠ” ì˜µì…˜ í•„ë“œë¡œ ì²˜ë¦¬
   - ê¸°ì¡´ `presence/ping` ë™ì‘ ë³€ê²½ ì—†ìŒ

5. **ì„¤ì • ê°€ëŠ¥ì„±**
   - ëª¨ë“  ì£¼ê¸°/ìº¡ ê°’ì€ env ë³€ìˆ˜ë¡œ ê´€ë¦¬ (í•˜ë“œì½”ë”© ê¸ˆì§€)

---

## ğŸ“ ì¶”ê°€ ê²€í†  í•„ìš” ì‚¬í•­

1. **ì„¸ì…˜ í‚¤ ì¶©ëŒ ë°©ì§€**
   - UUID ì‚¬ìš© ì‹œ ì¶©ëŒ í™•ë¥ ì€ ë§¤ìš° ë‚®ì§€ë§Œ, ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ í•„ìˆ˜

2. **ëŒ€ìš©ëŸ‰ ì›¨ë¹„ë‚˜ í…ŒìŠ¤íŠ¸**
   - ë™ì‹œ ì ‘ì†ì 1000+ ëª… ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í•„ìš”
   - ì„¸ì…˜ í…Œì´ë¸” íŒŒí‹°ì…”ë‹ ê³ ë ¤ (ì¥ê¸° ìš´ì˜ ì‹œ)

3. **ë°ì´í„° ì •ë¦¬ ì •ì±…**
   - ì˜¤ë˜ëœ ì„¸ì…˜ ë°ì´í„° ì •ë¦¬ í¬ë¡  í•„ìš” (ì˜ˆ: 90ì¼ ì´ìƒ ëœ ë°ì´í„°)

4. **ëª¨ë‹ˆí„°ë§ ì§€í‘œ**
   - ì„¸ì…˜ ìƒì„±ë¥ , heartbeat ì„±ê³µë¥ , sweeper ì²˜ë¦¬ ê±´ìˆ˜ ëª¨ë‹ˆí„°ë§

---

**ê²€í†  ì™„ë£Œ**: ìœ„ ê¶Œì¥ ì‚¬í•­ì„ ë°˜ì˜í•˜ì—¬ ëª…ì„¸ì„œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

---

## ğŸ“… êµ¬í˜„ í˜„í™© ì—…ë°ì´íŠ¸ (2026-02-06)

### âœ… ì™„ë£Œëœ ì‘ì—…
1. **`webinar_user_sessions` í…Œì´ë¸” ìƒì„±**
   - ë§ˆì´ê·¸ë ˆì´ì…˜ 089 ì ìš© ì™„ë£Œ
   - ëª¨ë“  í•„ë“œ ë° ì¸ë±ìŠ¤ ìƒì„± ì™„ë£Œ
   - RLS ì •ì±… ì„¤ì • ì™„ë£Œ
   - ìë™ duration ê³„ì‚° íŠ¸ë¦¬ê±° êµ¬í˜„ ì™„ë£Œ

2. **API êµ¬í˜„**
   - `/api/webinars/[webinarId]/access/track` ìˆ˜ì • ì™„ë£Œ
     - ì„¸ì…˜ ê¸°ë¡ ì €ì¥ ì¶”ê°€
     - IP ì£¼ì†Œ, User-Agent, Referrer ì €ì¥
   - `/api/webinars/[webinarId]/access/exit` ìƒì„± ì™„ë£Œ
     - í‡´ì¥ ì‹œê°„ ê¸°ë¡
     - ì²´ë¥˜ ì‹œê°„ ìë™ ê³„ì‚°

3. **í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„**
   - `WebinarEntry` ì»´í¬ë„ŒíŠ¸ì— í‡´ì¥ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¶”ê°€
   - `beforeunload` ì´ë²¤íŠ¸ ì²˜ë¦¬
   - `navigator.sendBeacon` ì‚¬ìš©

### â³ ì§„í–‰ ì¤‘ì¸ ì‘ì—… (Phase 1 ì™„ë£Œë¥¼ ìœ„í•´)
1. **Heartbeat ê¸°ë°˜ ì‹œì²­ì‹œê°„ ëˆ„ì **
   - `presence/ping` API í™•ì¥
   - `last_heartbeat_at`, `watched_seconds_raw` í•„ë“œ ì¶”ê°€
   - í´ë¼ì´ì–¸íŠ¸ heartbeat ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„

2. **ì„¤ì • ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„°**
   - Heartbeat ì£¼ê¸° (ê¸°ë³¸ 120ì´ˆ)
   - Î”t Cap (ê°„ê²©ì˜ 3ë°°)
   - í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬

### ğŸ“ ë‹¤ìŒ ë‹¨ê³„
- Phase 1 ì™„ë£Œ: Heartbeat ê¸°ë°˜ ì‹œì²­ì‹œê°„ ëˆ„ì  êµ¬í˜„
- Phase 2: ì„¸ì…˜ sweeper í¬ë¡  ë° í†µê³„ UX ê°œì„ 
