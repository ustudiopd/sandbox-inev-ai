# 완료된 작업 내역 (Progress)

## [2026-02-11] 이벤트 222152 체험 프로그램·오늘의 메뉴 페이지 및 gcbio 버킷 업로드
- ✅ EventExperienceProgramPage (`/event/222152/experience-program`): page4_top 히어로(체험 이벤트·부제), 5개 프로그램 블록(01~05: 원+구분선+텍스트+이미지), 번호별 원 색상(01 #EC1F23, 02 #45B652, 03 #F5D327, 04 #006FB7, 05 #EC1F23), 블록 간 17px·하단 200px 여백, 원·구분선 일직선 가운데 정렬.
- ✅ 오늘의 메뉴 페이지: `/event/[slug]/menu` (예: http://localhost:3000/event/222152/menu) 라우트·EventTodayMenuPage(헤더 variant today-menu, 본문 "Nothing" 가운데), 헤더 오늘의 메뉴 링크·활성 시 6px+border-b-2. 빌드·메모리뱅크·푸시 완료.
- ✅ gcbio 버킷 업로드 52개, 빌드 성공, memory_bank 반영, Git 푸시.

## [2026-02-11] 이벤트 222152 세션 안내 페이지(EventSessionGuidePage) 완료 및 gcbio 버킷 업로드
- ✅ EventSessionGuidePage (`/event/222152/session-guide`): 세션 안내 히어로, M1 대표이사 특강(허은철·배백식 카드), 구분선, M3 GCBP 우수사례발표(3행: 유성근·황정운·안기범), 크로스 스테이지 ㅣ 무대 프로그램(황성현 연사 카드·현/전 직함 2열 배치). 이미지 getGcbioImageUrl(page3_person1~6, page2_photo2 등). 구분선 1420×1px #EBEBEC 가운데 정렬·배백식–M3·안기범–크로스스테이지 간격 조정.
- ✅ gcbio 버킷 업로드: `npx tsx scripts/upload-gcbio-all-222152.ts` 실행, img/gcbio 45개 파일 Supabase Storage(gcbio) 업로드 완료.
- ✅ 빌드 성공, memory_bank 반영, Git 푸시.

## [2026-02-11] 이벤트 222152 협업스타일 진단 페이지 구현 및 gcbio 버킷 업로드
- ✅ CollaborationStylePage: 제목/부제 왼쪽 정렬, 구분선(437px), Click 버튼, 원형 이미지(page2_photo2, getGcbioImageUrl), 말풍선·빨간원·초록파란곡선·노란원 등 장식 SVG 배치. 헤더 협업스타일 선택 시 하단 2px 선.
- ✅ gcbio 버킷 업로드: img/gcbio 42개 파일 Supabase Storage(gcbio) 업로드 완료. 빌드 성공, memory_bank 반영, Git 푸시.

## [2026-02-11] 이벤트 222152 행사개요 페이지 UI 조정 및 gcbio 버킷 업로드
- ✅ EventOverviewPage UI 조정
  - "스케쥴 변경 예정" 오버레이 글씨 50px → 45px
  - 행사개요 헤더 메뉴 선택 시 하단 2px 검정선(border-b-2, 약 6px 아래)
  - 회색 배경 블록(#F2F2F2) 높이 860px → 1060px 연장 후 1010px로 하단 50px 절단
- ✅ gcbio 버킷 이미지 업로드: `npx tsx scripts/upload-gcbio-all-222152.ts` 실행, img/gcbio 41개 파일 Supabase Storage(gcbio 버킷) 업로드 완료
- ✅ 빌드 성공, memory_bank/progress.md 반영, Git 푸시

## [2026-02-11] 이벤트 222152 메인(랜딩) 페이지 개편
- ✅ Event222152Landing: 타이틀/날짜 제거 후 Main_name.png, DATE/LOCATION 텍스트, 행사개요 버튼(overview 링크), Main_poster.png 배치. 스크롤 가능(overflow-x-hidden, min-h-[900px]).
- ✅ Event222152Header: 로고 → Home_button.png(메인 링크), border-b·bg rgba(249,249,249,0.6), 사용자 영역 제거 후 메뉴 오른쪽 319px→619px에 홍길동 pill(0.8 scale) 추가. 메인에서 헤더 클릭 가능하도록 z-40 적용.
- ✅ 행사개요 버튼: Link to /event/${slug}/overview. 헤더 메뉴(행사개요·협업스타일 진단·세션 안내·체험 프로그램·갤러리)는 기존대로 각 서브 페이지 링크.
- ✅ gcbio 버킷: upload-gcbio-all-222152.ts를 img/gcbio 전체 자동 업로드로 변경, 29개 파일 업로드 완료.
- ✅ 수정된 파일: Event222152Landing.tsx, Event222152Header.tsx, scripts/upload-gcbio-all-222152.ts, public/img/gcbio (Home_button, Main_name, Main_poster 등).

## [2026-02-10] 이벤트 222152 갤러리 페이지 구현
- ✅ 갤러리 라우트 및 페이지 추가
  - `app/event/[slug]/gallery/page.tsx`: 이벤트 조회·code 222152 검증 후 EventGalleryPage 렌더
  - `app/event/[slug]/gallery/EventGalleryPage.tsx`: 갤러리 클라이언트 컴포넌트
- ✅ 갤러리 페이지 구성
  - 상단: 제목 "2026 GCBP Leadership Workshop" (Bebas Neue 70px), 부제 "2026 GCBP Leadership Workshop의 추억을 만나보세요." (Pretendard 24px), 가운데 정렬
  - Photo 섹션: 4개 이미지·캡션 세트(30px 간격), 이전/다음 버튼으로 세트 전체 반칸(215px)씩 좌우 이동
  - Video 섹션: 2개 비디오 썸네일(1092×518, 30px 간격) 세트, 이전/다음 버튼으로 세트 전체 반칸 이동
  - 하단: 1920×495px 그라데이션 막대 (linear-gradient 90deg #36C618 → #FFDF00 → #FF4606)
- ✅ 헤더 연동: Event222152Header에 `variant="gallery"` 추가, 갤러리 메뉴를 `/event/${slug}/gallery` 링크로 연결
- ✅ 수정된 파일
  - `app/event/[slug]/gallery/page.tsx`, `EventGalleryPage.tsx` (신규)
  - `app/event/[slug]/components/Event222152Header.tsx` (gallery variant·링크 추가)

## [2026-02-10] 이벤트 222152 랜딩 페이지 생성
- ✅ Event222152Landing 컴포넌트 생성
  - `app/event/[slug]/components/Event222152Landing.tsx` 파일 생성
  - GC녹십자 스타일 랜딩 페이지 (Event175419Landing과 동일한 디자인)
  - 배경 이미지, 네비게이션 바, 타이틀 이미지, 날짜/장소 표시
  - 이미지 버킷은 기존 GC녹십자 스토리지 공유 사용
- ✅ 이벤트 라우팅 분기 추가
  - `app/event/[slug]/page.tsx`에 `event.code === '222152'` 분기 추가
  - 222152 이벤트 접속 시 Event222152Landing 컴포넌트 렌더링
- ✅ 수정된 파일
  - `app/event/[slug]/components/Event222152Landing.tsx`: 새 파일 생성
  - `app/event/[slug]/page.tsx`: 222152 분기 추가

## [2026-02-09] 이벤트 랜딩 페이지 모바일 UI 개선 (Event722895Landing)
- ✅ 히어로 섹션 모바일 로고 배치 개선
  - 모바일에서도 PC처럼 상단 양쪽에 로고 배치 (`left-5`, `right-5`)
  - 모바일 로고 크기: `w-32 h-4` (128px × 16px)
  - PC 로고 크기: `md:w-72 md:h-9` (288px × 36px)
  - 로고 위치를 버튼 양끝단에 맞춤 (부모 컨테이너의 `px-5`와 동일한 20px 여백)
- ✅ 히어로 섹션 모바일 버튼 높이 조정
  - 모바일 버튼 패딩: `py-4` → `py-2` (상하 패딩 16px → 8px)
  - PC 버튼 패딩: `md:py-8` 유지
- ✅ 수정된 파일
  - `app/event/[slug]/components/Event722895Landing.tsx`: 모바일 로고 배치 및 버튼 높이 조정

## [2026-02-09] 이벤트 랜딩 페이지 UI 개선 (Event722895Landing)
- ✅ 이벤트 랜딩 페이지 이미지 및 레이아웃 개선
  - 선물 아이콘 이미지 교체: `🎁` 이모지 → `0312_icon_6_v2.png` (147x109px)
  - 이미지 위치 조정: `left: 690px, top: 147px` (절대 위치)
  - 메가MGC커피 이미지 추가: `0312_megacoffee.png` (250px, 하단 정렬)
  - 치킨 이미지 추가: `0312_chicken.png` (w-80 h-72, 하단 정렬, 회전 제거)
  - 피자 이미지 추가: `0312_pizza.png` (w-96 h-72, left: 520px)
- ✅ 폰트 크기 통일 (24px)
  - "사전등록자 추첨 100명" 텍스트: 28px → 24px
  - "Q&A 세션에서 좋은 질문을 해주신 분들 중 추첨을 통해" 텍스트: 28px → 24px
  - "웨비나 참여 후 설문조사를 작성해주신 분들 중 추첨을 통해" 텍스트: 28px → 24px
  - "적극적으로 참여해주시는 분들에게 소정의 상품을 드립니다." 텍스트: 30px → 24px
  - "BBQ 기프티콘", "도미노피자 기프티콘", "을 드립니다." 텍스트: 28px → 24px
  - "키워트 인사이트 웨비나 주의사항" 및 "문의 사항" 설명 텍스트: 30px → 24px
- ✅ 푸터 로고 추가
  - 하단 `bg-neutral-800` div에 `kewert_logo-w.png` 이미지 추가
  - 가운데 정렬 (flex items-center justify-center)
  - 높이: h-8
- ✅ 중복 텍스트 제거
  - "사전 등록 이벤트" 중복 텍스트 제거
- ✅ 이미지 위치 및 크기 조정
  - 피자 이미지 위치 조정: `md:top-[41px]` → `md:top-[10px]` (위로 이동)
  - 치킨 이미지 위치 조정: `md:bottom-[-20px]` → `md:bottom-[-50px]` (위로 이동)
  - 치킨 이미지 크기 확대: `md:w-80 md:h-72` → `md:w-96 md:h-80`
  - 피자 이미지 크기 확대: `md:w-96 md:h-72` → `md:w-[400px] md:h-80`
  - 노란색 원 인라인 스타일 추가: `style={{ left: '214px', top: '16px' }}`
- ✅ EVENT 3 카드 모바일 최적화
  - 모바일에서도 1줄 2칸 배치: `flex-col md:flex-row` → `flex-row`
  - 모바일 높이 고정: `h-[120px]` (기존 164px → 120px로 축소)
  - 모바일 패딩 축소: `p-5` → `p-3`
  - 모바일 간격 축소: `gap-5` → `gap-2`
  - 모바일 이미지 크기 축소: `w-16 h-16` → `w-12 h-12`
  - 모바일 텍스트 크기 축소: `text-sm` → `text-xs`
  - 모바일 줄간격 축소: `leading-5` → `leading-4`
  - 모바일 이미지 위치 조정: `-mt-2` 추가 (위로 이동)
- ✅ 이미지 업로드 스크립트 생성
  - `scripts/upload-0312-icon-6-v2-image.ts`: 선물 아이콘 이미지 업로드
  - `scripts/upload-0312-icon-6-image.ts`: 선물 아이콘 이미지 업로드
  - `scripts/upload-0312-megacoffee-image.ts`: 메가MGC커피 이미지 업로드
  - `scripts/upload-0312-chicken-image.ts`: 치킨 이미지 업로드
  - `scripts/upload-0312-pizza-image.ts`: 피자 이미지 업로드
  - `scripts/upload-kewert-logo-w-image.ts`: 푸터 로고 이미지 업로드
  - `scripts/upload-0312-icons-78-image.ts`: 아이콘 7, 8 이미지 업로드
- ✅ 수정된 파일
  - `app/event/[slug]/components/Event722895Landing.tsx`: 이미지 위치/크기 조정, 모바일 최적화, 레이아웃 개선

## [2026-02-09] 이벤트 생성 시스템 개선 및 대시보드 UI 개선
- ✅ 이벤트 생성 폼 개선
  - 제목 필드 추가 (`title` 컬럼)
  - 코드 자동 생성 기능 추가 (비워두면 6자리 숫자 자동 생성)
  - 캠페인 기간 필드 추가 (시작일/종료일, 필수)
  - 이벤트 날짜 필드 추가 (단일/기간 선택 가능)
  - 모든 모듈 옵션 추가 (등록, 설문, 웨비나, 이메일, UTM, 온디맨드)
- ✅ 데이터베이스 마이그레이션 적용
  - `009_add_title_to_events.sql`: `title` 컬럼 추가
  - `010_add_date_fields_to_events.sql`: 캠페인 기간 및 이벤트 날짜 필드 추가
  - MCP Supabase를 사용하여 마이그레이션 적용 완료
- ✅ 대시보드 UI 개선
  - 이벤트 목록에서 슬러그 대신 제목 표시
  - 모든 모듈 배지 표시 (온디맨드, 이메일, UTM 포함)
  - 캠페인 날짜와 이벤트 날짜 표시 (한국어 형식)
- ✅ 워트인텔리전스 이벤트 생성
  - "미래를 선점하는 기업의 비밀" 이벤트 생성 (코드: 722895)
  - 캠페인 기간: 2026-02-09 ~ 2026-03-13
  - 이벤트 날짜: 2026-03-12 (단일)
- ✅ 코드 185044 이벤트 날짜 업데이트
  - 캠페인 기간: 2026-02-09 ~ 종료 미정
  - 이벤트 날짜: 2026-02-09 (오늘)

## [2026-02-09] 온디맨드 시청 세션 추적 시스템 구현 완료
- ✅ 데이터베이스 마이그레이션 적용
  - `003_event_visits_add_session_id.sql`: `event_visits` 테이블에 `session_id` 컬럼 추가 (D-OD-9)
  - `004_event_playback_sessions.sql`: `event_playback_sessions` 테이블 생성 (D-OD-3 반영, RLS 정책 포함)
  - MCP Supabase를 사용하여 마이그레이션 적용 완료
- ✅ API 엔드포인트 구현
  - `/api/inev/events/[eventId]/ondemand/sessions/start`: 세션 시작 (D-OD-3, D-OD-9 반영)
  - `/api/inev/events/[eventId]/ondemand/sessions/ping`: Heartbeat (D-OD-3, D-OD-4, D-OD-7 반영)
  - `/api/inev/events/[eventId]/ondemand/sessions/end`: 세션 종료 (D-OD-3, D-OD-5 반영)
- ✅ Visit API 수정
  - `app/api/inev/visits/route.ts`: `session_id` 저장 로직 추가 (D-OD-9)
  - `app/event/[slug]/VisitLogger.tsx`: `session_id` 전달 로직 추가
- ✅ 클라이언트 Heartbeat 구현
  - `app/event/[slug]/ondemand/page.tsx`: 세션 시작/종료 및 heartbeat 로직 구현
  - 45초 간격 heartbeat (120초 cap, 30초 throttle)
  - 재생 상태 추적 (`is_playing`)
  - Visibility API 연동 (hidden 시 스킵)
  - `beforeunload`/`pagehide` 이벤트 처리
- ✅ 비디오 플레이어 컴포넌트 개선
  - `components/media/YouTubePlayer.tsx`: `onPlayingStateChange` 콜백 및 `playerRef` prop 추가
  - `components/media/VimeoPlayer.tsx`: `onPlayingStateChange` 콜백 및 `playerRef` prop 추가
- ✅ 설계 문서 작성
  - `docs/inev/온디맨드_시청_세션_설계.md`: 확정 결정 10개 반영 완료
- ✅ 테스트 완료
  - jubileo@naver.com 계정으로 테스트 완료
  - Visit 기록, Playback Session 생성, Heartbeat 전송, 세션 종료 모두 정상 작동 확인

## [2026-02-09] 로그인 및 대시보드 성능 최적화
- ✅ 관리자 로그인 속도 개선
  - 슈퍼 관리자 빠른 경로 추가: JWT `app_metadata.is_super_admin` 확인으로 DB 쿼리 생략, 즉시 리다이렉트
  - 500ms 고정 대기 시간 제거: `signInWithPassword` 후 세션은 즉시 설정되므로 불필요한 대기 제거
  - 대시보드 API 최적화: 슈퍼 관리자는 JWT만으로 판단하여 DB 쿼리 생략
  - 예상 개선: 슈퍼 관리자 ~700-800ms 단축, 일반 사용자 ~500ms 단축
- ✅ 이벤트 로딩 및 대시보드 성능 개선
  - 이벤트 목록 페이지 SSR 전환: 클라이언트 사이드 fetch → 서버 컴포넌트로 변경하여 초기 로딩 시간 단축
  - 대시보드 쿼리 최적화: 목록 조회에 limit 50개 추가, 필요한 필드만 선택 (`select` 최적화)
  - 통계 카드용 count 쿼리 병렬 실행: 정확한 총 개수 표시를 위해 별도 count 쿼리 추가
  - 이벤트 API limit 파라미터 추가: 기본값 100개, 최대 500개로 제한하여 대량 데이터 조회 방지
  - 예상 개선: 이벤트 목록 ~200-300ms 단축, 대시보드 ~300-500ms 단축, API 응답 ~50-100ms 단축
- ✅ 수정된 파일
  - `app/login/page.tsx`: 슈퍼 관리자 빠른 경로 추가, 500ms 대기 제거
  - `app/api/auth/dashboard/route.ts`: 슈퍼 관리자 조기 반환 로직 추가
  - `app/inev-admin/clients/[clientId]/events/page.tsx`: 서버 컴포넌트로 전환, limit 100개 추가
  - `app/(client)/client/[clientId]/dashboard/page.tsx`: limit 50개 추가, 필드 선택 최적화, count 쿼리 병렬 실행
  - `app/api/inev/events/route.ts`: limit 파라미터 추가 (기본값 100개, 최대 500개)

## [2026-02-09] Phase 6 착수 전 문서 고정 작업
- ✅ Phase 4~5 테스트 보고서에 Baseline 고정 선언 추가
  - `docs/reports/inev_Phase4-5_테스트_결과_보고서.md` 상단에 "✅ Baseline 고정 선언" 섹션 추가
  - Phase 6 이후 회귀 기준선으로 사용, 롤백 조건 명시
  - 통과가 보장하는 것(Guarantees) 5개 항목 추가 (Email draft 저장/조회/테스트발송, Entry Gate 자동/수동 플로우 분기, Side effect 없음, Display name 규칙 고정, 스캐너/미리보기 꼬임 방지)
- ✅ 전체 구현 계획에 Entry Gate Policy Lock 추가
  - `docs/inev/inev_리빌딩_전체구현계획.md`의 Phase 5 섹션에 "Policy Lock — Entry Gate (Non-Negotiable)" 블록 추가
  - 링크 오픈만으로 side effect 금지, 버튼 클릭 시에만 실행, 표시이름 규칙 등 확정 정책 문서화
- ✅ 운영 명세서 생성 및 Phase 6 롤백 기준 추가
  - `docs/inev/inev.ai_개발_배포_운영_명세서.md` 파일 생성
  - "Phase 6 Rollback Triggers" 섹션 추가 (중복 로그인 "둘 다 튕김" 재현, Entry Gate side effect 발생, 표시이름 fallback, 핫패스 트래픽 증가, 운영 앱 긴급 수정 필요 시)
- ⚠️ Phase 6 섹션에 변경 금지/허용 범위, 중복 로그인 정책, Hotpath Guardrails 추가 (파일 수정 실패로 수동 추가 필요)
  - Phase 6에서 바꾸지 않는 것: Entry Gate 정책, 표시이름 규칙, /s → /entry → 버튼 플로우
  - Phase 6에서 바꾸는 것: Webinar 모듈 event 귀속, 중복 로그인 정책 구현, 핫패스 최적화
  - 중복 로그인 정책 고정: 정책/버그 정의/승자 기준 명시
  - Hotpath Guardrails: 실시간 화면에서 무거운 집계/AI 호출/DB 핫쿼리 금지, 폴링 주기 증가 금지

## [2026-02-08] Giveaway Broadcast 전환 및 Realtime 권한 점검 (P1 티켓)
- ✅ P1-티켓1: GiveawayWidget DB Changes 제거 → Broadcast 전환
  - `components/webinar/GiveawayWidget.tsx`: giveaways, giveaway_entries **postgres_changes 구독 제거**
  - `webinar:${webinarId}` 채널에서 **Broadcast만** 구독 (raffle:start, raffle:draw, raffle:done 수신 시 loadGiveaway 1회)
  - 참여자 수: 초기 로드·Broadcast 후 1회만 조회 (실시간 카운트 제거로 DB 부하 감소)
- ✅ P1-티켓2: Giveaway open/closed 시 Broadcast 추가
  - `app/api/webinars/[webinarId]/giveaways/[giveawayId]/route.ts`: status === 'open' 시 broadcastRaffleStart, status === 'closed' 시 broadcastRaffleDone 호출
- ✅ P1-티켓3: Realtime Broadcast 권한 정책 점검
  - 코드 감사: poll:open, raffle:draw 등 관리자 이벤트는 서버만 전송 (클라이언트 send 코드 없음)
  - 마이그레이션 104 적용: `realtime.messages` RLS (SELECT=인증 수신, INSERT=서버/운영자만)
  - 문서: `docs/Realtime_Broadcast_권한_점검.md`, `docs/메모_Realtime_Authorization_나중적용.md`
- 📌 **메모(나중에 할 것)**: Realtime Authorization **설정**은 나중에 점검해서 넣기로 함
  - 채널을 `config: { private: true }` 로 열고, 대시보드에서 Allow public access 끄면 RLS가 실제 적용됨
  - 적용 전에 참가자 발신 이벤트 `session_conflict`를 API 경유로 옮길지 검토 필요

## [2026-02-06] 웨비나 추첨 및 통계 기능 개선
- ✅ 사용자 지정 방식 추첨에 저장 기능 추가
  - `app/api/webinars/[webinarId]/giveaways/[giveawayId]/route.ts`: PUT 엔드포인트에 `manual_winners` 업데이트 기능 추가
  - `app/(admin)/webinar/[id]/console/components/GiveawayManagement.tsx`: DrawModal에 저장 버튼 및 저장 기능 구현
    - 사용자 지정 방식일 때만 "저장" 버튼 표시
    - 선택한 당첨자들을 `giveaways.manual_winners` 필드에 저장
    - 모달을 다시 열 때 저장된 당첨자 목록 자동 로드
    - 저장된 데이터는 계속 유지되어 나중에 추첨 실행 가능
- ✅ 접속 통계 시작 시간 변경 (1시간 전 → 2시간 전)
  - `app/(admin)/webinar/[id]/console/components/StatsTab.tsx`: 그래프 시작 시간을 웨비나 시작 2시간 전으로 변경
  - `app/(admin)/webinar/[id]/console/components/DashboardTab.tsx`: 대시보드 접속 통계 시작 시간 변경
  - `app/api/webinars/[webinarId]/stats/access/route.ts`: API 데이터 조회 시작 시간을 2시간 전으로 변경
  - 변수명 및 메시지 업데이트: `oneHourBeforeStart` → `twoHoursBeforeStart`, "1시간 전" → "2시간 전"

## [2026-02-05] HPE 온디맨드 페이지 모바일 최적화 완료
- ✅ 온디맨드 랜딩 페이지 모바일 최적화 (`OnDemandLandingPage.tsx`)
  - 히어로 섹션 높이 조정 (`max-sm:h-[242px]`)
  - HPE 로고 위치 조정 (`max-sm:top-3`)
  - 제목 이미지 크기 조정 (`max-sm:w-[85%] max-sm:max-w-[320px]`)
  - 컨테이너 반응형 너비 (`max-sm:max-w-[calc(100vw-1.5rem)]`)
  - 로그인 폼 섹션 패딩 조정 (`max-sm:px-4 max-sm:py-8`)
  - 입력 필드 및 버튼 터치 영역 확보 (`max-sm:min-h-[44px]`)
  - 푸터 높이 및 텍스트 위치 조정 (`max-sm:h-[50px]`)
- ✅ 온디맨드 등록 페이지 모바일 최적화 (`OnDemandRegisterPage.tsx`)
  - 랜딩 페이지와 동일한 모바일 최적화 적용
  - 등록 폼 섹션 모바일 최적화
- ✅ 온디맨드 세션 목록 페이지 모바일 최적화 (`OnDemandWatchPage.tsx`)
  - 히어로 섹션 높이 자동 조정 (`max-sm:h-auto max-sm:min-h-[400px]`)
  - HPE 로고 및 제목 간격 조정
  - Info Box 모바일 최적화 (티켓 아이콘 인라인 배치)
  - 세션 카드 너비 조정 (`max-sm:max-w-[calc(100vw-2rem)]`)
  - 세션 카드 제목 한 줄 표시 (`max-sm:hidden` on `<br />`)
  - Market Analysis 섹션 폰트 크기 조정 (`max-sm:text-2xl`)
  - 스크롤 제거 (`max-sm:overflow-visible`)
- ✅ 온디맨드 플레이어 페이지 모바일 최적화 (`OnDemandPlayerPage.tsx`)
  - 히어로 섹션 높이 조정 (`max-sm:min-h-[400px]`)
  - HPE 로고 위치 및 크기 조정 (`max-sm:left-4 max-sm:top-3`)
  - 닫기 버튼 크기 조정 (`max-sm:w-8 max-sm:h-8`)
  - Shape Layer 모바일에서 숨김 (`max-sm:hidden`)
  - 홈 아이콘 및 카테고리 텍스트 크기 조정
  - 비디오 플레이어 위치 조정 (`max-sm:relative max-sm:top-0`)
  - 설명 텍스트 및 발표자 소개 레이아웃 조정
  - Info Box 모바일 구성 변경 (메인 페이지와 동일: 티켓 아이콘 인라인, 아이콘 가로 배치)
  - 푸터 높이 및 텍스트 위치 조정
- ✅ 주요 개선사항
  - 모든 페이지에서 `max-sm:` 브레이크포인트 사용 (모바일 전용)
  - 태블릿 및 PC 버전은 변경 없음
  - 인라인 스타일을 Tailwind 클래스로 변환하여 모바일 오버라이드 가능하도록 개선
  - 터치 영역 최소 44px 확보
  - 스크롤 문제 해결

## [2026-02-05] HPE 온디맨드 플레이어·설문조사 개선
- ✅ 온디맨드 플레이어 페이지 UI 정리
  - 히어로 섹션 1600×928 고정, 영상 1070×602
  - 발표자 소개 박스 112×32, 텍스트 왼쪽 라인 정렬, 간격 조정
  - 플레이어–설명 간격, 푸터·배경색 #171F32 통일
  - Info Box 구분선 183px 간격, 미팅/설문 구역 가운데 정렬
  - 온/오프라인 미팅 신청 클릭 시 새창 (juniper-meeting-maker 링크)
- ✅ 온디맨드 설문조사 추가 (웨비나 설문 로직 준수)
  - 설문조사 클릭 시 인페이지 팝업(모달)
  - `OnDemandSurveyModal`: HPE 데이터센터 5문항 단일 선택, 이름·회사명·휴대폰
  - `POST /api/public/ondemand/[id]/survey/submit`: 전화번호 1인 1회, survey_no/code6 발급
  - DB: `ondemand_survey_responses` (마이그레이션 086, Supabase MCP 적용)
  - OnDemandPlayerPage·OnDemandWatchPage 양쪽에 모달 연동
- ✅ 설문 모달 UI
  - 배경 흰색, 텍스트/입력 필드 진한 색으로 가독성 확보
  - 모든 항목 필수, 필수 표시 `*` 빨간색(`text-red-500`)
  - 회사명 필수 검증 추가

## [2026-02-04] 이메일 발송 시스템 에러 해결 및 크론 작업 설정
- ✅ 이메일 발송 시스템 jsdom ESM 에러 해결
  - `lib/email/markdown-to-html.ts`: `isomorphic-dompurify`를 `sanitize-html`로 교체
  - `markdownToHtml` 함수를 동기 함수로 변경 (async/await 제거)
  - `next.config.ts`: `serverExternalPackages` 설정 제거 (더 이상 필요 없음)
  - `app/api/client/emails/[id]/test-send/route.ts`: `markdownToHtml` 호출 시 await 제거
  - `lib/email/send-campaign.ts`: `markdownToHtml` 호출 시 await 제거
  - `components/email/EmailCampaignTab.tsx`: `handlePreview` 함수를 동기 함수로 변경
  - Vercel 프로덕션 환경에서 정상 작동 확인 (405/500 에러 해결)

## [2026-02-03] 이메일 캠페인 시스템 구현 완료
- ✅ 이메일 제작/발송 대시보드 구현 (`이메일발송시스템_확정명세서.md` 기반)
  - **데이터베이스 마이그레이션**: `supabase/migrations/083_create_email_campaigns.sql`
    - `email_campaigns` 테이블: 캠페인 초안/발송 단위 관리
    - `email_runs` 테이블: 실행 로그 (generate/test_send/send)
    - `email_send_logs` 테이블: 개별 발송 로그 (중복 방지, dedupe_key)
    - `clients.email_policy_json` 컬럼: 클라이언트별 발송 정책 (from_domain, reply_to 등)
  - **이메일 프로바이더**: Resend 통합 (`lib/email/resend.ts`)
  - **상태 전이**: `draft` → `ready` → `sending` → `sent`/`failed` (승인 취소: `ready` → `draft`)
  - **권한 관리**: `owner`/`admin`/`operator`만 편집/승인/발송 가능, `analyst`/`viewer`는 조회만
- ✅ 이메일 캠페인 생성 API (`/api/client/emails/generate`)
  - 웨비나/등록캠페인/설문캠페인 단위로 캠페인 생성
  - 캠페인 유형: `reminder_d1`, `reminder_h1`, `confirmation`, `custom`
  - AI 기반 초안 생성 (템플릿 변수 자동 추출)
  - 대상자 쿼리 자동 설정 (`audience_query_json`)
- ✅ 이메일 캠페인 편집/관리 UI (`components/email/EmailCampaignTab.tsx`)
  - 마크다운 편집기 (제목/본문)
  - 템플릿 변수 미리보기 (`{{변수명}}` 형식)
  - 대상자 미리보기 및 선택적 발송 (특정 이메일만 선택 가능)
  - 헤더 이미지/푸터 텍스트 설정
- ✅ 테스트 발송 API (`/api/client/emails/[id]/test-send`)
  - 최대 10개 이메일 주소로 테스트 발송
  - `ready` 상태에서만 테스트 발송 가능
  - 템플릿 변수 치환 및 개인화 (이름, 이메일, 입장 링크 등)
- ✅ 실제 발송 API (`/api/client/emails/[id]/send`)
  - 원자적 lock으로 중복 발송 방지 (`ready` → `sending`)
  - 배치 발송 (기본 50개씩, 0.5초 간격, 환경변수로 조정 가능)
  - 동시 요청 수 제한 (기본 10개, `EMAIL_MAX_CONCURRENT`)
  - 개별 발송 로그 기록 (`email_send_logs`, dedupe_key로 중복 방지)
  - 실패율 50% 이상 시 `failed` 상태, 그 외는 `sent` 상태
- ✅ 승인/취소 API
  - `/api/client/emails/[id]/approve`: `draft` → `ready` (발송 준비 완료)
  - `/api/client/emails/[id]/cancel-approval`: `ready` → `draft` (재편집 가능)
  - `/api/client/emails/[id]/cancel`: `ready` → `canceled` (발송 중단, 재승인 불가)
- ✅ 발송 정책 관리 (`/api/client/emails/policy`)
  - 클라이언트별 발송 도메인/Reply-To 설정
  - 캠페인별 override 지원 (캠페인 설정 우선)
- ✅ 템플릿 변수 처리 (`lib/email/template-processor.ts`)
  - `{{변수명}}` 형식의 템플릿 변수 치환
  - 개인화 변수: `{{name}}`, `{{email}}`, `{{entry_url}}` 등
  - 이벤트 변수: `{{title}}`, `{{date}}`, `{{url}}` 등
- ✅ 마크다운 → HTML 변환 (`lib/email/markdown-to-html.ts`)
  - `marked`로 마크다운 파싱
  - `sanitize-html`로 XSS 방지
  - 헤더 이미지/푸터 텍스트 자동 삽입
  - HTML/텍스트 형식 모두 생성 (Resend 전송용)
- ✅ 대상자 쿼리 시스템 (`lib/email/audience-query.ts`)
  - 웨비나 등록자 조회 (`webinar_registrants`)
  - 등록캠페인 참여자 조회 (`registration_campaign_participants`)
  - 설문캠페인 참여자 조회 (`survey_campaign_participants`)
  - 입장 여부 필터링 (`exclude_entered` 옵션)
- ✅ 발송 로그 및 통계
  - `email_send_logs`: 개별 발송 성공/실패 로그
  - `email_runs`: 캠페인 실행 로그 (총 발송 수, 성공/실패 수)
  - `audit_logs`: 감사 로그 (`EMAIL_CAMPAIGN_GENERATE`, `EMAIL_CAMPAIGN_SEND` 등)
- ✅ 고착 상태 복구 (`/api/client/emails/[id]/reset-stuck`)
  - `sending` 상태가 1시간 이상 지속 시 자동/수동 복구
  - `failed` 상태로 전이하여 재발송 가능하도록 처리
- ✅ 가입하지 않은 사용자 로그인 무한루프 방지
  - `app/api/auth/dashboard/route.ts`: 프로필이 없는 경우 `NOT_REGISTERED` 에러 반환 (403 상태)
  - `app/login/page.tsx`: `NOT_REGISTERED` 에러 감지 시 알림 표시, 로그아웃, 메인 페이지로 리다이렉트
  - 가입되지 않은 계정으로 로그인 시도 시 무한루프 방지
- ✅ 크론 작업 마이그레이션 적용
  - `supabase/migrations/079_create_marketing_stats_daily.sql`: 마케팅 통계 일일 집계 테이블 생성
  - `supabase/migrations/080_fix_cvr_precision.sql`: CVR 정밀도 수정
  - MCP Supabase `execute_sql` 도구를 사용하여 마이그레이션 적용 완료
  - `/api/cron/aggregate-marketing-stats` 크론 작업 정상 작동 확인
- ✅ 크론 작업 인증 설정
  - `CRON_SECRET` 환경 변수 생성 및 Vercel에 설정 안내
  - `/api/cron/webinar-access-snapshot` 크론 작업 인증 정상 작동 확인 (HTTP 204)
  - 중복 키 에러는 정상 동작 (idempotency 보장을 위한 처리)

## [2026-02-03] 온디맨드 웨비나 등록 시스템 개선 및 사용자 등록
- ✅ 온디맨드 웨비나 등록 확인 API 개선
  - `app/api/ondemand/[id]/check-registration/route.ts`: `event_survey_entries`에 없으면 `registrations` 테이블도 확인하도록 수정
  - 온디맨드 웨비나 등록 인식 개선
- ✅ 등록 API 이메일 기반 중복 체크 추가
  - `app/api/public/event-survey/[campaignId]/register/route.ts`: 이메일 기반 중복 체크 추가 (이메일 중복 금지)
  - 이름은 중복 허용 (같은 이름으로 여러 명 등록 가능)
  - 이름이 "양승철2"인 경우 자동으로 "양승철"로 수정
- ✅ 온디맨드 웨비나 사용자 등록 스크립트 생성
  - `scripts/register-ondemand-user.ts`: 온디맨드 웨비나 사용자 등록 스크립트 생성
  - `scripts/fix-ondemand-name.ts`: 등록된 이름 수정 스크립트 생성
- ✅ 사용자 등록 완료
  - 최은진 (eun-jin.choi@hpe.com): HPE Webinar Series 온디맨드 웨비나 등록 완료
  - 양승철 (jubileo@naver.com): HPE Webinar Series 온디맨드 웨비나 등록 완료
- ✅ 빌드 에러 수정
  - `app/api/ondemand/[id]/check-registration/route.ts`: 중복 변수 정의 제거 (`emailLower`, `nameTrimmed`)
  - 빌드 성공 확인

## [2026-02-03] pd@ustudio.co.kr 계정을 UStudio 에이전시 계정으로 변경
- ✅ MCP Supabase를 사용하여 계정 권한 변경 완료
  - `pd@ustudio.co.kr` 계정의 슈퍼어드민 권한 제거 (`profiles.is_super_admin = false`)
  - `auth.users.raw_app_meta_data.is_super_admin = false` 업데이트 완료
  - UStudio 에이전시 (`b48534de-ec75-4473-8d68-9e2e3aae0ab1`)의 `owner` 역할로 설정 확인
- ✅ 빌드 에러 수정
  - `scripts/set-pd-as-agency.ts` 타입 에러 수정 (agencies 타입 단언 추가)
  - 빌드 성공 확인

## [2025-01-27] IP Insight ON 이미지 추가 및 히어로 섹션 간격 조정
- ✅ IP Insight ON 이미지 추가
  - 메인 페이지(`/event/149403`), 등록 페이지(`/event/149403/register`), 입장 페이지(`/webinar/149402`) 히어로 섹션에 IP Insight ON 이미지 추가
  - 로고 바로 아래, 제목 시작 전에 배치
  - 크기: 204x60px, 가운데 정렬
  - 이미지 Supabase 버킷에 업로드 완료 (`wert/ip_insight_on.png`)
- ✅ 히어로 섹션 간격 통일 및 조정
  - 입장 페이지: "고객사례로 알아보는" 텍스트와 제목 사이 간격 24px, 제목과 날짜 배지 사이 32px, 날짜 배지와 아래 내용 사이 32px
  - 등록 페이지: 동일한 간격 적용
  - 메인 페이지: 간격 조정 (제목-날짜 배지 8px, 날짜 배지-IP팀 텍스트 8px)
- ✅ 입장 페이지 제목 변경
  - 웨비나 제목을 "AI 특허리서치 실무 활용 웨비나"로 고정
  - "고객사례로 알아보는" 서브타이틀 추가
- ✅ "고객사례로 알아보는" 텍스트 폰트 크기 증가
  - 기본: 16px → 20px
  - 태블릿: 18px → 22px
  - 데스크톱: 32px → 36px
  - 모바일: 16px → 18px

## [2025-01-27] 웨비나 등록 페이지 폼 필드 개선 및 개인정보 활용 동의 상세화
- ✅ 웨비나 등록 페이지(`/event/149403/register`) 폼 필드 재구성
  - 필수 필드: 이름*, 이메일*, 휴대폰번호*, 소속*, 부서*, 직함*, 연차(경력)*, 개인정보 활용 동의*
  - 선택 필드: 웨비나와 관련하여 궁금한 사항을 기재해 주세요. (주관식 textarea)
  - 커뮤니케이션 동의 섹션(이메일/전화번호) 제거
- ✅ 개인정보 활용 동의 섹션 상세화
  - 주식회사 워트인텔리전스 개인정보 수집 및 이용 안내 문구 추가
  - 수집 항목: 이름, 이메일, 휴대폰번호, 소속, 부서, 직함, 연차(경력)
  - 수집 및 이용목적: 참가자 혜택 제공(서비스 안내 등)
  - 보유 및 이용기간: 동의 철회까지
  - 동의 거부 권리 및 불이익 안내 문구 추가
  - 체크박스에서 라디오 버튼으로 변경: "네, 동의합니다." / "아니요, 동의하지 않습니다."
  - "네, 동의합니다." 선택 시에만 등록 가능하도록 검증 로직 추가
- ✅ 데이터베이스 스키마 문서화
  - `registration_data` JSONB 필드 구조 업데이트 마이그레이션 생성 (`062_update_registration_data_fields.sql`)
  - Supabase에 마이그레이션 적용 완료
- ✅ 빌드 성공 확인

## [2025-01-27] 원프레딕트 이벤트 숨김 처리 및 등록 완료 메시지 개선
- ✅ 원프레딕트 웨비나 페이지(`/webinar/426307`) 숨김 처리
  - `/webinar/426307` 접근 시 `/webinar/426307/register`로 자동 리다이렉트
  - `app/(webinar)/webinar/[id]/page.tsx`에서 426307 감지 시 등록 페이지로 리다이렉트 처리
- ✅ 원프레딕트 등록 페이지 완료 메시지 개선
  - 등록 완료 후 "등록이 완료되었습니다" 메시지 표시
  - 폼 숨김 처리 후 완료 메시지만 표시되도록 수정
  - 페이지 이동 없이 완료 메시지로 종료
- ✅ 빌드 에러 수정
  - 중복된 import 제거 (`redirect`, `notFound`)
  - 사용하지 않는 코드 블록 주석 처리

## [2025-01-27] 웨비나 로고 업데이트 및 모바일 간격 조정
- ✅ WERT Intelligence 로고 업데이트
  - 새로운 CI 로고 이미지(`wert_CI.png`) Supabase 버킷에 업로드
  - `kewert_logo-w.png` 파일 교체 완료
  - 업로드 스크립트 `scripts/upload-wert-ci-logo.ts` 생성
- ✅ 모바일 로고-제목 간격 조정
  - 웨비나 등록 페이지(`/event/149403/register`) 모바일에서 로고와 제목 사이 간격 16px 추가
  - 웨비나 시청 페이지(`/webinar/149402`) 모바일에서 로고와 제목 사이 간격 16px 추가
  - PC는 변경 없음

## [2025-01-27] 웨비나 시청 페이지 세션 소개 접기/펼치기 기능
- ✅ 모바일에서만 세션 소개 접기/펼치기 적용
  - 모바일에서만 접기/펼치기 버튼 표시 (`lg:hidden`)
  - PC에서는 항상 표시 (`hidden lg:block`)
  - 기본값: 접힘 상태 (모바일)
  - `isMobile` state 추가하여 화면 크기 감지
- ✅ 빌드 에러 수정
  - 중복된 세션 소개 섹션 제거
  - JSX 구조 정리 및 닫는 태그 수정

## [2025-01-27] 웨비나 입장 페이지 히어로 섹션 개선 및 안내 문구 추가
- ✅ 웨비나 입장 페이지(`/webinar/149402`) 히어로 섹션 구조 개선
  - 메인 페이지(`/webinarform/wert`) 및 등록 페이지(`/event/149403/register`)와 동일한 구조로 통일
  - 전체 너비 배경 적용 (`width: 100vw`, `margin-left/right: calc(-50vw + 50%)`)
  - 배경 이미지 `bg2.png` 적용
  - 헤더 높이: 모바일 56px, 데스크톱 112px
  - 히어로 섹션 위아래 간격: 모든 화면 크기에서 150px로 통일
  - 그라데이션 오버레이 추가
  - 컨텐츠 영역 padding 반응형 적용 (모바일 16px, 태블릿 24px, 데스크톱 72px)
- ✅ 웨비나 입장 페이지 안내 문구 추가
  - 제목 "웨비나 입장" 바로 아래에 안내 문구 추가
  - 문구: "웨비나 등록 시 입력했던 이름과 이메일 주소를 작성하시면 입장됩니다."
  - 제목과 안내 문구 간격 최소화 (제목 `margin-bottom: 0`, 안내 문구 `margin-top: 0`)
  - 폰트 크기: 데스크톱 14px, 모바일 12px
  - 중앙 정렬, 회색 텍스트 적용

## [2025-01-27] 웨비나 프로젝트명 필드 추가 및 OnePredict 페이지 개선
- ✅ 웨비나 콘솔 설정에 프로젝트명 필드 추가
  - 데이터베이스 마이그레이션: `060_add_project_name_to_webinars.sql` 생성 및 실행
  - `webinars` 테이블에 `project_name` 필드 추가
  - SettingsTab에 프로젝트명 입력 필드 추가 (웨비나 제목 위에 배치)
  - API 라우트에서 `project_name` 저장/업데이트 처리
  - 대시보드에서 `project_name` 표시 (없으면 `title` 사용)
- ✅ 웨비나 생성 시 기본 옵션 개선
  - 제목이 없으면 프로젝트명을 제목으로 사용
  - 프로젝트명이 없으면 제목을 프로젝트명으로 사용 (기본값)
  - 웨비나 생성 페이지에 프로젝트명 필드 추가
- ✅ OnePredict 웨비나 페이지 개선
  - 메인 제목 두 줄 표시: "산업 AI의 미래," 다음 줄바꿈 후 "원프레딕트가 제안하는 가동 효율의 극대화"
  - 이미지 버킷 업로드: `thumb1.jpg`, `thumb2.jpg`, `be6b22396f779.png` 업로드 완료
  - 모든 OnePredict 컴포넌트의 이미지 경로를 버킷 URL로 변경
- ✅ 메타 링크 설정
  - 제목: "산업 AI의 미래: 가동 효율 극대화 전략"
  - 소개글: "원프레딕트 GuardiOne® 기반 설비 관리 혁신 및 DX 성공 전략 공개"
  - 썸네일: `thumb2.jpg` (버킷 URL)
- ✅ 빌드 오류 수정
  - TypeScript 타입 오류 수정 (`query.value` 문자열 비교)
  - `webinar` null 체크 추가
  - `handleRegistration` 함수 추가

## [2025-01-26] 사이드바 완전 제거 및 통계 기능 개선
- ✅ 사이드바 기능 완전 제거
  - `NEXT_PUBLIC_USE_TOP_NAV` 환경 변수 제거
  - `LayoutWrapper.tsx`에서 사이드바 관련 코드 제거, 항상 TopNav 사용
  - `app/(super)/super/layout.tsx`에서 SuperSidebar 제거
  - 사이드바 없이 TopNav만 사용하도록 전환 완료
- ✅ 웨비나 통계 페이지에 설문조사 통계 추가
  - `/api/webinars/[webinarId]/stats/survey` API 생성
  - 웨비나의 `registration_campaign_id`로 연결된 설문조사 캠페인 통계 조회
  - 통계 탭에 설문조사 통계 섹션 추가 (완료 수, 스캔 완료 수, 경품 기록 수)
- ✅ 웨비나 대시보드 탭 간소화
  - 대시보드 탭: 간단한 통계 요약만 표시 (차트 제거)
  - 통계 탭: 상세 통계와 차트 표시
- ✅ 설문조사 캠페인 상세 페이지에 통계 탭 추가
  - `app/(client)/client/[clientId]/surveys/[campaignId]/components/tabs/StatsTab.tsx` 생성
  - 기본 통계 (완료 수, 스캔 완료 수, 경품 기록 수)
  - 시간대별 완료 추이 차트
  - 문항별 통계 (선택형: 파이 차트, 텍스트형: 답변 목록)
  - 날짜 범위 필터 기능 (전체/오늘/최근 7일/최근 30일)
- ✅ 프로필 설정 페이지 폼 중첩 오류 수정
  - 비밀번호 변경 폼을 프로필 수정 폼 밖으로 분리
  - HTML 중첩 오류 해결
- ✅ API 라우트 인증 문제 수정
  - `/api/profile/update`, `/api/profile/change-password`에서 `requireAuth()` 대신 직접 인증 확인
  - `NextRequest`를 사용하여 쿠키 직접 읽기
  - 클라이언트 fetch에 `credentials: 'include'` 추가

## [2025-01-XX] 이벤트 등록 페이지 기능 구현 완료
- ✅ 등록 페이지 컴포넌트 구현
  - `app/event/[...path]/components/RegistrationPage.tsx`: 공개 등록 페이지 (상세 폼)
    - 이메일, 이름, 성, 직책, 회사명, 우편번호, 시/도, 나라/지역, 전화번호, 커스텀 질문 필드
    - 커뮤니케이션 동의 (이메일/전화번호), 개인정보취급방침 동의
    - 등록 확인 모드 지원 (lookup=true)
  - `app/event/[...path]/components/RegistrationModal.tsx`: 등록 모달 컴포넌트 (간단한 폼)
  - `app/event/[...path]/components/WelcomePage.tsx`: 환영 페이지에 등록 페이지 타입 지원 추가
    - 등록 페이지일 때 헤더 이미지 위에 "등록하기" 버튼 오버레이 표시
- ✅ 등록 페이지 생성 페이지 구현
  - `app/(client)/client/[clientId]/registrations/new/page.tsx`: 등록 페이지 캠페인 생성 UI
    - 제목, 공개 경로, 호스트, 상태 설정
    - type='registration'으로 캠페인 생성
- ✅ 등록 API 구현
  - `app/api/public/event-survey/[campaignId]/register/route.ts`: 공개 등록 API
    - 기본 정보 등록 (이름, 회사명, 전화번호)
    - 상세 등록 정보 지원 (registration_data JSONB)
    - 중복 등록 방지 (phone_norm 기준)
    - survey_no 자동 발급 및 동시성 제어
- ✅ 데이터베이스 스키마 확장
  - `supabase/migrations/044_add_type_to_event_campaigns.sql`: 캠페인 타입 컬럼 추가
    - type: 'survey' | 'registration'
    - 인덱스 추가 (type, type+status 복합 인덱스)
  - `supabase/migrations/045_add_registration_fields_to_entries.sql`: 등록 상세 정보 필드 추가
    - registration_data JSONB 컬럼 추가
    - GIN 인덱스 추가 (검색 성능 향상)
- ✅ 이벤트 라우팅 확장
  - `app/event/[...path]/page.tsx`: 등록 페이지 라우팅 지원
    - `/event/{public_path}/register` 경로에서 등록 페이지 렌더링
    - type='registration'인 캠페인만 등록 페이지 접근 가능
- ✅ 주요 기능
  - 등록 페이지와 설문조사 페이지 분리 (type 기반)
  - 상세 등록 정보 수집 (이메일, 주소, 직책 등)
  - 등록 확인 기능 (이름+전화번호로 조회)
  - 완료 페이지 공유 (survey_no, code6)

## [2025-01-XX] 설문 문항 업데이트 스크립트 개선 및 문항 교체
- ✅ 설문 문항 업데이트 스크립트 개선 (`scripts/update-survey-questions.ts`)
  - public_path 정규화 로직 추가 (슬래시 포함/미포함 모두 지원)
  - 캠페인 조회 시 여러 경로 형식 시도하여 안정성 향상
- ✅ 설문 문항 교체 (캠페인: 345870)
  - 기존 문항 3개 삭제
  - 새로운 문항 5개 추가:
    1. 현재 네트워크 프로젝트 계획이 있으시다면 언제입니까? (단일 선택, 필수)
    2. 향후 네트워크 프로젝트 계획이 있으시다면, 다음 중 어떤 영역에 해당합니까? (다중 선택)
    3. 해당 프로젝트에 대한 예산은 이미 확보되어 있습니까? (단일 선택)
    4. 예정된 프로젝트에서 귀하의 역할은 의사결정 권한이 있는 구매 담당자(Authorized Buyer)입니까? (단일 선택)
    5. HPE의 네트워크 솔루션에 대해 보다 더 자세한 내용을 들어 보실 의향이 있으십니까? (단일 선택, 필수)

## [2025-01-XX] 접속중 탭 관리자 전용화
- ✅ 접속중 탭 추가 및 관리자 전용 설정
  - 채팅/Q&A 탭에 "접속중" 탭 추가 (관리자 모드일 때만 표시)
  - 화면 상단 PresenceBar를 관리자만 볼 수 있도록 수정
  - 일반 참가자는 접속중 정보를 전혀 볼 수 없도록 제한
  - 모바일과 데스크톱 모두에 적용

## [2025-01-XX] Q&A 및 UI 개선
- ✅ 로딩 메시지 애니메이션 추가
  - 채팅창과 Q&A 창의 "불러오는 중..." 메시지에 점 애니메이션 추가
  - `app/globals.css`에 `loading-dots` 키프레임 애니메이션 추가
  - 각 점이 0.2초 간격으로 순차적으로 나타났다 사라지는 효과
- ✅ 콘솔 페이지에 "관리자 접속" 버튼 추가
  - 콘솔 헤더에 "관리자 접속" 버튼 추가
  - 클릭 시 `/webinar/${webinarId}/live?admin=true`로 이동하여 바로 라이브 페이지 접속
- ✅ Q&A 답변 자동 펼치기 기능 제거
  - `loadQuestions`에서 답변이 있는 질문 자동 펼치기 로직 제거
  - UPDATE 이벤트에서 답변 추가 시 자동 펼치기 로직 제거
  - 접기/펼치기는 사용자가 수동으로만 제어 가능
- ✅ 관리자 모드 질문 핀 기능 추가
  - 각 질문의 시간 옆에 작은 핀 버튼 추가 (관리자 모드일 때만 표시)
  - 핀 상태에 따라 아이콘 스타일 변경 (고정됨: 노란색, 고정 안 됨: 회색)
  - 클릭 시 `/api/questions/[questionId]` API를 호출하여 핀 상태 토글
- ✅ Q&A 필터 버튼 단순화
  - 필터를 "전체" / "내 질문" 두 개로 단순화
  - "미답변", "답변됨", "고정됨" 버튼 제거
  - 필터 타입을 `'all' | 'mine'`로 변경

## [2025-01-XX] Realtime 연결 안정성 근본 개선 (해결책.md 5가지 수정안 적용)
- ✅ A. CLOSED를 실패로 세지 않기 (수동 해제 구분)
  - `manualCloseRef` 플래그 추가
  - cleanup 시 수동 종료 플래그 설정
  - CLOSED 콜백에서 수동 종료인 경우 실패로 카운팅하지 않음
  - "SUBSCRIBED → (정상 cleanup) → CLOSED" 패턴이 실패로 누적되지 않음
- ✅ B. 구독 이펙트 의존성에서 `currentUser?.id` 제거
  - useEffect 의존성 배열에서 `currentUser?.id` 제거
  - presence 설정 제거 (채팅만 사용하므로 필수 아님)
  - 사용자 로딩 완료 시 의도치 않은 재구독 방지
  - 가장 큰 효과를 기대할 수 있는 수정안
- ✅ C. 헬스체크를 채널 상태 기준으로 변경
  - "이벤트 부재" 대신 "채널 상태"로 판단
  - `channel.state === 'joined'` 확인
  - 조용한 시간대에 불필요한 폴백 방지
- ✅ D. 폴백 폴링에서 증분 조회에 ETag 제거
  - `after=lastMessageId`가 있으면 ETag 미사용
  - 304 오인 방지
  - 폴백 시에도 빠른 메시지 수신
- ✅ E. 기존 채널 정리 로직 간소화
  - `getChannels()` 대신 `channelRef.current`만 확인
  - 우리가 만든 채널만 정리
  - 경합 상황 감소 및 안전성 향상
- ✅ 주요 개선사항
  - "SUBSCRIBED → 바로 CLOSED" 루프 완전 해소
  - 불필요한 폴백 활성화 방지
  - 폴백 시 지연 최소화
  - 코드 안정성 향상

## [2025-01-XX] 폴백 폴링 성능 최적화 및 Vercel 프록시 우회
- ✅ 폴백 폴링 지연 시간 대폭 단축
  - 헬스체크 대기 시간: 10초 → 3초
  - 헬스체크 주기: 5초 → 1초
  - 폴링 주기: 15초 → 2초 (지터 ±0.5초)
  - 초기 로드 후 대기: 10초 → 3초
  - 체감 지연 시간: 15초 → 3~5초로 약 70% 단축
- ✅ Vercel 프록시 우회 구현
  - 원본 Supabase URL(`*.supabase.co`) 직접 사용
  - 커스텀 도메인 감지 및 원본 URL 자동 전환
  - `NEXT_PUBLIC_SUPABASE_ORIGIN_URL` 환경 변수 지원
  - WebSocket 연결 안정화 (CLOSED 상태 반복 문제 해소)
- ✅ 주요 개선사항
  - 사용자 경험: 메시지 수신 지연 대폭 감소
  - 연결 안정성: Vercel 프록시를 거치지 않아 WebSocket 연결 유지
  - 성능: 폴링 주기 단축으로 실시간성 향상

## [2025-01-XX] Realtime 연결 안정성 개선 완료
- ✅ 재연결 로직 개선 (setTimeout cleanup)
  - `reconnectTimeoutRef`, `fallbackReconnectTimeoutRef` 추가
  - cleanup 함수에서 모든 타이머 취소
  - 메모리 누수 및 경쟁 상태 방지
- ✅ 기존 채널 정리 개선 (비동기 대기)
  - `await`를 사용하여 기존 채널 정리 완료 대기
  - 약간의 지연 추가 (100ms)로 정리 완료 보장
  - 중복 구독 방지
- ✅ Chat 컴포넌트 중복 렌더링 방지
  - 모바일/데스크톱에서 각각 다른 `key` prop 사용
  - 중복 구독 방지
- ✅ 채널 참조 관리 개선
  - `channelRef`를 사용하여 cleanup에서 채널 접근
  - 비동기 함수 구조 개선

## [2025-01-XX] Phase 1 - 멀티테넌시 코어 완료
- ✅ 데이터베이스 스키마 구현 (agencies, clients, profiles, memberships, webinars 등)
- ✅ RLS 정책 구현 및 최적화 (무한 재귀 문제 해결)
- ✅ 인증/권한 가드 시스템 (`lib/auth/guards.ts`)
- ✅ 슈퍼 관리자 에이전시 생성 API (`/api/agencies/create`)
- ✅ 기본 대시보드 스켈레톤

## [2025-01-XX] Phase 2 - 에이전시/클라이언트 대시보드 완료
- ✅ 에이전시 회원가입 (`/signup/agency`)
- ✅ 클라이언트 회원가입 (`/signup/client`, 초대 토큰 기반)
- ✅ 에이전시 대시보드 (`/agency/[agencyId]/dashboard`)
- ✅ 클라이언트 대시보드 (`/client/[clientId]/dashboard`)
- ✅ 클라이언트 생성/관리 (`/agency/[agencyId]/clients`)
- ✅ 클라이언트 초대 기능 (`/api/clients/invite`)
- ✅ 브랜딩 설정 (`/client/[clientId]/settings/branding`)
- ✅ 통계 리포트 (`/agency/[agencyId]/reports`)
- ✅ CSV 내보내기 (`/api/report/export`)
- ✅ 도메인 관리 (`/agency/[agencyId]/domains`)
- ✅ UI/UX 개선 (Tailwind CSS 적용)

## [2025-01-XX] Phase 3 - 웨비나 및 실시간 기능 (일부 완료)
- ✅ 웨비나 생성 (`/client/[clientId]/webinars/new`, `/api/webinars/create`)
- ✅ 웨비나 수정 (`/api/webinars/[webinarId]` PUT)
- ✅ 웨비나 삭제 (`/api/webinars/[webinarId]` DELETE)
- ✅ 웨비나 목록 (`/client/[clientId]/webinars`, `/api/webinars/list`)
- ✅ 웨비나 입장 페이지 (`/webinar/[id]`, `components/WebinarEntry.tsx`)
  - ✅ 로그인/회원가입 폼
  - ✅ 이메일 인증 안내 모달
  - ✅ 자동 리다이렉트 (인증 완료 후)
- ✅ 웨비나 시청 페이지 (`/webinar/[id]/live`)
  - ✅ YouTube 임베드 플레이어
  - ✅ 전체화면 기능 (브라우저 네이티브 Fullscreen API)
  - ✅ 반응형 레이아웃 (모바일: 영상 → 참여자 → 채팅 순서)
  - ✅ 4K 모니터 지원 (전체 너비 레이아웃, 채팅 패널 최대 너비 제한)
  - ✅ 세션 소개 섹션 (리액션 패널 대체)
  - ✅ 웨비나 자동 등록 (`/api/webinars/[webinarId]/register`)
- ✅ 실시간 채팅 (`components/webinar/Chat.tsx`)
  - ✅ 메시지 전송 (`/api/messages/create`)
  - ✅ Supabase Realtime 활성화 및 구독
  - ✅ Optimistic Update (프로필 이름 즉시 표시)
  - ✅ 메시지 DB 저장
  - ✅ 메시지 모더레이션 (숨김 기능)
  - ✅ 프로필 정보 조회 API (`/api/webinars/[webinarId]/messages`)
- ✅ Q&A 시스템 (`components/webinar/QA.tsx`)
  - ✅ 질문 등록 (`/api/questions/create`)
  - ✅ 질문 모더레이션 (`/api/questions/[questionId]` PATCH)
  - ✅ 실시간 질문 업데이트
- ✅ PresenceBar (`components/webinar/PresenceBar.tsx`)
  - ✅ 참여자 수 표시
  - ✅ 참여자 목록 표시
  - ✅ 중복 제거 로직 (Map 기반)
  - ✅ 프로필 정보 표시 개선 (API를 통한 프로필 조회)
  - ✅ 타이핑 표시 구조 (실제 동작은 추후 구현)
- ✅ 운영 콘솔 (`/webinar/[id]/console`)
  - ✅ Q&A 모더레이션 (`components/console/QAModeration.tsx`)
  - ✅ 채팅 관리 (`components/console/ChatModeration.tsx`)
  - ✅ 기본 레이아웃 및 탭 구조

## [2025-01-XX] 기술적 개선사항
- ✅ Next.js 15 호환성 (params, cookies() await 처리)
- ✅ RLS 무한 재귀 문제 해결 (Admin Supabase 사용, 애플리케이션 레벨 권한 체크)
- ✅ 에이전시 멤버 권한 확장 (클라이언트 대시보드 접근, 웨비나 생성 권한)
- ✅ 4K 모니터 레이아웃 최적화
- ✅ 모바일 반응형 레이아웃 개선
- ✅ Supabase Realtime 활성화 (messages, questions, quizzes 등 테이블)
- ✅ 프로필 정보 조회 API 엔드포인트 생성 (`/api/profiles/[userId]`)
- ✅ 프로필 RLS 정책 개선 (같은 웨비나/클라이언트/에이전시 사용자 프로필 읽기 허용)
- ✅ 실시간 채팅 Optimistic Update 개선 (프로필 이름 즉시 표시)
- ✅ 채널 구독 관리 개선 (고유한 채널 이름, cleanup 로직)

## [2025-01-XX] 채팅 시스템 대폭 개선
- ✅ `client_msg_id` 기반 정확한 Optimistic Update 매칭
- ✅ API 성공 즉시 UI 교체 (Realtime 대기 없이)
- ✅ 중복 전송 방지 (`client_msg_id` 기반)
- ✅ 타임아웃 처리 (10초, AbortController)
- ✅ 조건부 폴백 폴링 (지터 ±400ms, 가시성/오프라인 고려)
- ✅ 증분 폴링 지원 (`?after=<lastId>`)
- ✅ Realtime 토큰 자동 주입
- ✅ 고정 채널명 사용 (`webinar:${webinarId}:messages`)
- ✅ DELETE/UPDATE payload 검증
- ✅ 자동 재연결 로직 (지수 백오프)
- ✅ 데이터베이스 마이그레이션 (`012_add_client_msg_id_to_messages.sql`)
  - `client_msg_id` 칼럼 추가
  - 복합 인덱스 `(webinar_id, id)` 추가
  - 유니크 제약 조건 추가

## [2025-01-XX] 웨비나 페이지 레이아웃 개선
- ✅ 마진 제거 및 전체 너비 사용
- ✅ 최대 너비 1600px 제한 및 가운데 정렬
- ✅ 모바일 패딩 최소화 (px-0)
- ✅ 웨비나 페이지에서 Sidebar 제거 (LayoutWrapper 수정)

## [2025-01-XX] 관리자 모드 및 Q&A 기능 개선
- ✅ 관리자 모드 구현 (`?admin=true` URL 파라미터 또는 특정 이메일)
- ✅ 관리자 권한 확인 API (`/api/webinars/[webinarId]/check-admin`)
- ✅ 관리자 채팅 메시지 삭제 기능
- ✅ 관리자 질문 삭제 기능
- ✅ 관리자 질문 답변 기능 (답변 내용 저장)
- ✅ 참여자 질문 수정 기능 (자신의 질문만)
- ✅ 참여자 질문 삭제 기능 (자신의 질문만)
- ✅ 답변 표시 개선 (기본 펼침, 접기 기능)
- ✅ 답변 모달 닫기 방지 (답변 중일 때)
- ✅ 데이터베이스 마이그레이션 (`014_add_answer_to_questions.sql`)
  - `answer` 컬럼 추가 (TEXT 타입)
  - 답변 내용 인덱스 추가
- ✅ PresenceBar에 "접속 중: [계정명]" 표시 (관리자 모드 지원)
- ✅ 참여자 목록에서 현재 사용자 제외

## [2025-01-XX] 게스트 접속 및 웨비나별 독립 세션 관리
- ✅ 게스트 계정 생성 API (`/api/auth/guest`)
  - 닉네임만으로 익명 계정 생성
  - 웨비나별 자동 등록
  - 세션 토큰 반환
- ✅ 게스트 입장 UI (`WebinarEntry.tsx`)
  - 게스트 탭 추가 (access_policy가 'guest_allowed'인 경우)
  - 닉네임 입력 폼
  - 기존 세션 로그아웃 처리
- ✅ 웨비나별 독립 회원가입/등록 시스템
  - 회원가입 시 해당 웨비나에만 자동 등록
  - 기존 세션 확인 및 로그아웃 처리
  - 웨비나별 등록 확인 강제 (`/webinar/[id]/live`)
- ✅ 회원가입 시 닉네임 선택 기능
  - 닉네임 필드 추가 (선택사항)
  - 닉네임 미지정 시 이름으로 표기
- ✅ 웨비나별 세션 격리
  - 각 웨비나별 독립적인 등록 관리
  - 게스트 모드 사용 시 기존 세션 자동 로그아웃

## [2025-01-XX] UI/UX 개선 및 페이지 구조 개선
- ✅ 메인 페이지 UI 개선 (`app/page.tsx`)
  - "시작하기", "로그인" 버튼 제거
  - 현재 진행중인 웨비나 카드 표시
  - 웨비나 접근 정책 안내 (게스트 입장 가능 / 회원가입 필요)
  - 웨비나 카드 클릭 시 입장 페이지로 이동
- ✅ 관리자 접속 페이지 생성 (`/admin`)
  - EventFlow 소개 섹션
  - 로그인/회원가입 탭 전환
  - 역할 선택 페이지로 이동
  - 사이드바 제거, 최대 너비 1600px 제한
- ✅ 사이드바 모바일 반응형 (`components/layout/Sidebar.tsx`)
  - 데스크톱: 왼쪽 사이드바 (lg 이상)
  - 모바일: 하단 고정 메뉴 아이콘 (lg 미만)
  - 로그아웃 버튼 포함
- ✅ 로그아웃 기능 개선
  - 에러 처리 추가
  - 세션 삭제 확인
  - 메인 페이지로 리다이렉트
- ✅ 웨비나 제목 클릭 기능 (`WebinarView.tsx`)
  - 웨비나 제목 클릭 시 입장 페이지로 이동
  - 호버 효과 추가
- ✅ 헤더 UI 개선 (`components/layout/Header.tsx`)
  - 로그인/회원가입 버튼 제거
  - "관리자 접속" 버튼 추가

## [2025-01-XX] 기술적 개선사항
- ✅ 게스트 계정 세션 설정 개선
  - `signInWithPassword` 사용으로 세션 안정성 향상
  - 세션 확인 및 재시도 로직
- ✅ 메시지 조회 API 인증 개선 (`/api/webinars/[webinarId]/messages`)
  - `requireAuth()` 대신 직접 인증 확인 (Route Handler 호환)
  - 에러 로깅 개선
  - 게스트 계정 지원
- ✅ 웨비나 등록 확인 강제
  - 모든 모드에서 웨비나별 등록 확인
  - 등록되지 않은 웨비나 접근 차단
- ✅ Vercel 리전 설정 (`vercel.json`)
  - 싱가폴 리전 (`sin1`) 설정
  - Supabase 리전과 일치

## [2025-01-XX] 설문/퀴즈 통합 시스템 구현 완료
- ✅ 설문/퀴즈 통합 데이터베이스 스키마 (`015_create_forms_system.sql`)
  - `forms` 테이블 (kind: 'survey' | 'quiz')
  - `form_questions` 테이블
  - `form_submissions` 테이블
  - `form_answers` 테이블
  - `quiz_attempts` 테이블
- ✅ 설문/퀴즈 관리 API (`/api/webinars/[webinarId]/forms/*`)
  - 생성, 조회, 수정, 삭제
  - 상태 변경 (draft → open → closed)
  - 제출 처리 및 퀴즈 채점
  - 결과 조회 및 통계
- ✅ 설문/퀴즈 관리 UI (`FormManagement.tsx`)
  - 설문/퀴즈 생성 및 편집
  - 문항 관리 (단일 선택, 다중 선택, 텍스트)
  - 정답 키 설정 (퀴즈)
  - 결과 조회 모달
- ✅ 참여자 UI (`FormWidget.tsx`)
  - 설문/퀴즈 응답 폼
  - 퀴즈 정답 즉시 표시 (제출 후)
  - 제출 완료 메시지 자동 사라짐
- ✅ 팝업 시스템 구현
  - 세션 소개 탭에 버튼 배치
  - 팝업 모달로 설문/퀴즈/발표자료/추첨 표시
  - 자동 팝업 기능 (오픈된 항목 1회만)
- ✅ 성능 최적화 (`021_optimize_form_loading_indexes.sql`)
  - 병렬 쿼리 실행
  - 필요한 컬럼만 선택
  - 인덱스 추가 (form_submissions, forms)

## [2025-01-XX] 발표자료 다운로드 기능 구현 완료
- ✅ 파일 관리 데이터베이스 스키마 (`016_create_webinar_files.sql`)
  - `webinar_files` 테이블
  - Supabase Storage 연동
- ✅ 파일 관리 API (`/api/webinars/[webinarId]/files/*`)
  - 파일 업로드
  - 파일 목록 조회
  - 파일 다운로드 (서명된 URL)
  - 파일 삭제
- ✅ 파일 관리 UI (`FileManagement.tsx`)
  - 파일 업로드
  - 파일 목록 표시
  - 파일 삭제
- ✅ 참여자 UI (`FileDownload.tsx`)
  - 파일 목록 표시
  - 다운로드 버튼
  - 팝업 모달 통합

## [2025-01-XX] 추첨 기능 구현 완료
- ✅ 추첨 데이터베이스 스키마 (`017_create_giveaways.sql`)
  - `giveaways` 테이블
  - `giveaway_entries` 테이블
  - `giveaway_winners` 테이블
  - Commit-Reveal 패턴 지원 (seed_commit, seed_reveal)
- ✅ 추첨 관리 API (`/api/webinars/[webinarId]/giveaways/*`)
  - 추첨 생성
  - 추첨 목록 조회
  - 추첨 참여 (엔트리 생성)
  - 추첨 실행 (자동 seed 생성)
  - 추첨 결과 조회 (당첨자 이름 포함)
- ✅ 추첨 관리 UI (`GiveawayManagement.tsx`)
  - 추첨 생성 모달
  - 추첨 목록 표시
  - 상태 관리 (draft → open → closed → drawn)
  - 추첨 실행 애니메이션
  - 당첨자 이름 표시
- ✅ 참여자 UI (`GiveawayWidget.tsx`)
  - 추첨 참여 버튼
  - 참여자 수 실시간 표시
  - 당첨자 목록 표시
  - 팝업 모달 통합
- ✅ 추첨 애니메이션
  - 로딩 애니메이션 (슬롯머신 이모지)
  - 완료 애니메이션 (축하 이모지)
  - 당첨자 순차 표시 (fade-in-up)
  - 그라데이션 배경 및 펄스 효과

## [2025-01-XX] 운영 콘솔 개선
- ✅ 운영 콘솔 접근 권한 개선
  - 에이전시 관리자 (owner/admin) 접근 허용
  - 클라이언트 관리자 (owner/admin/operator) 접근 허용
- ✅ Q&A 모더레이션 개선 (`QAModeration.tsx`)
  - 답변 기능 추가
  - 실시간 업데이트
- ✅ 채팅 모더레이션 개선 (`ChatModeration.tsx`)
  - 삭제 기능 추가
  - 실시간 업데이트 (optimistic update)
- ✅ 콘솔 탭 구조 (`ConsoleView.tsx`)
  - 설문/퀴즈 관리 탭
  - 발표자료 관리 탭
  - 추첨 관리 탭

## [2025-01-XX] 슈퍼어드민 기능 구현 완료
- ✅ 슈퍼어드민 계정 생성 (`scripts/seed-super-admin.ts`)
  - JWT `app_metadata`에 `is_super_admin` 저장
  - "admin" 이메일 별칭 지원
- ✅ 슈퍼어드민 대시보드 (`/super/dashboard`)
  - 전체 통계 (에이전시, 클라이언트, 웨비나 수)
  - 최근 에이전시/클라이언트 목록
  - Admin Supabase 사용으로 성능 최적화
- ✅ 에이전시 관리 페이지 (`/super/agencies`)
  - 전체 에이전시 목록 조회
  - 에이전시 생성 기능
  - 에이전시 삭제 기능 (CASCADE로 연관 클라이언트도 삭제)
- ✅ 클라이언트 관리 페이지 (`/super/clients`)
  - 전체 클라이언트 목록 조회
  - 클라이언트 삭제 기능 (CASCADE로 연관 웨비나도 삭제)
- ✅ RLS 무한 재귀 문제 해결
  - JWT `app_metadata` 기반 권한 확인으로 전환
  - `profiles` 테이블 RLS 정책 단순화
  - Admin Supabase를 통한 서버 측 데이터 조회
- ✅ 삭제 API 구현
  - `/api/super/agencies/[agencyId]` DELETE
  - `/api/super/clients/[clientId]` DELETE
  - 감사 로그 기록
- ✅ 인증 가드 개선 (`lib/auth/guards.ts`)
  - JWT `app_metadata` 기반 슈퍼어드민 확인
  - Fallback 메커니즘 (JWT 갱신 전 호환성)

## [2025-01-XX] 채팅 시스템 안정성 개선
- ✅ 메시지 전송 후 새로고침/초기화 문제 해결
  - 초기 로드는 한 번만 실행 (`initialLoadTimeRef` 추적)
  - Realtime 구독 재연결 시 메시지 유지 (초기 로드 건너뛰기)
  - `webinarId` 변경 감지 및 초기 로드 리셋 (`lastWebinarIdRef` 추적)
  - 304 Not Modified 응답 처리 개선 (에러로 처리하지 않음)
  - Realtime INSERT 이벤트 중복 메시지 방지 (`id`, `client_msg_id` 기반)
- ✅ Realtime 연결 디버깅 개선
  - 채널 subscribe 콜백에서 상세한 에러 정보 로깅 (status, error code, reason, wasClean)
  - 재시도 횟수 및 다음 재시도 지연 시간 로깅
  - 디버깅을 위한 구조화된 로그 출력
- ✅ RLS 정책 및 Supabase 설정 확인
  - messages 테이블 RLS 정책 분석 및 정상 작동 확인
  - Supabase Realtime Publication 설정 확인 (messages 테이블 포함 확인)
  - 관련 뷰(me, my_agencies, my_clients) 정의 확인
- ✅ messages 테이블 RLS 정책 단순화 적용
  - JWT 기반 슈퍼어드민 판정 함수 생성 (`jwt_is_super_admin()`)
  - SELECT 정책: 복잡한 조건 제거, registrations 기반 얇은 ACL로 단순화
  - INSERT 정책: 웨비나 등록 확인 제거 (앞단에서 처리), user_id 확인만
  - UPDATE/DELETE 정책: profiles 테이블 조회 제거, JWT 기반 슈퍼어드민 확인
  - registrations 테이블 복합 인덱스 추가 (webinar_id, user_id)
  - 예상 성능 향상: SELECT 5-10배, INSERT 10-20배, UPDATE/DELETE 50-100배

## [2025-01-XX] Broadcast 중심 아키텍처 전환 완료
- ✅ Phase 1: 채널 전환
  - `BroadcastEnvelope` 타입 정의 (`lib/webinar/realtime.ts`)
  - Chat 컴포넌트에서 `postgres_changes` → `broadcast` 전환
  - 재연결 로직 단순화 (SDK 자동 재연결 활용, 3회 실패 시 채널 제거)
  - RLS 영향 제거로 성능 향상 및 무한 재귀 문제 해소
- ✅ Phase 2: 송신 경로 개선
  - 서버 API에서 Broadcast 전파 구현 (`lib/webinar/broadcast.ts`)
  - 메시지 생성/업데이트/삭제 API에 Broadcast 전파 추가
  - API → DB insert → Broadcast 순서 확정
  - 권한 검증은 API/DB RLS에서 처리
- ✅ Phase 3: 이벤트 타입 확장
  - 퀴즈/설문/추첨 이벤트 타입 정의 (quiz:open, quiz:close, poll:open, poll:close, raffle:draw 등)
  - Forms API에 Broadcast 전파 추가 (상태 변경 시)
  - Giveaways API에 Broadcast 전파 추가 (추첨 실행 시)
  - Chat 컴포넌트에 이벤트 타입별 처리 로직 추가
- ✅ 주요 개선사항
  - RLS 영향 제거: `postgres_changes` → `broadcast`로 전환하여 RLS 무한 재귀 문제 해소
  - 재연결 안정화: SDK 자동 재연결 활용, 3회 실패 시 채널 제거로 무한 루프 방지
  - 성능 향상: Broadcast는 RLS를 거치지 않아 지연 시간 감소
  - 확장성: 단일 채널(`webinar:${webinarId}`)로 모든 이벤트 타입 처리 가능

## [2025-01-XX] 다크모드 텍스트 입력창 가시성 개선
- ✅ 모든 입력 필드에 명시적 배경색 및 텍스트 색상 추가
  - `bg-white text-gray-900` 클래스 추가
  - 다크모드에서도 텍스트 입력창이 명확하게 보이도록 개선
- ✅ 수정된 컴포넌트
  - Chat.tsx (메시지 입력)
  - QA.tsx (질문 입력, 질문 수정, 답변 입력)
  - FormWidget.tsx (설문/퀴즈 답변 입력)
  - WebinarEntry.tsx (게스트/로그인/회원가입 입력)
  - login/page.tsx (로그인 입력)
  - settings/profile/page.tsx (프로필 설정 입력)
  - signup/client/page.tsx (클라이언트 회원가입 입력)

## [2026-02-06] Q&A 모더레이션 중계화면 기능 추가
- ✅ Q&A 모더레이션에 중계화면 기능 추가
  - "새창에서 전체 리스트 보기" 버튼 제거
  - 각 질문 옆에 "중계화면으로 보기" 버튼 추가
  - 중계화면 페이지 생성 (`/webinar/[id]/console/qa/display/[questionId]`)
  - 배경색 #038D7C, 흰 글씨로 질문만 크게 표시 (답변 제외)
  - 질문 텍스트 크기: text-5xl (모바일), text-6xl (데스크톱)
- ✅ 중계화면 성능 최적화
  - postMessage를 사용하여 페이지 리로드 없이 질문 전환
  - 기존 창이 열려있으면 그 창에서 내용만 업데이트
  - 질문 데이터가 이미 로드되어 있으면 즉시 전달
- ✅ 설문 오픈/마감 기능 개선
  - 설문을 오픈-마감-다시 오픈할 때마다 팝업 표시
  - 설문 상태 변경 시 버튼 활성화/비활성화 실시간 반영
  - Broadcast 이벤트 구독으로 즉시 상태 업데이트
- ✅ API 엔드포인트 추가
  - `GET /api/questions/[questionId]` 추가 (질문 단일 조회)
- ✅ 수정된 파일
  - `app/(admin)/webinar/[id]/console/components/QAModeration.tsx`
  - `app/(webinar)/webinar/[id]/console/components/QAModeration.tsx`
  - `app/(admin)/webinar/[id]/console/qa/display/[questionId]/page.tsx`
  - `app/api/questions/[questionId]/route.ts`
  - `app/(webinar)/webinar/[id]/components/WebinarView.tsx`

## [2025-01-XX] 클라이언트별 초대 기능 구현
- ✅ 데이터베이스 마이그레이션 (`029_add_client_id_to_invitations.sql`)
  - `client_invitations` 테이블에 `client_id` 컬럼 추가
  - 클라이언트별 초대 토큰 관리 가능
- ✅ 초대 API 개선 (`/api/clients/invite`)
  - `clientId` 파라미터 추가
  - 클라이언트 소속 검증 로직 추가
  - 초대 생성 시 `client_id` 저장
- ✅ 클라이언트 목록에 초대 버튼 추가
  - 각 클라이언트 행에 "초대" 버튼 추가 (`ClientInviteButton.tsx`)
  - 클라이언트별 초대 링크 생성 및 모달 표시
- ✅ 회원가입 페이지 개선 (`/signup/client`)
  - 초대 토큰으로 클라이언트 정보 조회 API 추가 (`/api/clients/invite-info`)
  - 클라이언트명 자동 입력 및 고정 (수정 불가)
  - `clientNameFixed` 상태로 입력 필드 비활성화
- ✅ 회원가입 처리 로직 개선 (`/api/clients/create-self`)
  - `client_id`가 있는 경우: 기존 클라이언트에 멤버로 추가 (role: 'member')
  - `client_id`가 없는 경우: 새 클라이언트 생성 및 owner 역할 부여
  - 두 가지 시나리오 모두 지원

## [2025-12-16] Next.js 16 업그레이드 및 보안 취약점 해결
- ✅ Next.js 15 → 16 업그레이드
  - Next.js 16.0.10 설치 완료
  - React 18 → 19 업그레이드 (Next.js 16 요구사항)
  - React 19.2.3 설치 완료
- ✅ 관련 패키지 업데이트
  - `@types/react`: ^18 → ^19
  - `@types/react-dom`: ^18 → ^19
  - `eslint-config-next`: ^15.0.0 → ^16.0.0
  - `eslint`: ^8 → ^9 (Next.js 16 요구사항)
- ✅ 보안 취약점 해결
  - Next.js 15.5.0-15.5.7의 critical 취약점 해결 (RCE, Server Actions Source Code Exposure, DoS)
  - glob 패키지의 high 취약점 해결 (Command injection)
  - 모든 취약점 해결 완료 (0 vulnerabilities)
- ✅ 빌드 테스트 완료
  - Next.js 16.0.10 (Turbopack)로 정상 컴파일
  - TypeScript 검증 통과
  - 33개 정적 페이지 생성 완료
- ⚠️ 향후 작업: middleware → proxy 마이그레이션
  - Next.js 16에서 `middleware.ts`가 deprecated됨
  - `proxy.ts`로 마이그레이션 필요 (향후 Next.js 17+ 호환성)
  - 현재는 경고만 표시되며 기능은 정상 동작

## [2025-01-XX] 짧은 링크 리다이렉트 문제 해결
- ✅ 상세 로깅 추가 (`app/s/[code]/page.tsx`)
  - 각 단계별 상세 로그 추가 ([ShortLink] 태그)
  - 짧은 링크 조회 시작/성공/실패 로깅
  - 웨비나 조회 시작/성공/실패 로깅
  - 최종 slug 결정 및 리다이렉트 URL 생성 로깅
  - 예외 발생 시 상세 정보 로깅 (error, message, stack)
  - 디버깅을 위한 단계별 추적 가능
- ✅ 한글 slug 문제로 인한 임시 UUID 리다이렉트 적용
  - 한글 slug 리다이렉트 문제 해결 전까지 UUID 사용
  - 원래 UUID 링크: `/webinar/7d4ad9e9-2f69-49db-87a9-8d25cb82edee`
  - 예: `https://eventflow.kr/s/903514?email=ad@ustudio.co.kr` → UUID 링크로 리다이렉트
  - 한글 slug 문제 해결 후 다시 slug로 변경 예정
- ⚠️ 알려진 이슈
  - 한글 slug를 포함한 URL 리다이렉트 시 문제 발생 가능
  - Next.js `redirect()` 함수가 한글 slug를 제대로 처리하지 못할 수 있음
  - 임시 해결책: UUID로 리다이렉트하여 정상 작동 확인

## [2025-01-XX] 웨비나 슬러그 지원 구현
- ✅ 데이터베이스 마이그레이션 (`032_add_slug_to_webinars.sql`)
  - `webinars` 테이블에 `slug` 필드 추가 (unique, nullable)
  - slug 자동 생성 함수 (`generate_slug_from_title`) 구현
  - 기존 웨비나에 slug 자동 생성 (제목 기반)
  - slug 인덱스 추가 (조회 성능 향상)
- ✅ UUID와 slug 모두 지원하는 라우팅 로직
  - `lib/utils/webinar.ts`에 UUID 판별 유틸리티 함수 추가
  - `/webinar/[id]` 경로에서 UUID/slug 자동 판별
  - 모든 웨비나 관련 페이지에서 slug 지원 (입장, 라이브, 콘솔)
- ✅ 웨비나 생성 API 개선
  - 웨비나 생성 시 slug 자동 생성
  - 중복 체크 및 충돌 처리 로직 추가
- ✅ 이메일 템플릿 개선
  - 등록 확인 이메일에서 slug 주소 사용
  - 예: `https://eventflow.kr/webinar/인간지능x인공지능-토크쇼-2025년-ai-결산/live?email=...`
- ✅ 짧은 링크 개선 (`/s/[code]`)
  - 짧은 링크를 통해 접속 시 UUID로 리다이렉트 (임시, 한글 slug 문제 해결 전까지)
  - URL 파라미터(이메일 등) 유지하면서 리다이렉트
  - 예: `https://eventflow.kr/s/903514?email=ad@ustudio.co.kr` → UUID 주소로 리다이렉트
  - 한글 slug 문제 해결 후 다시 slug로 변경 예정
- ✅ 주요 개선사항
  - 웨비나 접속 주소를 UUID 대신 읽기 쉬운 slug로 사용 가능
  - 기존 UUID 주소도 계속 지원 (하위 호환성 유지)
  - 이메일 회신 및 짧은 링크에서도 slug 주소 사용

## [2025-01-XX] 웨비나 등록 시스템 개선 및 이메일 인증 정책 구현
- ✅ 웨비나 등록 용어 변경
  - "회원가입" → "웨비나 등록"으로 UI 텍스트 변경
  - "이 웨비나에 등록" → "웨비나 등록"으로 간소화
  - 버튼 텍스트: "웨비나 등록 신청하기" → "웨비나 등록 및 입장하기"
- ✅ 이메일 인증 접근 정책 구현 (email_auth)
  - 데이터베이스 마이그레이션 (`031_create_webinar_allowed_emails.sql`)
    - `webinar_allowed_emails` 테이블 생성
    - 웨비나별 허용 이메일 목록 관리
    - RLS 정책 설정 (웨비나 소유자 관리, 공개 읽기)
  - 웨비나 생성/수정 시 허용 이메일 목록 설정 기능
  - 웨비나 입장 페이지에 "웨비나 입장" / "웨비나 등록" 탭 추가
  - 이메일 인증 탭: 등록된 이메일로 바로 입장 (비밀번호 불필요)
  - 웨비나 등록 탭: 이름, 이메일, 닉네임(선택)으로 등록 신청
  - 등록 신청 후 자동으로 허용 이메일 목록에 추가
- ✅ 개인정보 수집 및 이용 동의 기능
  - 웨비나 등록 폼에 필수 동의 체크박스 추가
  - "개인정보 수집 및 이용" 링크 클릭 시 상세 모달 표시
  - 동의하지 않으면 등록 버튼 비활성화
  - 동의서 내용: 수집 목적, 항목, 보유 기간, 거부 권리 등
- ✅ 이메일 발송 기능 구현
  - nodemailer 패키지 설치
  - 이메일 발송 유틸리티 함수 생성 (`lib/email.ts`)
  - 구글 SMTP 설정 지원 (admin@modoolecture.com)
  - 웨비나 등록 완료 시 자동 이메일 발송
  - 이메일 내용: 웨비나 제목, 입장 링크, 등록 확인 메시지
  - HTML 및 텍스트 형식 이메일 지원
- ✅ 환경 변수 설정 가이드 작성 (`EMAIL_SETUP.md`)
  - SMTP 설정 방법 안내
  - 구글 앱 비밀번호 생성 방법
  - 환경 변수 예시 제공

## [2025-01-XX] 사이드바 개선 및 통계 명세서 작성
- ✅ 운영콘솔 페이지 사이드바 표시 문제 해결
  - `LayoutWrapper.tsx`에서 관리 웨비나 페이지를 명확히 식별하도록 수정
  - 정규식 개선: `/^\/webinar\/([^\/]+)\/(console|registrants|stats)/`로 한글 slug도 매칭
  - 디버깅 로그 추가로 경로 매칭 상태 확인 가능
- ✅ 기능별 통계 구현 명세서 작성 (`docs/feature-statistics-implementation-spec.md`)
  - 8개 기능별 통계 상세 명세 작성 완료
    - 채팅 통계: 메시지 수, 발신자, 시간대별 추이, 최다 발신자
    - Q&A 통계: 질문/답변, 답변 시간, 질문자 분석
    - 폼/퀴즈 통계: 응답률, 정답률, 문항별 분석
    - 추첨 통계: 참여자, 당첨률, 시간대별 분석
    - 파일 통계: 다운로드 수, 인기 파일
    - 등록자 통계: 등록 출처, 역할별 분포
    - 접속 통계: 동시 접속자, 참여 시간
    - 시간대별 통계: 통합 타임라인, 상관관계 분석
  - 각 기능별 SQL 쿼리 예시, API 엔드포인트 설계, UI 컴포넌트 구조 포함
  - 구현 우선순위 3단계로 구분 (Phase 1-3)
  - 데이터베이스 최적화, 성능 고려사항, 보안 고려사항 포함

## [2025-01-XX] 사이드바 및 레이아웃 개선 완료
- ✅ 사이드바 접기 기능 완전 제거
  - 접기/펼치기 버튼 제거 (항상 펼쳐진 상태 유지)
  - SidebarContext에서 isCollapsed 항상 false로 고정
  - sidebarWidth 항상 256px로 고정
  - SidebarTree에서 접힘 상태 관련 코드 모두 제거
- ✅ 운영콘솔 레이아웃 개선
  - 사이드바와 콘텐츠 사이 회색 공간 제거
  - LayoutWrapper에서 main 태그 너비를 `calc(100vw - ${sidebarWidth}px)`로 계산
  - 콘텐츠 가운데 정렬 개선 (`max-w-7xl mx-auto` 정상 작동)
  - 배경색을 LayoutWrapper의 main 태그로 이동하여 일관성 유지
- ✅ 중복 레이아웃 래핑 제거
  - `app/(admin)/layout.tsx`에서 중복 LayoutWrapper 제거
  - `app/layout.tsx`에서만 LayoutWrapper 사용하도록 정리
- ✅ 대시보드와 운영콘솔 레이아웃 일관성 유지
  - 동일한 패딩 및 최대 너비 설정 (`p-8`, `max-w-7xl mx-auto`)
  - 사이드바 너비에 맞춘 콘텐츠 영역 자동 조정

## [2025-01-XX] 설문조사 캠페인 모듈 구현 완료
- ✅ 설문조사 캠페인 데이터베이스 스키마 (`034_create_event_survey_campaigns.sql`)
  - `event_survey_campaigns` 테이블 (캠페인 정보)
  - `event_survey_entries` 테이블 (참여자 기록)
  - `survey_no` 발급 시스템 (순차 번호)
  - `code6` 6자리 확인 코드 시스템
  - RLS 정책 및 트리거 설정
- ✅ 설문조사 캠페인 API (`/api/event-survey/campaigns/*`)
  - 캠페인 생성 (`POST /create`)
  - 캠페인 목록 조회 (`GET /list`)
  - 캠페인 상세 조회 (`GET /[campaignId]`)
  - 캠페인 수정 (`PUT /[campaignId]`)
  - 캠페인 삭제 (`DELETE /[campaignId]`)
  - 상태 변경 (`PATCH /[campaignId]`)
  - 샘플 폼 생성 (`POST /[campaignId]/create-sample-form`)
- ✅ 설문조사 공개 페이지 (`/event/[...path]`)
  - 웰컴 페이지 (`/event/{public_path}`)
  - 설문 페이지 (`/event/{public_path}/survey`)
  - 완료 페이지 (`/event/{public_path}/done`)
  - 디스플레이 페이지 (`/event/{public_path}/display`)
  - QR 코드 표시 기능
- ✅ 설문조사 제출 API (`/api/public/event-survey/[campaignId]/submit`)
  - 공개 제출 처리 (인증 불필요)
  - 전화번호 기반 중복 참여 방지
  - `survey_no` 자동 발급
  - `form_submissions` 및 `form_answers` 생성
  - 개인정보 동의 데이터 저장 (`consent_data`)
- ✅ 설문조사 관리 UI
  - 설문조사 생성 페이지 (`/client/[clientId]/surveys/new`)
  - 설문조사 목록 페이지 (`/client/[clientId]/surveys`) - 대시보드로 리다이렉트
  - 설문조사 상세 페이지 (`/client/[clientId]/surveys/[campaignId]`)
  - 운영 콘솔 (개요, 폼 관리, 공개페이지 설정, 참여자 관리, 설정 탭)
- ✅ 통합 대시보드 (`/client/[clientId]/dashboard`)
  - 웨비나와 설문조사를 통합 목록으로 표시
  - 타입별 태그 표시 ("설문 | 웨비나")
  - 통합 메뉴 (공개페이지, 콘솔, 통계, 관리자 접속)
- ✅ 폼 시스템 확장 (`035_modify_forms_for_campaigns.sql`)
  - `forms` 테이블에 `campaign_id` 추가
  - `webinar_id` nullable로 변경
  - 설문조사와 웨비나 모두에서 폼 재사용 가능
- ✅ 공개 설문 제출 지원 (`036_make_form_submissions_nullable_for_public_surveys.sql`)
  - `form_submissions.participant_id` nullable
  - `form_answers.participant_id` nullable
  - 공개 설문에서 인증 없이 제출 가능
- ✅ 개인정보 동의 데이터 저장 (`037_add_consent_data_to_survey_entries.sql`)
  - `event_survey_entries.consent_data` JSONB 필드 추가
  - 동의 항목별 동의 여부 저장
- ✅ 폼 설정 시스템 (`038_add_form_config_for_survey_fields.sql`)
  - `forms.config` JSONB 필드 추가
  - 기본 필드 설정 (회사명, 이름, 전화번호)
  - 개인정보 동의 항목 설정
  - 헤더 이미지 설정
- ✅ 폼 관리 탭 기능
  - 폼 제목/설명 편집
  - 기본 필드 설정 (사용/필수 여부, 라벨)
  - 개인정보 동의 항목 설정 (사용/필수 여부, 제목, 내용)
  - 설문 페이지 미리보기 기능
- ✅ 설문 페이지 미리보기 기능
  - 폼 관리 탭에서 "미리보기" 버튼 클릭 시 설문 페이지 표시
  - 편집 중인 폼 데이터 실시간 반영
  - 미리보기 모드에서 제출 차단
  - "새 탭에서 열기" 기능으로 실제 공개 페이지 확인 가능
- ✅ 권한 확인 개선
  - 샘플 폼 생성 API에 에이전시 멤버십 확인 추가
  - 설문조사 관련 모든 API에 일관된 권한 확인 로직 적용
- ✅ 빌드 오류 수정
  - JSX 구문 오류 수정 (조건부 렌더링 닫는 태그)
  - TypeScript 타입 오류 수정 (SettingsTab)
- ✅ 설문조사 목록 페이지 제거
  - `/client/[clientId]/surveys` 페이지를 대시보드로 리다이렉트
  - 웨비나와 설문조사 통합 관리
- ✅ 설문 빌더 개선 (미리보기 인라인 편집 기능)
  - 미리보기에서 소개 텍스트 인라인 편집 (participationTitle, participationStep1-3, requiredNotice, bottomNotice)
  - 미리보기에서 문항 텍스트 인라인 편집 (선택지 제외)
  - 문항 클릭 시 폼 관리 영역으로 스크롤 및 하이라이트
  - 양방향 동기화 강화 (폼 관리 ↔ 미리보기 실시간 반영)
- ✅ 웰컴 페이지 디자인 개선
  - 헤더 이미지 추가 (HPE 부스 이벤트 이미지, 원본 크기의 50%)
  - 톤앤매너 변경 (purple/pink → blue/cyan/teal)
  - 콘텐츠 영역 너비를 헤더 이미지와 동일하게 맞춤 (50%)
- ✅ 타입 오류 수정
  - `Form` 인터페이스에 `introTexts` 타입 추가
  - `handleStartEdit` 및 `handleSaveEdit`에서 optional 필드 처리 개선
- ✅ 설문 답변 통계 연동 개선
  - `question-stats` API에서 `text_answer` 필드 우선 확인
  - 기존 `answer_value` 필드도 하위 호환성으로 지원
- ✅ 참여자 관리 기능 개선
  - 참여자 클릭 시 설문 답변 상세 모달 표시
  - 문항별 답변 확인 가능 (단일 선택, 다중 선택, 텍스트)
  - `/api/event-survey/campaigns/[campaignId]/entries/[entryId]/answers` API 추가
- ✅ 샘플 데이터 생성 기능 개선
  - `options` 파싱 로직 개선 (JSONB 문자열, 배열, 객체 모두 처리)
  - 선택지 ID 추출 함수 추가
  - 스캔완료/경품 기록 없이 생성 (테스트용)
  - 기존 데이터 삭제 옵션 추가
- ✅ 공개 대시보드 기능 추가
  - 6자리 영문숫자 `dashboard_code` 자동 생성
  - `/event/dashboard/[code]` 경로로 로그인 없이 통계 확인 가능
  - 개요 탭에 공개 대시보드 링크 표시 및 복사 기능
  - `/api/public/event-survey/campaigns/[campaignId]/question-stats` 공개 API 추가
- ✅ 통계 카드 중복 제거
  - 상단의 중복된 통계 카드 제거
  - 하단 "설문 통계" 섹션만 유지

## [2025-01-XX] 모바일 최적화 및 UI 개선
- ✅ 운영자 대시보드 모바일 최적화
  - 슈퍼 관리자, 클라이언트, 에이전시 대시보드 모바일 최적화
  - 반응형 패딩/마진 (`p-4 sm:p-6 md:p-8`)
  - 반응형 텍스트 크기 (`text-2xl sm:text-3xl md:text-4xl`)
  - 헤더 레이아웃 모바일에서 세로 배치 (`flex-col md:flex-row`)
  - 액션 버튼 그룹 모바일에서 세로 배치 (`flex-col md:flex-row`)
  - 통계 카드 그리드 레이아웃 (`grid-cols-1 sm:grid-cols-2 md:grid-cols-3`)
  - UnifiedListItem 모바일 최적화 (Kebab 메뉴 + Bottom Sheet)
  - 모든 버튼 최소 터치 타겟 44x44px 확보
- ✅ LayoutWrapper 모바일 최적화
  - 모바일에서 사이드바 공간 완전 제거 (`ml-0 lg:ml-64`)
  - iOS safe-area 대응 (`pb-[calc(4rem+env(safe-area-inset-bottom))]`)
  - 가로 스크롤 방지 (`min-w-0`)
- ✅ 하단 메뉴 개선
  - 홈, 클라이언트 관리, 로그아웃 3개 메뉴로 통일
  - 아이콘만 표시 (텍스트 제거)
  - 역할에 따라 적절한 경로로 동적 이동
  - iOS safe-area 대응
- ✅ 콘솔 관리 페이지 모바일 최적화
  - 헤더 레이아웃 모바일에서 세로 배치
  - 반응형 텍스트 크기 및 패딩
  - 버튼 터치 타겟 최적화
- ✅ 탭 메뉴 아이콘화
  - 개요, 폼 관리, 공개페이지 설정, 참여자 관리, 설정 탭 아이콘만 표시
  - 공개페이지 설정 아이콘 변경 (⚙️ → 🌐)
  - 툴팁으로 설명 제공
- ✅ 폼 관리 탭 버튼 아이콘화
  - 편집 모드, 새 탭에서 열기, 미리보기 닫기 버튼 아이콘만 표시
  - 모바일 최적화 적용

## [2025-01-XX] AI 분석 보고서 고도화 파이프라인 구현 완료
- ✅ 두 단계 파이프라인 구조 구현 (`ai보고서고도화.md` 명세서 기반)
  - Analysis Pack (ap-1.0): 서버에서 생성하는 결정론적 데이터 구조
  - Decision Pack (dp-1.0): LLM이 생성하는 의사결정 지원 보고서
- ✅ Analysis Pack 생성 함수 구현 (`lib/surveys/analysis/buildAnalysisPack.ts`)
  - 캠페인, 문항, 응답, 답변 데이터 조회
  - 문항별 통계 계산 (분포, topChoices)
  - 교차표 생성 및 하이라이트 추출
  - Evidence Catalog 생성 (E1~En ID 체계)
  - 리드 신호 생성 (조건부: timeframe + followup_intent 필요)
  - 데이터 품질 평가
  - Highlights 생성 (교차표 Evidence 우선 매칭)
- ✅ Decision Pack 생성 함수 구현 (`lib/surveys/analysis/generateDecisionPack.ts`)
  - Gemini API 호출 (JSON mode 사용)
  - JSON 파싱 안정화 (코드블록 + raw JSON 모두 처리)
  - Zod 스키마 검증
  - 재시도 로직 (최대 2회)
  - Linter 품질 검증 통합
- ✅ Decision Pack 스키마 정의 (`lib/surveys/analysis/decisionPackSchema.ts`)
  - Decision Cards (의사결정 지원 카드)
  - Action Board (시간대별 실행 계획: d0/d7/d14)
  - Playbooks (세일즈/마케팅 플레이북)
  - Survey Next Questions (설문 개선 제안)
- ✅ Linter 구현 (`lib/surveys/analysis/lintDecisionPack.ts`)
  - Decision Cards 검증 (evidenceIds, recommendation, confidence)
  - Action Board 검증 (targetCount, KPI, steps)
  - Playbooks 검증
  - Survey Next Questions 검증
  - 플레이스홀더 감지
- ✅ 병합 및 렌더링 함수 구현
  - `mergeAnalysisAndDecisionPack.ts`: Analysis Pack + Decision Pack 병합
  - `renderFinalReportMD.ts`: 최종 보고서 Markdown 렌더링
  - `renderAnalysisPackMD.ts`: Analysis Pack만 렌더링 (폴백용)
- ✅ 데이터베이스 마이그레이션 (`043_add_analysis_decision_pack_to_reports.sql`)
  - `survey_analysis_reports` 테이블에 `analysis_pack`, `decision_pack` JSONB 컬럼 추가
  - GIN 인덱스 추가 (쿼리 최적화)
- ✅ API 라우트 업데이트 (`app/api/event-survey/campaigns/[campaignId]/analysis/generate/route.ts`)
  - 새 파이프라인 통합 (`useNewPipeline = true` 기본값)
  - Decision Pack 실패 시 Analysis Pack만 저장하는 폴백 메커니즘
  - 상세 에러 로깅 및 구체적인 에러 코드 제공
  - `useNewPipeline` 값 로깅 추가 (디버깅용)
- ✅ UI 컴포넌트 업데이트 (`AnalysisReportSection.tsx`)
  - 도넛 차트 새 파이프라인 지원 (`analysis_pack.questions.topChoices` 사용)
  - Decision Pack 렌더링 지원 (`decision_pack` 또는 `action_pack` 모두 지원)
  - 기존 파이프라인과 호환성 유지
- ✅ 패치 적용 (`패치.md` 기반)
  - LeadQueue 조건부 생성 (timeframe + followup_intent 필요)
  - Highlights evidenceIds 교차표 우선 매칭 (E4~E6 우선 연결)
  - 셀 표본 수 기반 신뢰도 자동 조정 (5 미만 → Hypothesis, 10 미만 → Directional)
  - 하드코딩된 fallback 제거 (실제 존재하는 Evidence만 사용)
- ✅ 빌드 오류 수정
  - 템플릿 리터럴 내부 삼항 연산자 변수 분리
  - JSX 주석 위치 수정
  - Decision Cards options 렌더링 빈 줄 문제 수정

## [2026-01-06] 설문조사 AI 분석 시스템 구현 명세서 v1.0 구현 완료
- ✅ DB 마이그레이션 (`047_add_analysis_role_override_to_form_questions.sql`)
  - `form_questions` 테이블에 `analysis_role_override` 컬럼 추가
  - 역할 수동 지정 지원 (timeframe/project_type/followup_intent/other)
  - 인덱스 및 체크 제약조건 포함
- ✅ Utils 모듈 생성 (`lib/surveys/analysis/utils/`)
  - `normalizeQuestions.ts`: options 파싱/정규화 (문자열 JSON, JSONB, 배열, 객체 지원)
  - `normalizeAnswers.ts`: choice_ids/text_answer 정규화
  - `statsMath.ts`: 안전한 통계 계산 (백분율, lift, chi-square, Cramér's V 등)
- ✅ Role 추정 모듈 생성 (`lib/surveys/analysis/roleInference.ts`)
  - Heuristic 규칙 기반 자동 추정 (키워드 매칭)
  - `analysis_role_override` 컬럼 기반 수동 override 지원
  - 역할 소스 추적 (override/heuristic/unknown)
- ✅ 교차표 선택 모듈 생성 (`lib/surveys/analysis/crosstabSelection.ts`)
  - 분석 가치 점수 계산 (lift, chi-square 기반)
  - 역할 기반 우선순위 부여
  - 향후 확장 가능한 구조
- ✅ `buildAnalysisPack.ts` 개선
  - 정규화 모듈 통합 (normalizeQuestions, normalizeAnswers)
  - Role 추정 모듈 통합 (roleInference)
  - 안전한 통계 계산 사용 (statsMath)
  - 텍스트 답변 샘플링 추가 (최대 50개, 프롬프트에는 10개)
  - `analysis_role_override` 컬럼 조회 및 적용
- ✅ `buildComputedMetrics.ts` 개선
  - 교차표 선택 전략 확장 준비 (useExtendedSelection 파라미터 추가)
- ✅ `generateDecisionPack.ts` 개선
  - 텍스트 답변 샘플링 반영 (프롬프트에 최대 10개만 포함)
- ✅ `mergeAnalysisAndDecisionPack.ts` 검증
  - 숫자 교정 로직 이미 구현됨 (검증 완료)
- ✅ API 엔드포인트 추가 (`GET /api/event-survey/campaigns/[campaignId]/analysis/latest`)
  - 최신 리포트 조회 API
  - lens 파라미터 지원 (general/sales/marketing)
  - 권한 확인 포함
- ✅ 주요 개선 사항
  - 문항 동적 처리 강화: options 파싱 안정화, 답변 정규화
  - Role 추정 개선: 수동 override 지원으로 정확도 향상
  - 성능 최적화: 텍스트 답변 샘플링으로 프롬프트 토큰 절감
  - 확장성: 교차표 선택 전략 확장 준비, 모듈화로 유지보수성 향상
- ✅ 구현 명세서 문서화
  - `docs/설문조사_AI_분석_시스템_구현명세서.md` 작성 완료
  - `docs/설문조사_AI_분석_시스템_명세서.md` 업데이트 (현재 구현과 향후 계획 분리)

## [2025-01-XX] QR 체크인 팝업 스캔 모드 구현 완료
- ✅ QR 체크인 팝업 스캔 모드 구현 (`app/event/dashboard/[code]/PublicDashboardClient.tsx`)
  - "스캔받기" 버튼 추가 (QR 체크인 탭)
  - 버튼 클릭 시 모달 팝업 열림
  - 팝업에 "스캔 대기 중입니다..." 안내 메시지 표시
  - 입력 필드에 자동 포커스 및 자동 스캔 기능
- ✅ 자동 스캔 로직 구현
  - QR 코드 입력 완료 감지 (500ms debounce)
  - 입력이 멈추면 자동으로 스캔 처리
  - Enter 키나 버튼 클릭 없이도 작동
- ✅ 사용자 경험 개선
  - 스캔 성공/실패 메시지 표시
  - 성공 후 2초 뒤 다음 스캔 대기 (입력 필드 자동 포커스)
  - ESC 키로 팝업 닫기
  - 연속 스캔 가능
- ✅ 주요 기능
  - QR 스캐너가 키보드 입력(HID) 방식으로 작동 시 자동 인식
  - 팝업이 열려있고 입력 필드에 포커스가 있을 때 스캔만으로 자동 처리
  - 스캔 결과 즉시 표시 및 체크인 목록 자동 새로고침

## [2026-01-06] 공개 대시보드 및 운영콘솔 참여자 관리 기능 개선
- ✅ 공개 대시보드 통계 새로고침 기능 추가
  - `/api/public/event-survey/campaigns/[campaignId]/stats` API 엔드포인트 추가
  - 공개 대시보드에 "새로고침" 버튼 추가 (통계 탭)
  - 새로고침 중 로딩 애니메이션 및 버튼 비활성화 처리
- ✅ 공개 대시보드 수동 관리 탭 추가
  - "QR 체크인" 탭 옆에 "수동 관리" 탭 추가
  - 완료번호, 확인코드, 이름, 회사명, 완료일시, 전화번호 뒷자리 4자리 표시
  - 경품 관리: 우산/워시백 라디오 버튼으로 선택 가능
  - 저장 중 상태 표시 (레이아웃 시프트 방지)
  - `/api/public/event-survey/campaigns/[campaignId]/entries` API 엔드포인트 추가
  - `/api/public/event-survey/campaigns/[campaignId]/entries/[entryId]/prize` API 엔드포인트 추가
- ✅ 운영콘솔 참여자 관리 탭 개선
  - 경품 관리 기능 추가 (우산/워시백 라디오 버튼, X 버튼 초기화)
  - 새로고침 버튼 추가
  - Optimistic UI 업데이트 적용 (즉시 반영 후 서버 동기화)
- ✅ 개인정보 보호 강화
  - 공개 대시보드에서 전화번호 뒷자리 4자리만 노출
  - `phone_norm` 필드 활용하여 마스킹 처리
- ✅ 사용자 경험 개선
  - 경품 저장 시 Optimistic Update로 즉시 UI 반영
  - 저장 중 상태 표시로 피드백 제공
  - 공개 대시보드에서는 경품 초기화 X 버튼 제거 (선택만 가능)
  - 운영콘솔에서는 경품 초기화 X 버튼 유지 (관리자 전용)

## [2025-01-XX] 웨비나 콘솔 설문 결과 보기 기능 수정
- ✅ 설문 결과 조회 API 권한 확인 로직 개선
  - `app/api/webinars/[webinarId]/forms/[formId]/results/route.ts` 수정
  - 웨비나 조회 시 `getWebinarQuery` 사용하여 UUID/slug 모두 지원
  - 폼의 `client_id`가 없을 경우 웨비나의 `client_id`와 `agency_id` 사용
  - 권한 확인 시 웨비나 정보를 기반으로 클라이언트/에이전시 멤버십 확인
- ✅ 설문 문항 options 배열 처리 개선
  - `q.options.forEach is not a function` 오류 해결
  - options가 배열이 아닌 경우 처리 로직 추가:
    - 배열인 경우: 그대로 사용
    - 문자열인 경우: JSON 파싱 시도
    - 객체인 경우: 단일 옵션 객체 또는 키-값 쌍을 배열로 변환
  - 안전한 파싱 및 빈 배열 처리로 오류 방지

## [2025-01-27] 홈페이지 및 개인정보처리방침 페이지 구현
- ✅ 홈페이지 B2B 플랫폼 안내로 변경
  - 웨비나 리스트 섹션 제거
  - B2B 관리 플랫폼 안내 섹션 추가 (기업 전용 플랫폼, 다중 워크스페이스, 보안 및 권한 관리)
  - Hero 섹션에 B2B 이벤트 관리 강조
  - 서버 컴포넌트로 변경하여 성능 개선
- ✅ 개인정보처리방침 페이지 생성
  - `app/privacy/page.tsx`: 개인정보처리방침 페이지 구현
  - 주식회사 유스튜디오 (U-STUDIO CO., LTD.) 운영사 정보 명시
  - 클라이언트 귀속 관련 내용 포함 (이벤트 등록 정보의 클라이언트 귀속)
  - ISO/IEC 27001:2022 인증 정보 포함
  - 10개 조항으로 구성 (처리 목적, 수집 항목, 보유기간, 제3자 제공, 위탁, 파기, 권리 행사, 안전성 확보조치, 보호책임자, 변경사항)
- ✅ 푸터 개선
  - `components/layout/Footer.tsx`: 개인정보처리방침 링크 추가
  - "2025 EventFlow. Operated by U-Studio Inc." 문구로 변경
  - 반응형 레이아웃 적용
- ✅ 레이아웃 설정
  - `components/layout/LayoutWrapper.tsx`: privacy 페이지를 공개 페이지로 설정하여 사이드바 없이 표시
- ✅ 패키지 설치
  - `lucide-react` 패키지 추가 (아이콘 사용)

## [2026-01-25] 웨비나 및 등록 페이지 통합 및 UI 개선
- ✅ 데이터베이스 마이그레이션 (`054_add_email_template_to_webinars.sql`)
  - `webinars` 테이블에 `email_template_text`, `email_thumbnail_url` 컬럼 추가
  - 웨비나 등록 이메일 템플릿 및 썸네일 설정 기능
- ✅ 데이터베이스 마이그레이션 (`055_add_registration_campaign_to_webinars.sql`)
  - `webinars` 테이블에 `registration_campaign_id` 컬럼 추가
  - 웨비나와 등록 페이지 캠페인 연동 지원
  - 웨비나 입장 시 등록 페이지 캠페인의 등록 정보 확인 기능
- ✅ 사이드바 통합 개선
  - `app/api/client/[clientId]/sidebar-data/route.ts`: 웨비나와 설문/등록 캠페인 모두 조회
  - 모든 클라이언트에 대해 웨비나와 캠페인 통합 목록 제공
  - 생성일 기준 정렬로 최신순 표시
- ✅ 사이드바 표시 개선 (`components/layout/SidebarTree.tsx`)
  - 웨비나와 등록 페이지 모두 표시
  - 특정 웨비나/등록 페이지 제목 매핑 (149404 → "0206wert웨비나", /149403 → "AI 특허리서치 실무 활용 웨비나")
  - 타입별 아이콘 구분 (웨비나: 🎥, 설문: 📋, 등록: 📝)
- ✅ 웨비나 라이브 페이지 UI 개선 (`app/(webinar)/webinar/[id]/components/WebinarView.tsx`)
  - 특정 웨비나(149404)에 대한 커스텀 테마 적용
  - 헤더에 로고 표시 (kewert_logo.png), 제목 숨김
  - 전체 페이지 배경 흰색, Pretendard 폰트 적용
  - 세션 소개 섹션: PC에서 4개 카드를 1줄로 가로 배치
  - 세션 카드 클릭 시 모달로 상세 내용 표시
  - 채팅창 테두리 추가
- ✅ YouTube 플레이어 개선 (`components/webinar/YouTubePlayer.tsx`)
  - 자동 재생 기능 (autoplay=true, muted=true)
  - 썸네일 미리보기 표시 개선
- ✅ 접근 정책 확장 (`056_add_name_email_auth_policy.sql`)
  - `name_email_auth` 정책 추가 (이름+이메일 인증)
  - 기존 `email_auth` 정책 유지 (이메일만)
  - 웨비나 입장 페이지에 이름+이메일 입력 폼 추가
- ✅ 접근 정책 텍스트 수정
  - "인증 필요 (로그인 필수)" → "인증필요 (로그인 필수)"
  - 모든 설정 페이지에 일관된 텍스트 적용
- ✅ 운영콘솔 네비게이션 개선
  - 웨비나 운영콘솔: "← 시청 페이지로" → "← 메인 대시보드로"
  - 등록페이지 운영콘솔: "← 설문조사 목록으로" → "← 메인 대시보드로"
  - 클라이언트 메인 대시보드로 통일된 네비게이션
- ✅ 참여자 관리 탭 개선 (`app/(client)/client/[clientId]/surveys/[campaignId]/components/tabs/ParticipantsTab.tsx`)
  - 이메일 컬럼 추가 (`registration_data.email` 표시)
  - 스캔일시 컬럼 제거 (`verified_at` 제거)
  - 경품 컬럼 제거 (`prize_label` 관련 UI 및 함수 제거)
  - 마지막 로그인 정보 추가 (`last_login_at` 표시)
  - API에서 auth.users 조회하여 마지막 로그인 정보 가져오기
  - 모달에도 이메일 및 마지막 로그인 정보 표시

## [2026-01-25] 149402 웨비나 및 149403 등록 페이지 연동
- ✅ 149402 웨비나에 149403 등록 페이지 스타일 적용
  - `app/(webinar)/webinar/[id]/components/WebinarEntry.tsx`: 149402 전용 UI 추가
  - 149403 등록 페이지 스타일 참고 (registration-hero, registration-form-container 등)
  - 이름+이메일 로그인 폼 적용 (handleNameEmailAuth 사용)
  - Pretendard 폰트 및 WERT 스타일 CSS 추가
- ✅ 149403 등록 페이지와 149402 웨비나 연동
  - `app/event/[...path]/components/WertSummitPage.tsx`: 웨비나 시청 링크를 `/webinar/149402`로 변경
  - `scripts/link-149403-to-149402.ts`: 데이터베이스 연동 스크립트 실행
  - 149402 웨비나의 `registration_campaign_id`를 149403 캠페인으로 설정
- ✅ 149402 웨비나 입장 시 등록 페이지로 리다이렉트
  - `app/(webinar)/webinar/[id]/components/WebinarEntry.tsx`: handleNameEmailAuth, handleEmailAuth 함수 수정
  - 149402인 경우 `/event/149403`으로 리다이렉트, 그 외는 `/webinar/{id}/live`로 이동
- ✅ 149404 웨비나 삭제
  - `scripts/delete-149404-webinar.ts`: 149404 웨비나 및 관련 데이터 삭제 스크립트 실행
- ✅ 빌드 에러 수정
  - `app/(webinar)/webinar/[id]/page.tsx`: is149402 변수 정의 추가
  - 중복 정의된 isSlug149402 변수 제거

## [2026-02-02] `/webinarform/wert` 페이지 빌드 에러 해결
- ✅ Next.js 빌드 에러 해결 (`useSearchParams()` Suspense boundary)
  - `app/webinarform/wert/page.tsx`: 서버 컴포넌트로 변경
    - `WebinarFormWertPageContent` 컴포넌트를 `<Suspense>`로 감싸기
    - `export const dynamic = 'force-dynamic'` 설정 추가
  - `app/webinarform/wert/WebinarFormWertPageContent.tsx`: 새 파일 생성
    - 원본 `page.tsx`의 클라이언트 로직을 분리
    - `"use client"` 지시어 추가
    - `useSearchParams()`, `useState`, `useEffect` 등 클라이언트 훅 사용
  - 빌드 성공 확인 (Vercel 배포 환경에서도 정상 작동)
- ✅ 주요 개선사항
  - Next.js 16의 서버/클라이언트 컴포넌트 분리 원칙 준수
  - `useSearchParams()` 사용 시 Suspense boundary 필수 요구사항 충족
  - 정적 생성 방지 및 동적 렌더링 강제로 빌드 에러 해소

## [2026-01-26] 웨비나 시작 시간 분리 및 참여자 역할 관리 개선
- ✅ 웨비나 시작 시간 분리 기능 구현
  - `supabase/migrations/057_add_webinar_start_time.sql`: `webinar_start_time` 컬럼 추가
  - 캠페인 기간(`start_time`/`end_time`)과 웨비나 시작 시간(`webinar_start_time`) 분리
  - `app/(admin)/webinar/[id]/console/components/SettingsTab.tsx`: 웨비나 시작 설정 UI 추가
  - `app/(webinar)/webinar/[id]/components/WebinarEntry.tsx`: 카운트다운 타이머 구현
  - 웨비나 시작 시간 설정 시 입장 페이지에 날짜 표시 및 실시간 카운트다운
- ✅ 참여자 역할 관리 개선
  - `supabase/migrations/058_add_role_and_registered_via_to_registrations.sql`: `role`, `registered_via` 컬럼 추가
  - `supabase/migrations/059_fix_registrations_role_constraint.sql`: 역할 제약조건 확장 ('관리자', '운영자', '분석가' 추가)
  - `app/api/webinars/[webinarId]/registrants/route.ts`: DB의 `role` 값을 우선 사용하도록 수정
  - `app/(admin)/webinar/[id]/registrants/page.tsx`: DB의 `role` 값을 우선 사용하도록 수정
  - `app/api/webinars/[webinarId]/access/track/route.ts`: `manual` 등록 시 `role`을 '관리자'로 저장
  - `scripts/update-manual-registrations-role.ts`: 기존 `manual` 등록 408개의 `role`을 '관리자'로 일괄 업데이트
- ✅ 참여자 관리 탭 추가
  - `app/(admin)/webinar/[id]/console/components/ParticipantsTab.tsx`: 콘솔에 참여자 관리 탭 추가
  - `app/(webinar)/webinar/[id]/console/components/ParticipantsTab.tsx`: 웨비나 콘솔에도 참여자 관리 탭 추가
  - 역할 매핑에 '관리자', '운영자', '분석가' 추가
- ✅ 데이터 정합성 개선
  - `registration_campaign_id`가 있는 웨비나는 등록 캠페인 데이터를 우선 사용
  - `manual` 등록은 항상 '관리자' 역할로 표시 및 저장
  - DB에 저장된 `role` 값을 우선 사용, 없을 때만 멤버십 기반으로 계산

## [2026-01-26] 웨비나 폼 페이지 레이아웃 개선 (149403 이벤트 페이지)
- ✅ 이벤트 카드 레이아웃 개선 (`app/webinarform/wert/page.tsx`)
  - 두 개의 이벤트 카드를 세로로 배치 (`flex flex-col`)
  - Plus Icon을 두 카드 사이에 절대 위치로 배치 (`absolute top-1/2 left-1/2`)
  - Plus Icon의 원형 배경 제거하고 이미지만 표시 (`w-16 h-16`)
  - 각 이벤트 카드 내부 텍스트와 이미지를 양쪽 끝에 배치 (`justify-between`)
  - 커피 이미지를 "스타벅스 아메리카노 Tall 기프티콘 증정" 박스 내부로 이동
  - 카드 간격 조정 (`gap-6`)

## 남은 작업

### Phase 3 - 웨비나 및 실시간 기능 (대부분 완료)
- ✅ 퀴즈 기능 (출제, 응답, 정답 공개) - 완료
- ✅ 추첨 기능 (실행, 당첨자 알림) - 완료
- ✅ 설문조사 기능 - 완료
- ✅ 발표자료 다운로드 기능 - 완료
- ✅ 게스트 모드 (닉네임만으로 입장) - 완료
- ❌ 웨비나 등록 페이지 (`/webinar/[id]/register`)
- ❌ 초대 링크 처리 (`/invite/[token]`)

### Phase 4 - 이벤트 로직 고도화 & 리포트
- ❌ 퀴즈 정답자 집계 및 통계 (기본 통계는 구현됨)
- ❌ 추첨 재현성 보고 및 통계
- ❌ 참여/체류/행동 리포트 고도화
- ❌ 리포트 자동 발송
