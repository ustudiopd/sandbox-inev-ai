# 현재 작업 상황 (Active Context)

## 서비스 정보
- **서비스 이름**: Inev.ai
- **도메인**: inev.ai

## 1. 현재 집중하고 있는 작업  
- **작업명**: inev.ai 리빌딩 (Phase 0–10)
- **상태**: Phase 4 완료 (온디맨드 시청 세션 추적), Phase 10 완료 (필수 작업), Wert Intelligence 전용 배포 준비
- **최근 작업 (2026-02-09)**:
  - ✅ 워트인텔리전스 관리자 계정 추가 스크립트 수정 (inev 스키마 호환)
    - `scripts/add-wert-admin.ts`: `agency_id` 제거, `profiles`/`agency_members` 테이블 선택적 처리
  - ✅ Wert Intelligence 대시보드 메인 화면 개선
    - 통계 화면 제거 (StatisticsOverview 컴포넌트 제거)
    - 이벤트 목록만 표시하도록 변경
    - 중첩된 Link 컴포넌트 문제 해결 (EventItemActions Client Component로 분리)
  - ✅ 테스트 이벤트 삭제 스크립트 작성 및 실행
    - `scripts/delete-test-events.ts`: 테스트 이벤트 5개 삭제 (149403, 149402, W2, W1, 999888)
  - Phase 0: Supabase inev 연결, Auth/Tenant 문서화 완료 ✅
  - Phase 1~5: 기본 스키마 및 모듈 구현 완료 ✅
  - **Phase 4: 온디맨드 시청 세션 추적 시스템 완료** ✅
    - `event_playback_sessions` 테이블 생성 및 마이그레이션 적용
    - 세션 시작/Heartbeat/종료 API 구현
    - 클라이언트 heartbeat 로직 구현 (재생 상태 추적 포함)
    - Visit과 PlaybackSession 분리 아키텍처 확정
  - Phase 6: Webinar(Live) 모듈 이식 완료 ✅
  - Phase 7: Short Link(/s) 구현 완료 ✅
  - Phase 8: 전용 Supabase 분리 절차 문서화 완료 ✅
  - **Phase 10: 대시보드 및 통계 시스템 완료** ✅
    - 통계 계약서 작성 (`Phase10_통계_계약서.md`)
    - Client Dashboard 수정 (events 기준, 통계 API 연동)
    - Event Dashboard 확장 (모듈별 탭: Overview/Registration/Marketing/Survey/Email/Webinar)
    - 통계 API 구현 (overview, marketing, registration, survey)
    - RLS 보안 적용 완료
    - Wert Intelligence 브랜딩 적용 (로고 대신 클라이언트명 표시)
    - **Phase 10-5: 통계 집계 시스템 구현 완료** ✅
      - `event_stats_daily` 테이블 생성 (일별 집계 데이터 저장)
      - 크론 작업 구현 (`/api/cron/aggregate-event-stats`, 5분마다 실행)
      - 통계 API에 집계 테이블 사용 로직 추가 (성능 최적화)
      - 집계 테이블이 있으면 사용, 없으면 원본 테이블에서 집계하는 fallback 로직
  - **레이아웃 개선**: 전체 사이트 1600px 최대폭 기준 통일 완료 ✅
  - **UI 개선**: 대시보드 UI 개선 및 아이콘 추가 완료 ✅
    - 통계 카드에 아이콘 추가 (lucide-react 사용)
    - 그라데이션 배경 및 호버 효과 추가
    - 탭 네비게이션에 아이콘 추가
    - 버튼 및 액션 요소에 아이콘 추가
- **이전 작업**: 웨비나 추첨 및 통계 기능 개선
- **상태**: ✅ 완료
  - 사용자 지정 방식 추첨에 저장 기능 추가
    - API 엔드포인트에 `manual_winners` 업데이트 기능 추가 (`PUT /api/webinars/[webinarId]/giveaways/[giveawayId]`)
    - 추첨 실행 모달에 저장 버튼 추가 (사용자 지정 방식일 때만 표시)
    - 저장된 당첨자 목록 자동 로드 기능 구현
    - 선택한 당첨자들을 `giveaways.manual_winners` 필드에 저장하여 지속적으로 유지
  - 접속 통계 시작 시간 변경 (1시간 전 → 2시간 전)
    - `StatsTab.tsx`: 그래프 시작 시간을 웨비나 시작 2시간 전으로 변경
    - `DashboardTab.tsx`: 대시보드 접속 통계 시작 시간 변경
    - `app/api/webinars/[webinarId]/stats/access/route.ts`: API 데이터 조회 시작 시간 변경
- **이전 작업**: HPE 온디맨드 플레이어 페이지 태블릿/PC 반응형 최적화 완료
- **상태**: ✅ 완료
  - 온디맨드 플레이어 페이지 레이아웃·발표자 소개·Info Box·미팅 링크 적용
  - 온디맨드 설문조사 인페이지 팝업, 5문항 설문·API·DB(ondemand_survey_responses) 적용
  - 설문 모달 흰 배경, 전체 필수·빨간 별표 처리
  - 태블릿 해상도(768px-1024px) 최적화 완료
    - 히어로 섹션 높이 조정 (md:min-h-[800px], sm:min-h-[750px])
    - 플레이어 양옆 마진 추가 및 홈 버튼/타이틀 정렬
    - 정보박스 내부 요소 정렬 및 위치 계산 개선
    - 996px, 742px 구간 레이아웃 깨짐 문제 해결
  - PC 해상도 최적화 완료
    - 1600px에서 줄어들 때 히어로 섹션과 정보 섹션 동일 타이밍 적용
    - 히어로 섹션과 정보 섹션 명확히 구분 (배경색 분리)
    - PC 버전 HPE 로고 위치 조정 (2xl:top-16)
  - 태블릿 플레이어 페이지들에 동일한 최적화 적용
    - OnDemandPlayerPage.tsx (모든 세션에 적용)
    - OnDemandWatchPage.tsx (세션 목록 페이지)
- **이전 작업**: 이메일 발송 시스템 안정화 및 크론 작업 설정 완료
  - 이메일 발송 시스템의 jsdom ESM 에러 해결 완료 (isomorphic-dompurify → sanitize-html 교체)
  - 가입하지 않은 사용자 로그인 무한루프 방지 완료
  - 크론 작업 마이그레이션 적용 완료 (marketing_stats_daily 테이블 생성)
  - 크론 작업 인증 설정 완료 (CRON_SECRET 생성)
  - 이메일 캠페인 시스템 구현 완료 (Resend 기반, 대시보드, 생성/편집/발송 기능)
- **이전 작업**: 웨비나 프로젝트명 필드 추가 및 OnePredict 페이지 개선 완료
  - 웨비나 콘솔 설정에 프로젝트명 필드 추가 (대시보드 표시용)
  - 웨비나 생성 시 제목이 없으면 프로젝트명을 사용하는 기본 옵션
  - OnePredict 웨비나 페이지 메인 제목 두 줄 표시
  - 이미지 버킷 업로드 및 메타 링크 설정 완료
- **이전 작업**: 사이드바 제거 완료 및 통계 기능 개선 완료
  - 사이드바 기능 완전 제거 (환경 변수 및 관련 코드 제거)
  - 웨비나 통계 페이지에 설문조사 통계 추가 완료
  - 웨비나 대시보드 탭 간소화 완료 (통계 탭과 분리)
  - 설문조사 캠페인 상세 페이지에 통계 탭 추가 완료
  - 프로필 설정 페이지 폼 중첩 오류 수정 완료
  - API 라우트 인증 문제 수정 완료
- **이전 작업**: 공개 대시보드 및 운영콘솔 참여자 관리 기능 개선 완료
  - 공개 대시보드 통계 새로고침 기능 추가 완료
  - 공개 대시보드 수동 관리 탭 추가 완료 (경품 관리 포함)
  - 운영콘솔 참여자 관리 탭 경품 관리 및 새로고침 기능 추가 완료
  - 전화번호 뒷자리 4자리만 노출하는 개인정보 보호 기능 추가 완료
- **이전 작업**: 설문조사 AI 분석 시스템 구현 명세서 v1.0 구현 완료
  - DB 마이그레이션 완료 (analysis_role_override 컬럼 추가)
  - Utils 모듈 생성 완료 (normalizeQuestions, normalizeAnswers, statsMath)
  - Role 추정 모듈 생성 완료 (roleInference)
  - 교차표 선택 모듈 생성 완료 (crosstabSelection)
  - 기존 파일 개선 완료 (buildAnalysisPack, buildComputedMetrics, generateDecisionPack)
  - API 엔드포인트 추가 완료 (GET /analysis/latest)
- **이전 작업**: QR 체크인 팝업 스캔 모드 구현 완료
- **목표**: 
  - 두 단계 파이프라인 구조 구현 (Analysis Pack + Decision Pack)
  - Decision Pack 생성 안정화 (JSON mode, 파싱 개선)
  - 폴백 메커니즘 구현 (Decision Pack 실패 시 Analysis Pack만 저장)
  - Evidence 매칭 정확도 개선 (교차표 우선 연결)
  - 리드 스코어링 조건부 생성 (필요한 문항 있을 때만)
- **상태**: ✅ 고도화 파이프라인 구현 완료 및 안정화 작업 완료
  - Analysis Pack 생성 함수 구현 완료 (buildAnalysisPack.ts)
  - Decision Pack 생성 함수 구현 완료 (generateDecisionPack.ts)
  - JSON 파싱 안정화 완료 (코드블록 + raw JSON 모두 처리)
  - 폴백 메커니즘 구현 완료 (Decision Pack 실패 시 Analysis Pack만 저장)
  - Evidence fallback 수정 완료 (실제 존재하는 Evidence만 사용)
  - LeadQueue 조건부 생성 패치 완료 (timeframe + followup_intent 필요)
  - Highlights 교차표 우선 매칭 패치 완료 (E4~E6 우선 연결)
  - 도넛 차트 새 파이프라인 지원 완료
  - Decision Pack 렌더링 지원 완료
  - 빌드 오류 수정 완료 (템플릿 리터럴, JSX 주석 등)

## 2. 다음 예정 작업  
- **즉시 진행 가능**:
  1. ⏳ Phase 6: Webinar(Live) 모듈 이식 + 중복 로그인 교체
     - 웨비나를 event에 귀속, 핫패스/폴링 정리
     - 중복 로그인: "입장 시 선택 + 다음 갱신에 퇴장" 방식으로 교체
     - DoD: 등록↔라이브 세션 연결 유지, 두 탭 동시 접속 시 "둘 다 튕김" 재현 불가
     - 변경 금지: Entry Gate 정책, 표시이름 규칙, /s → /entry → 버튼 플로우
     - Hotpath Guardrails 준수: 실시간 화면에서 무거운 집계/AI 호출/DB 핫쿼리 금지
- **나중에 점검·적용 (메모)**:
  - **Realtime Authorization 설정**: 채널 `private: true` + 대시보드 Allow public access 끄기 → RLS가 실제 적용됨. 적용 전에 `session_conflict` 참가자 발신을 API 경유로 옮길지 검토. (2026-02-08 기준 기능 구현은 완료, 설정만 보류)
- **우선순위 높음**: 
  1. 설문 빌더 통합 구현 (`docs/설문_빌더_통합_명세서.md` 참조)
     - 드래그 앤 드롭으로 문항 순서 변경
     - 실시간 미리보기 통합 (왼쪽 편집, 오른쪽 미리보기)
     - 문항 추가/수정/삭제 기능 개선
     - 뷰 전환 기능 (데스크톱/모바일)
  2. 기능별 통계 구현 (Phase 1: 기본 통계 강화)
     - Q&A 통계 강화 (답변 시간 분포, 시간대별 질문 통계, 최다 질문자)
     - 채팅 통계 강화 (시간대별 메시지 통계, 최다 발신자, 채팅 참여율)
     - 폼 통계 강화 (문항별 통계, 선택지별 분포 차트)
     - 추첨 통계 강화 (추첨별 상세 통계, 시간대별 참여 통계)
  3. 웨비나 등록 페이지 구현 (`/webinar/[id]/register`)
  4. 초대 링크 처리 (`/invite/[token]`)

- **우선순위 중간**:
  4. 데이터 수집 시스템 구축 (Phase 2)
     - 접속 로그 수집 (5분마다 자동 기록)
     - 다운로드 로그 수집 (`webinar_downloads` 테이블 생성)
  5. Typing 표시 기능 완성
  6. middleware → proxy 마이그레이션 (Next.js 16 호환성)
     - `middleware.ts` → `proxy.ts` 파일명 변경
     - `middleware` 함수 → `proxy` 함수명 변경
     - 현재는 경고만 표시되며 기능 정상 동작
     - 향후 Next.js 17+ 호환성을 위해 마이그레이션 필요

- **우선순위 낮음**:
  7. 고급 통계 및 분석 (Phase 3)
     - 통합 시간대별 통계
     - 상관관계 분석
     - 통계 대시보드 개선
  8. 성능 최적화 추가 작업

## 3. 주요 이슈 및 블로커  
- 현재 개발을 진행하는 데 방해가 되는 요소 없음
- 설문조사 및 발표자료 다운로드 기능에 대한 상세 요구사항 검토 필요

## 4. 최근 해결된 이슈
- ✅ 이메일 발송 시스템 jsdom ESM 에러 해결
  - `isomorphic-dompurify`의 `jsdom` 의존성으로 인한 ESM 로딩 에러 해결
  - `sanitize-html`로 교체하여 CommonJS 호환성 확보
  - Vercel 프로덕션 환경에서 정상 작동 확인 (POST /api/client/emails/{id}/test-send 200 응답)
- ✅ 가입하지 않은 사용자 로그인 무한루프 방지
  - `/api/auth/dashboard`에서 프로필이 없는 경우 명시적 에러 반환
  - 클라이언트에서 `NOT_REGISTERED` 에러 감지 및 처리
  - 로그아웃 후 메인 페이지로 리다이렉트
- ✅ 크론 작업 마이그레이션 적용
  - `marketing_stats_daily` 테이블 생성 마이그레이션 적용 완료
  - CVR 정밀도 수정 마이그레이션 적용 완료
  - `/api/cron/aggregate-marketing-stats` 크론 작업 정상 작동 확인
- ✅ 크론 작업 인증 설정
  - `CRON_SECRET` 환경 변수 생성 및 Vercel 설정 완료
  - `/api/cron/webinar-access-snapshot` 크론 작업 인증 정상 작동 확인
- ✅ `/webinarform/wert` 페이지 빌드 에러 해결
  - `useSearchParams()` Suspense boundary 에러 해결
  - 서버 컴포넌트(`page.tsx`)와 클라이언트 컴포넌트(`WebinarFormWertPageContent.tsx`) 분리
  - `page.tsx`에서 `WebinarFormWertPageContent`를 `<Suspense>`로 감싸기
  - `export const dynamic = 'force-dynamic'` 설정으로 동적 렌더링 강제
  - 빌드 성공 확인 (Next.js 16.0.10)
- ✅ 사이드바 접기 기능 제거 및 레이아웃 개선
  - 사이드바 접기/펼치기 버튼 완전 제거 (항상 펼쳐진 상태 유지)
  - 운영콘솔 레이아웃 개선: 사이드바와 콘텐츠 사이 회색 공간 제거
  - LayoutWrapper에서 main 태그 너비를 `calc(100vw - ${sidebarWidth}px)`로 계산하여 콘텐츠 가운데 정렬
  - 중복 레이아웃 래핑 제거 (`app/(admin)/layout.tsx`에서 중복 LayoutWrapper 제거)
  - 배경색을 LayoutWrapper의 main 태그로 이동하여 일관성 유지
  - 대시보드와 운영콘솔 레이아웃 일관성 유지
- ✅ 운영콘솔 페이지 사이드바 표시 문제 해결 (`components/layout/LayoutWrapper.tsx`)
  - 관리 웨비나 페이지(`/webinar/[id]/console`, `/webinar/[id]/registrants`, `/webinar/[id]/stats`)에서 사이드바가 표시되도록 수정
  - 정규식 개선으로 한글 slug 포함 URL도 정상 매칭 (`/^\/webinar\/([^\/]+)\/(console|registrants|stats)/`)
  - 디버깅 로그 추가 (개발 환경에서 경로 매칭 상태 확인 가능)
- ✅ 기능별 통계 구현 명세서 작성 완료 (`docs/feature-statistics-implementation-spec.md`)
  - 8개 기능별 통계 상세 명세 (채팅, Q&A, 폼/퀴즈, 추첨, 파일, 등록자, 접속, 시간대별)
  - 각 기능별 추적 항목, 데이터 소스, SQL 쿼리 예시, API 설계, UI 컴포넌트 구조 포함
  - 구현 우선순위 3단계로 구분 (Phase 1: 기본 통계 강화, Phase 2: 데이터 수집, Phase 3: 고급 통계)
  - 데이터베이스 최적화, 성능 고려사항, 보안 고려사항 포함
- ✅ 짧은 링크 리다이렉트 로깅 강화 (`app/s/[code]/page.tsx`)
  - 각 단계별 상세 로그 추가 ([ShortLink] 태그)
  - 짧은 링크 조회, 웨비나 조회, 리다이렉트 URL 생성 단계별 로깅
  - 에러 발생 시 상세 정보 로깅 (error, message, stack)
  - 디버깅을 위한 단계별 추적 가능
- ✅ 짧은 링크 임시 UUID 리다이렉트 적용
  - 한글 slug 리다이렉트 문제 해결 전까지 UUID 사용
  - 원래 UUID 링크: `/webinar/7d4ad9e9-2f69-49db-87a9-8d25cb82edee`
  - 한글 slug 문제 해결 후 다시 slug로 변경 예정
- ✅ PresenceBar 중복 사용자 표시 문제 해결 (Map 기반 중복 제거)
- ✅ RLS 무한 재귀 문제 해결 (Admin Supabase 사용)
- ✅ Next.js 15 호환성 문제 해결 (params, cookies await 처리)
- ✅ 4K 모니터 레이아웃 문제 해결
- ✅ 채팅 메시지 "익명" 표시 문제 해결 (프로필 RLS 정책 추가, API 엔드포인트 생성)
- ✅ Supabase Realtime 구독 오류 해결 (Realtime 활성화 마이그레이션 적용)
- ✅ 서버-클라이언트 바인딩 불일치 오류 해결 (고유한 채널 이름 생성)
- ✅ Optimistic Update에서 프로필 이름 즉시 표시 (프로필 정보 사전 로드)
- ✅ 크롬에서 "전송 중..." 고착 문제 해결 (`client_msg_id` 기반 정확한 매칭, API 즉시 교체)
- ✅ Realtime 연결 안정성 향상 (토큰 주입, 폴백 폴링, 자동 재연결)
- ✅ 웨비나 페이지 모바일 레이아웃 문제 해결 (마진 제거, 전체 너비 사용)
- ✅ 관리자 모드 구현 (채팅/질문 관리 기능)
- ✅ Q&A 답변 기능 개선 (답변 내용 저장, 기본 펼침)
- ✅ 답변 모달 닫기 방지 (답변 중일 때)
- ✅ 게스트 계정 세션 설정 문제 해결 (`signInWithPassword` 사용)
- ✅ 메시지 조회 API 인증 오류 해결 (Route Handler 호환성 개선)
- ✅ 웨비나별 등록 확인 강제 (모든 모드에서 등록 확인)
- ✅ 웨비나 시간대 변환 문제 해결 (UTC ↔ 로컬 시간 변환)
- ✅ 설문 폼 로딩 성능 최적화 (병렬 쿼리, 인덱스 추가)
- ✅ 설문 질문 옵션 표시 문제 해결 (options 데이터 타입 처리)
- ✅ `fill_org_fields()` 트리거 오류 해결 (record "w" is not assigned yet)
- ✅ 설문 제출 시 org_fields 누락 문제 해결 (agency_id, client_id 컬럼 추가)
- ✅ 추첨 Seed 커밋-리빌 검증 제거 (바로 추첨 실행)
- ✅ 추첨 당첨자 이름 표시 기능 구현
- ✅ 추첨 실행 애니메이션 구현
- ✅ 메시지 전송 후 새로고침/초기화 문제 해결 (초기 로드 한 번만 실행, Realtime 재연결 시 메시지 유지)
- ✅ Realtime 연결 원인코드 로깅 강화 (채널 subscribe 콜백에서 상세 에러 정보 로깅)
- ✅ RLS 정책 분석 및 확인 (messages 테이블 RLS 정책 정상 작동 확인)
- ✅ Supabase Publication 설정 확인 (messages 테이블이 Realtime Publication에 포함됨 확인)
- ✅ messages 테이블 RLS 정책 단순화 적용 (성능 향상 및 RLS 재귀 방지)
  - JWT 기반 슈퍼어드민 판정 함수 생성 (`jwt_is_super_admin()`)
  - SELECT 정책: registrations 기반 얇은 ACL로 단순화
  - INSERT 정책: user_id 확인만 (등록 확인 제거)
  - UPDATE/DELETE 정책: JWT 기반 슈퍼어드민 확인
  - registrations 테이블 인덱스 추가 (성능 최적화)
- ✅ Realtime 연결 안정성 개선 완료
  - 재연결 로직 개선 (setTimeout cleanup으로 메모리 누수 방지)
  - 기존 채널 정리 개선 (비동기 대기로 중복 구독 방지)
  - Chat 컴포넌트 중복 렌더링 방지 (key prop으로 인스턴스 분리)
  - 채널 참조 관리 개선 (channelRef 사용)
- ✅ Broadcast 중심 아키텍처 전환 완료
  - Phase 1: `postgres_changes` → `broadcast` 전환 (RLS 영향 제거)
  - Phase 2: 서버 API에서 Broadcast 전파 구현 (권한 검증 강화)
  - Phase 3: 이벤트 타입 확장 (quiz, poll, raffle)
  - 재연결 로직 단순화 (SDK 자동 재연결 활용, 3회 실패 시 채널 제거)
  - 단일 채널(`webinar:${webinarId}`)로 모든 이벤트 타입 처리
- ✅ 폴백 폴링 성능 최적화 및 Vercel 프록시 우회
  - 폴백 폴링 지연 시간 대폭 단축 (15초 → 3~5초)
- ✅ Phase 10: 대시보드 및 통계 시스템 완료 (2026-02-09)
  - 통계 계약서 작성 및 확정 (`Phase10_통계_계약서.md`)
  - Client Dashboard 수정: events 기준 KPI 표시, 기간 필터 추가
  - Event Dashboard 확장: 모듈별 탭 구조, 탭 클릭 시에만 API 호출
  - 통계 API 구현: overview, marketing, registration, survey
  - RLS 보안 적용: 모든 통계 API에 `requireClientMember` 적용
  - Wert Intelligence 브랜딩: TopNav 및 inev-admin에서 로고 대신 클라이언트명 표시
  - 레이아웃 개선: 전체 사이트 1600px 최대폭 기준 통일
  - 헬스체크 대기 시간 단축 (10초 → 3초)
  - 폴링 주기 단축 (15초 → 2초)
  - 원본 Supabase URL 직접 사용 (Vercel 프록시 우회)
  - WebSocket 연결 안정화 (CLOSED 상태 반복 문제 해소)
- ✅ Realtime 연결 안정성 근본 개선 (해결책.md 5가지 수정안 적용)
  - A: 수동 종료 플래그로 CLOSED 오인 방지
  - B: currentUser?.id 의존성 제거로 의도치 않은 재구독 방지
  - C: 채널 상태 기준 헬스체크로 조용한 시간대 폴백 방지
  - D: 증분 조회 ETag 제거로 304 오인 방지
  - E: 채널 정리 로직 간소화로 경합 방지
  - "SUBSCRIBED → 바로 CLOSED" 루프 완전 해소
- ✅ 다크모드 텍스트 입력창 가시성 개선
  - 모든 input/textarea 필드에 `bg-white text-gray-900` 클래스 추가
  - 다크모드에서도 텍스트 입력창이 명확하게 보이도록 개선
- ✅ 클라이언트별 초대 기능 구현
  - `client_invitations` 테이블에 `client_id` 컬럼 추가
  - 클라이언트 목록에 각 클라이언트별 초대 버튼 추가
  - 회원가입 페이지에서 클라이언트명 자동 고정 기능
  - 기존 클라이언트에 멤버 추가 또는 새 클라이언트 생성 지원
- ✅ Next.js 16 업그레이드 및 보안 취약점 해결
  - Next.js 16.0.10 업그레이드 완료
  - React 19.2.3 업그레이드 완료
  - ESLint 9 업그레이드 완료
  - Next.js 15의 critical 취약점 해결 (RCE, Server Actions Source Code Exposure, DoS)
  - glob 패키지의 high 취약점 해결 (Command injection)
  - 모든 취약점 해결 완료 (0 vulnerabilities)
  - 빌드 테스트 통과 (33개 정적 페이지 생성 완료)
- ✅ 사용자 지정 방식 추첨 저장 기능 추가
  - 추첨 실행 모달에 저장 버튼 추가 (사용자 지정 방식일 때만 표시)
  - 선택한 당첨자 목록을 `giveaways.manual_winners` 필드에 저장
  - 저장된 데이터는 모달을 다시 열 때 자동으로 로드되어 선택 상태 유지
  - 저장 후에도 모달을 닫지 않고 계속 편집 가능
- ✅ 접속 통계 시작 시간 변경 (1시간 전 → 2시간 전)
  - 웨비나 시작 시간 2시간 전부터 접속 통계 그래프 표시
  - StatsTab, DashboardTab, API 엔드포인트 모두 일관되게 변경

## 5. 현재 시스템 상태
- **데이터베이스**: Supabase PostgreSQL (RLS 활성화)
- **인증**: Supabase Auth
- **실시간**: Supabase Realtime 활성화됨 (messages, questions, forms, form_submissions, giveaways, giveaway_entries, giveaway_winners 테이블)
- **스토리지**: Supabase Storage (발표자료 다운로드에 사용 중)
- **배포**: Vercel (로컬 개발 중)
- **프레임워크**: Next.js 16.0.10 (Turbopack), React 19.2.3
- **통계 시스템**: 기능별 통계 구현 명세서 작성 완료 (`docs/feature-statistics-implementation-spec.md`)
- **최근 마이그레이션**: 
  - `015_create_forms_system.sql` (설문/퀴즈 통합 시스템)
  - `016_create_webinar_files.sql` (발표자료 관리)
  - `017_create_giveaways.sql` (추첨 시스템)
  - `018_add_opened_closed_at_to_forms.sql` (폼 상태 관리)
  - `019_fix_fill_org_fields_for_forms.sql` (트리거 수정)
  - `020_add_org_fields_to_form_tables.sql` (org_fields 추가)
  - `021_optimize_form_loading_indexes.sql` (성능 최적화)
  - `022_create_me_view.sql` (me 뷰 생성)
  - `023_setup_profiles_rls.sql` (profiles RLS 설정)
  - `024_fix_profiles_rls_recursion.sql` (RLS 재귀 문제 해결)
  - `025_simplify_messages_rls.sql` (messages RLS 단순화)
  - `026_create_short_links.sql` (짧은 링크 시스템)
  - `027_add_nickname_to_registrations.sql` (registrations에 nickname 추가)
  - `028_add_nickname_to_profiles.sql` (profiles에 nickname 추가)
  - `029_add_client_id_to_invitations.sql` (client_invitations에 client_id 추가)
  - `031_create_webinar_allowed_emails.sql` (email_auth 정책용 허용 이메일 테이블)
  - `032_add_slug_to_webinars.sql` (웨비나 slug 지원)
  - `034_create_event_survey_campaigns.sql` (설문조사 캠페인 시스템)
  - `035_modify_forms_for_campaigns.sql` (폼 시스템 확장)
  - `036_make_form_submissions_nullable_for_public_surveys.sql` (공개 설문 제출 지원)
  - `037_add_consent_data_to_survey_entries.sql` (개인정보 동의 데이터 저장)
  - `038_add_form_config_for_survey_fields.sql` (폼 설정 시스템)
  - `079_create_marketing_stats_daily.sql` (마케팅 통계 일일 집계 테이블)
  - `080_fix_cvr_precision.sql` (CVR 정밀도 수정)
  - `083_create_email_campaigns.sql` (이메일 캠페인 시스템)
  - `086_create_ondemand_survey_responses.sql` (온디맨드 설문 응답 저장)