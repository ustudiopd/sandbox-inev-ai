-- 성능 개선을 위한 인덱스 추가
-- 배치 조회 및 병렬 쿼리 성능 최적화
-- 주의: 대용량 테이블의 경우 인덱스 생성에 시간이 걸릴 수 있습니다.

-- 성능 개선을 위한 인덱스 추가
-- 배치 조회 및 병렬 쿼리 성능 최적화
-- 
-- 중요: CONCURRENTLY 옵션은 트랜잭션 블록 안에서 실행할 수 없습니다!
-- 아래 명령어를 각각 단독으로 실행하세요.

-- ============================================
-- 1단계: 타임아웃 설정 (먼저 실행)
-- ============================================
SET statement_timeout = '30min';

-- ============================================
-- 2단계: 인덱스 존재 여부 확인 (선택적)
-- ============================================
SELECT indexname 
FROM pg_indexes 
WHERE tablename = 'profiles' 
  AND indexname = 'idx_profiles_email';

-- ============================================
-- 3단계: 인덱스 생성 (단독 실행!)
-- 주의: 이 명령어만 단독으로 실행하세요!
-- ============================================
-- CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_profiles_email 
-- ON public.profiles(email);
